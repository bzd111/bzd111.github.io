<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 5.14.1"/><style data-href="/styles.91d60bbab44133089581.css" data-identity="gatsby-global-css">*,:after,:before{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/*
! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com
*/*,:after,:before{border:0 solid #e5e7eb;box-sizing:border-box}:after,:before{--tw-content:""}:host,html{-webkit-text-size-adjust:100%;font-feature-settings:normal;-webkit-tap-highlight-color:transparent;font-family:ui-sans-serif,system-ui,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;font-variation-settings:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4}body{line-height:inherit}hr{border-top-width:1px;color:inherit;height:0}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}code,kbd,pre,samp{font-feature-settings:normal;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-variation-settings:normal}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{border-collapse:collapse;border-color:inherit;text-indent:0}button,input,optgroup,select,textarea{font-feature-settings:inherit;color:inherit;font-family:inherit;font-size:100%;font-variation-settings:inherit;font-weight:inherit;letter-spacing:inherit;line-height:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0}fieldset,legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:#9ca3af;opacity:1}input::placeholder,textarea::placeholder{color:#9ca3af;opacity:1}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{height:auto;max-width:100%}[hidden]:where(:not([hidden=until-found])){display:none}.prose{color:var(--tw-prose-body);max-width:65ch}.prose :where(p):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:1.25em;margin-top:1.25em}.prose :where([class~=lead]):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-lead);font-size:1.25em;line-height:1.6;margin-bottom:1.2em;margin-top:1.2em}.prose :where(a):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-links);font-weight:500;text-decoration:underline}.prose :where(strong):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-bold);font-weight:600}.prose :where(a strong):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit}.prose :where(blockquote strong):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit}.prose :where(thead th strong):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit}.prose :where(ol):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:decimal;margin-bottom:1.25em;margin-top:1.25em;padding-inline-start:1.625em}.prose :where(ol[type=A]):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:upper-alpha}.prose :where(ol[type=a]):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:lower-alpha}.prose :where(ol[type=A s]):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:upper-alpha}.prose :where(ol[type=a s]):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:lower-alpha}.prose :where(ol[type=I]):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:upper-roman}.prose :where(ol[type=i]):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:lower-roman}.prose :where(ol[type=I s]):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:upper-roman}.prose :where(ol[type=i s]):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:lower-roman}.prose :where(ol[type="1"]):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:decimal}.prose :where(ul):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:disc;margin-bottom:1.25em;margin-top:1.25em;padding-inline-start:1.625em}.prose :where(ol>li):not(:where([class~=not-prose],[class~=not-prose] *))::marker{color:var(--tw-prose-counters);font-weight:400}.prose :where(ul>li):not(:where([class~=not-prose],[class~=not-prose] *))::marker{color:var(--tw-prose-bullets)}.prose :where(dt):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-headings);font-weight:600;margin-top:1.25em}.prose :where(hr):not(:where([class~=not-prose],[class~=not-prose] *)){border-color:var(--tw-prose-hr);border-top-width:1px;margin-bottom:3em;margin-top:3em}.prose :where(blockquote):not(:where([class~=not-prose],[class~=not-prose] *)){border-inline-start-color:var(--tw-prose-quote-borders);border-inline-start-width:.25rem;color:var(--tw-prose-quotes);font-style:italic;font-weight:500;margin-bottom:1.6em;margin-top:1.6em;padding-inline-start:1em;quotes:"\201C""\201D""\2018""\2019"}.prose :where(blockquote p:first-of-type):not(:where([class~=not-prose],[class~=not-prose] *)):before{content:open-quote}.prose :where(blockquote p:last-of-type):not(:where([class~=not-prose],[class~=not-prose] *)):after{content:close-quote}.prose :where(h1):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-headings);font-size:2.25em;font-weight:800;line-height:1.1111111;margin-bottom:.8888889em;margin-top:0}.prose :where(h1 strong):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit;font-weight:900}.prose :where(h2):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-headings);font-size:1.5em;font-weight:700;line-height:1.3333333;margin-bottom:1em;margin-top:2em}.prose :where(h2 strong):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit;font-weight:800}.prose :where(h3):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-headings);font-size:1.25em;font-weight:600;line-height:1.6;margin-bottom:.6em;margin-top:1.6em}.prose :where(h3 strong):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit;font-weight:700}.prose :where(h4):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-headings);font-weight:600;line-height:1.5;margin-bottom:.5em;margin-top:1.5em}.prose :where(h4 strong):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit;font-weight:700}.prose :where(img):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:2em;margin-top:2em}.prose :where(picture):not(:where([class~=not-prose],[class~=not-prose] *)){display:block;margin-bottom:2em;margin-top:2em}.prose :where(video):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:2em;margin-top:2em}.prose :where(kbd):not(:where([class~=not-prose],[class~=not-prose] *)){border-radius:.3125rem;box-shadow:0 0 0 1px rgb(var(--tw-prose-kbd-shadows)/10%),0 3px 0 rgb(var(--tw-prose-kbd-shadows)/10%);color:var(--tw-prose-kbd);font-family:inherit;font-size:.875em;font-weight:500;padding-inline-end:.375em;padding-bottom:.1875em;padding-top:.1875em;padding-inline-start:.375em}.prose :where(code):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-code);font-size:.875em;font-weight:600}.prose :where(code):not(:where([class~=not-prose],[class~=not-prose] *)):before{content:"`"}.prose :where(code):not(:where([class~=not-prose],[class~=not-prose] *)):after{content:"`"}.prose :where(a code):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit}.prose :where(h1 code):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit}.prose :where(h2 code):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit;font-size:.875em}.prose :where(h3 code):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit;font-size:.9em}.prose :where(h4 code):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit}.prose :where(blockquote code):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit}.prose :where(thead th code):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit}.prose :where(pre):not(:where([class~=not-prose],[class~=not-prose] *)){background-color:var(--tw-prose-pre-bg);border-radius:.375rem;color:var(--tw-prose-pre-code);font-size:.875em;font-weight:400;line-height:1.7142857;margin-bottom:1.7142857em;margin-top:1.7142857em;overflow-x:auto;padding-inline-end:1.1428571em;padding-bottom:.8571429em;padding-top:.8571429em;padding-inline-start:1.1428571em}.prose :where(pre code):not(:where([class~=not-prose],[class~=not-prose] *)){background-color:transparent;border-radius:0;border-width:0;color:inherit;font-family:inherit;font-size:inherit;font-weight:inherit;line-height:inherit;padding:0}.prose :where(pre code):not(:where([class~=not-prose],[class~=not-prose] *)):before{content:none}.prose :where(pre code):not(:where([class~=not-prose],[class~=not-prose] *)):after{content:none}.prose :where(table):not(:where([class~=not-prose],[class~=not-prose] *)){font-size:.875em;line-height:1.7142857;margin-bottom:2em;margin-top:2em;table-layout:auto;width:100%}.prose :where(thead):not(:where([class~=not-prose],[class~=not-prose] *)){border-bottom-color:var(--tw-prose-th-borders);border-bottom-width:1px}.prose :where(thead th):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-headings);font-weight:600;padding-inline-end:.5714286em;padding-bottom:.5714286em;padding-inline-start:.5714286em;vertical-align:bottom}.prose :where(tbody tr):not(:where([class~=not-prose],[class~=not-prose] *)){border-bottom-color:var(--tw-prose-td-borders);border-bottom-width:1px}.prose :where(tbody tr:last-child):not(:where([class~=not-prose],[class~=not-prose] *)){border-bottom-width:0}.prose :where(tbody td):not(:where([class~=not-prose],[class~=not-prose] *)){vertical-align:baseline}.prose :where(tfoot):not(:where([class~=not-prose],[class~=not-prose] *)){border-top-color:var(--tw-prose-th-borders);border-top-width:1px}.prose :where(tfoot td):not(:where([class~=not-prose],[class~=not-prose] *)){vertical-align:top}.prose :where(th,td):not(:where([class~=not-prose],[class~=not-prose] *)){text-align:start}.prose :where(figure>*):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:0;margin-top:0}.prose :where(figcaption):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-captions);font-size:.875em;line-height:1.4285714;margin-top:.8571429em}.prose{--tw-prose-body:#374151;--tw-prose-headings:#111827;--tw-prose-lead:#4b5563;--tw-prose-links:#111827;--tw-prose-bold:#111827;--tw-prose-counters:#6b7280;--tw-prose-bullets:#d1d5db;--tw-prose-hr:#e5e7eb;--tw-prose-quotes:#111827;--tw-prose-quote-borders:#e5e7eb;--tw-prose-captions:#6b7280;--tw-prose-kbd:#111827;--tw-prose-kbd-shadows:17 24 39;--tw-prose-code:#111827;--tw-prose-pre-code:#e5e7eb;--tw-prose-pre-bg:#1f2937;--tw-prose-th-borders:#d1d5db;--tw-prose-td-borders:#e5e7eb;--tw-prose-invert-body:#d1d5db;--tw-prose-invert-headings:#fff;--tw-prose-invert-lead:#9ca3af;--tw-prose-invert-links:#fff;--tw-prose-invert-bold:#fff;--tw-prose-invert-counters:#9ca3af;--tw-prose-invert-bullets:#4b5563;--tw-prose-invert-hr:#374151;--tw-prose-invert-quotes:#f3f4f6;--tw-prose-invert-quote-borders:#374151;--tw-prose-invert-captions:#9ca3af;--tw-prose-invert-kbd:#fff;--tw-prose-invert-kbd-shadows:255 255 255;--tw-prose-invert-code:#fff;--tw-prose-invert-pre-code:#d1d5db;--tw-prose-invert-pre-bg:rgba(0,0,0,.5);--tw-prose-invert-th-borders:#4b5563;--tw-prose-invert-td-borders:#374151;font-size:1rem;line-height:1.75}.prose :where(picture>img):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:0;margin-top:0}.prose :where(li):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:.5em;margin-top:.5em}.prose :where(ol>li):not(:where([class~=not-prose],[class~=not-prose] *)){padding-inline-start:.375em}.prose :where(ul>li):not(:where([class~=not-prose],[class~=not-prose] *)){padding-inline-start:.375em}.prose :where(.prose>ul>li p):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:.75em;margin-top:.75em}.prose :where(.prose>ul>li>p:first-child):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:1.25em}.prose :where(.prose>ul>li>p:last-child):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:1.25em}.prose :where(.prose>ol>li>p:first-child):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:1.25em}.prose :where(.prose>ol>li>p:last-child):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:1.25em}.prose :where(ul ul,ul ol,ol ul,ol ol):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:.75em;margin-top:.75em}.prose :where(dl):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:1.25em;margin-top:1.25em}.prose :where(dd):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:.5em;padding-inline-start:1.625em}.prose :where(hr+*):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:0}.prose :where(h2+*):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:0}.prose :where(h3+*):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:0}.prose :where(h4+*):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:0}.prose :where(thead th:first-child):not(:where([class~=not-prose],[class~=not-prose] *)){padding-inline-start:0}.prose :where(thead th:last-child):not(:where([class~=not-prose],[class~=not-prose] *)){padding-inline-end:0}.prose :where(tbody td,tfoot td):not(:where([class~=not-prose],[class~=not-prose] *)){padding-inline-end:.5714286em;padding-bottom:.5714286em;padding-top:.5714286em;padding-inline-start:.5714286em}.prose :where(tbody td:first-child,tfoot td:first-child):not(:where([class~=not-prose],[class~=not-prose] *)){padding-inline-start:0}.prose :where(tbody td:last-child,tfoot td:last-child):not(:where([class~=not-prose],[class~=not-prose] *)){padding-inline-end:0}.prose :where(figure):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:2em;margin-top:2em}.prose :where(.prose>:first-child):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:0}.prose :where(.prose>:last-child):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:0}.prose-lg{font-size:1.125rem;line-height:1.7777778}.prose-lg :where(p):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:1.3333333em;margin-top:1.3333333em}.prose-lg :where([class~=lead]):not(:where([class~=not-prose],[class~=not-prose] *)){font-size:1.2222222em;line-height:1.4545455;margin-bottom:1.0909091em;margin-top:1.0909091em}.prose-lg :where(blockquote):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:1.6666667em;margin-top:1.6666667em;padding-inline-start:1em}.prose-lg :where(h1):not(:where([class~=not-prose],[class~=not-prose] *)){font-size:2.6666667em;line-height:1;margin-bottom:.8333333em;margin-top:0}.prose-lg :where(h2):not(:where([class~=not-prose],[class~=not-prose] *)){font-size:1.6666667em;line-height:1.3333333;margin-bottom:1.0666667em;margin-top:1.8666667em}.prose-lg :where(h3):not(:where([class~=not-prose],[class~=not-prose] *)){font-size:1.3333333em;line-height:1.5;margin-bottom:.6666667em;margin-top:1.6666667em}.prose-lg :where(h4):not(:where([class~=not-prose],[class~=not-prose] *)){line-height:1.5555556;margin-bottom:.4444444em;margin-top:1.7777778em}.prose-lg :where(img):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:1.7777778em;margin-top:1.7777778em}.prose-lg :where(picture):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:1.7777778em;margin-top:1.7777778em}.prose-lg :where(picture>img):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:0;margin-top:0}.prose-lg :where(video):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:1.7777778em;margin-top:1.7777778em}.prose-lg :where(kbd):not(:where([class~=not-prose],[class~=not-prose] *)){border-radius:.3125rem;font-size:.8888889em;padding-inline-end:.4444444em;padding-bottom:.2222222em;padding-top:.2222222em;padding-inline-start:.4444444em}.prose-lg :where(code):not(:where([class~=not-prose],[class~=not-prose] *)){font-size:.8888889em}.prose-lg :where(h2 code):not(:where([class~=not-prose],[class~=not-prose] *)){font-size:.8666667em}.prose-lg :where(h3 code):not(:where([class~=not-prose],[class~=not-prose] *)){font-size:.875em}.prose-lg :where(pre):not(:where([class~=not-prose],[class~=not-prose] *)){border-radius:.375rem;font-size:.8888889em;line-height:1.75;margin-bottom:2em;margin-top:2em;padding-inline-end:1.5em;padding-bottom:1em;padding-top:1em;padding-inline-start:1.5em}.prose-lg :where(ol):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:1.3333333em;margin-top:1.3333333em;padding-inline-start:1.5555556em}.prose-lg :where(ul):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:1.3333333em;margin-top:1.3333333em;padding-inline-start:1.5555556em}.prose-lg :where(li):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:.6666667em;margin-top:.6666667em}.prose-lg :where(ol>li):not(:where([class~=not-prose],[class~=not-prose] *)){padding-inline-start:.4444444em}.prose-lg :where(ul>li):not(:where([class~=not-prose],[class~=not-prose] *)){padding-inline-start:.4444444em}.prose-lg :where(.prose-lg>ul>li p):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:.8888889em;margin-top:.8888889em}.prose-lg :where(.prose-lg>ul>li>p:first-child):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:1.3333333em}.prose-lg :where(.prose-lg>ul>li>p:last-child):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:1.3333333em}.prose-lg :where(.prose-lg>ol>li>p:first-child):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:1.3333333em}.prose-lg :where(.prose-lg>ol>li>p:last-child):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:1.3333333em}.prose-lg :where(ul ul,ul ol,ol ul,ol ol):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:.8888889em;margin-top:.8888889em}.prose-lg :where(dl):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:1.3333333em;margin-top:1.3333333em}.prose-lg :where(dt):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:1.3333333em}.prose-lg :where(dd):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:.6666667em;padding-inline-start:1.5555556em}.prose-lg :where(hr):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:3.1111111em;margin-top:3.1111111em}.prose-lg :where(hr+*):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:0}.prose-lg :where(h2+*):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:0}.prose-lg :where(h3+*):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:0}.prose-lg :where(h4+*):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:0}.prose-lg :where(table):not(:where([class~=not-prose],[class~=not-prose] *)){font-size:.8888889em;line-height:1.5}.prose-lg :where(thead th):not(:where([class~=not-prose],[class~=not-prose] *)){padding-inline-end:.75em;padding-bottom:.75em;padding-inline-start:.75em}.prose-lg :where(thead th:first-child):not(:where([class~=not-prose],[class~=not-prose] *)){padding-inline-start:0}.prose-lg :where(thead th:last-child):not(:where([class~=not-prose],[class~=not-prose] *)){padding-inline-end:0}.prose-lg :where(tbody td,tfoot td):not(:where([class~=not-prose],[class~=not-prose] *)){padding-inline-end:.75em;padding-bottom:.75em;padding-top:.75em;padding-inline-start:.75em}.prose-lg :where(tbody td:first-child,tfoot td:first-child):not(:where([class~=not-prose],[class~=not-prose] *)){padding-inline-start:0}.prose-lg :where(tbody td:last-child,tfoot td:last-child):not(:where([class~=not-prose],[class~=not-prose] *)){padding-inline-end:0}.prose-lg :where(figure):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:1.7777778em;margin-top:1.7777778em}.prose-lg :where(figure>*):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:0;margin-top:0}.prose-lg :where(figcaption):not(:where([class~=not-prose],[class~=not-prose] *)){font-size:.8888889em;line-height:1.5;margin-top:1em}.prose-lg :where(.prose-lg>:first-child):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:0}.prose-lg :where(.prose-lg>:last-child):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:0}.fixed{position:fixed}.relative{position:relative}.left-4{left:1rem}.top-0{top:0}.top-32{top:8rem}.z-50{z-index:50}.mx-auto{margin-left:auto;margin-right:auto}.mb-2{margin-bottom:.5rem}.mb-3{margin-bottom:.75rem}.mb-4{margin-bottom:1rem}.mb-8{margin-bottom:2rem}.mt-1{margin-top:.25rem}.mt-8{margin-top:2rem}.block{display:block}.inline-block{display:inline-block}.flex{display:flex}.grid{display:grid}.hidden{display:none}.h-12{height:3rem}.w-12{width:3rem}.w-64{width:16rem}.w-full{width:100%}.max-w-4xl{max-width:56rem}.max-w-6xl{max-width:72rem}.max-w-7xl{max-width:80rem}.max-w-none{max-width:none}.scroll-mt-32{scroll-margin-top:8rem}.list-disc{list-style-type:disc}.list-none{list-style-type:none}.grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.items-center{align-items:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-4{gap:1rem}.gap-6{gap:1.5rem}.space-x-4>:not([hidden])~:not([hidden]){--tw-space-x-reverse:0;margin-left:calc(1rem*(1 - var(--tw-space-x-reverse)));margin-right:calc(1rem*var(--tw-space-x-reverse))}.space-x-7>:not([hidden])~:not([hidden]){--tw-space-x-reverse:0;margin-left:calc(1.75rem*(1 - var(--tw-space-x-reverse)));margin-right:calc(1.75rem*var(--tw-space-x-reverse))}.space-y-4>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-bottom:calc(1rem*var(--tw-space-y-reverse));margin-top:calc(1rem*(1 - var(--tw-space-y-reverse)))}.rounded{border-radius:.25rem}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:.5rem}.border{border-width:1px}.border-t{border-top-width:1px}.border-gray-200{--tw-border-opacity:1;border-color:rgb(229 231 235/var(--tw-border-opacity,1))}.bg-blue-600{--tw-bg-opacity:1;background-color:rgb(37 99 235/var(--tw-bg-opacity,1))}.bg-gray-200{--tw-bg-opacity:1;background-color:rgb(229 231 235/var(--tw-bg-opacity,1))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255/var(--tw-bg-opacity,1))}.object-cover{-o-object-fit:cover;object-fit:cover}.p-4{padding:1rem}.p-6{padding:1.5rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-4{padding-left:1rem;padding-right:1rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.py-2{padding-bottom:.5rem;padding-top:.5rem}.py-4{padding-bottom:1rem;padding-top:1rem}.py-8{padding-top:2rem}.pb-8,.py-8{padding-bottom:2rem}.pl-4{padding-left:1rem}.pt-20{padding-top:5rem}.text-left{text-align:left}.text-center{text-align:center}.text-2xl{font-size:1.5rem;line-height:2rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-lg{font-size:1.125rem}.text-lg,.text-xl{line-height:1.75rem}.text-xl{font-size:1.25rem}.font-bold{font-weight:700}.font-medium{font-weight:500}.font-semibold{font-weight:600}.text-blue-600{--tw-text-opacity:1;color:rgb(37 99 235/var(--tw-text-opacity,1))}.text-gray-600{--tw-text-opacity:1;color:rgb(75 85 99/var(--tw-text-opacity,1))}.text-gray-700{--tw-text-opacity:1;color:rgb(55 65 81/var(--tw-text-opacity,1))}.text-gray-800{--tw-text-opacity:1;color:rgb(31 41 55/var(--tw-text-opacity,1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity,1))}.shadow{--tw-shadow:0 1px 3px 0 rgba(0,0,0,.1),0 1px 2px -1px rgba(0,0,0,.1);--tw-shadow-colored:0 1px 3px 0 var(--tw-shadow-color),0 1px 2px -1px var(--tw-shadow-color)}.shadow,.shadow-lg{box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-lg{--tw-shadow:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -4px rgba(0,0,0,.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color),0 4px 6px -4px var(--tw-shadow-color)}.shadow-md{--tw-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -2px rgba(0,0,0,.1);--tw-shadow-colored:0 4px 6px -1px var(--tw-shadow-color),0 2px 4px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.transition-colors{transition-duration:.15s;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1)}.transition-shadow{transition-duration:.15s;transition-property:box-shadow;transition-timing-function:cubic-bezier(.4,0,.2,1)}.duration-300{transition-duration:.3s}.hover\:bg-blue-700:hover{--tw-bg-opacity:1;background-color:rgb(29 78 216/var(--tw-bg-opacity,1))}.hover\:bg-gray-300:hover{--tw-bg-opacity:1;background-color:rgb(209 213 219/var(--tw-bg-opacity,1))}.hover\:text-blue-800:hover{--tw-text-opacity:1;color:rgb(30 64 175/var(--tw-text-opacity,1))}.hover\:text-gray-900:hover{--tw-text-opacity:1;color:rgb(17 24 39/var(--tw-text-opacity,1))}.hover\:shadow-lg:hover{--tw-shadow:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -4px rgba(0,0,0,.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color),0 4px 6px -4px var(--tw-shadow-color)}.hover\:shadow-lg:hover,.hover\:shadow-md:hover{box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.hover\:shadow-md:hover{--tw-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -2px rgba(0,0,0,.1);--tw-shadow-colored:0 4px 6px -1px var(--tw-shadow-color),0 2px 4px -2px var(--tw-shadow-color)}@media (min-width:768px){.md\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.md\:grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}}@media (min-width:1024px){.lg\:block{display:block}.lg\:grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.lg\:grid-cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f8f9fa;border:1px solid #e2e8f0;border-radius:6px;margin:1em 0;padding:1em}code[class*=language-],pre[class*=language-]{color:#24292e;font-family:ui-monospace,SFMono-Regular,SF Mono,Menlo,Consolas,Liberation Mono,monospace;font-size:14px;line-height:1.5;text-shadow:none}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#6a737d}.token.punctuation{color:#24292e}.token.boolean,.token.constant,.token.number,.token.property,.token.symbol,.token.tag{color:#005cc5}.token.attr-name,.token.builtin,.token.char,.token.selector,.token.string{color:#032f62}.language-css .token.string,.style .token.string,.token.atrule,.token.attr-value,.token.entity,.token.keyword,.token.operator,.token.url{color:#d73a49}.token.function{color:#6f42c1}.token.important,.token.regex,.token.variable{color:#e36209}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]{scroll-margin-top:5rem}:root{--border-radius:4px;--color-text:#333;--color-primary:#7026b9;--color-code-bg:#fff4db;--color-code:#8a6534;--font-sans:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji";--font-mono:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;--font-lg:18px;--font-md:16px;--font-sm:14px;--font-sx:12px;--line-height-loose:1.75;--line-height-normal:1.5;--line-height-dense:1.1;--space-1:4px;--space-2:8px;--space-3:16px;--space-4:24px;--space-5:32px;--space-6:64px;--size-content:54rem;--size-gutter:var(--space-5);--size-gap:var(--space-6)}html{-webkit-text-size-adjust:100%;box-sizing:border-box;font:sans-serif;font-size:var(--font-md);line-height:var(--line-height-normal);overflow-y:scroll}body{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;word-wrap:break-word;color:var(--color-text);font-family:sans-serif;font-family:var(--font-sans);font-weight:400;margin:0}a{background-color:transparent;color:var(--color-primary);font-weight:500;text-decoration:none;text-decoration:underline;text-decoration-thickness:1.5px;text-underline-offset:2px}a:active,a:hover{outline-width:0;text-decoration:none}abbr[title]{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help;text-decoration:none}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{letter-spacing:-.01em;line-height:var(--line-height-dense);margin:0 0 3rem;padding:0}h1>b{color:var(--color-primary)}img{border-style:none;max-width:100%}code,kbd,pre,samp{font-family:var(--font-mono);font-size:1em;line-height:inherit}hr{background:rgba(0,0,0,.2);border:none;box-sizing:content-box;height:1px;margin-bottom:calc(var(--space-4) - 1px);margin-left:0;margin-right:0;margin-top:0;overflow:visible;padding:0}*,:after,:before{box-sizing:inherit}dd,dl,fieldset,figure,hgroup,img,ol,p,ul{margin:0;margin-bottom:var(--space-4);padding:0}ol,ul{list-style-image:none;list-style-position:outside;margin-left:var(--space-4)}pre{word-wrap:normal;background:rgba(0,0,0,.04);border-radius:var(--border-radius);font-size:.875rem;line-height:var(--line-height-normal);margin-bottom:var(--space-4);margin-left:0;margin-right:0;margin-top:0;overflow:auto;padding:var(--space-4)}b,dt,strong,th{font-weight:700}li{margin-bottom:calc(var(--space-4)/2)}ol li,ul li{padding-left:0}li>ol,li>ul{margin-bottom:calc(var(--space-4)/2);margin-left:var(--space-4);margin-top:calc(var(--space-4)/2)}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:calc(var(--space-4)/2)}p{max-width:680px}code,kbd,samp{font-size:.875rem}abbr,acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}code,tt{background-color:var(--color-code-bg);border-radius:var(--border-radius);color:var(--color-code);font-family:var(--font-mono);padding-bottom:.25em;padding-top:.25em;word-break:normal}pre code{background:none}code:after,code:before,tt:after,tt:before{content:"\00a0";letter-spacing:-.2em}pre code:after,pre code:before,pre tt:after,pre tt:before{content:none}</style><style type="text/css">
    .toc-anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .toc-anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .toc-anchor svg,
    h2 .toc-anchor svg,
    h3 .toc-anchor svg,
    h4 .toc-anchor svg,
    h5 .toc-anchor svg,
    h6 .toc-anchor svg {
      visibility: hidden;
    }
    h1:hover .toc-anchor svg,
    h2:hover .toc-anchor svg,
    h3:hover .toc-anchor svg,
    h4:hover .toc-anchor svg,
    h5:hover .toc-anchor svg,
    h6:hover .toc-anchor svg,
    h1 .toc-anchor:focus svg,
    h2 .toc-anchor:focus svg,
    h3 .toc-anchor:focus svg,
    h4 .toc-anchor:focus svg,
    h5 .toc-anchor:focus svg,
    h6 .toc-anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><nav class="bg-white shadow-lg fixed w-full top-0 z-50"><div class="max-w-6xl mx-auto px-4"><div class="flex justify-center"><div class="flex space-x-7"><a class="flex items-center py-4 px-2 text-gray-700 hover:text-gray-900" href="/">首页</a><a class="flex items-center py-4 px-2 text-gray-700 hover:text-gray-900" href="/tags/">标签</a><a class="flex items-center py-4 px-2 text-gray-700 hover:text-gray-900" href="/about/">关于</a><a class="flex items-center py-4 px-2 text-gray-700 hover:text-gray-900" href="/links/">友链</a></div></div></div></nav><div class="text-center" style="margin:0 auto;max-width:var(--size-content);padding:var(--size-gutter)"><main class="pt-20"></main></div><div class="max-w-7xl mx-auto px-4 py-8 relative" style="padding-top:6rem;margin-top:-6rem"><div class="max-w-4xl mx-auto" style="scroll-margin-top:6rem"><h1 class="text-4xl font-bold mb-4">gateway api初体验</h1><div class="prose prose-lg max-w-none"><div><h1 id="live-with-gateway-api" style="position:relative;"><a href="#live-with-gateway-api" aria-label="live with gateway api permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Live with Gateway API</h1>
<p>本文是对<a href="https://github.com/BuoyantIO/gateway-api-workshop">分享的记录</a>，全文使用了<a href="https://github.com/BuoyantIO/demosh">demosh演示工具</a>。为了方便记录，我会转换成常用的命令和Yaml。实验介绍了<code class="language-text">linkerd</code> 和 <code class="language-text">istio</code> ，由于时间关系，我只尝试istio的方式。我会使用最新版本的gateway api和istio，进行实验。</p>
<h1 id="准备" style="position:relative;"><a href="#%E5%87%86%E5%A4%87" aria-label="准备 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>准备</h1>
<h2 id="k8s集群" style="position:relative;"><a href="#k8s%E9%9B%86%E7%BE%A4" aria-label="k8s集群 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>k8s集群</h2>
<p>没有的话，使用仓库提供的<a href="https://raw.githubusercontent.com/BuoyantIO/gateway-api-workshop/refs/heads/main/create-cluster.sh">create-cluster.sh</a></p>
<h2 id="安装gateway-api" style="position:relative;"><a href="#%E5%AE%89%E8%A3%85gateway-api" aria-label="安装gateway api permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>安装gateway api</h2>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">kubectl apply <span class="token parameter variable">-f</span> https://github.com/kubernetes-sigs/gateway-api/releases/download/v1.2.1/experimental-install.yaml

customresourcedefinition.apiextensions.k8s.io/backendlbpolicies.gateway.networking.k8s.io created
customresourcedefinition.apiextensions.k8s.io/backendtlspolicies.gateway.networking.k8s.io created
customresourcedefinition.apiextensions.k8s.io/gatewayclasses.gateway.networking.k8s.io created
customresourcedefinition.apiextensions.k8s.io/gateways.gateway.networking.k8s.io created
customresourcedefinition.apiextensions.k8s.io/grpcroutes.gateway.networking.k8s.io created
customresourcedefinition.apiextensions.k8s.io/httproutes.gateway.networking.k8s.io created
customresourcedefinition.apiextensions.k8s.io/referencegrants.gateway.networking.k8s.io created
customresourcedefinition.apiextensions.k8s.io/tcproutes.gateway.networking.k8s.io created
customresourcedefinition.apiextensions.k8s.io/tlsroutes.gateway.networking.k8s.io created
customresourcedefinition.apiextensions.k8s.io/udproutes.gateway.networking.k8s.io created</code></pre></div>
<h2 id="安装isito" style="position:relative;"><a href="#%E5%AE%89%E8%A3%85isito" aria-label="安装isito permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>安装isito</h2>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">-L</span> https://istio.io/downloadIstio <span class="token operator">|</span> <span class="token assign-left variable">ISTIO_VERSION</span><span class="token operator">=</span><span class="token number">1.24</span>.2 <span class="token function">sh</span> - 
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PWD</span>/istio-1.24.2/bin:<span class="token environment constant">$PATH</span>
<span class="token function">which</span> istioctl
istioctl version
istioctl x precheck

istioctl <span class="token function">install</span> <span class="token parameter variable">--set</span> <span class="token assign-left variable">profile</span><span class="token operator">=</span>minimal <span class="token parameter variable">-y</span>
</code></pre></div>
<h2 id="创建gateway" style="position:relative;"><a href="#%E5%88%9B%E5%BB%BAgateway" aria-label="创建gateway permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>创建gateway</h2>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> gateway.networking.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Gateway
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">gatewayClassName</span><span class="token punctuation">:</span> istio
  <span class="token key atrule">listeners</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
      <span class="token key atrule">protocol</span><span class="token punctuation">:</span> HTTP
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">allowedRoutes</span><span class="token punctuation">:</span>
        <span class="token key atrule">namespaces</span><span class="token punctuation">:</span>
          <span class="token key atrule">from</span><span class="token punctuation">:</span> All

❯ k get gateway ingress
NAME      CLASS   ADDRESS      PROGRAMMED   AGE
ingress   istio   172.28.0.2   True         59s          

<span class="token comment"># 查看ip</span>
<span class="token comment"># kubectl get gateway ingress -ojsonpath='{ .status.addresses[0].value }'</span></code></pre></div>
<h2 id="安装测试应用" style="position:relative;"><a href="#%E5%AE%89%E8%A3%85%E6%B5%8B%E8%AF%95%E5%BA%94%E7%94%A8" aria-label="安装测试应用 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>安装测试应用</h2>
<p>原文提供的helm命令，但是拉取不下来。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">helm <span class="token function">install</span> faces <span class="token punctuation">\</span>
     <span class="token parameter variable">-n</span> faces <span class="token punctuation">\</span>
     oci://ghcr.io/buoyantio/faces-chart <span class="token punctuation">\</span>
     <span class="token parameter variable">--version</span> <span class="token number">2.0</span>.0-rc.1 <span class="token punctuation">\</span>
     <span class="token parameter variable">--values</span> faces/values.yaml</code></pre></div>
<p>我找到<a href="https://github.com/BuoyantIO/faces-demo.git">https://github.com/BuoyantIO/faces-demo.git</a> ，研究了一下，生成了一个output.yaml，apply了这个yaml</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">kubectl create namespace faces
     
kubectl label namespace faces istio-injection<span class="token operator">=</span>enabled

kubectl apply <span class="token parameter variable">-f</span> yaml</code></pre></div>
<ul>
<li>
<p>yaml</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token comment"># Source: faces-chart/templates/color.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"color"</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> faces
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">service</span><span class="token punctuation">:</span> <span class="token string">"color"</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> ClusterIP
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">service</span><span class="token punctuation">:</span> <span class="token string">"color"</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> http
<span class="token punctuation">---</span>
<span class="token comment"># Source: faces-chart/templates/color.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"color2"</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> faces
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">service</span><span class="token punctuation">:</span> <span class="token string">"color2"</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> ClusterIP
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">service</span><span class="token punctuation">:</span> <span class="token string">"color2"</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> http
<span class="token punctuation">---</span>
<span class="token comment"># Source: faces-chart/templates/color.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"color3"</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> faces
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">service</span><span class="token punctuation">:</span> <span class="token string">"color3"</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> ClusterIP
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">service</span><span class="token punctuation">:</span> <span class="token string">"color3"</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> http
<span class="token punctuation">---</span>
<span class="token comment"># Source: faces-chart/templates/face.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> face
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> faces
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">service</span><span class="token punctuation">:</span> face
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> ClusterIP
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">service</span><span class="token punctuation">:</span> face
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> http
<span class="token punctuation">---</span>
<span class="token comment"># Source: faces-chart/templates/faces-gui.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> faces<span class="token punctuation">-</span>gui
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> faces
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">service</span><span class="token punctuation">:</span> faces<span class="token punctuation">-</span>gui
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> ClusterIP
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">service</span><span class="token punctuation">:</span> faces<span class="token punctuation">-</span>gui
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> http
<span class="token punctuation">---</span>
<span class="token comment"># Source: faces-chart/templates/smiley.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"smiley"</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> faces
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">service</span><span class="token punctuation">:</span> <span class="token string">"smiley"</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> ClusterIP
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">service</span><span class="token punctuation">:</span> <span class="token string">"smiley"</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> http
<span class="token punctuation">---</span>
<span class="token comment"># Source: faces-chart/templates/smiley.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"smiley2"</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> faces
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">service</span><span class="token punctuation">:</span> <span class="token string">"smiley2"</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> ClusterIP
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">service</span><span class="token punctuation">:</span> <span class="token string">"smiley2"</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> http
<span class="token punctuation">---</span>
<span class="token comment"># Source: faces-chart/templates/smiley.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"smiley3"</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> faces
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">service</span><span class="token punctuation">:</span> <span class="token string">"smiley3"</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> ClusterIP
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">service</span><span class="token punctuation">:</span> <span class="token string">"smiley3"</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> http
<span class="token punctuation">---</span>
<span class="token comment"># Source: faces-chart/templates/color.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"color"</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> faces
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">service</span><span class="token punctuation">:</span> <span class="token string">"color"</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">service</span><span class="token punctuation">:</span> <span class="token string">"color"</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">service</span><span class="token punctuation">:</span> <span class="token string">"color"</span>
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"color"</span>
          <span class="token key atrule">image</span><span class="token punctuation">:</span> 192.168.1.94<span class="token punctuation">:</span>443/demo/faces<span class="token punctuation">-</span>color<span class="token punctuation">:</span>2.0.0
          <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
              <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">8000</span>
          <span class="token key atrule">env</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> FACES_SERVICE
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">"color"</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> USER_HEADER_NAME
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">"X-Faces-User"</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> DELAY_BUCKETS
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">"0,5,10,15,20,50,200,500,1500"</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ERROR_FRACTION
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">""</span>
          <span class="token key atrule">resources</span><span class="token punctuation">:</span>
            <span class="token key atrule">requests</span><span class="token punctuation">:</span>
              <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 100m
              <span class="token key atrule">memory</span><span class="token punctuation">:</span> 64Mi
            <span class="token key atrule">limits</span><span class="token punctuation">:</span>
              <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 250m
              <span class="token key atrule">memory</span><span class="token punctuation">:</span> 128Mi
<span class="token punctuation">---</span>
<span class="token comment"># Source: faces-chart/templates/color.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"color2"</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> faces
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">service</span><span class="token punctuation">:</span> <span class="token string">"color2"</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">service</span><span class="token punctuation">:</span> <span class="token string">"color2"</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">service</span><span class="token punctuation">:</span> <span class="token string">"color2"</span>
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"color2"</span>
          <span class="token key atrule">image</span><span class="token punctuation">:</span> 192.168.1.94<span class="token punctuation">:</span>443/demo/faces<span class="token punctuation">-</span>color<span class="token punctuation">:</span>2.0.0
          <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
              <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">8000</span>
          <span class="token key atrule">env</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> FACES_SERVICE
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">"color"</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> USER_HEADER_NAME
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">"X-Faces-User"</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"COLOR"</span>
              <span class="token key atrule">value</span><span class="token punctuation">:</span> green
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> DELAY_BUCKETS
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">"0,5,10,15,20,50,200,500,1500"</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ERROR_FRACTION
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">""</span>
          <span class="token key atrule">resources</span><span class="token punctuation">:</span>
            <span class="token key atrule">requests</span><span class="token punctuation">:</span>
              <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 100m
              <span class="token key atrule">memory</span><span class="token punctuation">:</span> 64Mi
            <span class="token key atrule">limits</span><span class="token punctuation">:</span>
              <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 250m
              <span class="token key atrule">memory</span><span class="token punctuation">:</span> 128Mi
<span class="token punctuation">---</span>
<span class="token comment"># Source: faces-chart/templates/color.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"color3"</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> faces
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">service</span><span class="token punctuation">:</span> <span class="token string">"color3"</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">service</span><span class="token punctuation">:</span> <span class="token string">"color3"</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">service</span><span class="token punctuation">:</span> <span class="token string">"color3"</span>
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"color3"</span>
          <span class="token key atrule">image</span><span class="token punctuation">:</span> 192.168.1.94<span class="token punctuation">:</span>443/demo/faces<span class="token punctuation">-</span>color<span class="token punctuation">:</span>2.0.0
          <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
              <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">8000</span>
          <span class="token key atrule">env</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> FACES_SERVICE
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">"color"</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> USER_HEADER_NAME
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">"X-Faces-User"</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"COLOR"</span>
              <span class="token key atrule">value</span><span class="token punctuation">:</span> darkblue
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> DELAY_BUCKETS
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">"0,5,10,15,20,50,200,500,1500"</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ERROR_FRACTION
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">""</span>
          <span class="token key atrule">resources</span><span class="token punctuation">:</span>
            <span class="token key atrule">requests</span><span class="token punctuation">:</span>
              <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 100m
              <span class="token key atrule">memory</span><span class="token punctuation">:</span> 64Mi
            <span class="token key atrule">limits</span><span class="token punctuation">:</span>
              <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 250m
              <span class="token key atrule">memory</span><span class="token punctuation">:</span> 128Mi
<span class="token punctuation">---</span>
<span class="token comment"># Source: faces-chart/templates/face.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> face
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> faces
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">service</span><span class="token punctuation">:</span> face
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">service</span><span class="token punctuation">:</span> face
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">service</span><span class="token punctuation">:</span> face
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> face
          <span class="token key atrule">image</span><span class="token punctuation">:</span> 192.168.1.94<span class="token punctuation">:</span>443/demo/faces<span class="token punctuation">-</span>workload<span class="token punctuation">:</span>2.0.0
          <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
              <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">8000</span>
          <span class="token key atrule">env</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> FACES_SERVICE
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">"face"</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> USER_HEADER_NAME
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">"X-Faces-User"</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ERROR_FRACTION
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">""</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> DELAY_BUCKETS
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">""</span>
          <span class="token key atrule">resources</span><span class="token punctuation">:</span>
            <span class="token key atrule">requests</span><span class="token punctuation">:</span>
              <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 300m <span class="token comment"># The face service doesn't need much memory, but it does need more</span>
              <span class="token key atrule">memory</span><span class="token punctuation">:</span> 64Mi <span class="token comment"># CPU than the other backend services since it has to call the</span>
            <span class="token key atrule">limits</span><span class="token punctuation">:</span> <span class="token comment"># face and smiley services, then composite the results.</span>
              <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 500m
              <span class="token key atrule">memory</span><span class="token punctuation">:</span> 128Mi
<span class="token punctuation">---</span>
<span class="token comment"># Source: faces-chart/templates/faces-gui.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> faces<span class="token punctuation">-</span>gui
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> faces
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">service</span><span class="token punctuation">:</span> faces<span class="token punctuation">-</span>gui
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">service</span><span class="token punctuation">:</span> faces<span class="token punctuation">-</span>gui
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">service</span><span class="token punctuation">:</span> faces<span class="token punctuation">-</span>gui
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> faces<span class="token punctuation">-</span>gui
          <span class="token key atrule">image</span><span class="token punctuation">:</span> 192.168.1.94<span class="token punctuation">:</span>443/demo/faces<span class="token punctuation">-</span>gui<span class="token punctuation">:</span>2.0.0
          <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
          <span class="token key atrule">env</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> USER_HEADER_NAME
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">"X-Faces-User"</span>
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
              <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">8000</span>
          <span class="token key atrule">resources</span><span class="token punctuation">:</span>
            <span class="token key atrule">requests</span><span class="token punctuation">:</span>
              <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 50m
              <span class="token key atrule">memory</span><span class="token punctuation">:</span> 64Mi
            <span class="token key atrule">limits</span><span class="token punctuation">:</span>
              <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 100m
              <span class="token key atrule">memory</span><span class="token punctuation">:</span> 128Mi
<span class="token punctuation">---</span>
<span class="token comment"># Source: faces-chart/templates/smiley.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"smiley"</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> faces
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">service</span><span class="token punctuation">:</span> <span class="token string">"smiley"</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">service</span><span class="token punctuation">:</span> <span class="token string">"smiley"</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">service</span><span class="token punctuation">:</span> <span class="token string">"smiley"</span>
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"smiley"</span>
          <span class="token key atrule">image</span><span class="token punctuation">:</span> 192.168.1.94<span class="token punctuation">:</span>443/demo/faces<span class="token punctuation">-</span>workload<span class="token punctuation">:</span>2.0.0
          <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
              <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">8000</span>
          <span class="token key atrule">env</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> FACES_SERVICE
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">"smiley"</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> USER_HEADER_NAME
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">"X-Faces-User"</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> DELAY_BUCKETS
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">"0,5,10,15,20,50,200,500,1500"</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ERROR_FRACTION
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">""</span>
          <span class="token key atrule">resources</span><span class="token punctuation">:</span>
            <span class="token key atrule">requests</span><span class="token punctuation">:</span>
              <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 100m
              <span class="token key atrule">memory</span><span class="token punctuation">:</span> 64Mi
            <span class="token key atrule">limits</span><span class="token punctuation">:</span>
              <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 250m
              <span class="token key atrule">memory</span><span class="token punctuation">:</span> 128Mi
<span class="token punctuation">---</span>
<span class="token comment"># Source: faces-chart/templates/smiley.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"smiley2"</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> faces
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">service</span><span class="token punctuation">:</span> <span class="token string">"smiley2"</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">service</span><span class="token punctuation">:</span> <span class="token string">"smiley2"</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">service</span><span class="token punctuation">:</span> <span class="token string">"smiley2"</span>
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"smiley2"</span>
          <span class="token key atrule">image</span><span class="token punctuation">:</span> 192.168.1.94<span class="token punctuation">:</span>443/demo/faces<span class="token punctuation">-</span>workload<span class="token punctuation">:</span>2.0.0
          <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
              <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">8000</span>
          <span class="token key atrule">env</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> FACES_SERVICE
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">"smiley"</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> USER_HEADER_NAME
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">"X-Faces-User"</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"SMILEY"</span>
              <span class="token key atrule">value</span><span class="token punctuation">:</span> HeartEyes
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> DELAY_BUCKETS
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">"0,5,10,15,20,50,200,500,1500"</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ERROR_FRACTION
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">""</span>
          <span class="token key atrule">resources</span><span class="token punctuation">:</span>
            <span class="token key atrule">requests</span><span class="token punctuation">:</span>
              <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 100m
              <span class="token key atrule">memory</span><span class="token punctuation">:</span> 64Mi
            <span class="token key atrule">limits</span><span class="token punctuation">:</span>
              <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 250m
              <span class="token key atrule">memory</span><span class="token punctuation">:</span> 128Mi
<span class="token punctuation">---</span>
<span class="token comment"># Source: faces-chart/templates/smiley.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"smiley3"</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> faces
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">service</span><span class="token punctuation">:</span> <span class="token string">"smiley3"</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">service</span><span class="token punctuation">:</span> <span class="token string">"smiley3"</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">service</span><span class="token punctuation">:</span> <span class="token string">"smiley3"</span>
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"smiley3"</span>
          <span class="token key atrule">image</span><span class="token punctuation">:</span> 192.168.1.94<span class="token punctuation">:</span>443/demo/faces<span class="token punctuation">-</span>workload<span class="token punctuation">:</span>2.0.0
          <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
              <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">8000</span>
          <span class="token key atrule">env</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> FACES_SERVICE
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">"smiley"</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> USER_HEADER_NAME
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">"X-Faces-User"</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"SMILEY"</span>
              <span class="token key atrule">value</span><span class="token punctuation">:</span> RollingEyes
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> DELAY_BUCKETS
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">"0,5,10,15,20,50,200,500,1500"</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ERROR_FRACTION
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">"50"</span>
          <span class="token key atrule">resources</span><span class="token punctuation">:</span>
            <span class="token key atrule">requests</span><span class="token punctuation">:</span>
              <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 100m
              <span class="token key atrule">memory</span><span class="token punctuation">:</span> 64Mi
            <span class="token key atrule">limits</span><span class="token punctuation">:</span>
              <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 250m
              <span class="token key atrule">memory</span><span class="token punctuation">:</span> 128Mi</code></pre></div>
</li>
</ul>
<h1 id="场景" style="position:relative;"><a href="#%E5%9C%BA%E6%99%AF" aria-label="场景 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>场景</h1>
<h2 id="base" style="position:relative;"><a href="#base" aria-label="base permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>base</h2>
<p>gui-route.yaml</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> gateway.networking.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> HTTPRoute
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> faces<span class="token punctuation">-</span>gui<span class="token punctuation">-</span>route
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> faces
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">parentRefs</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress
      <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">matches</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> PathPrefix
        <span class="token key atrule">value</span><span class="token punctuation">:</span> /gui/
    <span class="token key atrule">backendRefs</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> faces<span class="token punctuation">-</span>gui
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token key atrule">filters</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> URLRewrite
      <span class="token key atrule">urlRewrite</span><span class="token punctuation">:</span>
        <span class="token key atrule">path</span><span class="token punctuation">:</span>
          <span class="token key atrule">type</span><span class="token punctuation">:</span> ReplaceFullPath
          <span class="token key atrule">replaceFullPath</span><span class="token punctuation">:</span> /</code></pre></div>
<p>face-route.yaml</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> gateway.networking.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> HTTPRoute
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> face<span class="token punctuation">-</span>route
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> faces
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">parentRefs</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress
      <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
      <span class="token key atrule">kind</span><span class="token punctuation">:</span> Gateway
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">matches</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> PathPrefix
        <span class="token key atrule">value</span><span class="token punctuation">:</span> /face
    <span class="token key atrule">filters</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> URLRewrite
        <span class="token key atrule">urlRewrite</span><span class="token punctuation">:</span>
          <span class="token key atrule">path</span><span class="token punctuation">:</span>
            <span class="token key atrule">type</span><span class="token punctuation">:</span> ReplacePrefixMatch
            <span class="token key atrule">replacePrefixMatch</span><span class="token punctuation">:</span> /
    <span class="token key atrule">backendRefs</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> face
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span></code></pre></div>
<p><a href="http://localhost/gui">http://localhost/gui</a> 打开浏览器可以看到页面</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/c08ee9ab57fee417a8e8efce026d98d4/7b67d/gateway_api_image.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 66.87116564417178%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACjklEQVR42o2T309SYRzG+f/qptZFa+umbtra8r6bbtpaa7a1pgZKpo78MX+FkSSigB5QQgFBfg05ID8OIIaUIXAOfDocW4XZ5rs977P34n3e5/t8368uEt4jnxWh04Z2g3ZbAUVlpUVHadKRGyhyi7aKVusPZFm+FLpYpkw0W0XMS4TSx4i5ErmaTLnW4Liu8LUJcgfqbXW7wtIthARs4VmMuxHs4QkMuzHW96eZCnqZCa5ji1rZPsywHV0lnZUQxRTValW73On8+4jOYnuFMH+HMWENYeoao24nW7M3mbMbmbc8w2l5SCiWJuleI18okc/nKJVK1Go1DRdFdcZgimFfgKG9Mm+8XgZVHvH5MQQyDPjiGMIHRD0eDkwviMdSmsNUKkU2myWXy6mZt3sFrY5+Aiu3MW4sE7Jex7BhY//zDRbW9ZhtT/G6+ohuuZBmnyMVjsjls5ydnf0/w7e+CHqnC32wyJDdin6viMHpYHgnyaCwi8ETJB53kF57TEpMq+5Etew8yWSSRCJBJpPpKVtn9QwTcD9idMtJ2H2PEc+myg9YcL/no/Aar/cJkYMEUniZglTU8uuiWCwiSRKnp6e9Dk0uGyazHuNOjPHZfpXjTH4YYFzYxGhbwrQyRSgeIew0kTksqCIFLb9CoaBBUZRewSm/A0tgksGdfT7536mNiGD1TzDmExj7soJlfwm7P4HZvKh9m1z2UCu525CucLfTf38h3eLqEI6F+4wILhwztzCozjbm7jK9NsHM8ktWzH1kTprUa98Q06LmqtvlSqVCvV7XpqbHYbUhUzltUGu1Ofp+pnH3fNJUp6TeovKjiaJOidxqatmVy2VN9GJ2vwXPqfMLXMJaPee4wuj9BI4bpjHrVFEEAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/c08ee9ab57fee417a8e8efce026d98d4/a6d36/gateway_api_image.png"
        srcset="/static/c08ee9ab57fee417a8e8efce026d98d4/222b7/gateway_api_image.png 163w,
/static/c08ee9ab57fee417a8e8efce026d98d4/ff46a/gateway_api_image.png 325w,
/static/c08ee9ab57fee417a8e8efce026d98d4/a6d36/gateway_api_image.png 650w,
/static/c08ee9ab57fee417a8e8efce026d98d4/e548f/gateway_api_image.png 975w,
/static/c08ee9ab57fee417a8e8efce026d98d4/3c492/gateway_api_image.png 1300w,
/static/c08ee9ab57fee417a8e8efce026d98d4/7b67d/gateway_api_image.png 2240w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<h2 id="unconditional" style="position:relative;"><a href="#unconditional" aria-label="unconditional permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>unconditional</h2>
<p>smiley-route.yaml</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> gateway.networking.k8s.io/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> HTTPRoute
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> smiley<span class="token punctuation">-</span>route
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> faces
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">parentRefs</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
      <span class="token key atrule">group</span><span class="token punctuation">:</span> <span class="token string">""</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> smiley
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">backendRefs</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> smiley2
          <span class="token key atrule">group</span><span class="token punctuation">:</span> <span class="token string">""</span>
          <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span></code></pre></div>
<p>smiley2服务是微笑的表情</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/e4dc2283b7de833c16210611b509c612/e16b4/gateway_api_image_1.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 52.14723926380368%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAACH0lEQVR42pWSW08aURSF+Y39K23Th75Ya0yTNrFeuBhN08SkfbBVRq6achlGC4gYqxGwBQZmgJGMg7RekIHh6zjUpKRP3cnOeThZ31l77eOSyzIXbZ3RcIB5e4tlmowsi/sa8f/l2lEMguUm0bKKUJSJKW1iDR2x1WFP73L+8xqj2+amP3AE/aFFqV1B6xh0Ly+57fUmgTHhDaHNF2wKS2z7p9iwz53Pz/nod7O/8YT1TJas9xEnjYYjuO6ZFE53+V4+o16rYxgGlj3RYDB+0PXOFsynJLyZPItSCm82z5Ik4s4esrIbJ6t0SEoJtF93juDuxqS65qOSzdFstx2ooijouj4GSuF5vgRnCYe8JIIzhMI+xMA0QmSVQ+Ep2pjDaDRO1DItLoTXaCd5qorK9dXVxL1rNZ1mTkziTud4KyZYSh+wkIyzkM7jSWxz0XcwWA9Ae3mqNEutIKE0zmk2G47DarXKpZ2pay+yQDz0imjEixieJRLxIYVmCERXOdp69q/D4Qi9FEetFGg0NWq1mtOqqjo5ut5nvrKYSrKcyeFOJfDZTj2pGB470xUximFOAs0hiJE1SsVTOraj++zuu9vtjkfeDswh+F/yactN0D/N+paH8OYUHwLLSOuPafYmgbZB9g+POT37QbVSQZZr1Ot1Wq0W/X4f13H5G7lijny5QL705yzuc1ApclTY5cZi4pM/gFua5mQnyzJXfy3mNzkpx2MaauhBAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/e4dc2283b7de833c16210611b509c612/a6d36/gateway_api_image_1.png"
        srcset="/static/e4dc2283b7de833c16210611b509c612/222b7/gateway_api_image_1.png 163w,
/static/e4dc2283b7de833c16210611b509c612/ff46a/gateway_api_image_1.png 325w,
/static/e4dc2283b7de833c16210611b509c612/a6d36/gateway_api_image_1.png 650w,
/static/e4dc2283b7de833c16210611b509c612/e548f/gateway_api_image_1.png 975w,
/static/e4dc2283b7de833c16210611b509c612/3c492/gateway_api_image_1.png 1300w,
/static/e4dc2283b7de833c16210611b509c612/e16b4/gateway_api_image_1.png 2546w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<p>color-route.yaml</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> gateway.networking.k8s.io/v1alpha2
<span class="token key atrule">kind</span><span class="token punctuation">:</span> GRPCRoute
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> color<span class="token punctuation">-</span>route
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> faces
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">parentRefs</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> color
      <span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
      <span class="token key atrule">group</span><span class="token punctuation">:</span> <span class="token string">""</span>
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">backendRefs</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> color2
          <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span></code></pre></div>
<p><code class="language-text">color</code> returns blue, but <code class="language-text">color2</code> returns green</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/1d25548e05a0f6c16094086c172893dd/42267/gateway_api_image_2.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 53.987730061349694%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACQUlEQVR42qWT7UtTURzH/V963YuKKCI1ESwNpXrXc0EPamFFLwoikoJI7YXsQbe7mpsWBctKUhJ1Jmo+VJaJmem8987tzrZ2V2m5B3OfrruzFF9Fh3M4HDjn8/t+f7/fyfBOTROLxlgaycUk/zsy6nvtCJ13sLSbsXYIOPvquD/4kIZBB92TPYTCfj6rPpZDyZEgU1/8xGMJotHoWqC7NpNycxZPzVu4UZPLY9Mmyo3aXr2e6gcluGpycDn28jP9wCON8X6kH1HyIkkisViMeDz+F3hJKOKU/QDnLAWUOA5TVpvHGecxio3ZmNpvMzDcSP9IE4vpB6GudqaaXUzPhJj2evH5fCiKQjKpe8jouZvPLSGf50IuVUIhLcIOqmx7eGLaTIe7SgclF7WpI2f7mlDaGlBCX4mo4bWWL9uKOGHfz3lrAcV1hyiz7KTUeZSThkzquoypSwu/FjQFOjA81ojYZ8M/ozITUPD7/YiiSDAY1IFdtjxuWnfxzJJNhXU3TZbtVGhpcBk20uau1IuxpDBtaVYZxfehR8uhD1mWUjCPx8P8/LwOvGLfx2nHQS7aCil1HOGCUMDZ+uOUmHJwdpv1dlpheXjoJb0vmvn2/QeRiIqqqoTDYRKJhA5sM27lqmEbj6o3cM2QhUurbrkhh3uV62hpvb5GoT+oMjo+qVVYSimTZTll94/CdxOdvBYHGPrkZkga4M14B2/lVwx+bEUKTaQVrm74ubk5AoFAakUikdVF+defsARfGWD5vNw2vwFbqvRDEoUM5gAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/1d25548e05a0f6c16094086c172893dd/a6d36/gateway_api_image_2.png"
        srcset="/static/1d25548e05a0f6c16094086c172893dd/222b7/gateway_api_image_2.png 163w,
/static/1d25548e05a0f6c16094086c172893dd/ff46a/gateway_api_image_2.png 325w,
/static/1d25548e05a0f6c16094086c172893dd/a6d36/gateway_api_image_2.png 650w,
/static/1d25548e05a0f6c16094086c172893dd/e548f/gateway_api_image_2.png 975w,
/static/1d25548e05a0f6c16094086c172893dd/3c492/gateway_api_image_2.png 1300w,
/static/1d25548e05a0f6c16094086c172893dd/42267/gateway_api_image_2.png 2670w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<h2 id="canary" style="position:relative;"><a href="#canary" aria-label="canary permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>canary</h2>
<p>先删除两条路由</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">kubectl delete <span class="token parameter variable">-n</span> faces httproute smiley-route
kubectl delete <span class="token parameter variable">-n</span> faces grpcroute color-route</code></pre></div>
<p>smiley-canary-10.yaml 灰度10%</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> gateway.networking.k8s.io/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> HTTPRoute
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> smiley<span class="token punctuation">-</span>canary
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> faces
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">parentRefs</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> smiley
      <span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
      <span class="token key atrule">group</span><span class="token punctuation">:</span> <span class="token string">""</span>
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">backendRefs</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> smiley
          <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
          <span class="token key atrule">weight</span><span class="token punctuation">:</span> <span class="token number">90</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> smiley2
          <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
          <span class="token key atrule">weight</span><span class="token punctuation">:</span> <span class="token number">10</span></code></pre></div>
<p>可以看到笑脸比较少。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/762279306a2afc7c9f202ab0346e0dc8/80cfc/gateway_api_image_3.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 66.25766871165644%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAADHUlEQVR42n2T3U9bdRjH+4946Z03mhjjH2BijPHKC5MtMcZbM42JSwwuOAYxGzKyrVvVAU5ehtTBaCdldMBWsazv9LSlPX05faMvtKW0pUBboP34O8e5ZDf+km+e78XJk+/Lc3S2RB13vkVISePNVFmTkkRzJYKVDnKpSeGgjdyAvXaX47Mu+ydd/u/p9N51zNuz9LuzzEkmZiWz4BnMoRnu+DYY9kYxSRPMROM4UgHmn08SS2aJyhEikQitVuvVhRbTFyjGN7m26WJr/kO2Fj7SeHLuDUyW7xi3LZK69xqPHb+h5A+I+VxUqjX296vs7e3R6XTodrucnJzQ6/XQDWzGuPrExqh8zFW7h2t2r+BH/GB9xrArzo1wjaGlFe4qR+RXHxEevYgSz5DJppFlWUM0GtXUttttdPc9s7jCIww6Zewb4wITDLoiuMPDTHtN6N0uXP7vmVd8FG1rJA39pFN5EkqcTCajKVTVqVCV6symi4Sm3+W6J4Rf/z6SwKg7xPbk2zxcGuJX+wrhu69j8ZgpeK3kZi7QqB+yW9rVLKs2X8mwz1em35liRD5kwJ/ToPJLjhSD/jLXIwd8K2IxpHrsBqaRTZ8Ri8eEzRjpdFqzGggEkCSJYDCIbunvIXK+81yx+wg4Lgh8pfG89xMWN29hEAqLzz/gz4CZfKFIKfyUWq1OpVIRxexrs1r9t6B6vY7uF/NtHk5+zohPwWjsw/hHHz/6Eizc+5Sx5QkMDifzP3/MnOcvlKgHyXpDZCcyTCQ0hWohapbJZJJms4luOJjlp1CIkUgTQ0hY245r/E4oys3tAjcjNfTSFlM7Rzjdbu5PjVMsVyntFl8qVNWpvNFoiDu0fkN2/T2ubDgIrJ5DWj3PwDMnzbF3sBovc3tjkfzSWzz2zeJNlLGtP6FQqpBKJcnlcmSz2ZcKy+WyOJunD1heuMSYXOaR5RbmZT1jkRIrM19iXHvAVDCG5fevWfS76IgWu6cd4sLuzs6OZltRFE2Z+rTDbgtypH5Ij2MxWy/4oZjqgrMX/EzF6SltcXe1Wk2DWoaK/34/deE/2Gx3TUpxOrEAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/762279306a2afc7c9f202ab0346e0dc8/a6d36/gateway_api_image_3.png"
        srcset="/static/762279306a2afc7c9f202ab0346e0dc8/222b7/gateway_api_image_3.png 163w,
/static/762279306a2afc7c9f202ab0346e0dc8/ff46a/gateway_api_image_3.png 325w,
/static/762279306a2afc7c9f202ab0346e0dc8/a6d36/gateway_api_image_3.png 650w,
/static/762279306a2afc7c9f202ab0346e0dc8/e548f/gateway_api_image_3.png 975w,
/static/762279306a2afc7c9f202ab0346e0dc8/3c492/gateway_api_image_3.png 1300w,
/static/762279306a2afc7c9f202ab0346e0dc8/80cfc/gateway_api_image_3.png 1844w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<h3 id="模拟灰度发布" style="position:relative;"><a href="#%E6%A8%A1%E6%8B%9F%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83" aria-label="模拟灰度发布 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模拟灰度发布</h3>
<p>smiley-canary-10.yaml → smiley-canary-50.yaml → smiley-canary-90.yaml → smiley-canary-100.yaml</p>
<p>流量比例从90-10，50-50，10-90，0-100，最后缩容到0，<code class="language-text">kubectl scale -n faces deploy/smiley --replicas=0</code></p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> gateway.networking.k8s.io/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> HTTPRoute
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> smiley<span class="token punctuation">-</span>canary
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> faces
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">parentRefs</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> smiley
      <span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
      <span class="token key atrule">group</span><span class="token punctuation">:</span> <span class="token string">""</span>
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">backendRefs</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> smiley
          <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
          <span class="token key atrule">weight</span><span class="token punctuation">:</span> 9~~0 50 10~~ 0
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> smiley2
          <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
          <span class="token key atrule">weight</span><span class="token punctuation">:</span> 1~~0 50 90~~ 100</code></pre></div>
<p>灰度完成之后的效果，但是这样流量转发，出了问题不好排查。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/392a20c75f266e30cc3c0a55825c994e/0faf1/gateway_api_image_4.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 68.09815950920245%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAADG0lEQVR42oWUy28bZRTF/R+whG12iL+BDYhFF4gFWxaIHRI7dqhCBUqaponxoxGNW0pF1SYOcfNqgtNGddPELUlsE3v8GD/G9nhcP8bvyI86cexfZ+wiAq3ElY6+q0+j+51zz71jEPyHdLtdRjHg9Rj8Kx8M/sGbwhDKNZGf51HyRYRkloySpXTUoVBv0ep0qLwY8KI3oK993OX/w+AIe5n1p7kWkFgI7GE8zDEXDGIPBTEHVRwRH/Z4Hm9O5kFgEUkp8DyrkJZljo+PR7zPsDX0p97h9w0bjmUjPesYk0/cSDc+JnPzHONP9mibx9hZvkhQbRAN/ElOLaOqRQqFAqenp68znFqa5efDBKZ9AeOyjRmxjnlrDevWKlfFBlP3bFzzR8jsebSHfiAZSyOlJFLJFKFQCEmSiEaj9Hq9UUH3wTyznr+weTzsehcYP0iw7nHi9P7Bj54kjw/szAcFMk93Sc98QyqRIZVOabKzNJtNOlqfW60W/X5/VLB0/i0WN27gcBhRv3sb89N9/JZzRKwf8dMzHzntzrU0iSLsUbZ/TVWtImcyqMXim025cBjEKFaYCBf5XsunYi0uCRITQpLpaIsLvgDGZAslfJ/k+udExTAJKYmcTiOKIoIg4Pf7CQQCnJycYKgtfMZd1wrzD+1UHF9wedeLsPotkfvnGXcfUtTuth7dQS5kKYcfUq3UqNVq1Ov1IRqNBtVqdShbd9uwfeV9fnOt8avzLtumD7D4oqzf+grnrS8x+RI8Mn3Ivc3bxCUR0WUhmZA1yTKpVGpoiKyNj37+vRwGa1TCokk2RlTNVYnpyBFXowozGqYjDcyROLb0EfuCyOLcdTK5EoV8TmNZp1QqDdnqDNvt9qhgd3qMufXrLCyZ6FjeZfzxDtFfPiV58xMubj/jyPoe2ysT+JQaB+4dsnlVY5Qgq7mc1vqoKArxeJxyuTwquLlyiWUhyKJvnwerl5mXKmy47uB03WZOqrK5Osma101Tn+FBn1gsNpSrQ8/1sTm7LYb+q/XX0f/PeTbXt6LXOxk2X5fXfjV/+kCf/Vm8BHbC0QALyKtiAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/392a20c75f266e30cc3c0a55825c994e/a6d36/gateway_api_image_4.png"
        srcset="/static/392a20c75f266e30cc3c0a55825c994e/222b7/gateway_api_image_4.png 163w,
/static/392a20c75f266e30cc3c0a55825c994e/ff46a/gateway_api_image_4.png 325w,
/static/392a20c75f266e30cc3c0a55825c994e/a6d36/gateway_api_image_4.png 650w,
/static/392a20c75f266e30cc3c0a55825c994e/e548f/gateway_api_image_4.png 975w,
/static/392a20c75f266e30cc3c0a55825c994e/3c492/gateway_api_image_4.png 1300w,
/static/392a20c75f266e30cc3c0a55825c994e/0faf1/gateway_api_image_4.png 1956w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<p>回滚</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">kubectl scale <span class="token parameter variable">-n</span> faces deploy/smiley <span class="token parameter variable">--replicas</span><span class="token operator">=</span><span class="token number">1</span>
kubectl rollout status <span class="token parameter variable">-n</span> faces deploy
kubectl delete <span class="token parameter variable">-n</span> faces httproute smiley-canary</code></pre></div>
<p>灰度gRPC也是一样的操作</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> gateway.networking.k8s.io/v1alpha2
<span class="token key atrule">kind</span><span class="token punctuation">:</span> GRPCRoute
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> color<span class="token punctuation">-</span>canary
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> faces
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">parentRefs</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> color
      <span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
      <span class="token key atrule">group</span><span class="token punctuation">:</span> <span class="token string">""</span>
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">backendRefs</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> color
          <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
          <span class="token key atrule">weight</span><span class="token punctuation">:</span> <span class="token number">50</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> color2
          <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
          <span class="token key atrule">weight</span><span class="token punctuation">:</span> <span class="token number">50</span></code></pre></div>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/3406f000b42a788dea7d0ecb420ce2fe/3d22e/gateway_api_image_5.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 66.25766871165644%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC/klEQVR42nWT709TVxjHm/g3uMQ389X2yhhfLZnJglmMmrhlMXH4SjOj04j4oyLGSYYGulkMiqGT1tFW0K2jjMovgQXRKDAwVaQ6TNvb3t4L7b1tB4ItC9CK/XhvQdwyPck3z3lxzifP+T7fYxACQaSwyPtXbllL+1zurd61DA9FmX7BT1AW+Ss2iTcgEVGj+GIh1OlJ1DlILOTIvsqRevl+0ArwjLsIi7uQo20Wun1DOB70U9JShrW5kBNt1XhGh/A8HmBQ+Zve0SbCE1EiokhEirC4uPh/oM22GaliNSVNZ5GubqPLvh+Tcxfh71ZR5jrGiH0vT5y7GVHTCN77xBQVRVFQVZX5+XkymUxeK8CD7iPsrNuI8fYvXPYJmEcDfD/YR2lPLaf7uznWbuJwdzWPvV7EC8eRgyJKXEWKRAiFQoTDYaLR6FvgT9e/JujchNFdyXhPBX1dNm78eY90Rxk/dF6lw1bALefn3B9oZrrRjCyEGHv2DFmS3u1h5bVdOCrXUtpRS2vDQerd57EO9OKp2UJlbyM1Fz/lcm0BQyM3SXgOkYyNk5ycZGZmhtnZWdLpNKlUirm5uWUPn/q57hvm9N0OzrYWc6LlOIeaT2JqO4yxy4rd9xCr7xFjkp+Je+XIYhAxIqHEYkSWn+33+5FleQnYfauG1KUNnHKbEC59xG/m9ZRf+Ywp0xrKXUbGHHsJNOxhNDZFwteOGl0aiK43w0kkEitxMliehKkeuEvZ4B2+qStgj2Mn+1zF7K79hKL285xqM1Oi1eFAgL5Wi+bdRB6STCaJx+P5qgPfRMjgGexE7PlRu3iFO79+RZ19B6WOHfhchRywbafJ+QUtjdu56e2l/fcWBO0jCEIwP1lRy6NeBUHI+5kHujTjhy1bOdlppdn8IVUXNmC0beOPcx/w7c9fYq9aR33VxzyIPuWV1oSiKivd6Z1ms9n/fEXD88wiyfkMU5kFxmcUlLR2eHZa28dI/DNN9EWccU0LWS28GlEH6d7p0rv7d6h14Gu752Rdas4X/QAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/3406f000b42a788dea7d0ecb420ce2fe/a6d36/gateway_api_image_5.png"
        srcset="/static/3406f000b42a788dea7d0ecb420ce2fe/222b7/gateway_api_image_5.png 163w,
/static/3406f000b42a788dea7d0ecb420ce2fe/ff46a/gateway_api_image_5.png 325w,
/static/3406f000b42a788dea7d0ecb420ce2fe/a6d36/gateway_api_image_5.png 650w,
/static/3406f000b42a788dea7d0ecb420ce2fe/e548f/gateway_api_image_5.png 975w,
/static/3406f000b42a788dea7d0ecb420ce2fe/3c492/gateway_api_image_5.png 1300w,
/static/3406f000b42a788dea7d0ecb420ce2fe/3d22e/gateway_api_image_5.png 2010w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<h3 id="dynamic-routing" style="position:relative;"><a href="#dynamic-routing" aria-label="dynamic routing permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>Dynamic Routing</strong></h3>
<p>可以基于path, headers, or query parameters灰度，这里是用edge cell or a center cell的方式。</p>
<p><code class="language-text">smiley-edge.yaml</code></p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> gateway.networking.k8s.io/v1alpha2
<span class="token key atrule">kind</span><span class="token punctuation">:</span> GRPCRoute
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> color<span class="token punctuation">-</span>edge
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> faces
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">parentRefs</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> color
      <span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
      <span class="token key atrule">group</span><span class="token punctuation">:</span> <span class="token string">""</span>
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">matches</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">method</span><span class="token punctuation">:</span>
          <span class="token key atrule">service</span><span class="token punctuation">:</span> ColorService
          <span class="token key atrule">method</span><span class="token punctuation">:</span> Edge
      <span class="token key atrule">backendRefs</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> color2
          <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token punctuation">-</span> <span class="token key atrule">backendRefs</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> color
          <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span></code></pre></div>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/fb6e78013716b4bdec05cccee2c9fae3/cc418/gateway_api_image_6.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 67.48466257668711%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAADE0lEQVR42o2T3U9bdRjH+TMW72ZizDIv5kuiMUu89sYrL9REMueymXgz3HzZxhjbHHbSAmu6bAVh6gYUGDSWlglsUNxAqINtcFopp/T0tKft6ZtthXSBtnw85zTMGBPjk/zeLn6f3/d5vr+nTpLThGWVjcKf5PNFUsk0pc0SpadbVLbLVCtVypUd9KjN/x11HRNXuDJ5iRbnRdrGmmkZOYPZY8I20cT1mR9xSzlGJZXV3Aa/BqeRUykK+TzZbJbt7W12dnaoVqt/Azu73iRl388Ry8s87nqFn+2vctxygLz9BZp/OMTc0JeE+t9nTimwLMywFpFRYjEkSWJra+vfCs2DX2C1vsPZkUY6Oj+gtecw54ZOYet4m2/vXOXqQAu2WydYWU8Q6bUhLQdQkgkNqiCKogGOaQ/sqqzrfbSEZ2EAq28dp8+Fw3cP24Kfid+GMHvdmBz1tDsPMTU7jGxvYu3hIqIUJqKBcrkchUKBYrFIpVKpASc9VpSWvfQ88CHa32Wxt4F+7wxF8wG+G7uGy/Qi86bnmJ7vIzd4ipQYIBpPoCaT/6jds5TtfpW2pQCWhwFOOs/wlbuVxvEbHB8+SfPdPpqnBjh918Hi+iKS5zBrwn0ichw5IhEOhwkEAgiCYKRfLpep89y7SWrwI84NmpjVDPqp8y0a2l9H6X6DC7eOMecyE3Ce4JHyBxnBQ1KRUTWn09pQVZWUtiY1tZubmzWFfd4xnN2fcnlygPbL+2i1HuTzG+/ReX4PF4cbuTlipb/vNI9jWZYnrYTFIEo8bhihG6IoCtFo1FBXAwoS7t/9mLx3MN3+kEvDn/BZ71GsznqaXN/gWBEZElaYl7I4uq8jrIY0WFRTpRowXV1ce0A3xwCOjraR7NjHWccFFizPM9r+Eg2W10i37uH89x8z3VPP8rWD+BIbyKEQCTVtpJvJZIx09Q+u70ulUg3oi8SYXbqPVxJxTbXhftCFa+k2rvGvGfdPMbca4JcnC2SeVo3mkyIRgsEgIQ3u9/uf1U7vGAPI/wz9gl6n3VbbHfp5F6YD/wKsAWlEGpH6dwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/fb6e78013716b4bdec05cccee2c9fae3/a6d36/gateway_api_image_6.png"
        srcset="/static/fb6e78013716b4bdec05cccee2c9fae3/222b7/gateway_api_image_6.png 163w,
/static/fb6e78013716b4bdec05cccee2c9fae3/ff46a/gateway_api_image_6.png 325w,
/static/fb6e78013716b4bdec05cccee2c9fae3/a6d36/gateway_api_image_6.png 650w,
/static/fb6e78013716b4bdec05cccee2c9fae3/e548f/gateway_api_image_6.png 975w,
/static/fb6e78013716b4bdec05cccee2c9fae3/3c492/gateway_api_image_6.png 1300w,
/static/fb6e78013716b4bdec05cccee2c9fae3/cc418/gateway_api_image_6.png 1992w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<p><strong>Dynamic Canarying</strong></p>
<p><code class="language-text">smiley-edge-canary-50.yaml</code> 根据path灰度，全部流量的20%，在分成50%和50%</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> gateway.networking.k8s.io/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> HTTPRoute
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> smiley<span class="token punctuation">-</span>edge
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> faces
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">parentRefs</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> smiley
      <span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
      <span class="token key atrule">group</span><span class="token punctuation">:</span> <span class="token string">""</span>
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">matches</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span>
          <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">"/edge"</span>
      <span class="token key atrule">backendRefs</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> smiley3
          <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
          <span class="token key atrule">weight</span><span class="token punctuation">:</span> <span class="token number">50</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> smiley2
          <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
          <span class="token key atrule">weight</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token punctuation">-</span> <span class="token key atrule">backendRefs</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> smiley
          <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span></code></pre></div>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/d95c45205acf85ca1fae1e741cf60979/e216b/gateway_api_image_7.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 69.93865030674846%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAADRUlEQVR42n2T20+bZRzH339jUS+82o2JMdmu1BuFhMXsitThaZvHJUbZGBtKjMLCRlcpFaThMNBSBtXZyEka6MBpwTXgOii00FLpkcP6drQ0o0Dbtf34vq8bM27xl3zzPM/F832+v+/v+wjz8wv4lpd5chWecC5QKDzCf0tYioi4V9fxBwOExThOb4CoGGMtuUssmSKZ2mY1mSSdzZCVLmQK/G8JFeZPuDB0kvIBHYYlD4b5aTSz65hd07TPeajsO4/6uxKaRhqYCfzJmHOMtfUYoVCQSCSikOTz+X21whWzioT9bSpNn3F7uoHgTBV1U4vk255n1FRNpaaU8VMH+ObKu/hWQywtOhHvxolGo2xubj6usLz7fSoaD1Ex3Izaokc9cIn6Wwt8afiYC5YuKkwdlJ39EI3VzJ2RH/BebZPsWZPUhVmWvJfh8XgkxaF/CKv1RzF2vsIxXQnavmN833+c11qK+GnoBJ93v4FubAjbWD2D7jDRoR5WjM0Ewhv4/StsbGywu7tLKpVSVrltoe6rI5hOHuaty0cw1zzD1MWnUbWUIKqfxdj0Kpe6muhRHeTadRvxSSPRYS3xrR3C4RBbW1uPt1zW+h5FtS9RNaBmYnGE3xct1Ew0U9xehKr3BBcdEc7dWKY7CFG7mqXRc/j8Yf7y+RRSt9uNy+VidnYWr9eLoNMVM6l9gfZr1fuvdExo8Xa9SHtnKXpLJ/fMbzLqtCOuehC9N9lK3iMejysKE4nEPuS2hTN1r3O67DAt/RrS0vjzEqFhqh1TzQE0rUfRX+/DWn8Iy8IcK04rblsvIclDWZ3f7ycYDCqQIyTHR2hwONHOjFM7dYOakbPUWc7wxeQo2vlb1M/O8elII6cGymmwG5n8bZyBQWnasTh3Y6KiShRFklLw5Qil02mEwT+MJBynOT/UjFXzHK5vD/LRj1+T73qZ/t4qajtKSWmeouvnD3AsrXDb4WBt446kKqBERVYXDofxSZ5ub28jDDtnsNta6Zybpu3qOxiMKvSOSX79RYfZbqVprBFjazE9Nr3i7+5OSsndQxK57Ww2+2jKsmcPj/f/tc/JX+oBMg/WXO4+mUxGyd3e3h47OzsKcrnc/tf7Gyx7o4hHJREmAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/d95c45205acf85ca1fae1e741cf60979/a6d36/gateway_api_image_7.png"
        srcset="/static/d95c45205acf85ca1fae1e741cf60979/222b7/gateway_api_image_7.png 163w,
/static/d95c45205acf85ca1fae1e741cf60979/ff46a/gateway_api_image_7.png 325w,
/static/d95c45205acf85ca1fae1e741cf60979/a6d36/gateway_api_image_7.png 650w,
/static/d95c45205acf85ca1fae1e741cf60979/e548f/gateway_api_image_7.png 975w,
/static/d95c45205acf85ca1fae1e741cf60979/3c492/gateway_api_image_7.png 1300w,
/static/d95c45205acf85ca1fae1e741cf60979/e216b/gateway_api_image_7.png 1904w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<h3 id="rollback" style="position:relative;"><a href="#rollback" aria-label="rollback permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Rollback</h3>
<p>smiley3 有时候有问题。</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> gateway.networking.k8s.io/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> HTTPRoute
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> smiley<span class="token punctuation">-</span>edge
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> faces
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">parentRefs</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> smiley
      <span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
      <span class="token key atrule">group</span><span class="token punctuation">:</span> <span class="token string">""</span>
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">matches</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span>
          <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">"/edge"</span>
      <span class="token key atrule">backendRefs</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> smiley2
          <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token punctuation">-</span> <span class="token key atrule">backendRefs</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> smiley
          <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span></code></pre></div>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/b0b693011c7cb15612eed59027268df2/cb1ac/gateway_api_image_8.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 68.09815950920245%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAADSUlEQVR42oWU/U9bZRTH+7vxL1jMfjHxF2OiRg1DE7NEjUZdRIJuQWfi3NgWMsjW4UIy2It0bmNsBcbbDNkKG7QFdN0MsBeFFQVXB5a3ru/0vbTpmkHpbaF8fO6t06gzPsnJPbm5+Tzfc873XNWsdZqMlOG/z/o/8nXW1/PxuKOadjrx+QMEwxGm7t8nIPLFB0lC8ThSWiIpgbSWUz6W+P+j0pjK2ddbSYW+nKMDu/m8SzxNamoGyjg+dpM+cWG33c9kJMKg1YA7ECYSDuP3+1lZWVEguVzuLyDaZzhy9mXONbwC7c9T3FDIdMsm7Npn2WesR2p/jZ+N1UxFl5ixjBKMRAkGAiwsLJDJ/LtVqiNNH3Gov5a9Fz5mv+Y5yvSVHGh6m4r6Amp/HEDzTTknb+jwTM7jaq3BY3Picrvxer1YrVYcDgdzc3N/qlV9f9fAqbFR9l4qpdlYwpbWYjT67ZzUf8qWtmIaDaWo9Z8xax7C11iF3+XFK9QFhMpUKkU6nVZga2treeDqsQ1cHKinRfsmKc1TbNO+zsTXT2P9aiPbGjezWLcRg/ZVZn4dJKFXExVDc3k8+AT0cZNW7ezZT9XtHj7p2kFRUyG7vqujaqiTg4Md7DGdpqixkNLLO3HOXMNh+JAFl024Ikg0GsEjwHLJNptNCVmxatZYRGXLG9R2vM89/bvs6j2K5Y6O30YusNugYezKOzTrSphxW0jYhomEZNgiiUSCuLDWo4hGo2SzWQGs2cCx1vfQnNnE3eonUPcdZ7xzD5a2Ug5+e4qR6ifpOFfAlO0X3CMtuO0u7A47LmGn+XkxKJdLGcrS0lK+5CLdB2w3HKB64icOTdxCPXqDL67WsuPqYdQjQ3w5fpPDkxYs8056uxsJBKOEhcpYLEZEeFNWJ+fJZDIPzLQXUNexlZ7+0+SulFDRdxbz+Ze41/yi8OEZHnZvxXy9nnFvjGFTPx5fUPTNjs/nU0L2o9zLYDCYB5oaXuCEUc2lW72Yu8o4cec6nW1voTu/GY35Gj9cLsc4fJF4VtkJZUNCoZCiTgbKg/jblMNSiodZiZRwQEJEWuxtXFohJiItvPVAbNWyeL+6uiqanlFKfASU4cvLy/nfxh8W+h1SZJ/yj/Qb6AAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/b0b693011c7cb15612eed59027268df2/a6d36/gateway_api_image_8.png"
        srcset="/static/b0b693011c7cb15612eed59027268df2/222b7/gateway_api_image_8.png 163w,
/static/b0b693011c7cb15612eed59027268df2/ff46a/gateway_api_image_8.png 325w,
/static/b0b693011c7cb15612eed59027268df2/a6d36/gateway_api_image_8.png 650w,
/static/b0b693011c7cb15612eed59027268df2/e548f/gateway_api_image_8.png 975w,
/static/b0b693011c7cb15612eed59027268df2/3c492/gateway_api_image_8.png 1300w,
/static/b0b693011c7cb15612eed59027268df2/cb1ac/gateway_api_image_8.png 1936w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<h2 id="abtest" style="position:relative;"><a href="#abtest" aria-label="abtest permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>abtest</h2>
<p>smiley-ab.yaml，header里带有x-faces-user: heart，会返回爱心</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> gateway.networking.k8s.io/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> HTTPRoute
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> smiley<span class="token punctuation">-</span>a<span class="token punctuation">-</span>b
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> faces
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">parentRefs</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> smiley
      <span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
      <span class="token key atrule">group</span><span class="token punctuation">:</span> <span class="token string">""</span>
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">matches</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">headers</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"x-faces-user"</span>
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">"heart"</span>
      <span class="token key atrule">backendRefs</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> smiley2
          <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token punctuation">-</span> <span class="token key atrule">backendRefs</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> smiley
          <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span></code></pre></div>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/389d81461680ddf99b726c196c3d813e/09096/gateway_api_image_9.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 73.61963190184049%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC7ElEQVR42pWUW09TaRSG+z/GzPwTL/R6LvQfGO/Ucbw0c2kmRhRKsQ4KjBJHZkBUSmhVUCg9QYCW0hZo6e5hd/ewe6BCT0ixlGe+7gYLauLMSt6snZWdJ+v73rU+XUQKk1UztOOITojvo5aa7UxbR0cdfSt0mxEZKZUnn88jZbaRU2k+7FZRlTwHu2V2tms0PtY5FD8f8v3QjW8EmVj30u9PYfYv8mgtymhgk0nPEgNrClMeB+/iBZbkZZajbnK5IoqSoFqtts/xRae65efXCD84y915JzX9T/z5+h+sI78QHzrPnTkHha4zzC1MEIwrSCE/GTWHkkhQLpc1QKPROAXVGT0Buh1WDMEdem1v6A2k0K/4MCw46N0s0jU7xWiiRHp0gMiLp6TzH0iKDsPhMLFYjHg8zsHBQQdotw7hs9yi27WGar7OkN3KzLvHbEz/zj2nl9jEVWY2VlEnh0mb/0aSU4SCQWq1mgZoNpunO3xp7mPiyRUM7i1mH12g3zbPiKkPy8iv9C5vYnnwM1Nrq2RtejKOh+S2K+SyKpVKRVOpVNLgLbAGHF6XGPb56FnPM+Z30xdIM+gP8ywQoCeQ46l3iZfyLqrvL2TvKHElQzKpkMlkiEQiSJJENBqlXq+3gStjVwkbz9IjTKnqf+SJMGVemCIPnqN7zi5M+QGry4QS85EOLQhTCqiqKqBJbdRSqRT7+/udI9/3bnFvcZG+UIkepw3DuoreExTHdWMI7XDbPse4XGbJ+opFuwU1uy1AOQ1aKBTEGOXY29s7Ycp7Iz7TTbocbrKmywxYZ5h++wcblt+4Y3cTH7/ErM/Fe9cKTpeLhJJEFs62Omw53FIL/Bn49o2R2WdXeOiVWHl8kWGXHZPZiG3sBv2eLZyDF5hetWtbUhUmtO4vm82SODGLpwZ7TzheEfokrC+LXBe5VasKNY5rTbG7h4firj5q91YsFjXo8eicAh4vfUcnHoevav9hl/mfcfK1+daL8y8gJTDrfVuK4QAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/389d81461680ddf99b726c196c3d813e/a6d36/gateway_api_image_9.png"
        srcset="/static/389d81461680ddf99b726c196c3d813e/222b7/gateway_api_image_9.png 163w,
/static/389d81461680ddf99b726c196c3d813e/ff46a/gateway_api_image_9.png 325w,
/static/389d81461680ddf99b726c196c3d813e/a6d36/gateway_api_image_9.png 650w,
/static/389d81461680ddf99b726c196c3d813e/e548f/gateway_api_image_9.png 975w,
/static/389d81461680ddf99b726c196c3d813e/3c492/gateway_api_image_9.png 1300w,
/static/389d81461680ddf99b726c196c3d813e/09096/gateway_api_image_9.png 2104w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<p>清除</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml">kubectl delete <span class="token punctuation">-</span>n faces httproute smiley<span class="token punctuation">-</span>a<span class="token punctuation">-</span>b
kubectl delete <span class="token punctuation">-</span>n faces grpcroute color<span class="token punctuation">-</span>a<span class="token punctuation">-</span>b</code></pre></div>
<p>timeout</p>
<p><code class="language-text">face-route.yaml</code> 增加了200ms的超时。</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> gateway.networking.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> HTTPRoute
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> face<span class="token punctuation">-</span>route
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> faces
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">parentRefs</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress
      <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
      <span class="token key atrule">kind</span><span class="token punctuation">:</span> Gateway
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">matches</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> PathPrefix
        <span class="token key atrule">value</span><span class="token punctuation">:</span> /face
    <span class="token key atrule">filters</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> URLRewrite
        <span class="token key atrule">urlRewrite</span><span class="token punctuation">:</span>
          <span class="token key atrule">path</span><span class="token punctuation">:</span>
            <span class="token key atrule">type</span><span class="token punctuation">:</span> ReplacePrefixMatch
            <span class="token key atrule">replacePrefixMatch</span><span class="token punctuation">:</span> /
    <span class="token key atrule">backendRefs</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> face
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token key atrule">timeouts</span><span class="token punctuation">:</span>
      <span class="token key atrule">request</span><span class="token punctuation">:</span> 200ms</code></pre></div>
<p>可以看到有超时的结果了</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/7725befb7027c8452464591ad488309a/2adcb/gateway_api_image_10.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 71.16564417177914%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAADAklEQVR42pWU228iZRjG+T+89Vb/hFVj4o133ph4Z2KMmnhjNF70Sm9M27hV02533WYVti1bobSUHrYtDFvoARYGSmGAchgYoAwz0MWla0tP/Jyh2tV4iL7Jmy/fXPzyvN/zvGPJZtLkCzl6/Jfq0es9778rS7bUJCe3qFVrFKtNpFyJw9YTdL3D0dNndE57/NztmShO+sh/L8vujkAu8gCPP4xtL8aIEMf7aItCdIrATghbRmJmXySsdfAmXaTKMo26SllRODk5+StQWhmgPPcSjvlpsoE38a28z+LsOLrrRYSlUR56PiY+9wqB6iGFdAS5UkWt16nVanS73T7k8vLyOTC0vEzQNsSqL45rfhL38hzOYAq78y7OnTQ3gxEGBYGo3ET5boBiWEQ5OEApK2QyGfL5PLIsc35+fgVMBX+gGBkgtDBNbvsr0sERrAGB7b0hxsQoP4kO1pLjPN6vot/+HDkikjEhRZnj42POzs76fa0wsTBI7McbRD1TxCffJjbzATOCh23rq0xsCzjdX7Buf4fHchVt+j30fALNMK3Z1Lm4uPhTm85brPEiE1ubfB9XuReKci+cYCTZYjiW4E5CZS3gZ9Hvo1TKo3g/oSAFDUOMkZWy8a1ENptFkiRyuRynp6dYFsITKGuvMbS5QcL/LhuPPmMs6EH13sCxPkV29SPUh29Qy6Zp7G9Qr5TQ9KahsEmj0aDVaqFp2rXjlglD1bjjW8ZSKneWpri97mE0WuTW5DC2UIpFtxWX/abxZgo77q+RcxnqaoMDw5hKpdI/TcdNdX2gNR1jQbIzKBaYTS9xf9fLN6KES5rjS1+G+wkvLiN/vnKbB7a7iKl9ioYp5rimu7+fuq5fAZ3COHvWlxne3GLL8RYrsx9yy+9Gc77A6Oo88+5PCdpfJ6Q+pa23UDVjVFXtj1k38thutzk6OrrOpCXVeoZoPHKyfUa8prOrHpLUj9krFpGavxj3J0SrGoddM7yX/Q0xDTBVmTnsdDpXW/7bblv4H/VPP4Q/rt6v/GbXycIfUdoAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/7725befb7027c8452464591ad488309a/a6d36/gateway_api_image_10.png"
        srcset="/static/7725befb7027c8452464591ad488309a/222b7/gateway_api_image_10.png 163w,
/static/7725befb7027c8452464591ad488309a/ff46a/gateway_api_image_10.png 325w,
/static/7725befb7027c8452464591ad488309a/a6d36/gateway_api_image_10.png 650w,
/static/7725befb7027c8452464591ad488309a/e548f/gateway_api_image_10.png 975w,
/static/7725befb7027c8452464591ad488309a/3c492/gateway_api_image_10.png 1300w,
/static/7725befb7027c8452464591ad488309a/2adcb/gateway_api_image_10.png 1984w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p></div></div></div><div class="max-w-4xl mx-auto mt-8"><div class="giscus"></div></div><div class="hidden lg:block fixed left-4 top-32 w-64"><div class="bg-white p-4 rounded-lg shadow-lg" style="max-height:calc(100vh - 12rem);overflow-y:auto"><h3 class="font-bold mb-2 text-left">目录: </h3><div class="text-left"><ul>
<li>
<p><a href="#live-with-gateway-api">Live with Gateway API</a></p>
</li>
<li>
<p><a href="#%E5%87%86%E5%A4%87">准备</a></p>
<ul>
<li><a href="#k8s%E9%9B%86%E7%BE%A4">k8s集群</a></li>
<li><a href="#%E5%AE%89%E8%A3%85gateway-api">安装gateway api</a></li>
<li><a href="#%E5%AE%89%E8%A3%85isito">安装isito</a></li>
<li><a href="#%E5%88%9B%E5%BB%BAgateway">创建gateway</a></li>
<li><a href="#%E5%AE%89%E8%A3%85%E6%B5%8B%E8%AF%95%E5%BA%94%E7%94%A8">安装测试应用</a></li>
</ul>
</li>
<li>
<p><a href="#%E5%9C%BA%E6%99%AF">场景</a></p>
<ul>
<li>
<p><a href="#base">base</a></p>
</li>
<li>
<p><a href="#unconditional">unconditional</a></p>
</li>
<li>
<p><a href="#canary">canary</a></p>
<ul>
<li><a href="#%E6%A8%A1%E6%8B%9F%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83">模拟灰度发布</a></li>
<li><a href="#dynamic-routing"><strong>Dynamic Routing</strong></a></li>
<li><a href="#rollback">Rollback</a></li>
</ul>
</li>
<li>
<p><a href="#abtest">abtest</a></p>
</li>
</ul>
</li>
</ul></div></div></div></div><footer class="text-center py-4 mt-8 border-t">© 2025 · Built with Gatsby</footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2025-02-12-gateway_api/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-ec515adc39aa7430d310.js\"],\"component---src-pages-404-js\":[\"/component---src-pages-404-js-051f7e1a395ea4ec2b2a.js\"],\"component---src-pages-about-js\":[\"/component---src-pages-about-js-093de8076e2cf835e1d3.js\"],\"component---src-pages-index-js\":[\"/component---src-pages-index-js-c34369a01a85b628d9ac.js\"],\"component---src-pages-links-js\":[\"/component---src-pages-links-js-7666f811b66803f137c5.js\"],\"component---src-pages-tags-js\":[\"/component---src-pages-tags-js-512d381bd81244b1af9c.js\"],\"component---src-pages-using-ssr-js\":[\"/component---src-pages-using-ssr-js-005fd2817f4487ca3dc9.js\"],\"component---src-templates-blog-list-js\":[\"/component---src-templates-blog-list-js-5fadf6a59ac6c5cfa4ee.js\"],\"component---src-templates-blog-post-js\":[\"/component---src-templates-blog-post-js-9498a20d0ef2eefd61ce.js\"],\"component---src-templates-tags-js\":[\"/component---src-templates-tags-js-13eab85942606ca6630c.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="7d877e823468a4de5503";</script><script src="/webpack-runtime-7789ddc4cd9085cabb24.js" async></script><script src="/framework-6a525285796fb83f2864.js" async></script><script src="/app-ec515adc39aa7430d310.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>