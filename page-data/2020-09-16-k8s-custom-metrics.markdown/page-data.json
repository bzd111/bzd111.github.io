{"componentChunkName":"component---src-templates-blog-post-js","path":"/2020-09-16-k8s-custom-metrics.markdown/","result":{"data":{"markdownRemark":{"html":"<!-- vim-markdown-toc Redcarpet -->\n<ul>\n<li><a href=\"#%E5%89%8D%E8%A8%80\">前言</a></li>\n<li><a href=\"#pre-install\">pre-install</a>\n<ul>\n<li><a href=\"#kube-prometheus\">kube-prometheus</a></li>\n<li><a href=\"#prometheus-adapter\">prometheus-adapter</a></li>\n</ul>\n</li>\n<li><a href=\"#metrics\">Metrics</a>\n<ul>\n<li><a href=\"#%E6%8C%87%E6%A0%87%E7%B1%BB%E5%9E%8B\">指标类型</a></li>\n</ul>\n</li>\n<li><a href=\"#expose-metrics\">Expose Metrics</a>\n<ul>\n<li><a href=\"#metrics-url\">metrics url</a></li>\n<li><a href=\"#exporter\">exporter</a>\n<ul>\n<li><a href=\"#go-code\">Go code</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#podmonitor\">PodMonitor</a></li>\n<li><a href=\"#servicemonitor\">ServiceMonitor</a></li>\n<li><a href=\"#hpa\">HPA</a></li>\n<li><a href=\"#demo\">Demo</a>\n<ul>\n<li><a href=\"#nsq-pod\">nsq-pod</a></li>\n<li><a href=\"#nsq-service\">nsq-service</a></li>\n<li><a href=\"#nsq-servicemonitor\">nsq-servicemonitor</a></li>\n<li><a href=\"#nsq-hpa\">nsq-hpa</a></li>\n</ul>\n</li>\n<li><a href=\"#%E6%80%BB%E7%BB%93\">总结</a></li>\n<li><a href=\"#renference\">Renference</a></li>\n</ul>\n<!-- vim-markdown-toc -->\n<h1 id=\"前言\" style=\"position:relative;\"><a href=\"#%E5%89%8D%E8%A8%80\" aria-label=\"前言 permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>前言</h1>\n<p>为了更好的扩缩容，自定义一些指标，作为 HPA 的标准，在本文中采用 nsq 的队列长度作为指标</p>\n<h1 id=\"pre-install\" style=\"position:relative;\"><a href=\"#pre-install\" aria-label=\"pre install permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>pre-install</h1>\n<p>准备工作，准备一个 K8S 集群，然后安装下面两个组件</p>\n<h2 id=\"kube-prometheus\" style=\"position:relative;\"><a href=\"#kube-prometheus\" aria-label=\"kube prometheus permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>kube-prometheus</h2>\n<p>安装<a href=\"https://github.com/prometheus-operator/kube-prometheus\">kube-prometheus</a></p>\n<p><code class=\"language-text\">kubectl apply -f kube-prometheus-0.4.0/manifests/</code></p>\n<h2 id=\"prometheus-adapter\" style=\"position:relative;\"><a href=\"#prometheus-adapter\" aria-label=\"prometheus adapter permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>prometheus-adapter</h2>\n<p>安装<a href=\"https://github.com/DirectXMan12/k8s-prometheus-adapter\">prometheus-adapter</a></p>\n<p>将 prometheus-service-name、namespace 改成实际的名称</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kubectl create namespace custom-metrics\nhelm install prometheus-adapter stable/prometheus-adapter -n  custom-metrics --set prometheus.url=http://&lt;prometheus-service-name>.&lt;namespace>.svc</code></pre></div>\n<h1 id=\"metrics\" style=\"position:relative;\"><a href=\"#metrics\" aria-label=\"metrics permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Metrics</h1>\n<p>指标的格式是三行</p>\n<p>第一行是 HELP 开头的基础信息</p>\n<p>第二行是 TYPE 开头的指标名称和指标类型</p>\n<p>第三行是具体的指标值</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># HELP myapp_processed_ops_total The total number of processed events\n# TYPE myapp_processed_ops_total counter\nmyapp_processed_ops_total 5</code></pre></div>\n<h2 id=\"指标类型\" style=\"position:relative;\"><a href=\"#%E6%8C%87%E6%A0%87%E7%B1%BB%E5%9E%8B\" aria-label=\"指标类型 permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>指标类型</h2>\n<p>Counter: 累积量度，代表一个单调递增的计数器</p>\n<p>Gague: 通常用于测量值，例如温度或当前内存使用情况，但也可以用于上升和下降的“计数”，例如正在运行的 goroutine 的数量。</p>\n<p>Histogram: 直方图对观察值（通常是请求持续时间或响应大小之类的东西）进行采样，并将其计数在可配置的存储桶中。</p>\n<p>Summary: 采样观察值（通常是请求持续时间和响应大小之类的东西）</p>\n<h1 id=\"expose-metrics\" style=\"position:relative;\"><a href=\"#expose-metrics\" aria-label=\"expose metrics permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Expose Metrics</h1>\n<p>应用暴露指标通常有两种方式，一种是通过自身提供 metrics url 接口，第二种是 exporter 将指标导出成 Prometheus 的指标</p>\n<h2 id=\"metrics-url\" style=\"position:relative;\"><a href=\"#metrics-url\" aria-label=\"metrics url permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>metrics url</h2>\n<p>通常在应用层暴露 http 接口，就像多提供一个健康检查的接口一样</p>\n<h2 id=\"exporter\" style=\"position:relative;\"><a href=\"#exporter\" aria-label=\"exporter permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>exporter</h2>\n<p>当使用的中间件(数据库、消息队列)没有提供接口时，可以使用这种方式，产用外接一个 exporter 的方式，获取它的指标信息</p>\n<h3 id=\"go-code\" style=\"position:relative;\"><a href=\"#go-code\" aria-label=\"go code permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Go code</h3>\n<p>使用 prometheus 提供的 golang client，可以简单的增加指标。prometheus 同时还支持 python、java、ruby 的客户端</p>\n<p>这样就可以拿到指标了</p>\n<div class=\"gatsby-highlight\" data-language=\"golang\"><pre class=\"language-golang\"><code class=\"language-golang\">package main\n\nimport (\n        &quot;net/http&quot;\n        &quot;time&quot;\n\n        &quot;github.com/prometheus/client_golang/prometheus&quot;\n        &quot;github.com/prometheus/client_golang/prometheus/promauto&quot;\n        &quot;github.com/prometheus/client_golang/prometheus/promhttp&quot;\n)\n\nfunc recordMetrics() {\n        go func() {\n                for {\n                        opsProcessed.Inc()\n                        time.Sleep(2 * time.Second)\n                }\n        }()\n}\n\nvar (\n        opsProcessed = promauto.NewCounter(prometheus.CounterOpts{\n                Name: &quot;myapp_processed_ops_total&quot;,\n                Help: &quot;The total number of processed events&quot;,\n        })\n)\n\nfunc main() {\n        recordMetrics()\n\n        http.Handle(&quot;/metrics&quot;, promhttp.Handler())\n        http.ListenAndServe(&quot;:2112&quot;, nil)\n}</code></pre></div>\n<h1 id=\"podmonitor\" style=\"position:relative;\"><a href=\"#podmonitor\" aria-label=\"podmonitor permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PodMonitor</h1>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> monitoring.coreos.com/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> PodMonitor\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> monitoring\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> pm\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">k8s-app</span><span class=\"token punctuation\">:</span> pm<span class=\"token punctuation\">-</span>exporter\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">jobLabel</span><span class=\"token punctuation\">:</span> app\n  <span class=\"token key atrule\">podMetricsEndpoints</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> metrics\n      <span class=\"token key atrule\">interval</span><span class=\"token punctuation\">:</span> 15s\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> app<span class=\"token punctuation\">-</span>for<span class=\"token punctuation\">-</span>pm\n  <span class=\"token key atrule\">namespaceSelector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchNames</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> default</code></pre></div>\n<p>需要在 pod 的 template 中添加</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">annotations</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">prometheus.io/scrape</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"true\"</span>\n  <span class=\"token key atrule\">prometheus.io/path</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"/metrics\"</span>\n  <span class=\"token key atrule\">prometheus.io/port</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"port\"</span> <span class=\"token comment\"># pod实际的端口</span></code></pre></div>\n<h1 id=\"servicemonitor\" style=\"position:relative;\"><a href=\"#servicemonitor\" aria-label=\"servicemonitor permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ServiceMonitor</h1>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> monitoring.coreos.com/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ServiceMonitor\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> sm\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> monitoring\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">k8s-app</span><span class=\"token punctuation\">:</span> sm<span class=\"token punctuation\">-</span>exporter\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">jobLabel</span><span class=\"token punctuation\">:</span> app\n  <span class=\"token key atrule\">endpoints</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> metrics\n      <span class=\"token key atrule\">interval</span><span class=\"token punctuation\">:</span> 15s\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> sm\n  <span class=\"token key atrule\">namespaceSelector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchNames</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> default</code></pre></div>\n<p>需要在 Service 上指定名称，端口</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">9117</span>\n      <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> TCP\n      <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">9117</span>\n      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> metrics</code></pre></div>\n<h1 id=\"hpa\" style=\"position:relative;\"><a href=\"#hpa\" aria-label=\"hpa permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>HPA</h1>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> autoscaling/v2beta2\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> HorizontalPodAutoscaler\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nsq<span class=\"token punctuation\">-</span>hpa\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">scaleTargetRef</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n    <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nsq<span class=\"token punctuation\">-</span>deployment <span class=\"token comment\"># 需要扩缩容的deployment名字</span>\n  <span class=\"token key atrule\">minReplicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">60</span>\n  <span class=\"token key atrule\">maxReplicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">150</span>\n  <span class=\"token key atrule\">metrics</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> Object\n      <span class=\"token key atrule\">object</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">metric</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"metrics-name\"</span> <span class=\"token comment\"># 需要监控的指标</span>\n          <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">\"topic\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"topic-name\"</span>\n        <span class=\"token key atrule\">describedObject</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"v1\"</span>\n          <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nsq<span class=\"token punctuation\">-</span>exporter<span class=\"token punctuation\">-</span>svc <span class=\"token comment\"># 从哪里获取指标</span>\n        <span class=\"token key atrule\">target</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> Value\n          <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10</span></code></pre></div>\n<h1 id=\"demo\" style=\"position:relative;\"><a href=\"#demo\" aria-label=\"demo permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Demo</h1>\n<h2 id=\"nsq-pod\" style=\"position:relative;\"><a href=\"#nsq-pod\" aria-label=\"nsq pod permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>nsq-pod</h2>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nsq<span class=\"token punctuation\">-</span>exporter\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> nsq<span class=\"token punctuation\">-</span>exporter\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nsq<span class=\"token punctuation\">-</span>exporter\n      <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nsq<span class=\"token punctuation\">-</span>prometheus<span class=\"token punctuation\">-</span>exporter<span class=\"token punctuation\">:</span>latest\n      <span class=\"token key atrule\">imagePullPolicy</span><span class=\"token punctuation\">:</span> IfNotPresent\n      <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">9117</span>\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> metrics\n      <span class=\"token key atrule\">readinessProbe</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">tcpSocket</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">9117</span>\n        <span class=\"token key atrule\">initialDelaySeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3</span>\n        <span class=\"token key atrule\">periodSeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10</span>\n      <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> NSQD_ADDR\n          <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"http://nsqd-2.nsqd:4151/stats\"</span>\n      <span class=\"token key atrule\">args</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"-nsqd.addr\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"$(NSQD_ADDR)\"</span><span class=\"token punctuation\">]</span></code></pre></div>\n<h2 id=\"nsq-service\" style=\"position:relative;\"><a href=\"#nsq-service\" aria-label=\"nsq service permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>nsq-service</h2>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> nsq<span class=\"token punctuation\">-</span>exporter\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nsq<span class=\"token punctuation\">-</span>exporter<span class=\"token punctuation\">-</span>svc\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">9117</span>\n      <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> TCP\n      <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">9117</span>\n      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> metrics\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> nsq<span class=\"token punctuation\">-</span>exporter\n  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> ClusterIP <span class=\"token comment\"># ClusterIP or LoadBalancer</span></code></pre></div>\n<h2 id=\"nsq-servicemonitor\" style=\"position:relative;\"><a href=\"#nsq-servicemonitor\" aria-label=\"nsq servicemonitor permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>nsq-servicemonitor</h2>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> monitoring.coreos.com/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ServiceMonitor\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nsq\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> monitoring\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">k8s-app</span><span class=\"token punctuation\">:</span> nsq<span class=\"token punctuation\">-</span>exporter\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">jobLabel</span><span class=\"token punctuation\">:</span> app\n  <span class=\"token key atrule\">endpoints</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> metrics\n      <span class=\"token key atrule\">interval</span><span class=\"token punctuation\">:</span> 15s\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> nsq<span class=\"token punctuation\">-</span>exporter\n  <span class=\"token key atrule\">namespaceSelector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchNames</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> default</code></pre></div>\n<h2 id=\"nsq-hpa\" style=\"position:relative;\"><a href=\"#nsq-hpa\" aria-label=\"nsq hpa permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>nsq-hpa</h2>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> autoscaling/v2beta2\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> HorizontalPodAutoscaler\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> video<span class=\"token punctuation\">-</span>post<span class=\"token punctuation\">-</span>vid<span class=\"token punctuation\">-</span>hpa\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">scaleTargetRef</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n    <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> app<span class=\"token punctuation\">-</span>deployment <span class=\"token comment\"># 需要扩缩容的deployment名字</span>\n  <span class=\"token key atrule\">minReplicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">60</span>\n  <span class=\"token key atrule\">maxReplicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">150</span>\n  <span class=\"token key atrule\">metrics</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> Object\n      <span class=\"token key atrule\">object</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">metric</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"nsq_channel_depth\"</span> <span class=\"token comment\"># 需要监控的指标</span>\n          <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">\"topic\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"topic-name\"</span>\n        <span class=\"token key atrule\">describedObject</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"v1\"</span>\n          <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nsq<span class=\"token punctuation\">-</span>exporter<span class=\"token punctuation\">-</span>svc <span class=\"token comment\"># 从哪里获取指标</span>\n        <span class=\"token key atrule\">target</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> Value\n          <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10</span></code></pre></div>\n<h1 id=\"总结\" style=\"position:relative;\"><a href=\"#%E6%80%BB%E7%BB%93\" aria-label=\"总结 permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>总结</h1>\n<p><img src=\"https://github.com/prometheus-operator/prometheus-operator/blob/master/Documentation/custom-metrics-elements.png?raw=true\" alt=\"纵览\"></p>\n<h1 id=\"renference\" style=\"position:relative;\"><a href=\"#renference\" aria-label=\"renference permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Renference</h1>\n<ul>\n<li><a href=\"https://prometheus.io/docs/concepts/metric_types/\">https://prometheus.io/docs/concepts/metric_types/</a></li>\n<li><a href=\"https://prometheus.io/docs/instrumenting/exporters/\">https://prometheus.io/docs/instrumenting/exporters/</a></li>\n<li><a href=\"https://github.com/prometheus/client_golang\">https://github.com/prometheus/client_golang</a></li>\n<li><a href=\"https://github.com/prometheus-operator/prometheus-operator\">https://github.com/prometheus-operator/prometheus-operator</a></li>\n<li><a href=\"https://github.com/prometheus-operator/prometheus-operator/tree/master/Documentation\">https://github.com/prometheus-operator/prometheus-operator/tree/master/Documentation</a></li>\n</ul>","tableOfContents":"<ul>\n<li>\n<p><a href=\"#%E5%89%8D%E8%A8%80\">前言</a></p>\n</li>\n<li>\n<p><a href=\"#pre-install\">pre-install</a></p>\n<ul>\n<li><a href=\"#kube-prometheus\">kube-prometheus</a></li>\n<li><a href=\"#prometheus-adapter\">prometheus-adapter</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#metrics\">Metrics</a></p>\n<ul>\n<li><a href=\"#%E6%8C%87%E6%A0%87%E7%B1%BB%E5%9E%8B\">指标类型</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#expose-metrics\">Expose Metrics</a></p>\n<ul>\n<li>\n<p><a href=\"#metrics-url\">metrics url</a></p>\n</li>\n<li>\n<p><a href=\"#exporter\">exporter</a></p>\n<ul>\n<li><a href=\"#go-code\">Go code</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#podmonitor\">PodMonitor</a></p>\n</li>\n<li>\n<p><a href=\"#servicemonitor\">ServiceMonitor</a></p>\n</li>\n<li>\n<p><a href=\"#hpa\">HPA</a></p>\n</li>\n<li>\n<p><a href=\"#demo\">Demo</a></p>\n<ul>\n<li><a href=\"#nsq-pod\">nsq-pod</a></li>\n<li><a href=\"#nsq-service\">nsq-service</a></li>\n<li><a href=\"#nsq-servicemonitor\">nsq-servicemonitor</a></li>\n<li><a href=\"#nsq-hpa\">nsq-hpa</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E6%80%BB%E7%BB%93\">总结</a></p>\n</li>\n<li>\n<p><a href=\"#renference\">Renference</a></p>\n</li>\n</ul>","frontmatter":{"title":"k8s自定义指标HPA","date":"2020-09-16"}}},"pageContext":{"slug":"/2020-09-16-k8s-custom-metrics.markdown"}},"staticQueryHashes":["3649515864"],"slicesMap":{}}