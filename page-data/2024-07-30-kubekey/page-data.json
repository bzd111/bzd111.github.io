{"componentChunkName":"component---src-templates-blog-post-js","path":"/2024-07-30-kubekey/","result":{"data":{"markdownRemark":{"html":"<!-- vim-markdown-toc GitLab -->\n<ul>\n<li><a href=\"#%E5%89%8D%E8%A8%80\">前言</a></li>\n<li><a href=\"#kubekey\">kubekey</a>\n<ul>\n<li><a href=\"#clusteryaml\">cluster.yaml</a></li>\n<li><a href=\"#%E5%9C%A8%E7%BA%BF%E9%83%A8%E7%BD%B2\">在线部署</a>\n<ul>\n<li><a href=\"#1%E5%AE%89%E8%A3%85harbor%E4%B8%8D%E9%9C%80%E8%A6%81%E7%9A%84%E5%8F%AF%E4%BB%A5%E8%B7%B3%E8%BF%87\">1.安装harbor(不需要的可以跳过)</a></li>\n<li><a href=\"#2%E5%AE%89%E8%A3%85k8s%E9%9B%86%E7%BE%A4\">2.安装k8s集群</a></li>\n<li><a href=\"#3%E9%AA%8C%E8%AF%81\">3.验证</a></li>\n</ul>\n</li>\n<li><a href=\"#%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B2\">离线部署</a>\n<ul>\n<li><a href=\"#0%E6%89%80%E9%9C%80%E6%96%87%E4%BB%B6%E8%AF%B4%E6%98%8E\">0.所需文件说明</a></li>\n<li><a href=\"#1%E5%AE%89%E8%A3%85kubekey\">1.安装kubekey</a></li>\n<li><a href=\"#2%E5%AE%89%E8%A3%85%E4%BB%93%E5%BA%93\">2.安装仓库</a></li>\n<li><a href=\"#3%E5%AE%89%E8%A3%85conntrack%E5%92%8Csocat\">3.安装conntrack和socat</a></li>\n<li><a href=\"#4%E5%AE%89%E8%A3%85%E9%9B%86%E7%BE%A4k8s\">4.安装集群k8s</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#reference\">reference</a></li>\n</ul>\n<!-- vim-markdown-toc -->\n<h1 id=\"前言\" style=\"position:relative;\"><a href=\"#%E5%89%8D%E8%A8%80\" aria-label=\"前言 permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>前言</h1>\n<p>手动部署k8s太过于痛苦，随即发现kubekey这样的工具。</p>\n<h1 id=\"kubekey\" style=\"position:relative;\"><a href=\"#kubekey\" aria-label=\"kubekey permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>kubekey</h1>\n<p>准备工作：<code class=\"language-text\">wget &lt;https://github.com/kubesphere/kubekey/releases/download/v3.1.1/kubekey-v3.1.1-linux-amd64.tar.gz> &amp;&amp; tar zxvf kubekey-v3.1.1-linux-amd64.tar.gz</code></p>\n<h2 id=\"clusteryaml\" style=\"position:relative;\"><a href=\"#clusteryaml\" aria-label=\"clusteryaml permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>cluster.yaml</h2>\n<details>\n  <summary>cluster.yaml详情</summary>\n  <pre><code>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> kubekey.kubesphere.io/v1alpha2\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Cluster\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> sample\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">{</span><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> master<span class=\"token punctuation\">,</span> <span class=\"token key atrule\">address</span><span class=\"token punctuation\">:</span> 192.168.1.15<span class=\"token punctuation\">,</span> <span class=\"token key atrule\">internalAddress</span><span class=\"token punctuation\">:</span> 192.168.1.15<span class=\"token punctuation\">,</span> <span class=\"token key atrule\">user</span><span class=\"token punctuation\">:</span> root<span class=\"token punctuation\">,</span> <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"xxx\"</span><span class=\"token punctuation\">}</span> <span class=\"token comment\">#修改集群IP，用户名密码</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">{</span><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> node1<span class=\"token punctuation\">,</span> <span class=\"token key atrule\">address</span><span class=\"token punctuation\">:</span> 192.168.1.16<span class=\"token punctuation\">,</span> <span class=\"token key atrule\">internalAddress</span><span class=\"token punctuation\">:</span> 192.168.1.16<span class=\"token punctuation\">,</span> <span class=\"token key atrule\">user</span><span class=\"token punctuation\">:</span> root<span class=\"token punctuation\">,</span> <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"xxx\"</span><span class=\"token punctuation\">}</span> <span class=\"token comment\">#修改集群IP，用户名密码</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">{</span><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> node2<span class=\"token punctuation\">,</span> <span class=\"token key atrule\">address</span><span class=\"token punctuation\">:</span> 192.168.1.17<span class=\"token punctuation\">,</span> <span class=\"token key atrule\">internalAddress</span><span class=\"token punctuation\">:</span> 192.168.1.17<span class=\"token punctuation\">,</span> <span class=\"token key atrule\">user</span><span class=\"token punctuation\">:</span> root<span class=\"token punctuation\">,</span> <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"xxx\"</span><span class=\"token punctuation\">}</span> <span class=\"token comment\">#修改集群IP，用户名密码</span>\n  <span class=\"token key atrule\">roleGroups</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">registry</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> master\n    <span class=\"token key atrule\">etcd</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> master\n    <span class=\"token key atrule\">control-plane</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> master\n    <span class=\"token key atrule\">worker</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> node1\n      <span class=\"token punctuation\">-</span> node2\n  <span class=\"token key atrule\">controlPlaneEndpoint</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">domain</span><span class=\"token punctuation\">:</span> lb.k8s.local <span class=\"token comment\"># lb address</span>\n    <span class=\"token key atrule\">address</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n    <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">6443</span>\n  <span class=\"token key atrule\">kubernetes</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"1.28.6\"</span> <span class=\"token comment\"># 配置k8s版本，可以根据这个命令查看支持的k8s版本`./kk version --show-supported-k8s`</span>\n    <span class=\"token key atrule\">clusterName</span><span class=\"token punctuation\">:</span> my\n    <span class=\"token key atrule\">autoRenewCerts</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">containerManager</span><span class=\"token punctuation\">:</span> docker\n  <span class=\"token key atrule\">etcd</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> kubekey\n  <span class=\"token key atrule\">registry</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">auths</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">\"192.168.1.18:443\"</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> admin\n        <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> Harbor12345\n        <span class=\"token key atrule\">certsPath</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"/etc/docker/certs.d/192.168.1.18:443\"</span>\n    <span class=\"token key atrule\">privateRegistry</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"192.168.1.18:443\"</span>\n    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> harbor\n    <span class=\"token key atrule\">namespaceOverride</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"kubesphere\"</span>\n    <span class=\"token key atrule\">registryMirrors</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">insecureRegistries</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token key atrule\">network</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">plugin</span><span class=\"token punctuation\">:</span> calico\n    <span class=\"token key atrule\">kubePodsCIDR</span><span class=\"token punctuation\">:</span> 10.233.64.0/18\n    <span class=\"token key atrule\">kubeServiceCIDR</span><span class=\"token punctuation\">:</span> 10.233.0.0/18\n    <span class=\"token key atrule\">multusCNI</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n  <span class=\"token key atrule\">addons</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p></code></pre></p>\n</details>\n<h2 id=\"在线部署\" style=\"position:relative;\"><a href=\"#%E5%9C%A8%E7%BA%BF%E9%83%A8%E7%BD%B2\" aria-label=\"在线部署 permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>在线部署</h2>\n<h3 id=\"1安装harbor不需要的可以跳过\" style=\"position:relative;\"><a href=\"#1%E5%AE%89%E8%A3%85harbor%E4%B8%8D%E9%9C%80%E8%A6%81%E7%9A%84%E5%8F%AF%E4%BB%A5%E8%B7%B3%E8%BF%87\" aria-label=\"1安装harbor不需要的可以跳过 permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1.安装harbor(不需要的可以跳过)</h3>\n<ol>\n<li>上传cluster.yaml文件，将ip地址都替换为当前主机IP</li>\n<li>export KKZONE=cn # 使用国内的镜像安装</li>\n<li>./kk init registry -f cluster.yaml</li>\n</ol>\n<h3 id=\"2安装k8s集群\" style=\"position:relative;\"><a href=\"#2%E5%AE%89%E8%A3%85k8s%E9%9B%86%E7%BE%A4\" aria-label=\"2安装k8s集群 permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2.安装k8s集群</h3>\n<ol>\n<li>yum install conntrack -y &#x26;&#x26;  yum install socat -y</li>\n<li>sh create_project_harbor.sh # 跳过harbor安装的，这一步也可以跳过</li>\n<li>./kk create cluster f cluster.yaml</li>\n</ol>\n<h3 id=\"3验证\" style=\"position:relative;\"><a href=\"#3%E9%AA%8C%E8%AF%81\" aria-label=\"3验证 permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.验证</h3>\n<p>kubectl get node 查看集群状态</p>\n<p>\\可选 仓库验证：<a href=\"https://ip+443%EF%BC%88admin/Harbor12345%EF%BC%89\">https://ip+443（admin/Harbor12345）</a></p>\n<h2 id=\"离线部署\" style=\"position:relative;\"><a href=\"#%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B2\" aria-label=\"离线部署 permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>离线部署</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">无法访问外网情况\n准备文件：kubekey-v3.1.1-linux-amd64.tar.gz、images.tar.gz、cluster.yaml、rpm.tar.gz、create_project_harbor.sh</code></pre></div>\n<h3 id=\"0所需文件说明\" style=\"position:relative;\"><a href=\"#0%E6%89%80%E9%9C%80%E6%96%87%E4%BB%B6%E8%AF%B4%E6%98%8E\" aria-label=\"0所需文件说明 permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>0.所需文件说明</h3>\n<p>kubekey-v3.1.1-linux-amd64.tar.gz</p>\n<p>images.tar.gz: 通过<code class=\"language-text\">export KKZONE=cn ./kk create manifest --with-kubernetes v1.28.6 --with-registry &amp;&amp; ./kk artifact export -m manifest-sample.yaml -o image.tar.gz</code></p>\n<p>cluster.yaml: <a href=\"#cluster.yaml\">文件详情</a></p>\n<p>rpm.tar.gz: 包含conntrack和socat， <a href=\"https://s3.bzd111.xyz/rpm.tar.gz\">下载地址</a></p>\n<p>create_project_harbor.sh: <a href=\"https://raw.githubusercontent.com/kubesphere/ks-installer/master/scripts/create_project_harbor.sh\">下载地址</a></p>\n<h3 id=\"1安装kubekey\" style=\"position:relative;\"><a href=\"#1%E5%AE%89%E8%A3%85kubekey\" aria-label=\"1安装kubekey permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1.安装kubekey</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">上传kubekey-v3.1.1-linux-amd64.tar.gz文件\n\ntar zxvf kubekey-v3.1.1-linux-amd64.tar.gz</code></pre></div>\n<h3 id=\"2安装仓库\" style=\"position:relative;\"><a href=\"#2%E5%AE%89%E8%A3%85%E4%BB%93%E5%BA%93\" aria-label=\"2安装仓库 permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2.安装仓库</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">上传：images.tar.gz、cluster.yaml\n\n1. export KKZONE=cn\n2. ./kk init registry -f cluster.yaml -a images.tar.gz</code></pre></div>\n<h3 id=\"3安装conntrack和socat\" style=\"position:relative;\"><a href=\"#3%E5%AE%89%E8%A3%85conntrack%E5%92%8Csocat\" aria-label=\"3安装conntrack和socat permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.安装conntrack和socat</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">上传：rpm.tar.gz\n\n1. rpm -ivh libnetfilter_*.rpm\n2. rpm -ivh socat-*</code></pre></div>\n<h3 id=\"4安装集群k8s\" style=\"position:relative;\"><a href=\"#4%E5%AE%89%E8%A3%85%E9%9B%86%E7%BE%A4k8s\" aria-label=\"4安装集群k8s permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4.安装集群k8s</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">上传：images.tar.gz、create_project_harbor.sh\n\n1. sh create_project_harbor.sh\n2. ./kk create cluster -f cluster.yaml -a images.tar.gz</code></pre></div>\n<h1 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>reference</h1>\n<ul>\n<li></li>\n<li><a href=\"https://kubesphere.io/zh/blogs/deploying-kubesphere-and-k8s-offline-with-kubekey/#5-%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE-harbor\">https://kubesphere.io/zh/blogs/deploying-kubesphere-and-k8s-offline-with-kubekey/#5-%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE-harbor</a></li>\n</ul>","tableOfContents":"<ul>\n<li>\n<p><a href=\"#%E5%89%8D%E8%A8%80\">前言</a></p>\n</li>\n<li>\n<p><a href=\"#kubekey\">kubekey</a></p>\n<ul>\n<li>\n<p><a href=\"#clusteryaml\">cluster.yaml</a></p>\n</li>\n<li>\n<p><a href=\"#%E5%9C%A8%E7%BA%BF%E9%83%A8%E7%BD%B2\">在线部署</a></p>\n<ul>\n<li><a href=\"#1%E5%AE%89%E8%A3%85harbor%E4%B8%8D%E9%9C%80%E8%A6%81%E7%9A%84%E5%8F%AF%E4%BB%A5%E8%B7%B3%E8%BF%87\">1.安装harbor(不需要的可以跳过)</a></li>\n<li><a href=\"#2%E5%AE%89%E8%A3%85k8s%E9%9B%86%E7%BE%A4\">2.安装k8s集群</a></li>\n<li><a href=\"#3%E9%AA%8C%E8%AF%81\">3.验证</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B2\">离线部署</a></p>\n<ul>\n<li><a href=\"#0%E6%89%80%E9%9C%80%E6%96%87%E4%BB%B6%E8%AF%B4%E6%98%8E\">0.所需文件说明</a></li>\n<li><a href=\"#1%E5%AE%89%E8%A3%85kubekey\">1.安装kubekey</a></li>\n<li><a href=\"#2%E5%AE%89%E8%A3%85%E4%BB%93%E5%BA%93\">2.安装仓库</a></li>\n<li><a href=\"#3%E5%AE%89%E8%A3%85conntrack%E5%92%8Csocat\">3.安装conntrack和socat</a></li>\n<li><a href=\"#4%E5%AE%89%E8%A3%85%E9%9B%86%E7%BE%A4k8s\">4.安装集群k8s</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#reference\">reference</a></p>\n</li>\n</ul>","frontmatter":{"title":"kubekey","date":"2024-07-30"}}},"pageContext":{"slug":"/2024-07-30-kubekey"}},"staticQueryHashes":["3649515864"],"slicesMap":{}}