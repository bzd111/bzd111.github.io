{"componentChunkName":"component---src-templates-blog-post-js","path":"/2025-02-12-gateway_api/","result":{"data":{"markdownRemark":{"html":"<h1 id=\"live-with-gateway-api\" style=\"position:relative;\"><a href=\"#live-with-gateway-api\" aria-label=\"live with gateway api permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Live with Gateway API</h1>\n<p>本文是对<a href=\"https://github.com/BuoyantIO/gateway-api-workshop\">分享的记录</a>，全文使用了<a href=\"https://github.com/BuoyantIO/demosh\">demosh演示工具</a>。为了方便记录，我会转换成常用的命令和Yaml。实验介绍了<code class=\"language-text\">linkerd</code> 和 <code class=\"language-text\">istio</code> ，由于时间关系，我只尝试istio的方式。我会使用最新版本的gateway api和istio，进行实验。</p>\n<h1 id=\"准备\" style=\"position:relative;\"><a href=\"#%E5%87%86%E5%A4%87\" aria-label=\"准备 permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>准备</h1>\n<h2 id=\"k8s集群\" style=\"position:relative;\"><a href=\"#k8s%E9%9B%86%E7%BE%A4\" aria-label=\"k8s集群 permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>k8s集群</h2>\n<p>没有的话，使用仓库提供的<a href=\"https://raw.githubusercontent.com/BuoyantIO/gateway-api-workshop/refs/heads/main/create-cluster.sh\">create-cluster.sh</a></p>\n<h2 id=\"安装gateway-api\" style=\"position:relative;\"><a href=\"#%E5%AE%89%E8%A3%85gateway-api\" aria-label=\"安装gateway api permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>安装gateway api</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl apply <span class=\"token parameter variable\">-f</span> https://github.com/kubernetes-sigs/gateway-api/releases/download/v1.2.1/experimental-install.yaml\n\ncustomresourcedefinition.apiextensions.k8s.io/backendlbpolicies.gateway.networking.k8s.io created\ncustomresourcedefinition.apiextensions.k8s.io/backendtlspolicies.gateway.networking.k8s.io created\ncustomresourcedefinition.apiextensions.k8s.io/gatewayclasses.gateway.networking.k8s.io created\ncustomresourcedefinition.apiextensions.k8s.io/gateways.gateway.networking.k8s.io created\ncustomresourcedefinition.apiextensions.k8s.io/grpcroutes.gateway.networking.k8s.io created\ncustomresourcedefinition.apiextensions.k8s.io/httproutes.gateway.networking.k8s.io created\ncustomresourcedefinition.apiextensions.k8s.io/referencegrants.gateway.networking.k8s.io created\ncustomresourcedefinition.apiextensions.k8s.io/tcproutes.gateway.networking.k8s.io created\ncustomresourcedefinition.apiextensions.k8s.io/tlsroutes.gateway.networking.k8s.io created\ncustomresourcedefinition.apiextensions.k8s.io/udproutes.gateway.networking.k8s.io created</code></pre></div>\n<h2 id=\"安装isito\" style=\"position:relative;\"><a href=\"#%E5%AE%89%E8%A3%85isito\" aria-label=\"安装isito permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>安装isito</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-L</span> https://istio.io/downloadIstio <span class=\"token operator\">|</span> <span class=\"token assign-left variable\">ISTIO_VERSION</span><span class=\"token operator\">=</span><span class=\"token number\">1.24</span>.2 <span class=\"token function\">sh</span> - \n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">PATH</span></span><span class=\"token operator\">=</span><span class=\"token environment constant\">$PWD</span>/istio-1.24.2/bin:<span class=\"token environment constant\">$PATH</span>\n<span class=\"token function\">which</span> istioctl\nistioctl version\nistioctl x precheck\n\nistioctl <span class=\"token function\">install</span> <span class=\"token parameter variable\">--set</span> <span class=\"token assign-left variable\">profile</span><span class=\"token operator\">=</span>minimal <span class=\"token parameter variable\">-y</span>\n</code></pre></div>\n<h2 id=\"创建gateway\" style=\"position:relative;\"><a href=\"#%E5%88%9B%E5%BB%BAgateway\" aria-label=\"创建gateway permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>创建gateway</h2>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> gateway.networking.k8s.io/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Gateway\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ingress\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">gatewayClassName</span><span class=\"token punctuation\">:</span> istio\n  <span class=\"token key atrule\">listeners</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> http\n      <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> HTTP\n      <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n      <span class=\"token key atrule\">allowedRoutes</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">namespaces</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">from</span><span class=\"token punctuation\">:</span> All\n\n❯ k get gateway ingress\nNAME      CLASS   ADDRESS      PROGRAMMED   AGE\ningress   istio   172.28.0.2   True         59s          \n\n<span class=\"token comment\"># 查看ip</span>\n<span class=\"token comment\"># kubectl get gateway ingress -ojsonpath='{ .status.addresses[0].value }'</span></code></pre></div>\n<h2 id=\"安装测试应用\" style=\"position:relative;\"><a href=\"#%E5%AE%89%E8%A3%85%E6%B5%8B%E8%AF%95%E5%BA%94%E7%94%A8\" aria-label=\"安装测试应用 permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>安装测试应用</h2>\n<p>原文提供的helm命令，但是拉取不下来。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">helm <span class=\"token function\">install</span> faces <span class=\"token punctuation\">\\</span>\n     <span class=\"token parameter variable\">-n</span> faces <span class=\"token punctuation\">\\</span>\n     oci://ghcr.io/buoyantio/faces-chart <span class=\"token punctuation\">\\</span>\n     <span class=\"token parameter variable\">--version</span> <span class=\"token number\">2.0</span>.0-rc.1 <span class=\"token punctuation\">\\</span>\n     <span class=\"token parameter variable\">--values</span> faces/values.yaml</code></pre></div>\n<p>我找到<a href=\"https://github.com/BuoyantIO/faces-demo.git\">https://github.com/BuoyantIO/faces-demo.git</a> ，研究了一下，生成了一个output.yaml，apply了这个yaml</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl create namespace faces\n     \nkubectl label namespace faces istio-injection<span class=\"token operator\">=</span>enabled\n\nkubectl apply <span class=\"token parameter variable\">-f</span> yaml</code></pre></div>\n<ul>\n<li>\n<p>yaml</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># Source: faces-chart/templates/color.yaml</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"color\"</span>\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> faces\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"color\"</span>\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> ClusterIP\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"color\"</span>\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n      <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> http\n<span class=\"token punctuation\">---</span>\n<span class=\"token comment\"># Source: faces-chart/templates/color.yaml</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"color2\"</span>\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> faces\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"color2\"</span>\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> ClusterIP\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"color2\"</span>\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n      <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> http\n<span class=\"token punctuation\">---</span>\n<span class=\"token comment\"># Source: faces-chart/templates/color.yaml</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"color3\"</span>\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> faces\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"color3\"</span>\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> ClusterIP\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"color3\"</span>\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n      <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> http\n<span class=\"token punctuation\">---</span>\n<span class=\"token comment\"># Source: faces-chart/templates/face.yaml</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> face\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> faces\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> face\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> ClusterIP\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> face\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n      <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> http\n<span class=\"token punctuation\">---</span>\n<span class=\"token comment\"># Source: faces-chart/templates/faces-gui.yaml</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> faces<span class=\"token punctuation\">-</span>gui\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> faces\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> faces<span class=\"token punctuation\">-</span>gui\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> ClusterIP\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> faces<span class=\"token punctuation\">-</span>gui\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n      <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> http\n<span class=\"token punctuation\">---</span>\n<span class=\"token comment\"># Source: faces-chart/templates/smiley.yaml</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"smiley\"</span>\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> faces\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"smiley\"</span>\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> ClusterIP\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"smiley\"</span>\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n      <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> http\n<span class=\"token punctuation\">---</span>\n<span class=\"token comment\"># Source: faces-chart/templates/smiley.yaml</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"smiley2\"</span>\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> faces\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"smiley2\"</span>\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> ClusterIP\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"smiley2\"</span>\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n      <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> http\n<span class=\"token punctuation\">---</span>\n<span class=\"token comment\"># Source: faces-chart/templates/smiley.yaml</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"smiley3\"</span>\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> faces\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"smiley3\"</span>\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> ClusterIP\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"smiley3\"</span>\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n      <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> http\n<span class=\"token punctuation\">---</span>\n<span class=\"token comment\"># Source: faces-chart/templates/color.yaml</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"color\"</span>\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> faces\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"color\"</span>\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"color\"</span>\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"color\"</span>\n    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"color\"</span>\n          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> 192.168.1.94<span class=\"token punctuation\">:</span>443/demo/faces<span class=\"token punctuation\">-</span>color<span class=\"token punctuation\">:</span>2.0.0\n          <span class=\"token key atrule\">imagePullPolicy</span><span class=\"token punctuation\">:</span> IfNotPresent\n          <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> http\n              <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8000</span>\n          <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> FACES_SERVICE\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"color\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> USER_HEADER_NAME\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"X-Faces-User\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> DELAY_BUCKETS\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"0,5,10,15,20,50,200,500,1500\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ERROR_FRACTION\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n          <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 100m\n              <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 64Mi\n            <span class=\"token key atrule\">limits</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 250m\n              <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 128Mi\n<span class=\"token punctuation\">---</span>\n<span class=\"token comment\"># Source: faces-chart/templates/color.yaml</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"color2\"</span>\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> faces\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"color2\"</span>\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"color2\"</span>\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"color2\"</span>\n    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"color2\"</span>\n          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> 192.168.1.94<span class=\"token punctuation\">:</span>443/demo/faces<span class=\"token punctuation\">-</span>color<span class=\"token punctuation\">:</span>2.0.0\n          <span class=\"token key atrule\">imagePullPolicy</span><span class=\"token punctuation\">:</span> IfNotPresent\n          <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> http\n              <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8000</span>\n          <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> FACES_SERVICE\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"color\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> USER_HEADER_NAME\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"X-Faces-User\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"COLOR\"</span>\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> green\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> DELAY_BUCKETS\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"0,5,10,15,20,50,200,500,1500\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ERROR_FRACTION\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n          <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 100m\n              <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 64Mi\n            <span class=\"token key atrule\">limits</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 250m\n              <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 128Mi\n<span class=\"token punctuation\">---</span>\n<span class=\"token comment\"># Source: faces-chart/templates/color.yaml</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"color3\"</span>\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> faces\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"color3\"</span>\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"color3\"</span>\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"color3\"</span>\n    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"color3\"</span>\n          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> 192.168.1.94<span class=\"token punctuation\">:</span>443/demo/faces<span class=\"token punctuation\">-</span>color<span class=\"token punctuation\">:</span>2.0.0\n          <span class=\"token key atrule\">imagePullPolicy</span><span class=\"token punctuation\">:</span> IfNotPresent\n          <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> http\n              <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8000</span>\n          <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> FACES_SERVICE\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"color\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> USER_HEADER_NAME\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"X-Faces-User\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"COLOR\"</span>\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> darkblue\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> DELAY_BUCKETS\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"0,5,10,15,20,50,200,500,1500\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ERROR_FRACTION\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n          <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 100m\n              <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 64Mi\n            <span class=\"token key atrule\">limits</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 250m\n              <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 128Mi\n<span class=\"token punctuation\">---</span>\n<span class=\"token comment\"># Source: faces-chart/templates/face.yaml</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> face\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> faces\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> face\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> face\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> face\n    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> face\n          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> 192.168.1.94<span class=\"token punctuation\">:</span>443/demo/faces<span class=\"token punctuation\">-</span>workload<span class=\"token punctuation\">:</span>2.0.0\n          <span class=\"token key atrule\">imagePullPolicy</span><span class=\"token punctuation\">:</span> IfNotPresent\n          <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> http\n              <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8000</span>\n          <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> FACES_SERVICE\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"face\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> USER_HEADER_NAME\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"X-Faces-User\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ERROR_FRACTION\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> DELAY_BUCKETS\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n          <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 300m <span class=\"token comment\"># The face service doesn't need much memory, but it does need more</span>\n              <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 64Mi <span class=\"token comment\"># CPU than the other backend services since it has to call the</span>\n            <span class=\"token key atrule\">limits</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># face and smiley services, then composite the results.</span>\n              <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 500m\n              <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 128Mi\n<span class=\"token punctuation\">---</span>\n<span class=\"token comment\"># Source: faces-chart/templates/faces-gui.yaml</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> faces<span class=\"token punctuation\">-</span>gui\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> faces\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> faces<span class=\"token punctuation\">-</span>gui\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> faces<span class=\"token punctuation\">-</span>gui\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> faces<span class=\"token punctuation\">-</span>gui\n    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> faces<span class=\"token punctuation\">-</span>gui\n          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> 192.168.1.94<span class=\"token punctuation\">:</span>443/demo/faces<span class=\"token punctuation\">-</span>gui<span class=\"token punctuation\">:</span>2.0.0\n          <span class=\"token key atrule\">imagePullPolicy</span><span class=\"token punctuation\">:</span> IfNotPresent\n          <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> USER_HEADER_NAME\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"X-Faces-User\"</span>\n          <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> http\n              <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8000</span>\n          <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 50m\n              <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 64Mi\n            <span class=\"token key atrule\">limits</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 100m\n              <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 128Mi\n<span class=\"token punctuation\">---</span>\n<span class=\"token comment\"># Source: faces-chart/templates/smiley.yaml</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"smiley\"</span>\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> faces\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"smiley\"</span>\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"smiley\"</span>\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"smiley\"</span>\n    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"smiley\"</span>\n          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> 192.168.1.94<span class=\"token punctuation\">:</span>443/demo/faces<span class=\"token punctuation\">-</span>workload<span class=\"token punctuation\">:</span>2.0.0\n          <span class=\"token key atrule\">imagePullPolicy</span><span class=\"token punctuation\">:</span> IfNotPresent\n          <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> http\n              <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8000</span>\n          <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> FACES_SERVICE\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"smiley\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> USER_HEADER_NAME\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"X-Faces-User\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> DELAY_BUCKETS\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"0,5,10,15,20,50,200,500,1500\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ERROR_FRACTION\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n          <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 100m\n              <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 64Mi\n            <span class=\"token key atrule\">limits</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 250m\n              <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 128Mi\n<span class=\"token punctuation\">---</span>\n<span class=\"token comment\"># Source: faces-chart/templates/smiley.yaml</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"smiley2\"</span>\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> faces\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"smiley2\"</span>\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"smiley2\"</span>\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"smiley2\"</span>\n    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"smiley2\"</span>\n          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> 192.168.1.94<span class=\"token punctuation\">:</span>443/demo/faces<span class=\"token punctuation\">-</span>workload<span class=\"token punctuation\">:</span>2.0.0\n          <span class=\"token key atrule\">imagePullPolicy</span><span class=\"token punctuation\">:</span> IfNotPresent\n          <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> http\n              <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8000</span>\n          <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> FACES_SERVICE\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"smiley\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> USER_HEADER_NAME\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"X-Faces-User\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"SMILEY\"</span>\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> HeartEyes\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> DELAY_BUCKETS\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"0,5,10,15,20,50,200,500,1500\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ERROR_FRACTION\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n          <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 100m\n              <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 64Mi\n            <span class=\"token key atrule\">limits</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 250m\n              <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 128Mi\n<span class=\"token punctuation\">---</span>\n<span class=\"token comment\"># Source: faces-chart/templates/smiley.yaml</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"smiley3\"</span>\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> faces\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"smiley3\"</span>\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"smiley3\"</span>\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"smiley3\"</span>\n    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"smiley3\"</span>\n          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> 192.168.1.94<span class=\"token punctuation\">:</span>443/demo/faces<span class=\"token punctuation\">-</span>workload<span class=\"token punctuation\">:</span>2.0.0\n          <span class=\"token key atrule\">imagePullPolicy</span><span class=\"token punctuation\">:</span> IfNotPresent\n          <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> http\n              <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8000</span>\n          <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> FACES_SERVICE\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"smiley\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> USER_HEADER_NAME\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"X-Faces-User\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"SMILEY\"</span>\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> RollingEyes\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> DELAY_BUCKETS\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"0,5,10,15,20,50,200,500,1500\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ERROR_FRACTION\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"50\"</span>\n          <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 100m\n              <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 64Mi\n            <span class=\"token key atrule\">limits</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 250m\n              <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 128Mi</code></pre></div>\n</li>\n</ul>\n<h1 id=\"场景\" style=\"position:relative;\"><a href=\"#%E5%9C%BA%E6%99%AF\" aria-label=\"场景 permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>场景</h1>\n<h2 id=\"base\" style=\"position:relative;\"><a href=\"#base\" aria-label=\"base permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>base</h2>\n<p>gui-route.yaml</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> gateway.networking.k8s.io/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> HTTPRoute\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> faces<span class=\"token punctuation\">-</span>gui<span class=\"token punctuation\">-</span>route\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> faces\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">parentRefs</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ingress\n      <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> default\n  <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">matches</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> PathPrefix\n        <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> /gui/\n    <span class=\"token key atrule\">backendRefs</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> faces<span class=\"token punctuation\">-</span>gui\n      <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n    <span class=\"token key atrule\">filters</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> URLRewrite\n      <span class=\"token key atrule\">urlRewrite</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> ReplaceFullPath\n          <span class=\"token key atrule\">replaceFullPath</span><span class=\"token punctuation\">:</span> /</code></pre></div>\n<p>face-route.yaml</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> gateway.networking.k8s.io/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> HTTPRoute\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> face<span class=\"token punctuation\">-</span>route\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> faces\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">parentRefs</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ingress\n      <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> default\n      <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Gateway\n  <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">matches</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> PathPrefix\n        <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> /face\n    <span class=\"token key atrule\">filters</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> URLRewrite\n        <span class=\"token key atrule\">urlRewrite</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> ReplacePrefixMatch\n            <span class=\"token key atrule\">replacePrefixMatch</span><span class=\"token punctuation\">:</span> /\n    <span class=\"token key atrule\">backendRefs</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> face\n      <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></code></pre></div>\n<p><a href=\"http://localhost/gui\">http://localhost/gui</a> 打开浏览器可以看到页面</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c08ee9ab57fee417a8e8efce026d98d4/7b67d/gateway_api_image.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.87116564417178%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACjklEQVR42o2T309SYRzG+f/qptZFa+umbtra8r6bbtpaa7a1pgZKpo78MX+FkSSigB5QQgFBfg05ID8OIIaUIXAOfDocW4XZ5rs977P34n3e5/t8368uEt4jnxWh04Z2g3ZbAUVlpUVHadKRGyhyi7aKVusPZFm+FLpYpkw0W0XMS4TSx4i5ErmaTLnW4Liu8LUJcgfqbXW7wtIthARs4VmMuxHs4QkMuzHW96eZCnqZCa5ji1rZPsywHV0lnZUQxRTValW73On8+4jOYnuFMH+HMWENYeoao24nW7M3mbMbmbc8w2l5SCiWJuleI18okc/nKJVK1Go1DRdFdcZgimFfgKG9Mm+8XgZVHvH5MQQyDPjiGMIHRD0eDkwviMdSmsNUKkU2myWXy6mZt3sFrY5+Aiu3MW4sE7Jex7BhY//zDRbW9ZhtT/G6+ohuuZBmnyMVjsjls5ydnf0/w7e+CHqnC32wyJDdin6viMHpYHgnyaCwi8ETJB53kF57TEpMq+5Etew8yWSSRCJBJpPpKVtn9QwTcD9idMtJ2H2PEc+myg9YcL/no/Aar/cJkYMEUniZglTU8uuiWCwiSRKnp6e9Dk0uGyazHuNOjPHZfpXjTH4YYFzYxGhbwrQyRSgeIew0kTksqCIFLb9CoaBBUZRewSm/A0tgksGdfT7536mNiGD1TzDmExj7soJlfwm7P4HZvKh9m1z2UCu525CucLfTf38h3eLqEI6F+4wILhwztzCozjbm7jK9NsHM8ktWzH1kTprUa98Q06LmqtvlSqVCvV7XpqbHYbUhUzltUGu1Ofp+pnH3fNJUp6TeovKjiaJOidxqatmVy2VN9GJ2vwXPqfMLXMJaPee4wuj9BI4bpjHrVFEEAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"\"\n        src=\"/static/c08ee9ab57fee417a8e8efce026d98d4/a6d36/gateway_api_image.png\"\n        srcset=\"/static/c08ee9ab57fee417a8e8efce026d98d4/222b7/gateway_api_image.png 163w,\n/static/c08ee9ab57fee417a8e8efce026d98d4/ff46a/gateway_api_image.png 325w,\n/static/c08ee9ab57fee417a8e8efce026d98d4/a6d36/gateway_api_image.png 650w,\n/static/c08ee9ab57fee417a8e8efce026d98d4/e548f/gateway_api_image.png 975w,\n/static/c08ee9ab57fee417a8e8efce026d98d4/3c492/gateway_api_image.png 1300w,\n/static/c08ee9ab57fee417a8e8efce026d98d4/7b67d/gateway_api_image.png 2240w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"unconditional\" style=\"position:relative;\"><a href=\"#unconditional\" aria-label=\"unconditional permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>unconditional</h2>\n<p>smiley-route.yaml</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> gateway.networking.k8s.io/v1beta1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> HTTPRoute\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> smiley<span class=\"token punctuation\">-</span>route\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> faces\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">parentRefs</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n      <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> smiley\n      <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n  <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">backendRefs</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> smiley2\n          <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n          <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></code></pre></div>\n<p>smiley2服务是微笑的表情</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e4dc2283b7de833c16210611b509c612/e16b4/gateway_api_image_1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.14723926380368%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAACH0lEQVR42pWSW08aURSF+Y39K23Th75Ya0yTNrFeuBhN08SkfbBVRq6achlGC4gYqxGwBQZmgJGMg7RekIHh6zjUpKRP3cnOeThZ31l77eOSyzIXbZ3RcIB5e4tlmowsi/sa8f/l2lEMguUm0bKKUJSJKW1iDR2x1WFP73L+8xqj2+amP3AE/aFFqV1B6xh0Ly+57fUmgTHhDaHNF2wKS2z7p9iwz53Pz/nod7O/8YT1TJas9xEnjYYjuO6ZFE53+V4+o16rYxgGlj3RYDB+0PXOFsynJLyZPItSCm82z5Ik4s4esrIbJ6t0SEoJtF93juDuxqS65qOSzdFstx2ooijouj4GSuF5vgRnCYe8JIIzhMI+xMA0QmSVQ+Ep2pjDaDRO1DItLoTXaCd5qorK9dXVxL1rNZ1mTkziTud4KyZYSh+wkIyzkM7jSWxz0XcwWA9Ae3mqNEutIKE0zmk2G47DarXKpZ2pay+yQDz0imjEixieJRLxIYVmCERXOdp69q/D4Qi9FEetFGg0NWq1mtOqqjo5ut5nvrKYSrKcyeFOJfDZTj2pGB470xUximFOAs0hiJE1SsVTOraj++zuu9vtjkfeDswh+F/yactN0D/N+paH8OYUHwLLSOuPafYmgbZB9g+POT37QbVSQZZr1Ot1Wq0W/X4f13H5G7lijny5QL705yzuc1ApclTY5cZi4pM/gFua5mQnyzJXfy3mNzkpx2MaauhBAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"\"\n        src=\"/static/e4dc2283b7de833c16210611b509c612/a6d36/gateway_api_image_1.png\"\n        srcset=\"/static/e4dc2283b7de833c16210611b509c612/222b7/gateway_api_image_1.png 163w,\n/static/e4dc2283b7de833c16210611b509c612/ff46a/gateway_api_image_1.png 325w,\n/static/e4dc2283b7de833c16210611b509c612/a6d36/gateway_api_image_1.png 650w,\n/static/e4dc2283b7de833c16210611b509c612/e548f/gateway_api_image_1.png 975w,\n/static/e4dc2283b7de833c16210611b509c612/3c492/gateway_api_image_1.png 1300w,\n/static/e4dc2283b7de833c16210611b509c612/e16b4/gateway_api_image_1.png 2546w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>color-route.yaml</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> gateway.networking.k8s.io/v1alpha2\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> GRPCRoute\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> color<span class=\"token punctuation\">-</span>route\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> faces\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">parentRefs</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> color\n      <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n      <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n      <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n  <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">backendRefs</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> color2\n          <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></code></pre></div>\n<p><code class=\"language-text\">color</code> returns blue, but <code class=\"language-text\">color2</code> returns green</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1d25548e05a0f6c16094086c172893dd/42267/gateway_api_image_2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.987730061349694%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACQUlEQVR42qWT7UtTURzH/V963YuKKCI1ESwNpXrXc0EPamFFLwoikoJI7YXsQbe7mpsWBctKUhJ1Jmo+VJaJmem8987tzrZ2V2m5B3OfrruzFF9Fh3M4HDjn8/t+f7/fyfBOTROLxlgaycUk/zsy6nvtCJ13sLSbsXYIOPvquD/4kIZBB92TPYTCfj6rPpZDyZEgU1/8xGMJotHoWqC7NpNycxZPzVu4UZPLY9Mmyo3aXr2e6gcluGpycDn28jP9wCON8X6kH1HyIkkisViMeDz+F3hJKOKU/QDnLAWUOA5TVpvHGecxio3ZmNpvMzDcSP9IE4vpB6GudqaaXUzPhJj2evH5fCiKQjKpe8jouZvPLSGf50IuVUIhLcIOqmx7eGLaTIe7SgclF7WpI2f7mlDaGlBCX4mo4bWWL9uKOGHfz3lrAcV1hyiz7KTUeZSThkzquoypSwu/FjQFOjA81ojYZ8M/ozITUPD7/YiiSDAY1IFdtjxuWnfxzJJNhXU3TZbtVGhpcBk20uau1IuxpDBtaVYZxfehR8uhD1mWUjCPx8P8/LwOvGLfx2nHQS7aCil1HOGCUMDZ+uOUmHJwdpv1dlpheXjoJb0vmvn2/QeRiIqqqoTDYRKJhA5sM27lqmEbj6o3cM2QhUurbrkhh3uV62hpvb5GoT+oMjo+qVVYSimTZTll94/CdxOdvBYHGPrkZkga4M14B2/lVwx+bEUKTaQVrm74ubk5AoFAakUikdVF+defsARfGWD5vNw2vwFbqvRDEoUM5gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"\"\n        src=\"/static/1d25548e05a0f6c16094086c172893dd/a6d36/gateway_api_image_2.png\"\n        srcset=\"/static/1d25548e05a0f6c16094086c172893dd/222b7/gateway_api_image_2.png 163w,\n/static/1d25548e05a0f6c16094086c172893dd/ff46a/gateway_api_image_2.png 325w,\n/static/1d25548e05a0f6c16094086c172893dd/a6d36/gateway_api_image_2.png 650w,\n/static/1d25548e05a0f6c16094086c172893dd/e548f/gateway_api_image_2.png 975w,\n/static/1d25548e05a0f6c16094086c172893dd/3c492/gateway_api_image_2.png 1300w,\n/static/1d25548e05a0f6c16094086c172893dd/42267/gateway_api_image_2.png 2670w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"canary\" style=\"position:relative;\"><a href=\"#canary\" aria-label=\"canary permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>canary</h2>\n<p>先删除两条路由</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl delete <span class=\"token parameter variable\">-n</span> faces httproute smiley-route\nkubectl delete <span class=\"token parameter variable\">-n</span> faces grpcroute color-route</code></pre></div>\n<p>smiley-canary-10.yaml 灰度10%</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> gateway.networking.k8s.io/v1beta1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> HTTPRoute\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> smiley<span class=\"token punctuation\">-</span>canary\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> faces\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">parentRefs</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> smiley\n      <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n      <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n      <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n  <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">backendRefs</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> smiley\n          <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n          <span class=\"token key atrule\">weight</span><span class=\"token punctuation\">:</span> <span class=\"token number\">90</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> smiley2\n          <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n          <span class=\"token key atrule\">weight</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10</span></code></pre></div>\n<p>可以看到笑脸比较少。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/762279306a2afc7c9f202ab0346e0dc8/80cfc/gateway_api_image_3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.25766871165644%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAADHUlEQVR42n2T3U9bdRjH+4946Z03mhjjH2BijPHKC5MtMcZbM42JSwwuOAYxGzKyrVvVAU5ehtTBaCdldMBWsazv9LSlPX05faMvtKW0pUBboP34O8e5ZDf+km+e78XJk+/Lc3S2RB13vkVISePNVFmTkkRzJYKVDnKpSeGgjdyAvXaX47Mu+ydd/u/p9N51zNuz9LuzzEkmZiWz4BnMoRnu+DYY9kYxSRPMROM4UgHmn08SS2aJyhEikQitVuvVhRbTFyjGN7m26WJr/kO2Fj7SeHLuDUyW7xi3LZK69xqPHb+h5A+I+VxUqjX296vs7e3R6XTodrucnJzQ6/XQDWzGuPrExqh8zFW7h2t2r+BH/GB9xrArzo1wjaGlFe4qR+RXHxEevYgSz5DJppFlWUM0GtXUttttdPc9s7jCIww6Zewb4wITDLoiuMPDTHtN6N0uXP7vmVd8FG1rJA39pFN5EkqcTCajKVTVqVCV6symi4Sm3+W6J4Rf/z6SwKg7xPbk2zxcGuJX+wrhu69j8ZgpeK3kZi7QqB+yW9rVLKs2X8mwz1em35liRD5kwJ/ToPJLjhSD/jLXIwd8K2IxpHrsBqaRTZ8Ri8eEzRjpdFqzGggEkCSJYDCIbunvIXK+81yx+wg4Lgh8pfG89xMWN29hEAqLzz/gz4CZfKFIKfyUWq1OpVIRxexrs1r9t6B6vY7uF/NtHk5+zohPwWjsw/hHHz/6Eizc+5Sx5QkMDifzP3/MnOcvlKgHyXpDZCcyTCQ0hWohapbJZJJms4luOJjlp1CIkUgTQ0hY245r/E4oys3tAjcjNfTSFlM7Rzjdbu5PjVMsVyntFl8qVNWpvNFoiDu0fkN2/T2ubDgIrJ5DWj3PwDMnzbF3sBovc3tjkfzSWzz2zeJNlLGtP6FQqpBKJcnlcmSz2ZcKy+WyOJunD1heuMSYXOaR5RbmZT1jkRIrM19iXHvAVDCG5fevWfS76IgWu6cd4sLuzs6OZltRFE2Z+rTDbgtypH5Ij2MxWy/4oZjqgrMX/EzF6SltcXe1Wk2DWoaK/34/deE/2Gx3TUpxOrEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"\"\n        src=\"/static/762279306a2afc7c9f202ab0346e0dc8/a6d36/gateway_api_image_3.png\"\n        srcset=\"/static/762279306a2afc7c9f202ab0346e0dc8/222b7/gateway_api_image_3.png 163w,\n/static/762279306a2afc7c9f202ab0346e0dc8/ff46a/gateway_api_image_3.png 325w,\n/static/762279306a2afc7c9f202ab0346e0dc8/a6d36/gateway_api_image_3.png 650w,\n/static/762279306a2afc7c9f202ab0346e0dc8/e548f/gateway_api_image_3.png 975w,\n/static/762279306a2afc7c9f202ab0346e0dc8/3c492/gateway_api_image_3.png 1300w,\n/static/762279306a2afc7c9f202ab0346e0dc8/80cfc/gateway_api_image_3.png 1844w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3 id=\"模拟灰度发布\" style=\"position:relative;\"><a href=\"#%E6%A8%A1%E6%8B%9F%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83\" aria-label=\"模拟灰度发布 permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>模拟灰度发布</h3>\n<p>smiley-canary-10.yaml → smiley-canary-50.yaml → smiley-canary-90.yaml → smiley-canary-100.yaml</p>\n<p>流量比例从90-10，50-50，10-90，0-100，最后缩容到0，<code class=\"language-text\">kubectl scale -n faces deploy/smiley --replicas=0</code></p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> gateway.networking.k8s.io/v1beta1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> HTTPRoute\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> smiley<span class=\"token punctuation\">-</span>canary\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> faces\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">parentRefs</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> smiley\n      <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n      <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n      <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n  <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">backendRefs</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> smiley\n          <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n          <span class=\"token key atrule\">weight</span><span class=\"token punctuation\">:</span> 9~~0 50 10~~ 0\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> smiley2\n          <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n          <span class=\"token key atrule\">weight</span><span class=\"token punctuation\">:</span> 1~~0 50 90~~ 100</code></pre></div>\n<p>灰度完成之后的效果，但是这样流量转发，出了问题不好排查。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/392a20c75f266e30cc3c0a55825c994e/0faf1/gateway_api_image_4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.09815950920245%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAADG0lEQVR42oWUy28bZRTF/R+whG12iL+BDYhFF4gFWxaIHRI7dqhCBUqaponxoxGNW0pF1SYOcfNqgtNGddPELUlsE3v8GD/G9nhcP8bvyI86cexfZ+wiAq3ElY6+q0+j+51zz71jEPyHdLtdRjHg9Rj8Kx8M/sGbwhDKNZGf51HyRYRkloySpXTUoVBv0ep0qLwY8KI3oK993OX/w+AIe5n1p7kWkFgI7GE8zDEXDGIPBTEHVRwRH/Z4Hm9O5kFgEUkp8DyrkJZljo+PR7zPsDX0p97h9w0bjmUjPesYk0/cSDc+JnPzHONP9mibx9hZvkhQbRAN/ElOLaOqRQqFAqenp68znFqa5efDBKZ9AeOyjRmxjnlrDevWKlfFBlP3bFzzR8jsebSHfiAZSyOlJFLJFKFQCEmSiEaj9Hq9UUH3wTyznr+weTzsehcYP0iw7nHi9P7Bj54kjw/szAcFMk93Sc98QyqRIZVOabKzNJtNOlqfW60W/X5/VLB0/i0WN27gcBhRv3sb89N9/JZzRKwf8dMzHzntzrU0iSLsUbZ/TVWtImcyqMXim025cBjEKFaYCBf5XsunYi0uCRITQpLpaIsLvgDGZAslfJ/k+udExTAJKYmcTiOKIoIg4Pf7CQQCnJycYKgtfMZd1wrzD+1UHF9wedeLsPotkfvnGXcfUtTuth7dQS5kKYcfUq3UqNVq1Ov1IRqNBtVqdShbd9uwfeV9fnOt8avzLtumD7D4oqzf+grnrS8x+RI8Mn3Ivc3bxCUR0WUhmZA1yTKpVGpoiKyNj37+vRwGa1TCokk2RlTNVYnpyBFXowozGqYjDcyROLb0EfuCyOLcdTK5EoV8TmNZp1QqDdnqDNvt9qhgd3qMufXrLCyZ6FjeZfzxDtFfPiV58xMubj/jyPoe2ysT+JQaB+4dsnlVY5Qgq7mc1vqoKArxeJxyuTwquLlyiWUhyKJvnwerl5mXKmy47uB03WZOqrK5Osma101Tn+FBn1gsNpSrQ8/1sTm7LYb+q/XX0f/PeTbXt6LXOxk2X5fXfjV/+kCf/Vm8BHbC0QALyKtiAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"\"\n        src=\"/static/392a20c75f266e30cc3c0a55825c994e/a6d36/gateway_api_image_4.png\"\n        srcset=\"/static/392a20c75f266e30cc3c0a55825c994e/222b7/gateway_api_image_4.png 163w,\n/static/392a20c75f266e30cc3c0a55825c994e/ff46a/gateway_api_image_4.png 325w,\n/static/392a20c75f266e30cc3c0a55825c994e/a6d36/gateway_api_image_4.png 650w,\n/static/392a20c75f266e30cc3c0a55825c994e/e548f/gateway_api_image_4.png 975w,\n/static/392a20c75f266e30cc3c0a55825c994e/3c492/gateway_api_image_4.png 1300w,\n/static/392a20c75f266e30cc3c0a55825c994e/0faf1/gateway_api_image_4.png 1956w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>回滚</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl scale <span class=\"token parameter variable\">-n</span> faces deploy/smiley <span class=\"token parameter variable\">--replicas</span><span class=\"token operator\">=</span><span class=\"token number\">1</span>\nkubectl rollout status <span class=\"token parameter variable\">-n</span> faces deploy\nkubectl delete <span class=\"token parameter variable\">-n</span> faces httproute smiley-canary</code></pre></div>\n<p>灰度gRPC也是一样的操作</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> gateway.networking.k8s.io/v1alpha2\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> GRPCRoute\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> color<span class=\"token punctuation\">-</span>canary\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> faces\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">parentRefs</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> color\n      <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n      <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n      <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n  <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">backendRefs</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> color\n          <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n          <span class=\"token key atrule\">weight</span><span class=\"token punctuation\">:</span> <span class=\"token number\">50</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> color2\n          <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n          <span class=\"token key atrule\">weight</span><span class=\"token punctuation\">:</span> <span class=\"token number\">50</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3406f000b42a788dea7d0ecb420ce2fe/3d22e/gateway_api_image_5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.25766871165644%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC/klEQVR42nWT709TVxjHm/g3uMQ389X2yhhfLZnJglmMmrhlMXH4SjOj04j4oyLGSYYGulkMiqGT1tFW0K2jjMovgQXRKDAwVaQ6TNvb3t4L7b1tB4ItC9CK/XhvQdwyPck3z3lxzifP+T7fYxACQaSwyPtXbllL+1zurd61DA9FmX7BT1AW+Ss2iTcgEVGj+GIh1OlJ1DlILOTIvsqRevl+0ArwjLsIi7uQo20Wun1DOB70U9JShrW5kBNt1XhGh/A8HmBQ+Zve0SbCE1EiokhEirC4uPh/oM22GaliNSVNZ5GubqPLvh+Tcxfh71ZR5jrGiH0vT5y7GVHTCN77xBQVRVFQVZX5+XkymUxeK8CD7iPsrNuI8fYvXPYJmEcDfD/YR2lPLaf7uznWbuJwdzWPvV7EC8eRgyJKXEWKRAiFQoTDYaLR6FvgT9e/JujchNFdyXhPBX1dNm78eY90Rxk/dF6lw1bALefn3B9oZrrRjCyEGHv2DFmS3u1h5bVdOCrXUtpRS2vDQerd57EO9OKp2UJlbyM1Fz/lcm0BQyM3SXgOkYyNk5ycZGZmhtnZWdLpNKlUirm5uWUPn/q57hvm9N0OzrYWc6LlOIeaT2JqO4yxy4rd9xCr7xFjkp+Je+XIYhAxIqHEYkSWn+33+5FleQnYfauG1KUNnHKbEC59xG/m9ZRf+Ywp0xrKXUbGHHsJNOxhNDZFwteOGl0aiK43w0kkEitxMliehKkeuEvZ4B2+qStgj2Mn+1zF7K79hKL285xqM1Oi1eFAgL5Wi+bdRB6STCaJx+P5qgPfRMjgGexE7PlRu3iFO79+RZ19B6WOHfhchRywbafJ+QUtjdu56e2l/fcWBO0jCEIwP1lRy6NeBUHI+5kHujTjhy1bOdlppdn8IVUXNmC0beOPcx/w7c9fYq9aR33VxzyIPuWV1oSiKivd6Z1ms9n/fEXD88wiyfkMU5kFxmcUlLR2eHZa28dI/DNN9EWccU0LWS28GlEH6d7p0rv7d6h14Gu752Rdas4X/QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"\"\n        src=\"/static/3406f000b42a788dea7d0ecb420ce2fe/a6d36/gateway_api_image_5.png\"\n        srcset=\"/static/3406f000b42a788dea7d0ecb420ce2fe/222b7/gateway_api_image_5.png 163w,\n/static/3406f000b42a788dea7d0ecb420ce2fe/ff46a/gateway_api_image_5.png 325w,\n/static/3406f000b42a788dea7d0ecb420ce2fe/a6d36/gateway_api_image_5.png 650w,\n/static/3406f000b42a788dea7d0ecb420ce2fe/e548f/gateway_api_image_5.png 975w,\n/static/3406f000b42a788dea7d0ecb420ce2fe/3c492/gateway_api_image_5.png 1300w,\n/static/3406f000b42a788dea7d0ecb420ce2fe/3d22e/gateway_api_image_5.png 2010w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3 id=\"dynamic-routing\" style=\"position:relative;\"><a href=\"#dynamic-routing\" aria-label=\"dynamic routing permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><strong>Dynamic Routing</strong></h3>\n<p>可以基于path, headers, or query parameters灰度，这里是用edge cell or a center cell的方式。</p>\n<p><code class=\"language-text\">smiley-edge.yaml</code></p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> gateway.networking.k8s.io/v1alpha2\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> GRPCRoute\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> color<span class=\"token punctuation\">-</span>edge\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> faces\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">parentRefs</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> color\n      <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n      <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n      <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n  <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">matches</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">method</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> ColorService\n          <span class=\"token key atrule\">method</span><span class=\"token punctuation\">:</span> Edge\n      <span class=\"token key atrule\">backendRefs</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> color2\n          <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">backendRefs</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> color\n          <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fb6e78013716b4bdec05cccee2c9fae3/cc418/gateway_api_image_6.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.48466257668711%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAADE0lEQVR42o2T3U9bdRjH+TMW72ZizDIv5kuiMUu89sYrL9REMueymXgz3HzZxhjbHHbSAmu6bAVh6gYUGDSWlglsUNxAqINtcFopp/T0tKft6ZtthXSBtnw85zTMGBPjk/zeLn6f3/d5vr+nTpLThGWVjcKf5PNFUsk0pc0SpadbVLbLVCtVypUd9KjN/x11HRNXuDJ5iRbnRdrGmmkZOYPZY8I20cT1mR9xSzlGJZXV3Aa/BqeRUykK+TzZbJbt7W12dnaoVqt/Azu73iRl388Ry8s87nqFn+2vctxygLz9BZp/OMTc0JeE+t9nTimwLMywFpFRYjEkSWJra+vfCs2DX2C1vsPZkUY6Oj+gtecw54ZOYet4m2/vXOXqQAu2WydYWU8Q6bUhLQdQkgkNqiCKogGOaQ/sqqzrfbSEZ2EAq28dp8+Fw3cP24Kfid+GMHvdmBz1tDsPMTU7jGxvYu3hIqIUJqKBcrkchUKBYrFIpVKpASc9VpSWvfQ88CHa32Wxt4F+7wxF8wG+G7uGy/Qi86bnmJ7vIzd4ipQYIBpPoCaT/6jds5TtfpW2pQCWhwFOOs/wlbuVxvEbHB8+SfPdPpqnBjh918Hi+iKS5zBrwn0ichw5IhEOhwkEAgiCYKRfLpep89y7SWrwI84NmpjVDPqp8y0a2l9H6X6DC7eOMecyE3Ce4JHyBxnBQ1KRUTWn09pQVZWUtiY1tZubmzWFfd4xnN2fcnlygPbL+2i1HuTzG+/ReX4PF4cbuTlipb/vNI9jWZYnrYTFIEo8bhihG6IoCtFo1FBXAwoS7t/9mLx3MN3+kEvDn/BZ71GsznqaXN/gWBEZElaYl7I4uq8jrIY0WFRTpRowXV1ce0A3xwCOjraR7NjHWccFFizPM9r+Eg2W10i37uH89x8z3VPP8rWD+BIbyKEQCTVtpJvJZIx09Q+u70ulUg3oi8SYXbqPVxJxTbXhftCFa+k2rvGvGfdPMbca4JcnC2SeVo3mkyIRgsEgIQ3u9/uf1U7vGAPI/wz9gl6n3VbbHfp5F6YD/wKsAWlEGpH6dwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"\"\n        src=\"/static/fb6e78013716b4bdec05cccee2c9fae3/a6d36/gateway_api_image_6.png\"\n        srcset=\"/static/fb6e78013716b4bdec05cccee2c9fae3/222b7/gateway_api_image_6.png 163w,\n/static/fb6e78013716b4bdec05cccee2c9fae3/ff46a/gateway_api_image_6.png 325w,\n/static/fb6e78013716b4bdec05cccee2c9fae3/a6d36/gateway_api_image_6.png 650w,\n/static/fb6e78013716b4bdec05cccee2c9fae3/e548f/gateway_api_image_6.png 975w,\n/static/fb6e78013716b4bdec05cccee2c9fae3/3c492/gateway_api_image_6.png 1300w,\n/static/fb6e78013716b4bdec05cccee2c9fae3/cc418/gateway_api_image_6.png 1992w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><strong>Dynamic Canarying</strong></p>\n<p><code class=\"language-text\">smiley-edge-canary-50.yaml</code> 根据path灰度，全部流量的20%，在分成50%和50%</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> gateway.networking.k8s.io/v1beta1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> HTTPRoute\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> smiley<span class=\"token punctuation\">-</span>edge\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> faces\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">parentRefs</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> smiley\n      <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n      <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n      <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n  <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">matches</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"/edge\"</span>\n      <span class=\"token key atrule\">backendRefs</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> smiley3\n          <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n          <span class=\"token key atrule\">weight</span><span class=\"token punctuation\">:</span> <span class=\"token number\">50</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> smiley2\n          <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n          <span class=\"token key atrule\">weight</span><span class=\"token punctuation\">:</span> <span class=\"token number\">50</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">backendRefs</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> smiley\n          <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d95c45205acf85ca1fae1e741cf60979/e216b/gateway_api_image_7.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 69.93865030674846%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAADRUlEQVR42n2T20+bZRzH339jUS+82o2JMdmu1BuFhMXsitThaZvHJUbZGBtKjMLCRlcpFaThMNBSBtXZyEka6MBpwTXgOii00FLpkcP6drQ0o0Dbtf34vq8bM27xl3zzPM/F832+v+/v+wjz8wv4lpd5chWecC5QKDzCf0tYioi4V9fxBwOExThOb4CoGGMtuUssmSKZ2mY1mSSdzZCVLmQK/G8JFeZPuDB0kvIBHYYlD4b5aTSz65hd07TPeajsO4/6uxKaRhqYCfzJmHOMtfUYoVCQSCSikOTz+X21whWzioT9bSpNn3F7uoHgTBV1U4vk255n1FRNpaaU8VMH+ObKu/hWQywtOhHvxolGo2xubj6usLz7fSoaD1Ex3Izaokc9cIn6Wwt8afiYC5YuKkwdlJ39EI3VzJ2RH/BebZPsWZPUhVmWvJfh8XgkxaF/CKv1RzF2vsIxXQnavmN833+c11qK+GnoBJ93v4FubAjbWD2D7jDRoR5WjM0Ewhv4/StsbGywu7tLKpVSVrltoe6rI5hOHuaty0cw1zzD1MWnUbWUIKqfxdj0Kpe6muhRHeTadRvxSSPRYS3xrR3C4RBbW1uPt1zW+h5FtS9RNaBmYnGE3xct1Ew0U9xehKr3BBcdEc7dWKY7CFG7mqXRc/j8Yf7y+RRSt9uNy+VidnYWr9eLoNMVM6l9gfZr1fuvdExo8Xa9SHtnKXpLJ/fMbzLqtCOuehC9N9lK3iMejysKE4nEPuS2hTN1r3O67DAt/RrS0vjzEqFhqh1TzQE0rUfRX+/DWn8Iy8IcK04rblsvIclDWZ3f7ycYDCqQIyTHR2hwONHOjFM7dYOakbPUWc7wxeQo2vlb1M/O8elII6cGymmwG5n8bZyBQWnasTh3Y6KiShRFklLw5Qil02mEwT+MJBynOT/UjFXzHK5vD/LRj1+T73qZ/t4qajtKSWmeouvnD3AsrXDb4WBt446kKqBERVYXDofxSZ5ub28jDDtnsNta6Zybpu3qOxiMKvSOSX79RYfZbqVprBFjazE9Nr3i7+5OSsndQxK57Ww2+2jKsmcPj/f/tc/JX+oBMg/WXO4+mUxGyd3e3h47OzsKcrnc/tf7Gyx7o4hHJREmAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"\"\n        src=\"/static/d95c45205acf85ca1fae1e741cf60979/a6d36/gateway_api_image_7.png\"\n        srcset=\"/static/d95c45205acf85ca1fae1e741cf60979/222b7/gateway_api_image_7.png 163w,\n/static/d95c45205acf85ca1fae1e741cf60979/ff46a/gateway_api_image_7.png 325w,\n/static/d95c45205acf85ca1fae1e741cf60979/a6d36/gateway_api_image_7.png 650w,\n/static/d95c45205acf85ca1fae1e741cf60979/e548f/gateway_api_image_7.png 975w,\n/static/d95c45205acf85ca1fae1e741cf60979/3c492/gateway_api_image_7.png 1300w,\n/static/d95c45205acf85ca1fae1e741cf60979/e216b/gateway_api_image_7.png 1904w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3 id=\"rollback\" style=\"position:relative;\"><a href=\"#rollback\" aria-label=\"rollback permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Rollback</h3>\n<p>smiley3 有时候有问题。</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> gateway.networking.k8s.io/v1beta1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> HTTPRoute\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> smiley<span class=\"token punctuation\">-</span>edge\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> faces\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">parentRefs</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> smiley\n      <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n      <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n      <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n  <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">matches</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"/edge\"</span>\n      <span class=\"token key atrule\">backendRefs</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> smiley2\n          <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">backendRefs</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> smiley\n          <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b0b693011c7cb15612eed59027268df2/cb1ac/gateway_api_image_8.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.09815950920245%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAADSUlEQVR42oWU/U9bZRTH+7vxL1jMfjHxF2OiRg1DE7NEjUZdRIJuQWfi3NgWMsjW4UIy2It0bmNsBcbbDNkKG7QFdN0MsBeFFQVXB5a3ru/0vbTpmkHpbaF8fO6t06gzPsnJPbm5+Tzfc873XNWsdZqMlOG/z/o/8nXW1/PxuKOadjrx+QMEwxGm7t8nIPLFB0lC8ThSWiIpgbSWUz6W+P+j0pjK2ddbSYW+nKMDu/m8SzxNamoGyjg+dpM+cWG33c9kJMKg1YA7ECYSDuP3+1lZWVEguVzuLyDaZzhy9mXONbwC7c9T3FDIdMsm7Npn2WesR2p/jZ+N1UxFl5ixjBKMRAkGAiwsLJDJ/LtVqiNNH3Gov5a9Fz5mv+Y5yvSVHGh6m4r6Amp/HEDzTTknb+jwTM7jaq3BY3Picrvxer1YrVYcDgdzc3N/qlV9f9fAqbFR9l4qpdlYwpbWYjT67ZzUf8qWtmIaDaWo9Z8xax7C11iF3+XFK9QFhMpUKkU6nVZga2treeDqsQ1cHKinRfsmKc1TbNO+zsTXT2P9aiPbGjezWLcRg/ZVZn4dJKFXExVDc3k8+AT0cZNW7ezZT9XtHj7p2kFRUyG7vqujaqiTg4Md7DGdpqixkNLLO3HOXMNh+JAFl024Ikg0GsEjwHLJNptNCVmxatZYRGXLG9R2vM89/bvs6j2K5Y6O30YusNugYezKOzTrSphxW0jYhomEZNgiiUSCuLDWo4hGo2SzWQGs2cCx1vfQnNnE3eonUPcdZ7xzD5a2Ug5+e4qR6ifpOFfAlO0X3CMtuO0u7A47LmGn+XkxKJdLGcrS0lK+5CLdB2w3HKB64icOTdxCPXqDL67WsuPqYdQjQ3w5fpPDkxYs8056uxsJBKOEhcpYLEZEeFNWJ+fJZDIPzLQXUNexlZ7+0+SulFDRdxbz+Ze41/yi8OEZHnZvxXy9nnFvjGFTPx5fUPTNjs/nU0L2o9zLYDCYB5oaXuCEUc2lW72Yu8o4cec6nW1voTu/GY35Gj9cLsc4fJF4VtkJZUNCoZCiTgbKg/jblMNSiodZiZRwQEJEWuxtXFohJiItvPVAbNWyeL+6uiqanlFKfASU4cvLy/nfxh8W+h1SZJ/yj/Qb6AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"\"\n        src=\"/static/b0b693011c7cb15612eed59027268df2/a6d36/gateway_api_image_8.png\"\n        srcset=\"/static/b0b693011c7cb15612eed59027268df2/222b7/gateway_api_image_8.png 163w,\n/static/b0b693011c7cb15612eed59027268df2/ff46a/gateway_api_image_8.png 325w,\n/static/b0b693011c7cb15612eed59027268df2/a6d36/gateway_api_image_8.png 650w,\n/static/b0b693011c7cb15612eed59027268df2/e548f/gateway_api_image_8.png 975w,\n/static/b0b693011c7cb15612eed59027268df2/3c492/gateway_api_image_8.png 1300w,\n/static/b0b693011c7cb15612eed59027268df2/cb1ac/gateway_api_image_8.png 1936w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"abtest\" style=\"position:relative;\"><a href=\"#abtest\" aria-label=\"abtest permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>abtest</h2>\n<p>smiley-ab.yaml，header里带有x-faces-user: heart，会返回爱心</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> gateway.networking.k8s.io/v1beta1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> HTTPRoute\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> smiley<span class=\"token punctuation\">-</span>a<span class=\"token punctuation\">-</span>b\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> faces\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">parentRefs</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> smiley\n      <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n      <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n      <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n  <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">matches</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">headers</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"x-faces-user\"</span>\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"heart\"</span>\n      <span class=\"token key atrule\">backendRefs</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> smiley2\n          <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">backendRefs</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> smiley\n          <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/389d81461680ddf99b726c196c3d813e/09096/gateway_api_image_9.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 73.61963190184049%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC7ElEQVR42pWUW09TaRSG+z/GzPwTL/R6LvQfGO/Ucbw0c2kmRhRKsQ4KjBJHZkBUSmhVUCg9QYCW0hZo6e5hd/ewe6BCT0ixlGe+7gYLauLMSt6snZWdJ+v73rU+XUQKk1UztOOITojvo5aa7UxbR0cdfSt0mxEZKZUnn88jZbaRU2k+7FZRlTwHu2V2tms0PtY5FD8f8v3QjW8EmVj30u9PYfYv8mgtymhgk0nPEgNrClMeB+/iBZbkZZajbnK5IoqSoFqtts/xRae65efXCD84y915JzX9T/z5+h+sI78QHzrPnTkHha4zzC1MEIwrSCE/GTWHkkhQLpc1QKPROAXVGT0Buh1WDMEdem1v6A2k0K/4MCw46N0s0jU7xWiiRHp0gMiLp6TzH0iKDsPhMLFYjHg8zsHBQQdotw7hs9yi27WGar7OkN3KzLvHbEz/zj2nl9jEVWY2VlEnh0mb/0aSU4SCQWq1mgZoNpunO3xp7mPiyRUM7i1mH12g3zbPiKkPy8iv9C5vYnnwM1Nrq2RtejKOh+S2K+SyKpVKRVOpVNLgLbAGHF6XGPb56FnPM+Z30xdIM+gP8ywQoCeQ46l3iZfyLqrvL2TvKHElQzKpkMlkiEQiSJJENBqlXq+3gStjVwkbz9IjTKnqf+SJMGVemCIPnqN7zi5M+QGry4QS85EOLQhTCqiqKqBJbdRSqRT7+/udI9/3bnFvcZG+UIkepw3DuoreExTHdWMI7XDbPse4XGbJ+opFuwU1uy1AOQ1aKBTEGOXY29s7Ycp7Iz7TTbocbrKmywxYZ5h++wcblt+4Y3cTH7/ErM/Fe9cKTpeLhJJEFs62Omw53FIL/Bn49o2R2WdXeOiVWHl8kWGXHZPZiG3sBv2eLZyDF5hetWtbUhUmtO4vm82SODGLpwZ7TzheEfokrC+LXBe5VasKNY5rTbG7h4firj5q91YsFjXo8eicAh4vfUcnHoevav9hl/mfcfK1+daL8y8gJTDrfVuK4QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"\"\n        src=\"/static/389d81461680ddf99b726c196c3d813e/a6d36/gateway_api_image_9.png\"\n        srcset=\"/static/389d81461680ddf99b726c196c3d813e/222b7/gateway_api_image_9.png 163w,\n/static/389d81461680ddf99b726c196c3d813e/ff46a/gateway_api_image_9.png 325w,\n/static/389d81461680ddf99b726c196c3d813e/a6d36/gateway_api_image_9.png 650w,\n/static/389d81461680ddf99b726c196c3d813e/e548f/gateway_api_image_9.png 975w,\n/static/389d81461680ddf99b726c196c3d813e/3c492/gateway_api_image_9.png 1300w,\n/static/389d81461680ddf99b726c196c3d813e/09096/gateway_api_image_9.png 2104w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>清除</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">kubectl delete <span class=\"token punctuation\">-</span>n faces httproute smiley<span class=\"token punctuation\">-</span>a<span class=\"token punctuation\">-</span>b\nkubectl delete <span class=\"token punctuation\">-</span>n faces grpcroute color<span class=\"token punctuation\">-</span>a<span class=\"token punctuation\">-</span>b</code></pre></div>\n<p>timeout</p>\n<p><code class=\"language-text\">face-route.yaml</code> 增加了200ms的超时。</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> gateway.networking.k8s.io/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> HTTPRoute\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> face<span class=\"token punctuation\">-</span>route\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> faces\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">parentRefs</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ingress\n      <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> default\n      <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Gateway\n  <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">matches</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> PathPrefix\n        <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> /face\n    <span class=\"token key atrule\">filters</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> URLRewrite\n        <span class=\"token key atrule\">urlRewrite</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> ReplacePrefixMatch\n            <span class=\"token key atrule\">replacePrefixMatch</span><span class=\"token punctuation\">:</span> /\n    <span class=\"token key atrule\">backendRefs</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> face\n      <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n    <span class=\"token key atrule\">timeouts</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">request</span><span class=\"token punctuation\">:</span> 200ms</code></pre></div>\n<p>可以看到有超时的结果了</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7725befb7027c8452464591ad488309a/2adcb/gateway_api_image_10.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 71.16564417177914%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAADAklEQVR42pWU228iZRjG+T+89Vb/hFVj4o133ph4Z2KMmnhjNF70Sm9M27hV02533WYVti1bobSUHrYtDFvoARYGSmGAchgYoAwz0MWla0tP/Jyh2tV4iL7Jmy/fXPzyvN/zvGPJZtLkCzl6/Jfq0es9778rS7bUJCe3qFVrFKtNpFyJw9YTdL3D0dNndE57/NztmShO+sh/L8vujkAu8gCPP4xtL8aIEMf7aItCdIrATghbRmJmXySsdfAmXaTKMo26SllRODk5+StQWhmgPPcSjvlpsoE38a28z+LsOLrrRYSlUR56PiY+9wqB6iGFdAS5UkWt16nVanS73T7k8vLyOTC0vEzQNsSqL45rfhL38hzOYAq78y7OnTQ3gxEGBYGo3ET5boBiWEQ5OEApK2QyGfL5PLIsc35+fgVMBX+gGBkgtDBNbvsr0sERrAGB7b0hxsQoP4kO1pLjPN6vot/+HDkikjEhRZnj42POzs76fa0wsTBI7McbRD1TxCffJjbzATOCh23rq0xsCzjdX7Buf4fHchVt+j30fALNMK3Z1Lm4uPhTm85brPEiE1ubfB9XuReKci+cYCTZYjiW4E5CZS3gZ9Hvo1TKo3g/oSAFDUOMkZWy8a1ENptFkiRyuRynp6dYFsITKGuvMbS5QcL/LhuPPmMs6EH13sCxPkV29SPUh29Qy6Zp7G9Qr5TQ9KahsEmj0aDVaqFp2rXjlglD1bjjW8ZSKneWpri97mE0WuTW5DC2UIpFtxWX/abxZgo77q+RcxnqaoMDw5hKpdI/TcdNdX2gNR1jQbIzKBaYTS9xf9fLN6KES5rjS1+G+wkvLiN/vnKbB7a7iKl9ioYp5rimu7+fuq5fAZ3COHvWlxne3GLL8RYrsx9yy+9Gc77A6Oo88+5PCdpfJ6Q+pa23UDVjVFXtj1k38thutzk6OrrOpCXVeoZoPHKyfUa8prOrHpLUj9krFpGavxj3J0SrGoddM7yX/Q0xDTBVmTnsdDpXW/7bblv4H/VPP4Q/rt6v/GbXycIfUdoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image.png\"\n        title=\"\"\n        src=\"/static/7725befb7027c8452464591ad488309a/a6d36/gateway_api_image_10.png\"\n        srcset=\"/static/7725befb7027c8452464591ad488309a/222b7/gateway_api_image_10.png 163w,\n/static/7725befb7027c8452464591ad488309a/ff46a/gateway_api_image_10.png 325w,\n/static/7725befb7027c8452464591ad488309a/a6d36/gateway_api_image_10.png 650w,\n/static/7725befb7027c8452464591ad488309a/e548f/gateway_api_image_10.png 975w,\n/static/7725befb7027c8452464591ad488309a/3c492/gateway_api_image_10.png 1300w,\n/static/7725befb7027c8452464591ad488309a/2adcb/gateway_api_image_10.png 1984w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>","tableOfContents":"<ul>\n<li>\n<p><a href=\"#live-with-gateway-api\">Live with Gateway API</a></p>\n</li>\n<li>\n<p><a href=\"#%E5%87%86%E5%A4%87\">准备</a></p>\n<ul>\n<li><a href=\"#k8s%E9%9B%86%E7%BE%A4\">k8s集群</a></li>\n<li><a href=\"#%E5%AE%89%E8%A3%85gateway-api\">安装gateway api</a></li>\n<li><a href=\"#%E5%AE%89%E8%A3%85isito\">安装isito</a></li>\n<li><a href=\"#%E5%88%9B%E5%BB%BAgateway\">创建gateway</a></li>\n<li><a href=\"#%E5%AE%89%E8%A3%85%E6%B5%8B%E8%AF%95%E5%BA%94%E7%94%A8\">安装测试应用</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E5%9C%BA%E6%99%AF\">场景</a></p>\n<ul>\n<li>\n<p><a href=\"#base\">base</a></p>\n</li>\n<li>\n<p><a href=\"#unconditional\">unconditional</a></p>\n</li>\n<li>\n<p><a href=\"#canary\">canary</a></p>\n<ul>\n<li><a href=\"#%E6%A8%A1%E6%8B%9F%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83\">模拟灰度发布</a></li>\n<li><a href=\"#dynamic-routing\"><strong>Dynamic Routing</strong></a></li>\n<li><a href=\"#rollback\">Rollback</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#abtest\">abtest</a></p>\n</li>\n</ul>\n</li>\n</ul>","frontmatter":{"title":"gateway api初体验","date":"2025-02-12"}}},"pageContext":{"slug":"/2025-02-12-gateway_api"}},"staticQueryHashes":["3649515864"],"slicesMap":{}}