{"componentChunkName":"component---src-templates-blog-post-js","path":"/2019-11-25-python-sub-rsub.markdown/","result":{"data":{"markdownRemark":{"html":"<!-- vim-markdown-toc Redcarpet -->\n<ul>\n<li><a href=\"#%E5%89%8D%E8%A8%80\">前言</a></li>\n<li><a href=\"#moment-%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95\">moment 使用方法</a></li>\n<li><a href=\"#%E6%8A%BD%E7%A6%BB%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81\">抽离核心代码</a>\n<ul>\n<li><a href=\"#%E8%A7%A3%E6%9E%90\">解析</a></li>\n</ul>\n</li>\n<li><a href=\"#reference\">reference</a></li>\n</ul>\n<!-- vim-markdown-toc -->\n<h1 id=\"前言\" style=\"position:relative;\"><a href=\"#%E5%89%8D%E8%A8%80\" aria-label=\"前言 permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>前言</h1>\n<p>最近使用到<a href=\"https://momentjs.com/docs/\">Moment.js</a>，发现可以加减月份。python 中好像没有这个实现，遂在 github 上找到一个库<a href=\"https://github.com/aaugustin/datedelta\">datedelta</a></p>\n<h1 id=\"moment-使用方法\" style=\"position:relative;\"><a href=\"#moment-%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95\" aria-label=\"moment 使用方法 permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>moment 使用方法</h1>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> moment <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"moment\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">moment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"YYYY-MM\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>\n  <span class=\"token function\">moment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"months\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"YYYY-MM\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>输出结果：</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">❯ node moment.js\n2019-11\n2019-10</code></pre></div>\n<h1 id=\"抽离核心代码\" style=\"position:relative;\"><a href=\"#%E6%8A%BD%E7%A6%BB%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81\" aria-label=\"抽离核心代码 permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>抽离核心代码</h1>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> datetime\n\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">datedelta</span><span class=\"token punctuation\">:</span>\n\n    __slots__ <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'_years'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'_months'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'_days'</span><span class=\"token punctuation\">]</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">,</span> years<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> months<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> days<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        int_years <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>years<span class=\"token punctuation\">)</span>\n        int_months <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>months<span class=\"token punctuation\">)</span>\n        int_days <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>days<span class=\"token punctuation\">)</span>\n\n        self<span class=\"token punctuation\">.</span>_years <span class=\"token operator\">=</span> int_years\n        self<span class=\"token punctuation\">.</span>_months <span class=\"token operator\">=</span> int_months\n        self<span class=\"token punctuation\">.</span>_days <span class=\"token operator\">=</span> int_days\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__rsub__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> other<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">if</span> <span class=\"token builtin\">isinstance</span><span class=\"token punctuation\">(</span>other<span class=\"token punctuation\">,</span> datetime<span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            month <span class=\"token operator\">=</span> other<span class=\"token punctuation\">.</span>month\n            year <span class=\"token operator\">=</span> other<span class=\"token punctuation\">.</span>year\n\n            month <span class=\"token operator\">-=</span> self<span class=\"token punctuation\">.</span>_months\n            dyear<span class=\"token punctuation\">,</span> month0 <span class=\"token operator\">=</span> <span class=\"token builtin\">divmod</span><span class=\"token punctuation\">(</span>month <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">12</span><span class=\"token punctuation\">)</span>\n            year <span class=\"token operator\">+=</span> dyear\n            month <span class=\"token operator\">=</span> month0 <span class=\"token operator\">+</span> <span class=\"token number\">1</span>\n            result <span class=\"token operator\">=</span> other<span class=\"token punctuation\">.</span>replace<span class=\"token punctuation\">(</span>year<span class=\"token punctuation\">,</span> month<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\n            <span class=\"token keyword\">return</span> result\n\n\nMONTH <span class=\"token operator\">=</span> datedelta<span class=\"token punctuation\">(</span>months<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">'__main__'</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>datetime<span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">(</span><span class=\"token number\">2016</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> MONTH<span class=\"token punctuation\">)</span>\n    <span class=\"token comment\"># 2016-02-01</span></code></pre></div>\n<p>输出结果：\n<code class=\"language-text\">2016-02-01</code></p>\n<h2 id=\"解析\" style=\"position:relative;\"><a href=\"#%E8%A7%A3%E6%9E%90\" aria-label=\"解析 permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>解析</h2>\n<p>python 有很多魔法方法，比如加减乘除、取余取模、大于小于等于… 感兴趣的可以看<a href=\"https://docs.python.org/3/library/operator.htm://docs.python.org/3/library/operator.html\">官方文档</a></p>\n<p>值得一提的是，python 不仅提供了这些魔法方法，还提供部分反向操作符(+, -, *, /, %, divmod(), pow(), **, «, », &#x26;, ^, |)。</p>\n<p>如果 x-y，x 没有实现<strong>sub</strong>方法，那就要看 y 有没有实现<strong>rsub</strong>，如果 y 有实现这个方法，就可以会调用 y-x。</p>\n<p><a href=\"https://github.com/python/cpython/blob/master/Lib/datetime.py#L651\">datetime.date</a>的__sub__，只支持 timedelta 类型才能减。</p>\n<p>所以当 datetime.date(2016, 3, 1)去减 datedelta(months=1)时，会反向调用 datedelta 的__rsub__，来减去一个月。</p>\n<p>有时间下次整理下，python 的魔法方法</p>\n<h1 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"toc-anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>reference</h1>\n<ul>\n<li><a href=\"https://github.com/aaugustin/datedelta\">https://github.com/aaugustin/datedelta</a></li>\n</ul>","tableOfContents":"<ul>\n<li>\n<p><a href=\"#%E5%89%8D%E8%A8%80\">前言</a></p>\n</li>\n<li>\n<p><a href=\"#moment-%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95\">moment 使用方法</a></p>\n</li>\n<li>\n<p><a href=\"#%E6%8A%BD%E7%A6%BB%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81\">抽离核心代码</a></p>\n<ul>\n<li><a href=\"#%E8%A7%A3%E6%9E%90\">解析</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#reference\">reference</a></p>\n</li>\n</ul>","frontmatter":{"title":"python魔法函数  sub     rsub  ","date":"2019-11-25"}}},"pageContext":{"slug":"/2019-11-25-python-sub-rsub.markdown"}},"staticQueryHashes":["3649515864"],"slicesMap":{}}