---
date: "2025-07-12"
slug: "2025-07-12-mcp-for-beginners"
layout: post
title: "[ç¬”è®°]mcp for beginners"
tags: ["ai", "mcp"]
---

# mcp-for-beginners

# **01-MCP ä»‹ç»**

### **MCP æ ‡å‡†åŒ–çš„ä¼˜åŠ¿**

| **ä¼˜åŠ¿** | **æè¿°** |
| --- | --- |
| äº’æ“ä½œæ€§ | LLMs å¯æ— ç¼ä¸ä¸åŒä¾›åº”å•†çš„å·¥å…·ååŒå·¥ä½œ |
| ä¸€è‡´æ€§ | è·¨å¹³å°å’Œå·¥å…·çš„è¡Œä¸ºç»Ÿä¸€ |
| å¯é‡ç”¨æ€§ | ä¸€æ¬¡æ„å»ºçš„å·¥å…·å¯åœ¨é¡¹ç›®ä¸ç³»ç»Ÿä¸­å¤ç”¨ |
| åŠ é€Ÿå¼€å‘ | é€šè¿‡æ ‡å‡†åŒ–å³æ’å³ç”¨æ¥å£å‡å°‘å¼€å‘æ—¶é—´ |

## **MCP é«˜å±‚æ¶æ„æ¦‚è¿°**

MCP é‡‡ç”¨**å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¨¡å‹**ï¼š

- **MCP Hosts**Â è¿è¡Œ AI æ¨¡å‹
- **MCP Clients**Â å‘èµ·è¯·æ±‚
- **MCP Servers**Â æä¾›ä¸Šä¸‹æ–‡ã€å·¥å…·å’Œèƒ½åŠ›

### **å…³é”®ç»„ä»¶ï¼š**

- **èµ„æºï¼ˆResourcesï¼‰**Â â€“ é™æ€æˆ–åŠ¨æ€æ¨¡å‹æ•°æ®
- **æç¤ºï¼ˆPromptsï¼‰**Â â€“ é¢„å®šä¹‰çš„å·¥ä½œæµï¼Œç”¨äºå¼•å¯¼ç”Ÿæˆ
- **å·¥å…·ï¼ˆToolsï¼‰**Â â€“ å¯æ‰§è¡Œå‡½æ•°ï¼ˆå¦‚æœç´¢ã€è®¡ç®—ï¼‰
- **é‡‡æ ·ï¼ˆSamplingï¼‰**Â â€“ é€šè¿‡é€’å½’äº¤äº’å®ç°ä»£ç†è¡Œä¸º

## **MCP æœåŠ¡å™¨å¦‚ä½•å·¥ä½œ**

MCP æœåŠ¡å™¨æŒ‰ä»¥ä¸‹æ–¹å¼è¿ä½œï¼š

- **è¯·æ±‚æµç¨‹**ï¼š
    1. MCP å®¢æˆ·ç«¯å‘è¿è¡Œåœ¨ MCP Host ä¸­çš„ AI æ¨¡å‹å‘é€è¯·æ±‚ã€‚
    2. AI æ¨¡å‹è¯†åˆ«ä½•æ—¶éœ€è¦å¤–éƒ¨å·¥å…·æˆ–æ•°æ®ã€‚
    3. æ¨¡å‹ä½¿ç”¨æ ‡å‡†åŒ–åè®®ä¸ MCP æœåŠ¡å™¨é€šä¿¡ã€‚
- **MCP æœåŠ¡å™¨åŠŸèƒ½**ï¼š
    - å·¥å…·æ³¨å†Œï¼šç»´æŠ¤å¯ç”¨å·¥å…·åŠå…¶åŠŸèƒ½çš„ç›®å½•ã€‚
    - èº«ä»½éªŒè¯ï¼šéªŒè¯å·¥å…·è®¿é—®æƒé™ã€‚
    - è¯·æ±‚å¤„ç†ç¨‹åºï¼šå¤„ç†æ¥è‡ªæ¨¡å‹çš„å·¥å…·è¯·æ±‚ã€‚
    - å“åº”æ ¼å¼åŒ–å™¨ï¼šå°†å·¥å…·è¾“å‡ºæ ¼å¼åŒ–ä¸ºæ¨¡å‹å¯ç†è§£çš„ç»“æ„ã€‚
- **å·¥å…·æ‰§è¡Œ**ï¼š
    - æœåŠ¡å™¨å°†è¯·æ±‚è·¯ç”±åˆ°ç›¸åº”çš„å¤–éƒ¨å·¥å…·
    - å·¥å…·æ‰§è¡Œå…¶ä¸“ä¸šåŠŸèƒ½ï¼ˆæœç´¢ã€è®¡ç®—ã€æ•°æ®åº“æŸ¥è¯¢ç­‰ï¼‰
    - ç»“æœä»¥ä¸€è‡´çš„æ ¼å¼è¿”å›ç»™æ¨¡å‹
- **å“åº”å®Œæˆ**ï¼š
    - AI æ¨¡å‹å°†å·¥å…·è¾“å‡ºæ•´åˆåˆ°å…¶å“åº”ä¸­ã€‚
    - æœ€ç»ˆå“åº”è¿”å›ç»™å®¢æˆ·ç«¯åº”ç”¨ã€‚

![image.png](../images/mcp_image.png)

## **å¦‚ä½•æ„å»º MCP æœåŠ¡å™¨ï¼ˆé™„ç¤ºä¾‹ï¼‰**

MCP æœåŠ¡å™¨å…è®¸é€šè¿‡æä¾›æ•°æ®å’ŒåŠŸèƒ½æ¥æ‰©å±• LLM èƒ½åŠ›ã€‚

å‡†å¤‡å°è¯•äº†å—ï¼Ÿä»¥ä¸‹æ˜¯ä¸åŒè¯­è¨€åˆ›å»ºç®€å• MCP æœåŠ¡å™¨çš„ç¤ºä¾‹ï¼š

- **Python ç¤ºä¾‹**ï¼š[https://github.com/modelcontextprotocol/python-sdk](https://github.com/modelcontextprotocol/python-sdk)
- **TypeScript ç¤ºä¾‹**ï¼š[https://github.com/modelcontextprotocol/typescript-sdk](https://github.com/modelcontextprotocol/typescript-sdk)
- **Java ç¤ºä¾‹**ï¼š[https://github.com/modelcontextprotocol/java-sdk](https://github.com/modelcontextprotocol/java-sdk)
- **C#/.NET ç¤ºä¾‹**ï¼š[https://github.com/modelcontextprotocol/csharp-sdk](https://github.com/modelcontextprotocol/csharp-sdk)

## **ğŸŒ MCP å®é™…åº”ç”¨åœºæ™¯**

MCP é€šè¿‡æ‰©å±• AI èƒ½åŠ›å®ç°å¹¿æ³›åº”ç”¨ï¼š

| **åº”ç”¨åœºæ™¯** | **æè¿°** |
| --- | --- |
| ä¼ä¸šæ•°æ®é›†æˆ | å°† LLMs è¿æ¥åˆ°æ•°æ®åº“ã€CRM æˆ–å†…éƒ¨å·¥å…· |
| ä»£ç†å¼ AI ç³»ç»Ÿ | é€šè¿‡å·¥å…·è®¿é—®å’Œå†³ç­–å·¥ä½œæµå®ç°è‡ªä¸»ä»£ç† |
| å¤šæ¨¡æ€åº”ç”¨ | åœ¨å•ä¸€ AI åº”ç”¨ä¸­ç»“åˆæ–‡æœ¬ã€å›¾åƒå’ŒéŸ³é¢‘å·¥å…· |
| å®æ—¶æ•°æ®é›†æˆ | å°†å®æ—¶æ•°æ®å¼•å…¥ AI äº¤äº’ï¼Œè·å¾—æ›´å‡†ç¡®ã€æ›´æ–°çš„è¾“å‡º |

### **ğŸ§  MCP = AI äº¤äº’çš„é€šç”¨æ ‡å‡†**

Model Context Protocol (MCP) æ˜¯ AI äº¤äº’çš„é€šç”¨æ ‡å‡†ï¼Œå°±åƒ USB-C æ ‡å‡†åŒ–äº†è®¾å¤‡çš„ç‰©ç†è¿æ¥ä¸€æ ·ã€‚åœ¨ AI é¢†åŸŸï¼ŒMCP æä¾›äº†ä¸€è‡´çš„æ¥å£ï¼Œå…è®¸æ¨¡å‹ï¼ˆå®¢æˆ·ç«¯ï¼‰ä¸å¤–éƒ¨å·¥å…·å’Œæ•°æ®æä¾›è€…ï¼ˆæœåŠ¡å™¨ï¼‰æ— ç¼é›†æˆã€‚è¿™æ¶ˆé™¤äº†ä¸ºæ¯ä¸ª API æˆ–æ•°æ®æºè®¾è®¡ä¸åŒå®šåˆ¶åè®®çš„éœ€æ±‚ã€‚

åœ¨ MCP ä¸‹ï¼Œå…¼å®¹ MCP çš„å·¥å…·ï¼ˆç§°ä¸º MCP æœåŠ¡å™¨ï¼‰éµå¾ªç»Ÿä¸€æ ‡å‡†ã€‚è¿™äº›æœåŠ¡å™¨å¯ä»¥åˆ—å‡ºå®ƒä»¬æä¾›çš„å·¥å…·æˆ–æ“ä½œï¼Œå¹¶åœ¨ AI ä»£ç†è¯·æ±‚æ—¶æ‰§è¡Œè¿™äº›æ“ä½œã€‚æ”¯æŒ MCP çš„ AI ä»£ç†å¹³å°èƒ½å¤Ÿå‘ç°æœåŠ¡å™¨ä¸Šçš„å¯ç”¨å·¥å…·ï¼Œå¹¶é€šè¿‡æ­¤æ ‡å‡†åè®®è°ƒç”¨å®ƒä»¬ã€‚

### **ğŸ’¡ ä¿ƒè¿›çŸ¥è¯†è®¿é—®**

é™¤äº†æä¾›å·¥å…·ï¼ŒMCP è¿˜ä¿ƒè¿›çŸ¥è¯†è®¿é—®ã€‚å®ƒä½¿åº”ç”¨ç¨‹åºèƒ½å¤Ÿé€šè¿‡å°† LLMs è¿æ¥åˆ°å„ç§æ•°æ®æºæ¥æä¾›ä¸Šä¸‹æ–‡ã€‚ä¾‹å¦‚ï¼ŒMCP æœåŠ¡å™¨å¯èƒ½ä»£è¡¨å…¬å¸çš„æ–‡æ¡£åº“ï¼Œå…è®¸ä»£ç†æŒ‰éœ€æ£€ç´¢ç›¸å…³ä¿¡æ¯ã€‚å¦ä¸€ä¸ªæœåŠ¡å™¨å¯èƒ½å¤„ç†å‘é€ç”µå­é‚®ä»¶æˆ–æ›´æ–°è®°å½•ç­‰ç‰¹å®šæ“ä½œã€‚ä»ä»£ç†çš„è§’åº¦æ¥çœ‹ï¼Œè¿™äº›åªæ˜¯å®ƒå¯ä½¿ç”¨çš„å·¥å…·â€”â€”ä¸€äº›å·¥å…·è¿”å›æ•°æ®ï¼ˆçŸ¥è¯†ä¸Šä¸‹æ–‡ï¼‰ï¼Œè€Œå…¶ä»–å·¥å…·æ‰§è¡Œæ“ä½œã€‚MCP é«˜æ•ˆåœ°ç®¡ç†ä¸¤è€…ã€‚

è¿æ¥åˆ° MCP æœåŠ¡å™¨çš„ä»£ç†é€šè¿‡æ ‡å‡†æ ¼å¼è‡ªåŠ¨äº†è§£æœåŠ¡å™¨çš„å¯ç”¨èƒ½åŠ›å’Œå¯è®¿é—®æ•°æ®ã€‚è¿™ç§æ ‡å‡†åŒ–å®ç°äº†åŠ¨æ€å·¥å…·å¯ç”¨æ€§ã€‚ä¾‹å¦‚ï¼Œå‘ä»£ç†ç³»ç»Ÿæ·»åŠ æ–°çš„ MCP æœåŠ¡å™¨ä¼šç«‹å³ä½¿å…¶åŠŸèƒ½å¯ç”¨ï¼Œè€Œæ— éœ€è¿›ä¸€æ­¥å®šåˆ¶ä»£ç†æŒ‡ä»¤ã€‚

è¿™ç§æµçº¿å‹é›†æˆç¬¦åˆ Mermaid å›¾è¡¨ä¸­æè¿°çš„æµç¨‹ï¼Œå…¶ä¸­æœåŠ¡å™¨æä¾›å·¥å…·å’ŒçŸ¥è¯†ï¼Œç¡®ä¿è·¨ç³»ç»Ÿçš„æ— ç¼åä½œã€‚

### **ğŸ‘‰ ç¤ºä¾‹ï¼šå¯æ‰©å±•çš„ä»£ç†è§£å†³æ–¹æ¡ˆ**

![image.png](../images/mcp_image_1.png)

### **ğŸ”„ å®¢æˆ·ç«¯-æœåŠ¡å™¨ LLM é›†æˆçš„é«˜çº§ MCP åœºæ™¯**

åœ¨åŸºç¡€ MCP æ¶æ„ä¹‹å¤–ï¼Œè¿˜æœ‰é«˜çº§åœºæ™¯ï¼Œå…¶ä¸­å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½åŒ…å« LLMsï¼Œå®ç°æ›´å¤æ‚çš„äº¤äº’ï¼š

```mermaid
---
title: å®¢æˆ·ç«¯-æœåŠ¡å™¨ LLM é›†æˆçš„é«˜çº§ MCP åœºæ™¯
description: å±•ç¤ºç”¨æˆ·ã€å®¢æˆ·ç«¯åº”ç”¨ã€å®¢æˆ·ç«¯ LLMã€å¤šä¸ª MCP æœåŠ¡å™¨å’ŒæœåŠ¡å™¨ LLM ä¹‹é—´è¯¦ç»†äº¤äº’æµç¨‹çš„åºåˆ—å›¾ï¼Œæè¿°äº†å·¥å…·å‘ç°ã€ç”¨æˆ·äº¤äº’ã€ç›´æ¥å·¥å…·è°ƒç”¨å’Œç‰¹æ€§åå•†é˜¶æ®µ
---
sequenceDiagram
    autonumber
    actor User as ğŸ‘¤ User
    participant ClientApp as ğŸ–¥ï¸ Client App
    participant ClientLLM as ğŸ§  Client LLM
    participant Server1 as ğŸ”§ MCP Server 1
    participant Server2 as ğŸ“š MCP Server 2
    participant ServerLLM as ğŸ¤– Server LLM

    %% å‘ç°é˜¶æ®µ
    rect rgb(220, 240, 255)
        Note over ClientApp, Server2: å·¥å…·å‘ç°é˜¶æ®µ
        ClientApp->>+Server1: è¯·æ±‚å¯ç”¨å·¥å…·/èµ„æº
        Server1-->>-ClientApp: è¿”å›å·¥å…·åˆ—è¡¨ (JSON)
        ClientApp->>+Server2: è¯·æ±‚å¯ç”¨å·¥å…·/èµ„æº
        Server2-->>-ClientApp: è¿”å›å·¥å…·åˆ—è¡¨ (JSON)
        Note right of ClientApp: æœ¬åœ°å­˜å‚¨ç»„åˆåçš„å·¥å…·ç›®å½•
    end

    %% ç”¨æˆ·äº¤äº’
    rect rgb(255, 240, 220)
        Note over User, ClientLLM: ç”¨æˆ·äº¤äº’é˜¶æ®µ
        User->>+ClientApp: è¾“å…¥è‡ªç„¶è¯­è¨€æç¤º
        ClientApp->>+ClientLLM: è½¬å‘æç¤º + å·¥å…·ç›®å½•
        ClientLLM->>-ClientLLM: åˆ†ææç¤ºå¹¶é€‰æ‹©å·¥å…·
    end

    %% åœºæ™¯ A: ç›´æ¥å·¥å…·è°ƒç”¨
    alt ç›´æ¥å·¥å…·è°ƒç”¨
        rect rgb(220, 255, 220)
            Note over ClientApp, Server1: åœºæ™¯ A: ç›´æ¥å·¥å…·è°ƒç”¨
            ClientLLM->>+ClientApp: è¯·æ±‚æ‰§è¡Œå·¥å…·
            ClientApp->>+Server1: æ‰§è¡Œç‰¹å®šå·¥å…·
            Server1-->>-ClientApp: è¿”å›ç»“æœ
            ClientApp->>+ClientLLM: å¤„ç†ç»“æœ
            ClientLLM-->>-ClientApp: ç”Ÿæˆå“åº”
            ClientApp-->>-User: æ˜¾ç¤ºæœ€ç»ˆç­”æ¡ˆ
        end

    %% åœºæ™¯ B: ç‰¹æ€§åå•†ï¼ˆVS Code é£æ ¼ï¼‰
    else ç‰¹æ€§åå•†ï¼ˆVS Code é£æ ¼ï¼‰
        rect rgb(255, 220, 220)
            Note over ClientApp, ServerLLM: åœºæ™¯ B: ç‰¹æ€§åå•†
            ClientLLM->>+ClientApp: è¯†åˆ«æ‰€éœ€èƒ½åŠ›
            ClientApp->>+Server2: åå•†ç‰¹æ€§/èƒ½åŠ›
            Server2->>+ServerLLM: è¯·æ±‚é¢å¤–ä¸Šä¸‹æ–‡
            ServerLLM-->>-Server2: æä¾›ä¸Šä¸‹æ–‡
            Server2-->>-ClientApp: è¿”å›å¯ç”¨ç‰¹æ€§
            ClientApp->>+Server2: è°ƒç”¨åå•†åçš„å·¥å…·
            Server2-->>-ClientApp: è¿”å›ç»“æœ
            ClientApp->>+ClientLLM: å¤„ç†ç»“æœ
            ClientLLM-->>-ClientApp: ç”Ÿæˆå“åº”
            ClientApp-->>-User: æ˜¾ç¤ºæœ€ç»ˆç­”æ¡ˆ
        end
    end
```

## **ğŸ” MCP çš„å®é™…ä¼˜åŠ¿**

ä½¿ç”¨ MCP çš„å®é™…ä¼˜åŠ¿åŒ…æ‹¬ï¼š

- **æ–°é²œåº¦**ï¼šæ¨¡å‹å¯è®¿é—®è¶…å‡ºå…¶è®­ç»ƒæ•°æ®çš„æœ€æ–°ä¿¡æ¯
- **èƒ½åŠ›æ‰©å±•**ï¼šæ¨¡å‹å¯åˆ©ç”¨æœªè®­ç»ƒè¿‡çš„ä¸“ä¸šå·¥å…·
- **å‡å°‘å¹»è§‰**ï¼šå¤–éƒ¨æ•°æ®æºæä¾›äº‹å®ä¾æ®
- **éšç§**ï¼šæ•æ„Ÿæ•°æ®å¯ä¿ç•™åœ¨å®‰å…¨ç¯å¢ƒä¸­ï¼Œè€ŒéåµŒå…¥æç¤ºä¸­

## **ğŸ“Œ å…³é”®è¦ç‚¹**

ä½¿ç”¨ MCP çš„å…³é”®è¦ç‚¹ï¼š

- **MCP**Â æ ‡å‡†åŒ–äº† AI æ¨¡å‹ä¸å·¥å…·å’Œæ•°æ®çš„äº¤äº’æ–¹å¼
- ä¿ƒè¿›**å¯æ‰©å±•æ€§ã€ä¸€è‡´æ€§å’Œäº’æ“ä½œæ€§**
- MCP æœ‰åŠ©äº**å‡å°‘å¼€å‘æ—¶é—´ã€æé«˜å¯é æ€§å¹¶æ‰©å±•æ¨¡å‹èƒ½åŠ›**
- å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¶æ„**æ”¯æŒçµæ´»ã€å¯æ‰©å±•çš„ AI åº”ç”¨**

# **02-æ ¸å¿ƒæ¦‚å¿µè¯¦è§£**

## **ğŸ” MCP æ¶æ„ï¼šæ·±å…¥è§£æ**

MCP ç”Ÿæ€ç³»ç»ŸåŸºäºå®¢æˆ·ç«¯-æœåŠ¡å™¨æ¨¡å‹æ„å»ºã€‚è¿™ç§æ¨¡å—åŒ–ç»“æ„ä½¿ AI åº”ç”¨èƒ½å¤Ÿé«˜æ•ˆåœ°ä¸å·¥å…·ã€æ•°æ®åº“ã€API å’Œä¸Šä¸‹æ–‡èµ„æºäº¤äº’ã€‚è®©æˆ‘ä»¬å°†è¿™ä¸ªæ¶æ„åˆ†è§£ä¸ºå…¶æ ¸å¿ƒç»„ä»¶ã€‚

### **1. ä¸»æœº**

åœ¨æ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼ˆMCPï¼‰ä¸­ï¼Œä¸»æœºä½œä¸ºç”¨æˆ·ä¸åè®®äº¤äº’çš„ä¸»è¦æ¥å£ï¼Œæ‰®æ¼”ç€å…³é”®è§’è‰²ã€‚ä¸»æœºæ˜¯å¯åŠ¨ä¸ MCP æœåŠ¡å™¨è¿æ¥ä»¥è®¿é—®æ•°æ®ã€å·¥å…·å’Œæç¤ºçš„åº”ç”¨ç¨‹åºæˆ–ç¯å¢ƒã€‚ä¸»æœºçš„ç¤ºä¾‹åŒ…æ‹¬é›†æˆå¼€å‘ç¯å¢ƒï¼ˆIDEï¼‰å¦‚ Visual Studio Codeã€AI å·¥å…·å¦‚ Claude Desktopï¼Œæˆ–ä¸ºç‰¹å®šä»»åŠ¡è®¾è®¡çš„è‡ªå®šä¹‰ä»£ç†ã€‚

**ä¸»æœº**æ˜¯æ‰§è¡Œæˆ–ä¸ AI æ¨¡å‹äº¤äº’çš„ LLM åº”ç”¨ç¨‹åºï¼Œå®ƒä»¬ï¼š

- æ‰§è¡Œæˆ–ä¸ AI æ¨¡å‹äº¤äº’ä»¥ç”Ÿæˆå“åº”
- å¯åŠ¨ä¸ MCP æœåŠ¡å™¨çš„è¿æ¥
- ç®¡ç†å¯¹è¯æµç¨‹å’Œç”¨æˆ·ç•Œé¢
- æ§åˆ¶æƒé™å’Œå®‰å…¨çº¦æŸ
- å¤„ç†æ•°æ®å…±äº«å’Œå·¥å…·æ‰§è¡Œçš„ç”¨æˆ·åŒæ„

### **2. å®¢æˆ·ç«¯**

å®¢æˆ·ç«¯æ˜¯ä¿ƒè¿›ä¸»æœºä¸ MCP æœåŠ¡å™¨ä¹‹é—´äº¤äº’çš„å…³é”®ç»„ä»¶ã€‚å®¢æˆ·ç«¯å……å½“ä¸­ä»‹ï¼Œä½¿ä¸»æœºèƒ½å¤Ÿè®¿é—®å’Œåˆ©ç”¨ MCP æœåŠ¡å™¨æä¾›çš„åŠŸèƒ½ã€‚å®ƒä»¬åœ¨ç¡®ä¿ MCP æ¶æ„å†…é€šä¿¡æµç•…å’Œæ•°æ®é«˜æ•ˆäº¤æ¢æ–¹é¢èµ·ç€è‡³å…³é‡è¦çš„ä½œç”¨ã€‚

**å®¢æˆ·ç«¯**æ˜¯ä¸»æœºåº”ç”¨ç¨‹åºå†…çš„è¿æ¥å™¨ï¼Œå®ƒä»¬ï¼š

- å‘æœåŠ¡å™¨å‘é€å¸¦æœ‰æç¤º/æŒ‡ä»¤çš„è¯·æ±‚
- ä¸æœåŠ¡å™¨åå•†èƒ½åŠ›
- ç®¡ç†æ¥è‡ªæ¨¡å‹çš„å·¥å…·æ‰§è¡Œè¯·æ±‚
- å¤„ç†å¹¶å‘ç”¨æˆ·æ˜¾ç¤ºå“åº”

### **3. æœåŠ¡å™¨**

æœåŠ¡å™¨è´Ÿè´£å¤„ç†æ¥è‡ª MCP å®¢æˆ·ç«¯çš„è¯·æ±‚å¹¶æä¾›é€‚å½“çš„å“åº”ã€‚å®ƒä»¬ç®¡ç†å„ç§æ“ä½œï¼Œå¦‚æ•°æ®æ£€ç´¢ã€å·¥å…·æ‰§è¡Œå’Œæç¤ºç”Ÿæˆã€‚æœåŠ¡å™¨ç¡®ä¿å®¢æˆ·ç«¯ä¸ä¸»æœºä¹‹é—´çš„é€šä¿¡é«˜æ•ˆå¯é ï¼Œä¿æŒäº¤äº’è¿‡ç¨‹çš„å®Œæ•´æ€§ã€‚

**æœåŠ¡å™¨**æ˜¯æä¾›ä¸Šä¸‹æ–‡å’Œèƒ½åŠ›çš„æœåŠ¡ï¼Œå®ƒä»¬ï¼š

- æ³¨å†Œå¯ç”¨åŠŸèƒ½ï¼ˆèµ„æºã€æç¤ºã€å·¥å…·ï¼‰
- æ¥æ”¶å¹¶æ‰§è¡Œæ¥è‡ªå®¢æˆ·ç«¯çš„å·¥å…·è°ƒç”¨
- æä¾›ä¸Šä¸‹æ–‡ä¿¡æ¯ä»¥å¢å¼ºæ¨¡å‹å“åº”
- å°†è¾“å‡ºè¿”å›ç»™å®¢æˆ·ç«¯
- åœ¨éœ€è¦æ—¶ç»´æŠ¤è·¨äº¤äº’çš„çŠ¶æ€

ä»»ä½•äººéƒ½å¯ä»¥å¼€å‘æœåŠ¡å™¨ï¼Œé€šè¿‡ä¸“ä¸šåŠŸèƒ½æ‰©å±•æ¨¡å‹èƒ½åŠ›ã€‚

### **4. æœåŠ¡å™¨åŠŸèƒ½**

æ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼ˆMCPï¼‰ä¸­çš„æœåŠ¡å™¨æä¾›åŸºæœ¬çš„æ„å»ºæ¨¡å—ï¼Œä½¿å®¢æˆ·ç«¯ã€ä¸»æœºå’Œè¯­è¨€æ¨¡å‹ä¹‹é—´èƒ½å¤Ÿè¿›è¡Œä¸°å¯Œçš„äº¤äº’ã€‚è¿™äº›åŠŸèƒ½æ—¨åœ¨é€šè¿‡æä¾›ç»“æ„åŒ–ä¸Šä¸‹æ–‡ã€å·¥å…·å’Œæç¤ºæ¥å¢å¼º MCP çš„èƒ½åŠ›ã€‚

MCP æœåŠ¡å™¨å¯ä»¥æä¾›ä»¥ä¸‹ä»»ä½•åŠŸèƒ½ï¼š

### **ğŸ“‘ èµ„æº**

æ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼ˆMCPï¼‰ä¸­çš„èµ„æºåŒ…æ‹¬ç”¨æˆ·æˆ– AI æ¨¡å‹å¯ä»¥åˆ©ç”¨çš„å„ç§ä¸Šä¸‹æ–‡å’Œæ•°æ®ç±»å‹ï¼š

- **ä¸Šä¸‹æ–‡æ•°æ®**ï¼šç”¨æˆ·æˆ– AI æ¨¡å‹å¯ç”¨äºå†³ç­–å’Œä»»åŠ¡æ‰§è¡Œçš„ä¿¡æ¯å’Œä¸Šä¸‹æ–‡
- **çŸ¥è¯†åº“å’Œæ–‡æ¡£ä»“åº“**ï¼šç»“æ„åŒ–å’Œéç»“æ„åŒ–æ•°æ®çš„é›†åˆï¼Œå¦‚æ–‡ç« ã€æ‰‹å†Œå’Œç ”ç©¶è®ºæ–‡ï¼Œæä¾›æœ‰ä»·å€¼çš„è§è§£å’Œä¿¡æ¯
- **æœ¬åœ°æ–‡ä»¶å’Œæ•°æ®åº“**ï¼šå­˜å‚¨åœ¨è®¾å¤‡æœ¬åœ°æˆ–æ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œå¯ä¾›å¤„ç†å’Œåˆ†æ
- **API å’Œ Web æœåŠ¡**ï¼šæä¾›é¢å¤–æ•°æ®åŠŸèƒ½çš„å¤–éƒ¨æ¥å£å’ŒæœåŠ¡ï¼Œæ”¯æŒä¸å„ç§åœ¨çº¿èµ„æºå’Œå·¥å…·çš„é›†æˆ

### **ğŸ¤– æç¤º**

æ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼ˆMCPï¼‰ä¸­çš„æç¤ºåŒ…æ‹¬å„ç§é¢„å®šä¹‰çš„æ¨¡æ¿å’Œäº¤äº’æ¨¡å¼ï¼Œæ—¨åœ¨ç®€åŒ–ç”¨æˆ·å·¥ä½œæµç¨‹å¹¶å¢å¼ºé€šä¿¡ï¼š

- **æ¨¡æ¿åŒ–æ¶ˆæ¯å’Œå·¥ä½œæµç¨‹**ï¼šé¢„ç»“æ„åŒ–çš„æ¶ˆæ¯å’Œæµç¨‹ï¼Œå¼•å¯¼ç”¨æˆ·å®Œæˆç‰¹å®šä»»åŠ¡å’Œäº¤äº’
- **é¢„å®šä¹‰äº¤äº’æ¨¡å¼**ï¼šæ ‡å‡†åŒ–çš„æ“ä½œå’Œå“åº”åºåˆ—ï¼Œä¿ƒè¿›ä¸€è‡´é«˜æ•ˆçš„é€šä¿¡
- **ä¸“ä¸šå¯¹è¯æ¨¡æ¿**ï¼šä¸ºç‰¹å®šç±»å‹å¯¹è¯å®šåˆ¶çš„å¯å®šåˆ¶æ¨¡æ¿ï¼Œç¡®ä¿ç›¸å…³å’Œä¸Šä¸‹æ–‡é€‚å½“çš„äº¤äº’

æç¤ºæ¨¡æ¿ç¤ºä¾‹å¦‚ä¸‹ï¼š

```markdown
æ ¹æ®ä»¥ä¸‹ {{product}} å’Œ {{keywords}} ç”Ÿæˆäº§å“æ ‡è¯­
```

### **â›ï¸ å·¥å…·**

æ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼ˆMCPï¼‰ä¸­çš„å·¥å…·æ˜¯ AI æ¨¡å‹å¯ä»¥æ‰§è¡Œä»¥å®Œæˆç‰¹å®šä»»åŠ¡çš„å‡½æ•°ã€‚è¿™äº›å·¥å…·æ—¨åœ¨é€šè¿‡æä¾›ç»“æ„åŒ–å’Œå¯é çš„æ“ä½œæ¥å¢å¼º AI æ¨¡å‹çš„èƒ½åŠ›ã€‚å…³é”®æ–¹é¢åŒ…æ‹¬ï¼š

- **AI æ¨¡å‹æ‰§è¡Œçš„å‡½æ•°**ï¼šå·¥å…·æ˜¯ AI æ¨¡å‹å¯ä»¥è°ƒç”¨çš„å¯æ‰§è¡Œå‡½æ•°ï¼Œç”¨äºæ‰§è¡Œå„ç§ä»»åŠ¡
- **å”¯ä¸€åç§°å’Œæè¿°**ï¼šæ¯ä¸ªå·¥å…·éƒ½æœ‰ä¸€ä¸ªç‹¬ç‰¹çš„åç§°å’Œè¯¦ç»†æè¿°ï¼Œè§£é‡Šå…¶ç›®çš„å’ŒåŠŸèƒ½
- **å‚æ•°å’Œè¾“å‡º**ï¼šå·¥å…·æ¥å—ç‰¹å®šå‚æ•°å¹¶è¿”å›ç»“æ„åŒ–è¾“å‡ºï¼Œç¡®ä¿ä¸€è‡´å’Œå¯é¢„æµ‹çš„ç»“æœ
- **ç¦»æ•£å‡½æ•°**ï¼šå·¥å…·æ‰§è¡Œç¦»æ•£å‡½æ•°ï¼Œå¦‚ç½‘ç»œæœç´¢ã€è®¡ç®—å’Œæ•°æ®åº“æŸ¥è¯¢

å·¥å…·ç¤ºä¾‹å¦‚ä¸‹ï¼š

```tsx
server.tool(
  "GetProducts",
  {
    pageSize: z.string().optional(),
    pageCount: z.string().optional(),
  },
  () => {
// ä» API è¿”å›ç»“æœ
  }
);

```

## **å®¢æˆ·ç«¯åŠŸèƒ½**

åœ¨æ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼ˆMCPï¼‰ä¸­ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨æä¾›å‡ ä¸ªå…³é”®åŠŸèƒ½ï¼Œå¢å¼ºåè®®çš„æ•´ä½“åŠŸèƒ½å’Œäº¤äº’ã€‚å…¶ä¸­ä¸€ä¸ªæ˜¾è‘—åŠŸèƒ½æ˜¯é‡‡æ ·ã€‚

### **ğŸ‘‰ é‡‡æ ·**

- **æœåŠ¡å™¨å¯åŠ¨çš„ä»£ç†è¡Œä¸º**ï¼šå®¢æˆ·ç«¯ä½¿æœåŠ¡å™¨èƒ½å¤Ÿè‡ªä¸»å¯åŠ¨ç‰¹å®šæ“ä½œæˆ–è¡Œä¸ºï¼Œå¢å¼ºç³»ç»Ÿçš„åŠ¨æ€èƒ½åŠ›
- **é€’å½’ LLM äº¤äº’**ï¼šæ­¤åŠŸèƒ½å…è®¸ä¸å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMsï¼‰è¿›è¡Œé€’å½’äº¤äº’ï¼Œæ”¯æŒæ›´å¤æ‚å’Œè¿­ä»£çš„ä»»åŠ¡å¤„ç†
- **è¯·æ±‚é¢å¤–çš„æ¨¡å‹è¡¥å…¨**ï¼šæœåŠ¡å™¨å¯ä»¥è¯·æ±‚æ¨¡å‹çš„é¢å¤–è¡¥å…¨ï¼Œç¡®ä¿å“åº”å…¨é¢ä¸”ä¸Šä¸‹æ–‡ç›¸å…³

## **MCP ä¸­çš„ä¿¡æ¯æµ**

æ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼ˆMCPï¼‰å®šä¹‰äº†ä¸»æœºã€å®¢æˆ·ç«¯ã€æœåŠ¡å™¨å’Œæ¨¡å‹ä¹‹é—´çš„ç»“æ„åŒ–ä¿¡æ¯æµã€‚ç†è§£è¿™ç§æµç¨‹æœ‰åŠ©äºé˜æ˜ç”¨æˆ·è¯·æ±‚å¦‚ä½•å¤„ç†ä»¥åŠå¤–éƒ¨å·¥å…·å’Œæ•°æ®å¦‚ä½•é›†æˆåˆ°æ¨¡å‹å“åº”ä¸­ã€‚

- **ä¸»æœºå¯åŠ¨è¿æ¥**
    
    ä¸»æœºåº”ç”¨ç¨‹åºï¼ˆå¦‚ IDE æˆ–èŠå¤©ç•Œé¢ï¼‰å»ºç«‹åˆ° MCP æœåŠ¡å™¨çš„è¿æ¥ï¼Œé€šå¸¸é€šè¿‡ STDIOã€WebSocket æˆ–å…¶ä»–æ”¯æŒçš„ä¼ è¾“æ–¹å¼
    
- **èƒ½åŠ›åå•†**
    
    å®¢æˆ·ç«¯ï¼ˆåµŒå…¥åœ¨ä¸»æœºä¸­ï¼‰å’ŒæœåŠ¡å™¨äº¤æ¢æœ‰å…³å…¶æ”¯æŒçš„åŠŸèƒ½ã€å·¥å…·ã€èµ„æºå’Œåè®®ç‰ˆæœ¬çš„ä¿¡æ¯ã€‚è¿™ç¡®ä¿åŒæ–¹äº†è§£ä¼šè¯ä¸­å¯ç”¨çš„èƒ½åŠ›
    
- **ç”¨æˆ·è¯·æ±‚**
    
    ç”¨æˆ·ä¸ä¸»æœºäº¤äº’ï¼ˆä¾‹å¦‚è¾“å…¥æç¤ºæˆ–å‘½ä»¤ï¼‰ã€‚ä¸»æœºæ”¶é›†æ­¤è¾“å…¥å¹¶å°†å…¶ä¼ é€’ç»™å®¢æˆ·ç«¯è¿›è¡Œå¤„ç†
    
- **èµ„æºæˆ–å·¥å…·ä½¿ç”¨**
    - å®¢æˆ·ç«¯å¯èƒ½ä»æœåŠ¡å™¨è¯·æ±‚é¢å¤–çš„ä¸Šä¸‹æ–‡æˆ–èµ„æºï¼ˆå¦‚æ–‡ä»¶ã€æ•°æ®åº“æ¡ç›®æˆ–çŸ¥è¯†åº“æ–‡ç« ï¼‰ä»¥ä¸°å¯Œæ¨¡å‹çš„ç†è§£
    - å¦‚æœæ¨¡å‹ç¡®å®šéœ€è¦å·¥å…·ï¼ˆä¾‹å¦‚è·å–æ•°æ®ã€æ‰§è¡Œè®¡ç®—æˆ–è°ƒç”¨ APIï¼‰ï¼Œå®¢æˆ·ç«¯å°†å·¥å…·è°ƒç”¨è¯·æ±‚å‘é€åˆ°æœåŠ¡å™¨ï¼ŒæŒ‡å®šå·¥å…·åç§°å’Œå‚æ•°
- **æœåŠ¡å™¨æ‰§è¡Œ**
    
    æœåŠ¡å™¨æ¥æ”¶èµ„æºæˆ–å·¥å…·è¯·æ±‚ï¼Œæ‰§è¡Œå¿…è¦çš„æ“ä½œï¼ˆå¦‚è¿è¡Œå‡½æ•°ã€æŸ¥è¯¢æ•°æ®åº“æˆ–æ£€ç´¢æ–‡ä»¶ï¼‰ï¼Œå¹¶å°†ç»“æœä»¥ç»“æ„åŒ–æ ¼å¼è¿”å›ç»™å®¢æˆ·ç«¯
    
- **å“åº”ç”Ÿæˆ**
    
    å®¢æˆ·ç«¯å°†æœåŠ¡å™¨çš„å“åº”ï¼ˆèµ„æºæ•°æ®ã€å·¥å…·è¾“å‡ºç­‰ï¼‰æ•´åˆåˆ°æ­£åœ¨è¿›è¡Œçš„æ¨¡å‹äº¤äº’ä¸­ã€‚æ¨¡å‹ä½¿ç”¨æ­¤ä¿¡æ¯ç”Ÿæˆå…¨é¢ä¸”ä¸Šä¸‹æ–‡ç›¸å…³çš„å“åº”
    
- **ç»“æœå‘ˆç°**
    
    ä¸»æœºä»å®¢æˆ·ç«¯æ¥æ”¶æœ€ç»ˆè¾“å‡ºï¼Œå¹¶å°†å…¶å‘ˆç°ç»™ç”¨æˆ·ï¼Œé€šå¸¸åŒ…æ‹¬æ¨¡å‹ç”Ÿæˆçš„æ–‡æœ¬å’Œä»»ä½•å·¥å…·æ‰§è¡Œæˆ–èµ„æºæŸ¥æ‰¾çš„ç»“æœ
    

è¿™ç§æµç¨‹ä½¿ MCP èƒ½å¤Ÿæ”¯æŒé«˜çº§ã€äº¤äº’å¼å’Œä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„ AI åº”ç”¨ç¨‹åºï¼Œé€šè¿‡æ— ç¼è¿æ¥æ¨¡å‹ä¸å¤–éƒ¨å·¥å…·å’Œæ•°æ®æºã€‚

## **åè®®è¯¦æƒ…**

MCPï¼ˆæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼‰å»ºç«‹åœ¨Â [JSON-RPC 2.0](https://www.jsonrpc.org/)Â ä¹‹ä¸Šï¼Œä¸ºä¸»æœºã€å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡æä¾›äº†æ ‡å‡†åŒ–ã€è¯­è¨€æ— å…³çš„æ¶ˆæ¯æ ¼å¼ã€‚è¿™ä¸ªåŸºç¡€æ”¯æŒè·¨ä¸åŒå¹³å°å’Œç¼–ç¨‹è¯­è¨€çš„å¯é ã€ç»“æ„åŒ–å’Œå¯æ‰©å±•çš„äº¤äº’ã€‚

### **å…³é”®åè®®ç‰¹æ€§**

MCP ä½¿ç”¨å·¥å…·è°ƒç”¨ã€èµ„æºè®¿é—®å’Œæç¤ºç®¡ç†çš„é™„åŠ çº¦å®šæ‰©å±•äº† JSON-RPC 2.0ã€‚å®ƒæ”¯æŒå¤šç§ä¼ è¾“å±‚ï¼ˆSTDIOã€WebSocketã€SSEï¼‰ï¼Œå¹¶ç¡®ä¿ç»„ä»¶ä¹‹é—´çš„å®‰å…¨ã€å¯æ‰©å±•å’Œè¯­è¨€æ— å…³çš„é€šä¿¡ã€‚

### **ğŸ§¢ åŸºç¡€åè®®**

- **JSON-RPC æ¶ˆæ¯æ ¼å¼**ï¼šæ‰€æœ‰è¯·æ±‚å’Œå“åº”ä½¿ç”¨ JSON-RPC 2.0 è§„èŒƒï¼Œç¡®ä¿æ–¹æ³•è°ƒç”¨ã€å‚æ•°ã€ç»“æœå’Œé”™è¯¯å¤„ç†çš„ç»“æ„ä¸€è‡´æ€§
- **æœ‰çŠ¶æ€è¿æ¥**ï¼šMCP ä¼šè¯åœ¨å¤šä¸ªè¯·æ±‚ä¹‹é—´ä¿æŒçŠ¶æ€ï¼Œæ”¯æŒæŒç»­å¯¹è¯ã€ä¸Šä¸‹æ–‡ç§¯ç´¯å’Œèµ„æºç®¡ç†
- **èƒ½åŠ›åå•†**ï¼šåœ¨è¿æ¥å»ºç«‹æœŸé—´ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨äº¤æ¢æœ‰å…³æ”¯æŒçš„åŠŸèƒ½ã€åè®®ç‰ˆæœ¬ã€å¯ç”¨å·¥å…·å’Œèµ„æºçš„ä¿¡æ¯ã€‚è¿™ç¡®ä¿åŒæ–¹äº†è§£å½¼æ­¤çš„èƒ½åŠ›å¹¶å¯ä»¥ç›¸åº”è°ƒæ•´

### **â• é™„åŠ å®ç”¨å·¥å…·**

ä»¥ä¸‹æ˜¯ MCP æä¾›çš„ä¸€äº›é™„åŠ å®ç”¨å·¥å…·å’Œåè®®æ‰©å±•ï¼Œä»¥å¢å¼ºå¼€å‘äººå‘˜ä½“éªŒå¹¶æ”¯æŒé«˜çº§åœºæ™¯ï¼š

- **é…ç½®é€‰é¡¹**ï¼šMCP å…è®¸åŠ¨æ€é…ç½®ä¼šè¯å‚æ•°ï¼Œå¦‚å·¥å…·æƒé™ã€èµ„æºè®¿é—®å’Œæ¨¡å‹è®¾ç½®ï¼Œé’ˆå¯¹æ¯æ¬¡äº¤äº’è¿›è¡Œå®šåˆ¶
- **è¿›åº¦è·Ÿè¸ª**ï¼šé•¿æ—¶é—´è¿è¡Œçš„æ“ä½œå¯ä»¥æŠ¥å‘Šè¿›åº¦æ›´æ–°ï¼Œåœ¨å¤æ‚ä»»åŠ¡æœŸé—´å®ç°å“åº”å¼ç”¨æˆ·ç•Œé¢å’Œæ›´å¥½çš„ç”¨æˆ·ä½“éªŒ
- **è¯·æ±‚å–æ¶ˆ**ï¼šå®¢æˆ·ç«¯å¯ä»¥å–æ¶ˆè¿›è¡Œä¸­çš„è¯·æ±‚ï¼Œå…è®¸ç”¨æˆ·ä¸­æ–­ä¸å†éœ€è¦æˆ–è€—æ—¶è¿‡é•¿çš„æ“ä½œ
- **é”™è¯¯æŠ¥å‘Š**ï¼šæ ‡å‡†åŒ–çš„é”™è¯¯æ¶ˆæ¯å’Œä»£ç æœ‰åŠ©äºè¯Šæ–­é—®é¢˜ã€ä¼˜é›…åœ°å¤„ç†æ•…éšœå¹¶å‘ç”¨æˆ·å’Œå¼€å‘äººå‘˜æä¾›å¯æ“ä½œçš„åé¦ˆ
- **æ—¥å¿—è®°å½•**ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½å¯ä»¥å‘å‡ºç»“æ„åŒ–æ—¥å¿—ç”¨äºå®¡è®¡ã€è°ƒè¯•å’Œç›‘æ§åè®®äº¤äº’

é€šè¿‡åˆ©ç”¨è¿™äº›åè®®ç‰¹æ€§ï¼ŒMCP ç¡®ä¿äº†è¯­è¨€æ¨¡å‹ä¸å¤–éƒ¨å·¥å…·æˆ–æ•°æ®æºä¹‹é—´çš„ç¨³å¥ã€å®‰å…¨å’Œçµæ´»çš„é€šä¿¡ã€‚

### **ğŸ” å®‰å…¨è€ƒè™‘**

MCP å®ç°åº”éµå¾ªå‡ ä¸ªå…³é”®å®‰å…¨åŸåˆ™ï¼Œä»¥ç¡®ä¿å®‰å…¨å’Œå¯ä¿¡çš„äº¤äº’ï¼š

- **ç”¨æˆ·åŒæ„å’Œæ§åˆ¶**ï¼šåœ¨æ‰§è¡Œä»»ä½•æ•°æ®è®¿é—®æˆ–æ“ä½œä¹‹å‰ï¼Œç”¨æˆ·å¿…é¡»æä¾›æ˜ç¡®åŒæ„ã€‚ä»–ä»¬åº”è¯¥æ¸…æ¥šåœ°æ§åˆ¶å…±äº«å“ªäº›æ•°æ®ä»¥åŠæˆæƒå“ªäº›æ“ä½œï¼Œå¹¶é€šè¿‡ç›´è§‚çš„ç”¨æˆ·ç•Œé¢æ”¯æŒå®¡æŸ¥å’Œæ‰¹å‡†æ´»åŠ¨
- **æ•°æ®éšç§**ï¼šç”¨æˆ·æ•°æ®åªèƒ½åœ¨æ˜ç¡®åŒæ„çš„æƒ…å†µä¸‹å…¬å¼€ï¼Œå¹¶ä¸”å¿…é¡»é€šè¿‡é€‚å½“çš„è®¿é—®æ§åˆ¶è¿›è¡Œä¿æŠ¤ã€‚MCP å®ç°å¿…é¡»é˜²èŒƒæœªç»æˆæƒçš„æ•°æ®ä¼ è¾“ï¼Œå¹¶ç¡®ä¿æ‰€æœ‰äº¤äº’è¿‡ç¨‹ä¸­ç»´æŠ¤éšç§
- **å·¥å…·å®‰å…¨**ï¼šåœ¨è°ƒç”¨ä»»ä½•å·¥å…·ä¹‹å‰ï¼Œéœ€è¦æ˜ç¡®çš„ç”¨æˆ·åŒæ„ã€‚ç”¨æˆ·åº”æ¸…æ¥šäº†è§£æ¯ä¸ªå·¥å…·çš„åŠŸèƒ½ï¼Œå¹¶ä¸”å¿…é¡»å¼ºåˆ¶æ‰§è¡Œå¼ºå¤§çš„å®‰å…¨è¾¹ç•Œä»¥é˜²æ­¢æ„å¤–æˆ–ä¸å®‰å…¨çš„å·¥å…·æ‰§è¡Œ

é€šè¿‡éµå¾ªè¿™äº›åŸåˆ™ï¼ŒMCP ç¡®ä¿åœ¨æ‰€æœ‰åè®®äº¤äº’ä¸­ç»´æŠ¤ç”¨æˆ·ä¿¡ä»»ã€éšç§å’Œå®‰å…¨ã€‚

## **ä»£ç ç¤ºä¾‹ï¼šå…³é”®ç»„ä»¶**

ä»¥ä¸‹æ˜¯å‡ ç§æµè¡Œç¼–ç¨‹è¯­è¨€çš„ä»£ç ç¤ºä¾‹ï¼Œè¯´æ˜å¦‚ä½•å®ç°å…³é”®çš„ MCP æœåŠ¡å™¨ç»„ä»¶å’Œå·¥å…·ã€‚

```python
#!/usr/bin/env python3
import asyncio
from mcp.server.fastmcp import FastMCP
from mcp.server.transports.stdio import serve_stdio

# åˆ›å»º FastMCP æœåŠ¡å™¨
mcp = FastMCP(
    name="å¤©æ°” MCP æœåŠ¡å™¨",
    version="1.0.0"
)

@mcp.tool()
def get_weather(location: str) -> dict:
    """è·å–å½“å‰ä½ç½®çš„å¤©æ°”"""
    # è¿™é‡Œé€šå¸¸ä¼šè°ƒç”¨å¤©æ°” API
    # ä¸ºæ¼”ç¤ºç®€åŒ–
    return {
        "temperature": 72.5,
        "conditions": "æ™´å¤©",
        "location": location
    }

# ä½¿ç”¨ç±»çš„æ›¿ä»£æ–¹æ³•
class WeatherTools:
    @mcp.tool()
    def forecast(self, location: str, days: int = 1) -> dict:
        """è·å–æŒ‡å®šä½ç½®æœªæ¥å¤©æ•°çš„å¤©æ°”é¢„æŠ¥"""
        # è¿™é‡Œé€šå¸¸ä¼šè°ƒç”¨å¤©æ°” API çš„é¢„æŠ¥ç«¯ç‚¹
        # ä¸ºæ¼”ç¤ºç®€åŒ–
        return {
            "location": location,
            "forecast": [
                {"day": i+1, "temperature": 70 + i, "conditions": "å±€éƒ¨å¤šäº‘"}
                for i in range(days)
            ]
        }

# å®ä¾‹åŒ–ç±»ä»¥æ³¨å†Œå…¶å·¥å…·
weather_tools = WeatherTools()

# ä½¿ç”¨ stdio ä¼ è¾“å¯åŠ¨æœåŠ¡å™¨
if __name__ == "__main__":
    asyncio.run(serve_stdio(mcp))
```

## **å®‰å…¨ä¸æˆæƒ**

MCP åŒ…å«å‡ ä¸ªå†…ç½®æ¦‚å¿µå’Œæœºåˆ¶ï¼Œç”¨äºåœ¨æ•´ä¸ªåè®®ä¸­ç®¡ç†å®‰å…¨æ€§å’Œæˆæƒï¼š

1. **å·¥å…·æƒé™æ§åˆ¶**ï¼š
    
    å®¢æˆ·ç«¯å¯ä»¥æŒ‡å®šæ¨¡å‹åœ¨ä¼šè¯æœŸé—´å…è®¸ä½¿ç”¨çš„å·¥å…·ã€‚è¿™ç¡®ä¿åªæœ‰æ˜ç¡®æˆæƒçš„å·¥å…·å¯è®¿é—®ï¼Œé™ä½äº†æ„å¤–æˆ–ä¸å®‰å…¨æ“ä½œçš„é£é™©ã€‚æƒé™å¯ä»¥æ ¹æ®ç”¨æˆ·åå¥½ã€ç»„ç»‡ç­–ç•¥æˆ–äº¤äº’ä¸Šä¸‹æ–‡åŠ¨æ€é…ç½®
    
2. **èº«ä»½éªŒè¯**ï¼š
    
    æœåŠ¡å™¨å¯ä»¥åœ¨æˆäºˆå·¥å…·ã€èµ„æºæˆ–æ•æ„Ÿæ“ä½œè®¿é—®æƒé™ä¹‹å‰è¦æ±‚èº«ä»½éªŒè¯ã€‚è¿™å¯èƒ½æ¶‰åŠ API å¯†é’¥ã€OAuth ä»¤ç‰Œæˆ–å…¶ä»–èº«ä»½éªŒè¯æ–¹æ¡ˆã€‚é€‚å½“çš„èº«ä»½éªŒè¯ç¡®ä¿åªæœ‰å—ä¿¡ä»»çš„å®¢æˆ·ç«¯å’Œç”¨æˆ·å¯ä»¥è°ƒç”¨æœåŠ¡å™¨ç«¯åŠŸèƒ½
    
3. **éªŒè¯**ï¼š
    
    å¯¹æ‰€æœ‰å·¥å…·è°ƒç”¨å¼ºåˆ¶æ‰§è¡Œå‚æ•°éªŒè¯ã€‚æ¯ä¸ªå·¥å…·å®šä¹‰å…¶å‚æ•°çš„é¢„æœŸç±»å‹ã€æ ¼å¼å’Œçº¦æŸï¼ŒæœåŠ¡å™¨ç›¸åº”åœ°éªŒè¯ä¼ å…¥è¯·æ±‚ã€‚è¿™é˜²æ­¢æ ¼å¼é”™è¯¯æˆ–æ¶æ„è¾“å…¥åˆ°è¾¾å·¥å…·å®ç°ï¼Œå¹¶æœ‰åŠ©äºç»´æŠ¤æ“ä½œçš„å®Œæ•´æ€§
    
4. **é€Ÿç‡é™åˆ¶**ï¼š
    
    ä¸ºé˜²æ­¢æ»¥ç”¨å¹¶ç¡®ä¿æœåŠ¡å™¨èµ„æºçš„å…¬å¹³ä½¿ç”¨ï¼ŒMCP æœåŠ¡å™¨å¯ä»¥å®ç°å·¥å…·è°ƒç”¨å’Œèµ„æºè®¿é—®çš„é€Ÿç‡é™åˆ¶ã€‚é€Ÿç‡é™åˆ¶å¯ä»¥æŒ‰ç”¨æˆ·ã€æŒ‰ä¼šè¯æˆ–å…¨å±€åº”ç”¨ï¼Œæœ‰åŠ©äºé˜²èŒƒæ‹’ç»æœåŠ¡æ”»å‡»æˆ–è¿‡åº¦èµ„æºæ¶ˆè€—
    

é€šè¿‡ç»“åˆè¿™äº›æœºåˆ¶ï¼ŒMCP ä¸ºå°†è¯­è¨€æ¨¡å‹ä¸å¤–éƒ¨å·¥å…·å’Œæ•°æ®æºé›†æˆæä¾›äº†å®‰å…¨åŸºç¡€ï¼ŒåŒæ—¶ä¸ºç”¨æˆ·å’Œå¼€å‘äººå‘˜æä¾›äº†å¯¹è®¿é—®å’Œä½¿ç”¨çš„ç»†ç²’åº¦æ§åˆ¶ã€‚

## **åè®®æ¶ˆæ¯**

MCP é€šä¿¡ä½¿ç”¨ç»“æ„åŒ– JSON æ¶ˆæ¯ï¼Œä»¥ä¿ƒè¿›å®¢æˆ·ç«¯ã€æœåŠ¡å™¨å’Œæ¨¡å‹ä¹‹é—´çš„æ¸…æ™°å¯é äº¤äº’ã€‚ä¸»è¦æ¶ˆæ¯ç±»å‹åŒ…æ‹¬ï¼š

- **å®¢æˆ·ç«¯è¯·æ±‚**
    
    ä»å®¢æˆ·ç«¯å‘é€åˆ°æœåŠ¡å™¨ï¼Œé€šå¸¸åŒ…æ‹¬ï¼š
    
    - ç”¨æˆ·çš„æç¤ºæˆ–å‘½ä»¤
    - ç”¨äºä¸Šä¸‹æ–‡çš„å¯¹è¯å†å²
    - å·¥å…·é…ç½®å’Œæƒé™
    - ä»»ä½•é¢å¤–çš„å…ƒæ•°æ®æˆ–ä¼šè¯ä¿¡æ¯
- **æ¨¡å‹å“åº”**
    
    ç”±æ¨¡å‹ï¼ˆé€šè¿‡å®¢æˆ·ç«¯ï¼‰è¿”å›ï¼ŒåŒ…å«ï¼š
    
    - åŸºäºæç¤ºå’Œä¸Šä¸‹æ–‡ç”Ÿæˆçš„æ–‡æœ¬æˆ–è¡¥å…¨
    - å¦‚æœæ¨¡å‹ç¡®å®šåº”è°ƒç”¨å·¥å…·ï¼Œåˆ™åŒ…å«å¯é€‰çš„å·¥å…·è°ƒç”¨æŒ‡ä»¤
    - æ ¹æ®éœ€è¦å¼•ç”¨èµ„æºæˆ–å…¶ä»–ä¸Šä¸‹æ–‡
- **å·¥å…·è¯·æ±‚**
    
    å½“éœ€è¦æ‰§è¡Œå·¥å…·æ—¶ï¼Œä»å®¢æˆ·ç«¯å‘é€åˆ°æœåŠ¡å™¨ã€‚æ­¤æ¶ˆæ¯åŒ…æ‹¬ï¼š
    
    - è¦è°ƒç”¨çš„å·¥å…·åç§°
    - å·¥å…·æ‰€éœ€çš„å‚æ•°ï¼ˆæ ¹æ®å·¥å…·çš„æ¨¡å¼è¿›è¡ŒéªŒè¯ï¼‰
    - ç”¨äºè·Ÿè¸ªè¯·æ±‚çš„ä¸Šä¸‹æ–‡ä¿¡æ¯æˆ–æ ‡è¯†ç¬¦
- **å·¥å…·å“åº”**
    
    æœåŠ¡å™¨æ‰§è¡Œå·¥å…·åè¿”å›ã€‚æ­¤æ¶ˆæ¯æä¾›ï¼š
    
    - å·¥å…·æ‰§è¡Œçš„ç»“æœï¼ˆç»“æ„åŒ–æ•°æ®æˆ–å†…å®¹ï¼‰
    - å¦‚æœå·¥å…·è°ƒç”¨å¤±è´¥ï¼Œåˆ™åŒ…å«ä»»ä½•é”™è¯¯æˆ–çŠ¶æ€ä¿¡æ¯
    - å¯é€‰åœ°åŒ…å«ä¸æ‰§è¡Œç›¸å…³çš„å…¶ä»–å…ƒæ•°æ®æˆ–æ—¥å¿—

è¿™äº›ç»“æ„åŒ–æ¶ˆæ¯ç¡®ä¿ MCP å·¥ä½œæµç¨‹ä¸­çš„æ¯ä¸ªæ­¥éª¤éƒ½æ˜¯æ˜ç¡®ã€å¯è¿½è¸ªå’Œå¯æ‰©å±•çš„ï¼Œæ”¯æŒé«˜çº§åœºæ™¯ï¼Œå¦‚å¤šè½®å¯¹è¯ã€å·¥å…·é“¾å’Œç¨³å¥çš„é”™è¯¯å¤„ç†ã€‚

## **å…³é”®è¦ç‚¹**

- MCP ä½¿ç”¨å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¶æ„è¿æ¥æ¨¡å‹ä¸å¤–éƒ¨åŠŸèƒ½
- ç”Ÿæ€ç³»ç»ŸåŒ…æ‹¬å®¢æˆ·ç«¯ã€ä¸»æœºã€æœåŠ¡å™¨ã€å·¥å…·å’Œæ•°æ®æº
- é€šä¿¡å¯ä»¥é€šè¿‡ STDIOã€SSE æˆ– WebSockets è¿›è¡Œ
- å·¥å…·æ˜¯æš´éœ²ç»™æ¨¡å‹çš„åŸºæœ¬åŠŸèƒ½å•å…ƒ
- ç»“æ„åŒ–é€šä¿¡åè®®ç¡®ä¿ä¸€è‡´çš„äº¤äº’

# **03-MCP å®‰å…¨æ€§**

## **å…¥é—¨æŒ‡å—**

æœ¬èŠ‚åŒ…å«å¤šä¸ªè¯¾ç¨‹ï¼š

- **1- çš„ç¬¬ä¸€ä¸ªæœåŠ¡å™¨**ï¼Œåœ¨ç¬¬ä¸€è¯¾ä¸­ï¼Œå°†å­¦ä¹ å¦‚ä½•åˆ›å»ºç¬¬ä¸€ä¸ªæœåŠ¡å™¨å¹¶ä½¿ç”¨æ£€æŸ¥å™¨å·¥å…·è¿›è¡Œæ£€æŸ¥ï¼Œè¿™æ˜¯æµ‹è¯•å’Œè°ƒè¯•æœåŠ¡å™¨çš„å®è´µæ–¹å¼
- **2- å®¢æˆ·ç«¯**ï¼Œåœ¨æœ¬è¯¾ä¸­ï¼Œå°†å­¦ä¹ å¦‚ä½•ç¼–å†™èƒ½è¿æ¥åˆ°æœåŠ¡å™¨çš„å®¢æˆ·ç«¯
- **3- å¸¦ LLM çš„å®¢æˆ·ç«¯**ï¼Œç¼–å†™å®¢æˆ·ç«¯çš„æ›´å¥½æ–¹å¼æ˜¯æ·»åŠ  LLMï¼Œä½¿å…¶èƒ½å¤Ÿä¸æœåŠ¡å™¨"åå•†"æ“ä½œ
- **4- åœ¨ Visual Studio Code ä¸­ä½¿ç”¨ GitHub Copilot ä»£ç†æ¨¡å¼æ¶ˆè´¹æœåŠ¡å™¨**ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬å°†æ¢è®¨å¦‚ä½•åœ¨ Visual Studio Code ä¸­è¿è¡Œ MCP æœåŠ¡å™¨
- **5- é€šè¿‡ SSEï¼ˆæœåŠ¡å™¨å‘é€äº‹ä»¶ï¼‰æ¶ˆè´¹**ã€‚SSE æ˜¯æœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯æµçš„æ ‡å‡†ï¼Œå…è®¸æœåŠ¡å™¨é€šè¿‡ HTTP å‘å®¢æˆ·ç«¯æ¨é€å®æ—¶æ›´æ–°
- **6- ä½¿ç”¨ VSCode çš„ AI å·¥å…·åŒ…**æ¥æ¶ˆè´¹å’Œæµ‹è¯•çš„ MCP å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨
- **7 æµ‹è¯•**ã€‚è¿™é‡Œæˆ‘ä»¬å°†ç‰¹åˆ«å…³æ³¨å¦‚ä½•ä»¥ä¸åŒæ–¹å¼æµ‹è¯•æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯
- **8- éƒ¨ç½²**ã€‚æœ¬ç« å°†æ¢è®¨éƒ¨ç½² MCP è§£å†³æ–¹æ¡ˆçš„ä¸åŒæ–¹å¼

## 01-first-server

mcp 

```python
# server.py
from mcp.server.fastmcp import FastMCP

# Create an MCP server
mcp = FastMCP("Demo")
print("123123")

# Add an addition tool
@mcp.tool()
def add(a: int, b: int) -> int:
    """Add two numbers"""
    return a + b

# Add a dynamic greeting resource
@mcp.resource("greeting://{name}")
def get_greeting(name: str) -> str:
    """Get a personalized greeting"""
    return f"Hello, {name}!"
```

![image.png](../images/mcp_image_2.png)

## 02-client

client.py

```python
from mcp import ClientSession, StdioServerParameters, types
from mcp.client.stdio import stdio_client

# Create server parameters for stdio connection
server_params = StdioServerParameters(
    command="mcp",  # Executable
    args=["run", "server.py"],  # Optional command line arguments
    env=None,  # Optional environment variables
)

async def run():
    async with stdio_client(server_params) as (read, write):
        async with ClientSession(
            read, write
        ) as session:
            # Initialize the connection
            await session.initialize()

            # List available resources
            resources = await session.list_resources()
            print("LISTING RESOURCES")
            for resource in resources:
                print("Resource: ", resource)

            # List available tools
            tools = await session.list_tools()
            print("LISTING TOOLS")
            for tool in tools.tools:
                print("Tool: ", tool.name)

            # Read a resource
            print("READING RESOURCE")
            content, mime_type = await session.read_resource("greeting://hello")

            # Call a tool
            print("CALL TOOL")
            result = await session.call_tool("add", arguments={"a": 1, "b": 7})
            print(result.content)

if __name__ == "__main__":
    import asyncio

    asyncio.run(run())
```

python3 client.py

output:

```python
 python3 client.py
[06/14/25 22:47:27] INFO     Processing request of type                  server.py:523
                             ListResourcesRequest
LISTING RESOURCES
Resource:  ('meta', None)
Resource:  ('nextCursor', None)
Resource:  ('resources', [])
                    INFO     Processing request of type ListToolsRequest server.py:523
LISTING TOOLS
Tool:  add
READING RESOURCE
                    INFO     Processing request of type                  server.py:523
                             ReadResourceRequest
CALL TOOL
                    INFO     Processing request of type CallToolRequest  server.py:523
[TextContent(type='text', text='8', annotations=None)]
```

## 03-llm-client

client.py

```python
from mcp import ClientSession, StdioServerParameters, types
from mcp.client.stdio import stdio_client

# llm
import os
from azure.ai.inference import ChatCompletionsClient
from azure.ai.inference.models import SystemMessage, UserMessage
from azure.core.credentials import AzureKeyCredential
from dotenv import load_dotenv
import json

load_dotenv() 

# Create server parameters for stdio connection
server_params = StdioServerParameters(
    command="mcp",  # Executable
    args=["run", "server.py"],  # Optional command line arguments
    env=None,  # Optional environment variables
)

def call_llm(prompt, functions):
    token = os.environ["GITHUB_TOKEN"]
    endpoint = "https://models.inference.ai.azure.com"

    model_name = "gpt-4o"

    client = ChatCompletionsClient(
        endpoint=endpoint,
        credential=AzureKeyCredential(token),
    )

    print("CALLING LLM")
    response = client.complete(
        messages=[
            {
            "role": "system",
            "content": "You are a helpful assistant.",
            },
            {
            "role": "user",
            "content": prompt,
            },
        ],
        model=model_name,
        tools = functions,
        # Optional parameters
        temperature=1.,
        max_tokens=1000,
        top_p=1.    
    )

    response_message = response.choices[0].message
    
    functions_to_call = []

    if response_message.tool_calls:
        for tool_call in response_message.tool_calls:
            print("TOOL: ", tool_call)
            name = tool_call.function.name
            args = json.loads(tool_call.function.arguments)
            functions_to_call.append({ "name": name, "args": args })

    return functions_to_call

def convert_to_llm_tool(tool):
    tool_schema = {
        "type": "function",
        "function": {
            "name": tool.name,
            "description": tool.description,
            "type": "function",
            "parameters": {
                "type": "object",
                "properties": tool.inputSchema["properties"]
            }
        }
    }

    return tool_schema

async def run():
    async with stdio_client(server_params) as (read, write):
        async with ClientSession(
            read, write
        ) as session:
            # Initialize the connection
            await session.initialize()

            # List available resources
            resources = await session.list_resources()
            print("LISTING RESOURCES")
            for resource in resources:
                print("Resource: ", resource)

            # List available tools
            tools = await session.list_tools()
            print("LISTING TOOLS")

            functions = []

            for tool in tools.tools:
                print("Tool: ", tool.name)
                print("Tool", tool.inputSchema["properties"])
                functions.append(convert_to_llm_tool(tool))
            
            prompt = "Add 2 to 20"

            # ask LLM what tools to all, if any
            functions_to_call = call_llm(prompt, functions)

            # call suggested functions
            for f in functions_to_call:
                result = await session.call_tool(f["name"], arguments=f["args"])
                print("TOOLS result: ", result.content)

if __name__ == "__main__":
    import asyncio

    asyncio.run(run())
```

python client.py

```python
[06/14/25 22:53:22] INFO     Processing request of type                  server.py:523
                             ListResourcesRequest
LISTING RESOURCES
Resource:  ('meta', None)
Resource:  ('nextCursor', None)
Resource:  ('resources', [])
                    INFO     Processing request of type ListToolsRequest server.py:523
LISTING TOOLS
Tool:  add
Tool {'a': {'title': 'A', 'type': 'integer'}, 'b': {'title': 'B', 'type': 'integer'}}
CALLING LLM
TOOL:  {'function': {'arguments': '{"a":2,"b":20}', 'name': 'add'}, 'id': 'call_iNpA7aQA96xfqCKNmGWLnZFR', 'type': 'function'}
[06/14/25 22:53:25] INFO     Processing request of type CallToolRequest  server.py:523
TOOLS result:  [TextContent(type='text', text='22', annotations=None)]
```

## 04-vscode

![image.png](../images/mcp_image_3.png)

![image.png](../images/mcp_image_4.png)

![image.png](../images/mcp_image_5.png)

## 05-sse-server

uvicorn server:app

server.py

```python
from starlette.applications import Starlette
from starlette.routing import Mount, Host
from mcp.server.fastmcp import FastMCP

mcp = FastMCP("My App")

@mcp.tool()
def add(a: int, b: int) -> int:
    """Add two numbers"""
    return a + b

# Mount the SSE server to the existing ASGI server
app = Starlette(
    routes=[
        Mount('/', app=mcp.sse_app()),
    ]
)
```

npx @modelcontextprotocol/inspector --cli [http://localhost:8000/sse](http://localhost:8000/sse) --method tools/list

```bash
{
  "tools": [
    {
      "name": "add",
      "description": "Add two numbers",
      "inputSchema": {
        "type": "object",
        "properties": {
          "a": {
            "title": "A",
            "type": "integer"
          },
          "b": {
            "title": "B",
            "type": "integer"
          }
        },
        "required": [
          "a",
          "b"
        ],
        "title": "addArguments"
      }
    }
  ]
}
```

npx @modelcontextprotocol/inspector --cli [http://localhost:8000/sse](http://localhost:8000/sse) --method tools/call --tool-name add --tool-arg a=1 --tool-arg b=2

```bash
{
  "content": [
    {
      "type": "text",
      "text": "3"
    }
  ],
  "isError": false
}
```

## 06-http-streaming

| ä¼ è¾“æœºåˆ¶ | å®æ—¶æ›´æ–° | æµå¼ä¼ è¾“ | å¯æ‰©å±•æ€§ | ç”¨ä¾‹ |
| --- | --- | --- | --- | --- |
| stdio | å¦ | å¦ | ä½ | æœ¬åœ° CLI å·¥å…· |
| SSE | æ˜¯ | æ˜¯ | ä¸­ | Webï¼Œå®æ—¶æ›´æ–° |
| å¯æµå¼ HTTP | æ˜¯ | æ˜¯ | é«˜ | äº‘ï¼Œå¤šå®¢æˆ·ç«¯ |

**æµå¼ä¼ è¾“**æ˜¯ç½‘ç»œç¼–ç¨‹ä¸­çš„ä¸€ç§æŠ€æœ¯ï¼Œå…è®¸æ•°æ®ä»¥å°è€Œå¯ç®¡ç†çš„å—æˆ–äº‹ä»¶åºåˆ—çš„å½¢å¼å‘é€å’Œæ¥æ”¶ï¼Œè€Œä¸æ˜¯ç­‰å¾…æ•´ä¸ªå“åº”å‡†å¤‡å°±ç»ªã€‚è¿™åœ¨ä»¥ä¸‹æƒ…å†µä¸‹ç‰¹åˆ«æœ‰ç”¨ï¼š

- å¤„ç†å¤§æ–‡ä»¶æˆ–æ•°æ®é›†
- å®æ—¶æ›´æ–°ï¼ˆå¦‚èŠå¤©ã€è¿›åº¦æ¡ï¼‰
- é•¿æ—¶é—´è¿è¡Œçš„è®¡ç®—ä»»åŠ¡ï¼ˆéœ€è¦è®©ç”¨æˆ·äº†è§£è¿›åº¦ï¼‰

ä»¥ä¸‹æ˜¯å…³äºæµå¼ä¼ è¾“çš„é«˜çº§è¦ç‚¹ï¼š

- æ•°æ®æ˜¯æ¸è¿›å¼ä¼ è¾“ï¼Œè€Œéä¸€æ¬¡æ€§å‘é€
- å®¢æˆ·ç«¯å¯ä»¥åœ¨æ•°æ®åˆ°è¾¾æ—¶ç«‹å³å¤„ç†
- å‡å°‘æ„ŸçŸ¥å»¶è¿Ÿå¹¶æ”¹å–„ç”¨æˆ·ä½“éªŒ

**ä¸ºä»€ä¹ˆä½¿ç”¨æµå¼ä¼ è¾“ï¼Ÿ**

ä½¿ç”¨æµå¼ä¼ è¾“çš„åŸå› åŒ…æ‹¬ï¼š

- ç”¨æˆ·å¯ä»¥ç«‹å³è·å¾—åé¦ˆï¼Œè€Œä¸ä»…ä»…æ˜¯åœ¨ç»“æŸæ—¶
- æ”¯æŒå®æ—¶åº”ç”¨å’Œå“åº”å¼ UI
- æ›´æœ‰æ•ˆåœ°åˆ©ç”¨ç½‘ç»œå’Œè®¡ç®—èµ„æº

**å¯¹æ¯”ï¼šç»å…¸æµå¼ä¼ è¾“ vs MCP æµå¼ä¼ è¾“**

"ç»å…¸"æµå¼ä¼ è¾“ä¸ MCP æµå¼ä¼ è¾“çš„åŒºåˆ«å¯æè¿°å¦‚ä¸‹ï¼š

| ç‰¹æ€§ | ç»å…¸ HTTP æµå¼ä¼ è¾“ | MCP æµå¼ä¼ è¾“ (é€šçŸ¥æœºåˆ¶) |
| --- | --- | --- |
| ä¸»å“åº” | åˆ†å—ä¼ è¾“ | ç»“æŸæ—¶è¿”å›å•ä¸ªå“åº” |
| è¿›åº¦æ›´æ–° | ä½œä¸ºæ•°æ®å—å‘é€ | ä½œä¸ºé€šçŸ¥å‘é€ |
| å®¢æˆ·ç«¯è¦æ±‚ | å¿…é¡»å¤„ç†æµ | å¿…é¡»å®ç°æ¶ˆæ¯å¤„ç†å™¨ |
| ç”¨ä¾‹ | å¤§æ–‡ä»¶ã€AI ä»¤ç‰Œæµ | è¿›åº¦ã€æ—¥å¿—ã€å®æ—¶åé¦ˆ |

**å…³é”®å·®å¼‚è§‚å¯Ÿ**

æ­¤å¤–ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å…³é”®å·®å¼‚ï¼š

- **é€šä¿¡æ¨¡å¼ï¼š**
    - ç»å…¸ HTTP æµå¼ä¼ è¾“ï¼šä½¿ç”¨ç®€å•çš„åˆ†å—ä¼ è¾“ç¼–ç å‘é€æ•°æ®
    - MCP æµå¼ä¼ è¾“ï¼šä½¿ç”¨å¸¦æœ‰ JSON-RPC åè®®çš„ç»“æ„åŒ–é€šçŸ¥ç³»ç»Ÿ
- **æ¶ˆæ¯æ ¼å¼ï¼š**
    - ç»å…¸ HTTPï¼šå¸¦æœ‰æ¢è¡Œç¬¦çš„çº¯æ–‡æœ¬å—
    - MCPï¼šå¸¦æœ‰å…ƒæ•°æ®çš„ç»“æ„åŒ– LoggingMessageNotification å¯¹è±¡
- **å®¢æˆ·ç«¯å®ç°ï¼š**
    - ç»å…¸ HTTPï¼šå¤„ç†æµå¼å“åº”çš„ç®€å•å®¢æˆ·ç«¯
    - MCPï¼šæ›´å¤æ‚çš„å®¢æˆ·ç«¯ï¼Œå¸¦æœ‰å¤„ç†ä¸åŒç±»å‹æ¶ˆæ¯çš„æ¶ˆæ¯å¤„ç†å™¨
- **è¿›åº¦æ›´æ–°ï¼š**
    - ç»å…¸ HTTPï¼šè¿›åº¦æ˜¯ä¸»å“åº”æµçš„ä¸€éƒ¨åˆ†
    - MCPï¼šè¿›åº¦é€šè¿‡å•ç‹¬çš„é€šçŸ¥æ¶ˆæ¯å‘é€ï¼Œä¸»å“åº”åœ¨ç»“æŸæ—¶è¿”å›

server.py

```python
# server.py
from fastapi import FastAPI
from fastapi.responses import StreamingResponse, HTMLResponse
from mcp.server.fastmcp import FastMCP, Context
from mcp.types import (
    TextContent
)
import asyncio
import uvicorn
import os

# Create an MCP server
mcp = FastMCP("Streamable DEMO")

app = FastAPI()

@app.get("/", response_class=HTMLResponse)
async def root():
    html_path = os.path.join(os.path.dirname(__file__), "welcome.html")
    with open(html_path, "r", encoding="utf-8") as f:
        html_content = f.read()
    return HTMLResponse(content=html_content)

async def event_stream(message: str):
    for i in range(1, 4):
        yield f"Processing file {i}/3...\n"
        await asyncio.sleep(1)
    yield f"Here's the file content: {message}\n"

@app.get("/stream")
async def stream(message: str = "hello"):
    return StreamingResponse(event_stream(message), media_type="text/plain")

@mcp.tool(description="A tool that simulates file processing and sends progress notifications")
async def process_files(message: str, ctx: Context) -> TextContent:
    files = [f"file_{i}.txt" for i in range(1, 4)]
    for idx, file in enumerate(files, 1):
        await ctx.info(f"Processing {file} ({idx}/{len(files)})...")
        await asyncio.sleep(1)  
    await ctx.info("All files processed!")
    return TextContent(type="text", text=f"Processed files: {', '.join(files)} | Message: {message}")

if __name__ == "__main__":
    import sys
    if "mcp" in sys.argv:
        # Configure MCP server with streamable-http transport
        print("Starting MCP server with streamable-http transport...")
        # MCP server will create its own FastAPI app with the /mcp endpoint
        mcp.run(transport="streamable-http")
    else:
        # Start FastAPI app for classic HTTP streaming
        print("Starting FastAPI server for classic HTTP streaming...")
        uvicorn.run("server:app", host="127.0.0.1", port=8000, reload=True)
```

client.py

```python
# client.py
from mcp.client.streamable_http import streamablehttp_client
from mcp import ClientSession
import asyncio
import mcp.types as types
from mcp.shared.session import RequestResponder
import requests
import logging

# Configure logging
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    datefmt='%Y-%m-%d %H:%M:%S'
)
logger = logging.getLogger('mcp_client')

class LoggingCollector:
    def __init__(self):
        self.log_messages: list[types.LoggingMessageNotificationParams] = []
    async def __call__(self, params: types.LoggingMessageNotificationParams) -> None:
        self.log_messages.append(params)
        logger.info("MCP Log: %s - %s", params.level, params.data)

logging_collector = LoggingCollector()
port = 8000

async def message_handler(
    message: RequestResponder[types.ServerRequest, types.ClientResult]
    | types.ServerNotification
    | Exception,
) -> None:
    logger.info("Received message: %s", message)
    if isinstance(message, Exception):
        logger.error("Exception received!")
        raise message
    elif isinstance(message, types.ServerNotification):
        logger.info("NOTIFICATION: %s", message)
    elif isinstance(message, RequestResponder):
        logger.info("REQUEST_RESPONDER: %s", message)
    else:
        logger.info("SERVER_MESSAGE: %s", message)

async def main():
    logger.info("Starting client...")
    async with streamablehttp_client(f"http://localhost:{port}/mcp") as (
        read_stream,
        write_stream,
        session_callback,
    ):
        async with ClientSession(
            read_stream,
            write_stream,
            logging_callback=logging_collector,
            message_handler=message_handler,
        ) as session:
            id_before = session_callback()
            logger.info("Session ID before init: %s", id_before)
            await session.initialize()
            id_after = session_callback()
            logger.info("Session ID after init: %s", id_after)
            logger.info("Session initialized, ready to call tools.")
            tool_result = await session.call_tool("process_files", {"message": "hello from client"})
            logger.info("Tool result: %s", tool_result)
            if logging_collector.log_messages:
                logger.info("Collected log messages:")
                for log in logging_collector.log_messages:
                    logger.info("Log: %s", log)

def stream_progress(message="hello", url="http://localhost:8000/stream"):
    params = {"message": message}
    logger.info("Connecting to %s with message: %s", url, message)
    try:
        with requests.get(url, params=params, stream=True, timeout=10) as r:
            r.raise_for_status()
            logger.info("--- Streaming Progress ---")
            for line in r.iter_lines():
                if line:
                    # Still print the streamed content to stdout for visibility
                    decoded_line = line.decode().strip()
                    print(decoded_line)
                    logger.debug("Stream content: %s", decoded_line)
            logger.info("--- Stream Ended ---")
    except requests.RequestException as e:
        logger.error("Error during streaming: %s", e)

if __name__ == "__main__":
    import sys
    
    if len(sys.argv) > 1 and sys.argv[1] == "mcp":
        # MCP client mode
        logger.info("Running MCP client...")
        asyncio.run(main())
    else:
        # Classic HTTP streaming client mode
        logger.info("Running classic HTTP streaming client...")
        stream_progress()
        
    # Don't run both by default, let the user choose the mode
```

## 07-**AI Toolkit**

server.py

```python
import math

from mcp.server.fastmcp import FastMCP

server = FastMCP("calculator")

@server.tool()
def add(a: float, b: float) -> float:
    """å°†ä¸¤ä¸ªæ•°å­—ç›¸åŠ å¹¶è¿”å›ç»“æœ"""
    return a + b

@server.tool()
def subtract(a: float, b: float) -> float:
    """ä» a ä¸­å‡å» b å¹¶è¿”å›ç»“æœ"""
    return a - b

@server.tool()
def multiply(a: float, b: float) -> float:
    """å°†ä¸¤ä¸ªæ•°å­—ç›¸ä¹˜å¹¶è¿”å›ç»“æœ"""
    return a * b

@server.tool()
def divide(a: float, b: float) -> float:
    """å°† a é™¤ä»¥ b å¹¶è¿”å›ç»“æœ"""
    if b == 0:
        raise ValueError("ä¸èƒ½é™¤ä»¥é›¶")
    return a / b

@server.tool()
def square_root(x: float) -> float:
    """è®¡ç®—æ•°å­—çš„å¹³æ–¹æ ¹"""
    if x < 0:
        raise ValueError("ä¸èƒ½è®¡ç®—è´Ÿæ•°çš„å¹³æ–¹æ ¹")
    return math.sqrt(x)
```

![image.png](../images/mcp_image_6.png)

## 08-testing

**æ‰‹åŠ¨æµ‹è¯•**

```bash
# ç¤ºä¾‹ï¼šæµ‹è¯•æœåŠ¡å™¨å…ƒæ•°æ®
curl http://localhost:3000/v1/metadata

# ç¤ºä¾‹ï¼šæ‰§è¡Œå·¥å…·
curl -X POST http://localhost:3000/v1/tools/execute \
  -H "Content-Type: application/json" \
  -d '{"name": "calculator", "parameters": {"expression": "2+2"}}'
```

**pytest**

```python
import pytest

from mcp.server.fastmcp import FastMCP
from mcp.shared.memory import (
    create_connected_server_and_client_session as create_session,
)

# Mark the whole module for async tests
pytestmark = pytest.mark.anyio

async def test_list_tools_cursor_parameter(stream_spy):
    """Test that the cursor parameter is accepted for list_tools
    and that it is correctly passed to the server.

    See: https://modelcontextprotocol.io/specification/2025-03-26/server/utilities/pagination#request-format
    """
    server = FastMCP("test")

    # Create a couple of test tools
    @server.tool(name="test_tool_1")
    async def test_tool_1() -> str:
        """First test tool"""
        return "Result 1"

    @server.tool(name="test_tool_2")
    async def test_tool_2() -> str:
        """Second test tool"""
        return "Result 2"

    async with create_session(server._mcp_server) as client_session:
        spies = stream_spy()

        # Test without cursor parameter (omitted)
        _ = await client_session.list_tools()
        list_tools_requests = spies.get_client_requests(method="tools/list")
        assert len(list_tools_requests) == 1
        assert list_tools_requests[0].params is None

        spies.clear()

        # Test with cursor=None
        _ = await client_session.list_tools(cursor=None)
        list_tools_requests = spies.get_client_requests(method="tools/list")
        assert len(list_tools_requests) == 1
        assert list_tools_requests[0].params is None

        spies.clear()

        # Test with cursor as string
        _ = await client_session.list_tools(cursor="some_cursor_value")
        list_tools_requests = spies.get_client_requests(method="tools/list")
        assert len(list_tools_requests) == 1
        assert list_tools_requests[0].params is not None
        assert list_tools_requests[0].params["cursor"] == "some_cursor_value"

        spies.clear()

        # Test with empty string cursor
        _ = await client_session.list_tools(cursor="")
        list_tools_requests = spies.get_client_requests(method="tools/list")
        assert len(list_tools_requests) == 1
        assert list_tools_requests[0].params is not None
        assert list_tools_requests[0].params["cursor"] == ""

async def test_list_resources_cursor_parameter(stream_spy):
    """Test that the cursor parameter is accepted for list_resources
    and that it is correctly passed to the server.

    See: https://modelcontextprotocol.io/specification/2025-03-26/server/utilities/pagination#request-format
    """
    server = FastMCP("test")

    # Create a test resource
    @server.resource("resource://test/data")
    async def test_resource() -> str:
        """Test resource"""
        return "Test data"

    async with create_session(server._mcp_server) as client_session:
        spies = stream_spy()

        # Test without cursor parameter (omitted)
        _ = await client_session.list_resources()
        list_resources_requests = spies.get_client_requests(method="resources/list")
        assert len(list_resources_requests) == 1
        assert list_resources_requests[0].params is None

        spies.clear()

        # Test with cursor=None
        _ = await client_session.list_resources(cursor=None)
        list_resources_requests = spies.get_client_requests(method="resources/list")
        assert len(list_resources_requests) == 1
        assert list_resources_requests[0].params is None

        spies.clear()

        # Test with cursor as string
        _ = await client_session.list_resources(cursor="some_cursor")
        list_resources_requests = spies.get_client_requests(method="resources/list")
        assert len(list_resources_requests) == 1
        assert list_resources_requests[0].params is not None
        assert list_resources_requests[0].params["cursor"] == "some_cursor"

        spies.clear()

        # Test with empty string cursor
        _ = await client_session.list_resources(cursor="")
        list_resources_requests = spies.get_client_requests(method="resources/list")
        assert len(list_resources_requests) == 1
        assert list_resources_requests[0].params is not None
        assert list_resources_requests[0].params["cursor"] == ""

async def test_list_prompts_cursor_parameter(stream_spy):
    """Test that the cursor parameter is accepted for list_prompts
    and that it is correctly passed to the server.
    See: https://modelcontextprotocol.io/specification/2025-03-26/server/utilities/pagination#request-format
    """
    server = FastMCP("test")

    # Create a test prompt
    @server.prompt()
    async def test_prompt(name: str) -> str:
        """Test prompt"""
        return f"Hello, {name}!"

    async with create_session(server._mcp_server) as client_session:
        spies = stream_spy()

        # Test without cursor parameter (omitted)
        _ = await client_session.list_prompts()
        list_prompts_requests = spies.get_client_requests(method="prompts/list")
        assert len(list_prompts_requests) == 1
        assert list_prompts_requests[0].params is None

        spies.clear()

        # Test with cursor=None
        _ = await client_session.list_prompts(cursor=None)
        list_prompts_requests = spies.get_client_requests(method="prompts/list")
        assert len(list_prompts_requests) == 1
        assert list_prompts_requests[0].params is None

        spies.clear()

        # Test with cursor as string
        _ = await client_session.list_prompts(cursor="some_cursor")
        list_prompts_requests = spies.get_client_requests(method="prompts/list")
        assert len(list_prompts_requests) == 1
        assert list_prompts_requests[0].params is not None
        assert list_prompts_requests[0].params["cursor"] == "some_cursor"

        spies.clear()

        # Test with empty string cursor
        _ = await client_session.list_prompts(cursor="")
        list_prompts_requests = spies.get_client_requests(method="prompts/list")
        assert len(list_prompts_requests) == 1
        assert list_prompts_requests[0].params is not None
        assert list_prompts_requests[0].params["cursor"] == ""

async def test_list_resource_templates_cursor_parameter(stream_spy):
    """Test that the cursor parameter is accepted for list_resource_templates
    and that it is correctly passed to the server.

    See: https://modelcontextprotocol.io/specification/2025-03-26/server/utilities/pagination#request-format
    """
    server = FastMCP("test")

    # Create a test resource template
    @server.resource("resource://test/{name}")
    async def test_template(name: str) -> str:
        """Test resource template"""
        return f"Data for {name}"

    async with create_session(server._mcp_server) as client_session:
        spies = stream_spy()

        # Test without cursor parameter (omitted)
        _ = await client_session.list_resource_templates()
        list_templates_requests = spies.get_client_requests(method="resources/templates/list")
        assert len(list_templates_requests) == 1
        assert list_templates_requests[0].params is None

        spies.clear()

        # Test with cursor=None
        _ = await client_session.list_resource_templates(cursor=None)
        list_templates_requests = spies.get_client_requests(method="resources/templates/list")
        assert len(list_templates_requests) == 1
        assert list_templates_requests[0].params is None

        spies.clear()

        # Test with cursor as string
        _ = await client_session.list_resource_templates(cursor="some_cursor")
        list_templates_requests = spies.get_client_requests(method="resources/templates/list")
        assert len(list_templates_requests) == 1
        assert list_templates_requests[0].params is not None
        assert list_templates_requests[0].params["cursor"] == "some_cursor"

        spies.clear()

        # Test with empty string cursor
        _ = await client_session.list_resource_templates(cursor="")
        list_templates_requests = spies.get_client_requests(method="resources/templates/list")
        assert len(list_templates_requests) == 1
        assert list_templates_requests[0].params is not None
        assert list_templates_requests[0].params["cursor"] == ""
```

## 09-deployment

**æœ¬åœ°å¼€å‘ä¸éƒ¨ç½²**

å¦‚æœçš„æœåŠ¡å™¨æ—¨åœ¨ç”¨æˆ·æœºå™¨ä¸Šè¿è¡Œä½¿ç”¨ï¼Œè¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. **ä¸‹è½½æœåŠ¡å™¨**ï¼šå¦‚æœæ²¡æœ‰ç¼–å†™æœåŠ¡å™¨ï¼Œè¯·å…ˆå°†å…¶ä¸‹è½½åˆ°çš„æœºå™¨ä¸Š
2. **å¯åŠ¨æœåŠ¡å™¨è¿›ç¨‹**ï¼šè¿è¡Œçš„ MCP æœåŠ¡å™¨åº”ç”¨

å¯¹äº SSE æœåŠ¡å™¨ï¼ˆstdio ç±»å‹æœåŠ¡å™¨ä¸éœ€è¦æ­¤æ­¥éª¤ï¼‰

1. **é…ç½®ç½‘ç»œ**ï¼šç¡®ä¿æœåŠ¡å™¨åœ¨é¢„æœŸç«¯å£ä¸Šå¯è®¿é—®
2. **è¿æ¥å®¢æˆ·ç«¯**ï¼šä½¿ç”¨æœ¬åœ°è¿æ¥ URLï¼Œå¦‚Â `http://localhost:3000`

**äº‘éƒ¨ç½²**

MCP æœåŠ¡å™¨å¯ä»¥éƒ¨ç½²åˆ°å„ç§äº‘å¹³å°ï¼š

- **æ— æœåŠ¡å™¨å‡½æ•°**ï¼šå°†è½»é‡çº§ MCP æœåŠ¡å™¨éƒ¨ç½²ä¸ºæ— æœåŠ¡å™¨å‡½æ•°
- **å®¹å™¨æœåŠ¡**ï¼šä½¿ç”¨ Azure Container Appsã€AWS ECS æˆ– Google Cloud Run ç­‰æœåŠ¡
- **Kubernetes**ï¼šåœ¨ Kubernetes é›†ç¾¤ä¸­éƒ¨ç½²å’Œç®¡ç† MCP æœåŠ¡å™¨ä»¥å®ç°é«˜å¯ç”¨æ€§

**ç¤ºä¾‹ï¼šAzure Container Apps**

Azure Container Apps æ”¯æŒéƒ¨ç½² MCP æœåŠ¡å™¨ã€‚ç›®å‰ä»åœ¨å¼€å‘ä¸­ï¼Œå½“å‰æ”¯æŒ SSE æœåŠ¡å™¨ã€‚

ä»¥ä¸‹æ˜¯éƒ¨ç½²æ­¥éª¤ï¼š

1. å…‹éš†ä»“åº“ï¼š

```bash
git clone https://github.com/anthonychu/azure-container-apps-mcp-sample.git
```

1. æœ¬åœ°è¿è¡Œæµ‹è¯•ï¼š

```bash
uv venv
uv sync

# Linux/macOSexport API_KEYS=<APIå¯†é’¥>
# Windowsset API_KEYS=<APIå¯†é’¥>

uv run fastapi dev main.py

```

1. æœ¬åœ°æµ‹è¯•æ—¶ï¼Œåœ¨Â *.vscode*Â ç›®å½•åˆ›å»ºÂ *mcp.json*Â æ–‡ä»¶å¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

```json
{
  "inputs": [
    {
      "type": "promptString",
      "id": "weather-api-key",
      "description": "å¤©æ°” API å¯†é’¥",
      "password": true}
  ],
  "servers": {
    "weather-sse": {
      "type": "sse",
      "url": "http://localhost:8000/sse",
      "headers": {
        "x-api-key": "${input:weather-api-key}"
      }
    }
  }
}
```

å¯åŠ¨ SSE æœåŠ¡å™¨åï¼Œç‚¹å‡» JSON æ–‡ä»¶ä¸­çš„æ’­æ”¾å›¾æ ‡ï¼Œç°åœ¨åº”è¯¥çœ‹åˆ° GitHub Copilot æ£€æµ‹åˆ°æœåŠ¡å™¨å·¥å…·ï¼ˆæŸ¥çœ‹å·¥å…·å›¾æ ‡ï¼‰ã€‚

1. éƒ¨ç½²è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
az containerapp up -g <èµ„æºç»„åç§°> -n weather-mcp --environment mcp -l westus --env-vars API_KEYS=<APIå¯†é’¥> --source .
```

# **04-å®æˆ˜åº”ç”¨**

### **æ ¸å¿ƒæœåŠ¡å™¨åŠŸèƒ½**

MCPæœåŠ¡å™¨å¯ä»¥å®ç°ä»¥ä¸‹ä»»æ„ç»„åˆçš„åŠŸèƒ½ï¼š

### **èµ„æº**

èµ„æºä¸ºç”¨æˆ·æˆ–AIæ¨¡å‹æä¾›ä¸Šä¸‹æ–‡å’Œæ•°æ®ï¼š

- æ–‡æ¡£åº“
- çŸ¥è¯†åº“
- ç»“æ„åŒ–æ•°æ®æº
- æ–‡ä»¶ç³»ç»Ÿ

### **æç¤º**

æç¤ºæ˜¯ä¸ºç”¨æˆ·é¢„å®šä¹‰çš„æ¨¡æ¿æ¶ˆæ¯å’Œå·¥ä½œæµç¨‹ï¼š

- é¢„å®šä¹‰çš„å¯¹è¯æ¨¡æ¿
- å¼•å¯¼å¼äº¤äº’æ¨¡å¼
- ä¸“ä¸šåŒ–çš„å¯¹è¯ç»“æ„

### **å·¥å…·**

å·¥å…·æ˜¯AIæ¨¡å‹æ‰§è¡Œçš„å‡½æ•°ï¼š

- æ•°æ®å¤„ç†å®ç”¨ç¨‹åº
- å¤–éƒ¨APIé›†æˆ
- è®¡ç®—èƒ½åŠ›
- æœç´¢åŠŸèƒ½

### **ç¤ºä¾‹å®ç°ï¼šPython**

Python SDKæä¾›äº†ä¸€ç§ç¬¦åˆPythoné£æ ¼çš„MCPå®ç°æ–¹å¼ï¼Œå¹¶é›†æˆäº†ä¼˜ç§€çš„æœºå™¨å­¦ä¹ æ¡†æ¶ã€‚

### **å…³é”®åŠŸèƒ½**

- æ”¯æŒasyncioçš„å¼‚æ­¥/ç­‰å¾…
- ä¸Flaskå’ŒFastAPIé›†æˆ
- ç®€å•çš„å·¥å…·æ³¨å†Œ
- ä¸æµè¡ŒMLåº“çš„æœ¬æœºé›†æˆ

æœ‰å…³å®Œæ•´çš„Pythonå®ç°ç¤ºä¾‹ï¼Œè¯·å‚è§ç¤ºä¾‹ç›®å½•ä¸­çš„[mcp_sample.py](https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/04-PracticalImplementation/samples/python/mcp_sample.py)ã€‚

### **APIç®¡ç†**

Azure APIç®¡ç†æ˜¯ä¿æŠ¤MCPæœåŠ¡å™¨çš„ç†æƒ³è§£å†³æ–¹æ¡ˆã€‚å…¶æ€æƒ³æ˜¯åœ¨çš„MCPæœåŠ¡å™¨å‰æ”¾ç½®ä¸€ä¸ªAzure APIç®¡ç†å®ä¾‹ï¼Œè®©å®ƒå¤„ç†å¯èƒ½éœ€è¦çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼š

- é€Ÿç‡é™åˆ¶
- ä»¤ç‰Œç®¡ç†
- ç›‘æ§
- è´Ÿè½½å‡è¡¡
- å®‰å…¨æ€§

![image.png](../images/mcp_image_7.png)

![image.png](../images/mcp_image_8.png)

### **å°†è¿œç¨‹MCPæœåŠ¡å™¨éƒ¨ç½²åˆ°Azure**

1. å…‹éš†ä»£ç åº“
    
    ```bash
    git clone https://github.com/Azure-Samples/remote-mcp-apim-functions-python.git
    cd remote-mcp-apim-functions-python
    ```
    
2. æ³¨å†Œ`Microsoft.App`èµ„æºæä¾›ç¨‹åºã€‚
    - å¦‚æœä½¿ç”¨Azure CLIï¼Œè¿è¡Œ`az provider register --namespace Microsoft.App --wait`ã€‚
    - å¦‚æœä½¿ç”¨Azure PowerShellï¼Œè¿è¡Œ`Register-AzResourceProvider -ProviderNamespace Microsoft.App`ã€‚ç„¶ååœ¨ä¸€æ®µæ—¶é—´åè¿è¡Œ`(Get-AzResourceProvider -ProviderNamespace Microsoft.App).RegistrationState`ä»¥æ£€æŸ¥æ³¨å†Œæ˜¯å¦å®Œæˆã€‚
3. è¿è¡Œæ­¤[azd](https://aka.ms/azd)å‘½ä»¤ï¼Œä»¥é¢„é…APIç®¡ç†æœåŠ¡ã€å‡½æ•°åº”ç”¨ï¼ˆåŒ…å«ä»£ç ï¼‰å’Œæ‰€æœ‰å…¶ä»–æ‰€éœ€çš„Azureèµ„æº
    
    ```
    azd up
    ```
    
    æ­¤å‘½ä»¤åº”éƒ¨ç½²Azureä¸Šçš„æ‰€æœ‰äº‘èµ„æºã€‚
    

### **ä½¿ç”¨MCPæ£€æŸ¥å™¨æµ‹è¯•çš„æœåŠ¡å™¨**

1. åœ¨**æ–°ç»ˆç«¯çª—å£**ä¸­ï¼Œå®‰è£…å¹¶è¿è¡ŒMCPæ£€æŸ¥å™¨
    
    ```
    npx @modelcontextprotocol/inspector
    ```
    
    åº”è¯¥ä¼šçœ‹åˆ°ä¸€ä¸ªç±»ä¼¼äºä»¥ä¸‹å†…å®¹çš„ç•Œé¢ï¼š
    
    ![image.png](../images/mcp_image_9.png)
    
2. CTRLç‚¹å‡»ä»¥ä»åº”ç”¨æ˜¾ç¤ºçš„URLåŠ è½½MCPæ£€æŸ¥å™¨Webåº”ç”¨ï¼ˆä¾‹å¦‚http://127.0.0.1:6274/#resourcesï¼‰ã€‚
3. å°†ä¼ è¾“ç±»å‹è®¾ç½®ä¸º`SSE`ã€‚
4. å°†URLè®¾ç½®ä¸º`azd up`åæ˜¾ç¤ºçš„è¿è¡Œä¸­çš„APIç®¡ç†SSEç«¯ç‚¹å¹¶**è¿æ¥**ï¼š
    
    ```
    https://<apim-servicename-from-azd-output>.azure-api.net/mcp/sse
    ```
    
5. **åˆ—å‡ºå·¥å…·**ã€‚ç‚¹å‡»ä¸€ä¸ªå·¥å…·å¹¶**è¿è¡Œå·¥å…·**ã€‚

server.py

```python
#!/usr/bin/env python3
"""
Model Context Protocol (MCP) Python Sample Implementation.

This module demonstrates how to implement a basic MCP server that can handle
completion requests. It provides a mock implementation that simulates
interaction with various AI models.

For more information about MCP: https://modelcontextprotocol.io/
"""

import json
import logging

# Import FastMCP - the high-level MCP server API
from mcp.server.fastmcp import FastMCP

# Configure module logger
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

# Define available models
AVAILABLE_MODELS = ["gpt-4", "llama-3-70b", "claude-3-sonnet"]

# Create an MCP server
mcp = FastMCP("Python MCP Demo Server")

# Define a tool for generating completions
@mcp.tool()
def completion(model: str, prompt: str, temperature: float = 0.7, max_tokens: int = 100) -> str:
    """Generate completions using AI models
    
    Args:
        model: The AI model to use for completion
        prompt: The prompt text to complete
        temperature: Sampling temperature (0.0 to 1.0)
        max_tokens: Maximum number of tokens to generate
    """
    # Validate model
    if model not in AVAILABLE_MODELS:
        raise ValueError(f"Model {model} not supported")
    
    # In a real implementation, this would call an AI model
    # Here we provide a more comprehensive mock response based on the prompt
    logging.info(f"Processing completion request for model: {model} with temperature: {temperature}")
    
    # Return different responses based on common prompts
    if "meaning of life" in prompt.lower():
        completion_text = "The meaning of life is a philosophical question that has been debated throughout human history. According to Douglas Adams in 'The Hitchhiker's Guide to the Galaxy', the answer is simply '42'. However, many philosophers suggest that the meaning of life is something each person must discover for themselves through their own experiences, values, and beliefs."
    elif "hello" in prompt.lower() or "hi" in prompt.lower():
        completion_text = "Hello! I'm a simulated AI response from the MCP server example. How can I help you today?"
    elif "who are you" in prompt.lower():
        completion_text = f"I'm a mock {model} model response from the Model Context Protocol (MCP) Python sample implementation. I'm not actually using {model}, just simulating how it would respond in a real MCP server."
    else:
        completion_text = f"This is a simulated response to your prompt about '{prompt[:30]}...' from model {model}. In a real implementation, you would get an actual AI-generated completion here."
    
    # Return the response
    return completion_text

# Define a calculator tool to add two numbers
@mcp.tool()
def add(a: int, b: int) -> int:
    """Add two numbers together
    
    Args:
        a: First number
        b: Second number
    
    Returns:
        The sum of the two numbers
    """
    logger.info(f"Adding {a} and {b}")
    return a + b

# Define a models resource to expose available AI models
@mcp.resource("models://")
def get_models() -> str:
    """Get information about available AI models"""
    logger.info("Retrieving available models")
    models_data = [
        {
            "id": "gpt-4", 
            "name": "GPT-4",
            "description": "OpenAI's GPT-4 large language model"
        },
        {
            "id": "llama-3-70b",
            "name": "LLaMA 3 (70B)",
            "description": "Meta's LLaMA 3 with 70 billion parameters"
        },
        {
            "id": "claude-3-sonnet",
            "name": "Claude 3 Sonnet",
            "description": "Anthropic's Claude 3 Sonnet model"
        }
    ]
    
    return json.dumps({"models": models_data})

# Define a greeting resource that dynamically constructs a personalized greeting
@mcp.resource("greeting://{name}")
def get_greeting(name: str) -> str:
    """Return a greeting for the given name
    
    Args:
        name: The name to greet
        
    Returns:
        A personalized greeting message
    """
    import urllib.parse
    # Decode URL-encoded name
    decoded_name = urllib.parse.unquote(name)
    logger.info(f"Generating greeting for {decoded_name}")
    return f"Hello, {decoded_name}!"

# Define a prompt for code review
@mcp.prompt()
def review_code(code: str) -> str:
    """Provide a template for reviewing code
    
    Args:
        code: The code to review
        
    Returns:
        A prompt that asks the LLM to review the code
    """
    logger.info(f"Creating code review prompt for {len(code)} bytes of code")
    return f"Please review this code and provide feedback on best practices, potential bugs, and improvements:\n\n```\n{code}\n```"

if __name__ == "__main__":
    logger.info(f"MCP Server initialized")
    logger.info(f"Supported models: {', '.join(AVAILABLE_MODELS)}")
    
    # Run the server with stdio transport
    # This can be tested with one of these methods:
    # 1. Direct execution: python server.py
    # 2. MCP inspector: mcp dev server.py
    # 3. Install in Claude Desktop: mcp install server.py
    mcp.run()

```

client.py

```python
#!/usr/bin/env python3
"""
Clean MCP Client Example.

This is a clean implementation of an MCP client that demonstrates
all capabilities of the MCP protocol with proper error handling.
"""

import asyncio
import logging
import json
import urllib.parse
import sys
from mcp import ClientSession, StdioServerParameters
from mcp.client.stdio import stdio_client
from mcp.types import TextContent, TextResourceContents

# Configure logging
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

async def main():
    """Main client function that demonstrates MCP client features"""
    logger.info("Starting clean MCP client")
    
    server_params = StdioServerParameters(
        command="python",
        args=["server.py"],
    )
    
    try:
        logger.info("Connecting to server...")
        async with stdio_client(server_params) as (reader, writer):
            async with ClientSession(reader, writer) as session:
                logger.info("Initializing session")
                await session.initialize()
                
                # 1. Call the add tool
                logger.info("Testing calculator tool")
                add_result = await session.call_tool("add", arguments={"a": 5, "b": 7})
                if add_result and add_result.content:
                    text_content = next((content for content in add_result.content 
                                        if isinstance(content, TextContent)), None)
                    if text_content:
                        print(f"\n1. Calculator result (5 + 7) = {text_content.text}")
                
                # 2. Call the completion tool
                logger.info("Testing completion tool")
                completion_result = await session.call_tool(
                    "completion", 
                    arguments={
                        "model": "gpt-4",
                        "prompt": "What is the meaning of life?",
                        "temperature": 0.7
                    }
                )
                if completion_result and completion_result.content:
                    text_content = next((content for content in completion_result.content 
                                        if isinstance(content, TextContent)), None)
                    if text_content:
                        print(f"\n2. Completion: {text_content.text}")
                
                # 3. Get models resource
                logger.info("Testing models resource")
                models_response = await session.read_resource("models://")
                if models_response and models_response.contents:
                    text_resource = next((content for content in models_response.contents 
                                        if isinstance(content, TextResourceContents)), None)
                    if text_resource:
                        models = json.loads(text_resource.text)
                        print("\n3. Available models:")
                        for model in models.get("models", []):
                            print(f"   - {model['name']} ({model['id']}): {model['description']}")
                
                # 4. Get greeting resource
                logger.info("Testing greeting resource")
                name = "MCP Explorer"
                encoded_name = urllib.parse.quote(name)
                greeting_response = await session.read_resource(f"greeting://{encoded_name}")
                if greeting_response and greeting_response.contents:
                    text_resource = next((content for content in greeting_response.contents 
                                        if isinstance(content, TextResourceContents)), None)
                    if text_resource:
                        print(f"\n4. Greeting: {text_resource.text}")
                
                # 5. Use code review prompt
                logger.info("Testing code review prompt")
                sample_code = "def hello_world():\n    print('Hello, world!')"
                prompt_response = await session.get_prompt("review_code", {"code": sample_code})
                if prompt_response and prompt_response.messages:
                    message = next((msg for msg in prompt_response.messages if msg.content), None)
                    if message and message.content:
                        text_content = next((content for content in [message.content] 
                                            if isinstance(content, TextContent)), None)
                        if text_content:
                            print("\n5. Code review prompt:")
                            print(f"   {text_content.text}")
    
    except Exception:
        logger.exception("An error occurred")
        sys.exit(1)

if __name__ == "__main__":
    asyncio.run(main())

```

# **05-MCP é«˜çº§è¯é¢˜**

æœ¬ç« æ¶µç›–æ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼ˆMCPï¼‰å®ç°ä¸­çš„ä¸€ç³»åˆ—é«˜çº§ä¸»é¢˜ï¼ŒåŒ…æ‹¬å¤šæ¨¡æ€é›†æˆã€å¯æ‰©å±•æ€§ã€å®‰å…¨æœ€ä½³å®è·µå’Œä¼ä¸šé›†æˆã€‚è¿™äº›ä¸»é¢˜å¯¹äºæ„å»ºå¥å£®ä¸”ç”Ÿäº§å°±ç»ªçš„MCPåº”ç”¨è‡³å…³é‡è¦ï¼Œèƒ½å¤Ÿæ»¡è¶³ç°ä»£AIç³»ç»Ÿçš„éœ€æ±‚ã€‚

| é“¾æ¥ | æ ‡é¢˜ | æè¿° |
| --- | --- | --- |
| [5.1 ä¸Azureé›†æˆ](https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-integration/README.md) | ä¸Azureé›†æˆ | å­¦ä¹ å¦‚ä½•åœ¨Azureä¸Šé›†æˆçš„MCPæœåŠ¡å™¨ |
| [5.2 å¤šæ¨¡æ€ç¤ºä¾‹](https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-multi-modality/README.md) | MCPå¤šæ¨¡æ€ç¤ºä¾‹ | éŸ³é¢‘ã€å›¾åƒå’Œå¤šæ¨¡æ€å“åº”çš„ç¤ºä¾‹ |
| [5.3 MCP OAuth2ç¤ºä¾‹](https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-oauth2-demo/) | MCP OAuth2æ¼”ç¤º | æœ€å°çš„Spring Bootåº”ç”¨ï¼Œå±•ç¤ºOAuth2ä¸MCPç»“åˆï¼ŒåŒ…æ‹¬æˆæƒå’Œèµ„æºæœåŠ¡å™¨ã€‚æ¼”ç¤ºå®‰å…¨ä»¤ç‰Œå‘æ”¾ã€å—ä¿æŠ¤çš„ç«¯ç‚¹ã€Azure Container Appséƒ¨ç½²å’ŒAPIç®¡ç†é›†æˆã€‚ |
| [5.4 æ ¹ä¸Šä¸‹æ–‡](https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-root-contexts/README.md) | æ ¹ä¸Šä¸‹æ–‡ | äº†è§£æ ¹ä¸Šä¸‹æ–‡åŠå…¶å®ç°æ–¹å¼ |
| [5.5 è·¯ç”±](https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-routing/README.md) | è·¯ç”± | å­¦ä¹ ä¸åŒç±»å‹çš„è·¯ç”± |
| [5.6 é‡‡æ ·](https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-sampling/README.md) | é‡‡æ · | å­¦ä¹ å¦‚ä½•ä½¿ç”¨é‡‡æ · |
| [5.7 æ‰©å±•](https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-scaling/README.md) | æ‰©å±• | å­¦ä¹ æ‰©å±•ç›¸å…³çŸ¥è¯† |
| [5.8 å®‰å…¨](https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-security/README.md) | å®‰å…¨ | ä¿æŠ¤çš„MCPæœåŠ¡å™¨ |
| [5.9 ç½‘ç»œæœç´¢ç¤ºä¾‹](https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/web-search-mcp/README.md) | ç½‘ç»œæœç´¢MCP | é›†æˆäº†SerpAPIçš„Python MCPæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ï¼Œç”¨äºå®æ—¶ç½‘ç»œæœç´¢ã€æ–°é—»æœç´¢ã€äº§å“æœç´¢å’Œé—®ç­”ã€‚å±•ç¤ºäº†å¤šå·¥å…·åè°ƒã€å¤–éƒ¨APIé›†æˆå’Œå¥å£®çš„é”™è¯¯å¤„ç†ã€‚ |
| [5.10 å®æ—¶æµ](https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-realtimestreaming/README.md) | å®æ—¶æµä¼ è¾“ | åœ¨å½“ä»Šæ•°æ®é©±åŠ¨çš„ä¸–ç•Œä¸­ï¼Œå®æ—¶æ•°æ®æµä¼ è¾“å˜å¾—è‡³å…³é‡è¦ï¼Œä¼ä¸šå’Œåº”ç”¨éœ€è¦å³æ—¶è®¿é—®ä¿¡æ¯ä»¥åšå‡ºåŠæ—¶å†³ç­–ã€‚ |

| é“¾æ¥ | æ ‡é¢˜ | æè¿° |
| --- | --- | --- |
| [5.1 ä¸ Azure é›†æˆ](https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-integration/README.md) | ä¸ Azure é›†æˆ | äº†è§£å¦‚ä½•åœ¨ Azure ä¸Šé›†æˆçš„ MCP æœåŠ¡å™¨ |
| [5.2 å¤šæ¨¡æ€ç¤ºä¾‹](https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-multi-modality/README.md) | MCP å¤šæ¨¡æ€ç¤ºä¾‹ | éŸ³é¢‘ã€å›¾åƒå’Œå¤šæ¨¡æ€å“åº”çš„ç¤ºä¾‹ |
| [5.3 MCP OAuth2 ç¤ºä¾‹](https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-oauth2-demo/) | MCP OAuth2 æ¼”ç¤º | ä¸€ä¸ªæœ€å°çš„ Spring Boot åº”ç”¨ç¨‹åºï¼Œå±•ç¤ºäº†ä¸ MCP çš„ OAuth2ï¼Œæ—¢ä½œä¸ºæˆæƒæœåŠ¡å™¨åˆä½œä¸ºèµ„æºæœåŠ¡å™¨ã€‚æ¼”ç¤ºäº†å®‰å…¨ä»¤ç‰Œé¢å‘ã€å—ä¿æŠ¤çš„ç«¯ç‚¹ã€Azure å®¹å™¨åº”ç”¨éƒ¨ç½²å’Œ API ç®¡ç†é›†æˆã€‚ |
| [5.4 æ ¹ä¸Šä¸‹æ–‡](https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-root-contexts/README.md) | æ ¹ä¸Šä¸‹æ–‡ | äº†è§£æœ‰å…³æ ¹ä¸Šä¸‹æ–‡ä»¥åŠå¦‚ä½•å®ç°å®ƒä»¬çš„æ›´å¤šä¿¡æ¯ |
| [5.5 è·¯ç”±](https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-routing/README.md) | è·¯ç”± | äº†è§£ä¸åŒç±»å‹çš„è·¯ç”± |
| [5.6 é‡‡æ ·](https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-sampling/README.md) | é‡‡æ · | äº†è§£å¦‚ä½•ä½¿ç”¨é‡‡æ · |
| [5.7 æ‰©å±•](https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-scaling/README.md) | æ‰©å±• | äº†è§£æœ‰å…³æ‰©å±•çš„ä¿¡æ¯ |
| [5.8 å®‰å…¨](https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-security/README.md) | å®‰å…¨ | ä¿æŠ¤çš„ MCP æœåŠ¡å™¨ |
| [5.9 Web æœç´¢ç¤ºä¾‹](https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/web-search-mcp/README.md) | Web æœç´¢ MCP | ä¸ SerpAPI é›†æˆçš„ Python MCP æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ï¼Œç”¨äºå®æ—¶ Webã€æ–°é—»ã€äº§å“æœç´¢å’Œé—®ç­”ã€‚æ¼”ç¤ºäº†å¤šå·¥å…·ç¼–æ’ã€å¤–éƒ¨ API é›†æˆå’Œå¼ºå¤§çš„é”™è¯¯å¤„ç†ã€‚ |
| [5.10 å®æ—¶æµ](https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-realtimestreaming/README.md) | æµ | å®æ—¶æ•°æ®æµåœ¨å½“ä»Šæ•°æ®é©±åŠ¨çš„ä¸–ç•Œä¸­å·²å˜å¾—è‡³å…³é‡è¦ï¼Œä¼ä¸šå’Œåº”ç”¨ç¨‹åºéœ€è¦ç«‹å³è®¿é—®ä¿¡æ¯ä»¥åšå‡ºåŠæ—¶å†³ç­–ã€‚ |
| [5.11 å®æ—¶ Web æœç´¢](https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-realtimesearch/README.md) | Web æœç´¢ | å®æ—¶ Web æœç´¢ MCP å¦‚ä½•é€šè¿‡æä¾›è·¨ AI æ¨¡å‹ã€æœç´¢å¼•æ“å’Œåº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡ç®¡ç†çš„æ ‡å‡†åŒ–æ–¹æ³•æ¥æ”¹å˜å®æ—¶ Web æœç´¢ã€‚ |
| [5.12 æ¨¡å‹ä¸Šä¸‹æ–‡åè®®æœåŠ¡å™¨çš„ Entra ID èº«ä»½éªŒè¯](https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-security-entra/README.md) | Entra ID èº«ä»½éªŒè¯ | Microsoft Entra ID æä¾›äº†å¼ºå¤§çš„åŸºäºäº‘çš„èº«ä»½å’Œè®¿é—®ç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œæœ‰åŠ©äºç¡®ä¿åªæœ‰æˆæƒçš„ç”¨æˆ·å’Œåº”ç”¨ç¨‹åºæ‰èƒ½ä¸çš„ MCP æœåŠ¡å™¨äº¤äº’ã€‚ |
| [5.13 Azure AI Foundry ä»£ç†é›†æˆ](https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-foundry-agent-integration/README.md) | Azure AI Foundry é›†æˆ | äº†è§£å¦‚ä½•å°†æ¨¡å‹ä¸Šä¸‹æ–‡åè®®æœåŠ¡å™¨ä¸ Azure AI Foundry ä»£ç†é›†æˆï¼Œä»è€Œé€šè¿‡æ ‡å‡†åŒ–çš„å¤–éƒ¨æ•°æ®æºè¿æ¥å®ç°å¼ºå¤§çš„å·¥å…·ç¼–æ’å’Œä¼ä¸š AI åŠŸèƒ½ã€‚ |

## **MCP ä¸ Azure é›†æˆ**

**ä¸Azure OpenAI é›†æˆ TODO change to python**

**Microsoft AI Foundry é›†æˆ TODO change to python**

**å°† MCP ä¸ Azure ML é›†æˆ**

- Python
    
    ```python
     Python Azure AI é›†æˆ
    from mcp_client import McpClient
    from azure.ai.ml import MLClient
    from azure.identity import DefaultAzureCredential
    from azure.ai.ml.entities import Environment, AmlCompute
    import os
    import asyncio
    
    class EnterpriseAiIntegration:
        def __init__(self, mcp_server_url, subscription_id, resource_group, workspace_name):
            # è®¾ç½® MCP å®¢æˆ·ç«¯
            self.mcp_client = McpClient(server_url=mcp_server_url)
    
            # è®¾ç½® Azure ML å®¢æˆ·ç«¯
            self.credential = DefaultAzureCredential()
            self.ml_client = MLClient(
                self.credential,
                subscription_id,
                resource_group,
                workspace_name
            )
    
        async def execute_ml_pipeline(self, pipeline_name, input_data):
            """åœ¨ Azure ML ä¸­æ‰§è¡Œ ML æµæ°´çº¿"""
            # é¦–å…ˆä½¿ç”¨ MCP å·¥å…·å¤„ç†è¾“å…¥æ•°æ®
            processed_data = await self.mcp_client.execute_tool(
                "dataPreprocessor",
                {
                    "data": input_data,
                    "operations": ["normalize", "clean", "transform"]
                }
            )
    
            # å°†æµæ°´çº¿æäº¤åˆ° Azure ML
            pipeline_job = self.ml_client.jobs.create_or_update(
                entity={
                    "name": pipeline_name,
                    "display_name": f"MCPè§¦å‘çš„ {pipeline_name}",
                    "experiment_name": "mcp-integration",
                    "inputs": {
                        "processed_data": processed_data.result
                    }
                }
            )
    
            # è¿”å›ä½œä¸šä¿¡æ¯
            return {
                "job_id": pipeline_job.id,
                "status": pipeline_job.status,
                "creation_time": pipeline_job.creation_context.created_at
            }
    
        async def register_ml_model_as_tool(self, model_name, model_version="latest"):
            """å°† Azure ML æ¨¡å‹æ³¨å†Œä¸º MCP å·¥å…·"""
            # è·å–æ¨¡å‹è¯¦æƒ…
            if model_version == "latest":
                model = self.ml_client.models.get(name=model_name, label="latest")
            else:
                model = self.ml_client.models.get(name=model_name, version=model_version)
    
            # åˆ›å»ºéƒ¨ç½²ç¯å¢ƒ
            env = Environment(
                name="mcp-model-env",
                conda_file="./environments/inference-env.yml"
            )
    
            # è®¾ç½®è®¡ç®—èµ„æº
            compute = self.ml_client.compute.get("mcp-inference")
    
            # å°†æ¨¡å‹éƒ¨ç½²ä¸ºåœ¨çº¿ç«¯ç‚¹
            deployment = self.ml_client.online_deployments.create_or_update(
                endpoint_name=f"mcp-{model_name}",
                deployment={
                    "name": f"mcp-{model_name}-deployment",
                    "model": model.id,
                    "environment": env,
                    "compute": compute,
                    "scale_settings": {
                        "scale_type": "auto",
                        "min_instances": 1,
                        "max_instances": 3
                    }
                }
            )
    
            # åŸºäºæ¨¡å‹æ¨¡å¼åˆ›å»º MCP å·¥å…·æ¨¡å¼
            tool_schema = {
                "type": "object",
                "properties": {},
                "required": []
            }
    
            # åŸºäºæ¨¡å‹æ¨¡å¼æ·»åŠ è¾“å…¥å±æ€§
            for input_name, input_spec in model.signature.inputs.items():
                tool_schema["properties"][input_name] = {
                    "type": self._map_ml_type_to_json_type(input_spec.type)
                }
                tool_schema["required"].append(input_name)
    
            # æ³¨å†Œä¸º MCP å·¥å…·
            # åœ¨å®é™…å®ç°ä¸­ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªè°ƒç”¨ç«¯ç‚¹çš„å·¥å…·
            return {
                "model_name": model_name,
                "model_version": model.version,
                "endpoint": deployment.endpoint_uri,
                "tool_schema": tool_schema
            }
    
        def _map_ml_type_to_json_type(self, ml_type):
            """å°† ML æ•°æ®ç±»å‹æ˜ å°„åˆ° JSON æ¨¡å¼ç±»å‹"""
            mapping = {
                "float": "number",
                "int": "integer",
                "bool": "boolean",
                "str": "string",
                "object": "object",
                "array": "array"
            }
            return mapping.get(ml_type, "string")
    ```
    

## **å¤šæ¨¡æ€**

**å¤šæ¨¡æ€ç¤ºä¾‹ï¼šå›¾åƒåˆ†æ TODO change to python**

**å¤šæ¨¡æ€ç¤ºä¾‹ï¼šéŸ³é¢‘å¤„ç† TODO change to python**

**å¤šæ¨¡æ€ç¤ºä¾‹ï¼šå¤šæ¨¡æ€å“åº”ç”Ÿæˆ**

- Python
    
    ```python
    
    ```
    

## **MCP OAuth2 æ¼”ç¤º**

## **æ ¹ä¸Šä¸‹æ–‡**

æ ¹ä¸Šä¸‹æ–‡æ˜¯æ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼ˆMCPï¼‰ä¸­çš„åŸºç¡€æ¦‚å¿µï¼Œæä¾›äº†ä¸€ä¸ªæŒä¹…å±‚ï¼Œç”¨äºè·¨å¤šä¸ªè¯·æ±‚å’Œä¼šè¯ç»´æŠ¤å¯¹è¯å†å²å’Œå…±äº«çŠ¶æ€ã€‚

æ ¹ä¸Šä¸‹æ–‡ä½œä¸ºå®¹å™¨ï¼Œä¿å­˜ä¸€ç³»åˆ—ç›¸å…³äº¤äº’çš„å†å²å’ŒçŠ¶æ€ã€‚å®ƒä»¬æ”¯æŒï¼š

- **å¯¹è¯æŒä¹…æ€§**ï¼šç»´æŠ¤è¿è´¯çš„å¤šè½®å¯¹è¯
- **è®°å¿†ç®¡ç†**ï¼šè·¨äº¤äº’å­˜å‚¨å’Œæ£€ç´¢ä¿¡æ¯
- **çŠ¶æ€ç®¡ç†**ï¼šè·Ÿè¸ªå¤æ‚å·¥ä½œæµçš„è¿›åº¦
- **ä¸Šä¸‹æ–‡å…±äº«**ï¼šå…è®¸å¤šä¸ªå®¢æˆ·ç«¯è®¿é—®ç›¸åŒçš„å¯¹è¯çŠ¶æ€

åœ¨ MCP ä¸­ï¼Œæ ¹ä¸Šä¸‹æ–‡å…·æœ‰ä»¥ä¸‹å…³é”®ç‰¹å¾ï¼š

- æ¯ä¸ªæ ¹ä¸Šä¸‹æ–‡éƒ½æœ‰å”¯ä¸€æ ‡è¯†ç¬¦
- å¯åŒ…å«å¯¹è¯å†å²ã€ç”¨æˆ·åå¥½å’Œå…¶ä»–å…ƒæ•°æ®
- å¯æ ¹æ®éœ€è¦åˆ›å»ºã€è®¿é—®å’Œå½’æ¡£
- æ”¯æŒç»†ç²’åº¦çš„è®¿é—®æ§åˆ¶å’Œæƒé™ç®¡ç†

**æ ¹ä¸Šä¸‹æ–‡ç”Ÿå‘½å‘¨æœŸ**

**ä½¿ç”¨æ ¹ä¸Šä¸‹æ–‡**

ä»¥ä¸‹æ˜¯åˆ›å»ºå’Œç®¡ç†æ ¹ä¸Šä¸‹æ–‡çš„ç¤ºä¾‹ã€‚

**ç¤ºä¾‹ï¼šè´¢åŠ¡åˆ†æçš„æ ¹ä¸Šä¸‹æ–‡å®ç°**

æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†ä¸ºè´¢åŠ¡åˆ†æä¼šè¯åˆ›å»ºæ ¹ä¸Šä¸‹æ–‡ï¼Œå±•ç¤ºå¦‚ä½•è·¨å¤šä¸ªäº¤äº’ç»´æŠ¤çŠ¶æ€ã€‚

**ç¤ºä¾‹ï¼šæ ¹ä¸Šä¸‹æ–‡ç®¡ç†**

æœ‰æ•ˆç®¡ç†æ ¹ä¸Šä¸‹æ–‡å¯¹äºç»´æŠ¤å¯¹è¯å†å²å’ŒçŠ¶æ€è‡³å…³é‡è¦ã€‚ä»¥ä¸‹æ˜¯å®ç°æ ¹ä¸Šä¸‹æ–‡ç®¡ç†çš„ç¤ºä¾‹ã€‚

**å¤šè½®ååŠ©çš„æ ¹ä¸Šä¸‹æ–‡**

åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†ä¸ºå¤šè½®ååŠ©ä¼šè¯åˆ›å»ºæ ¹ä¸Šä¸‹æ–‡ï¼Œå±•ç¤ºå¦‚ä½•è·¨å¤šä¸ªäº¤äº’ç»´æŠ¤çŠ¶æ€ã€‚

- Python
    
    ```python
    # Python ç¤ºä¾‹ï¼šå¤šè½®ååŠ©çš„æ ¹ä¸Šä¸‹æ–‡
    import asyncio
    from datetime import datetime
    from mcp_client import McpClient, RootContextManager
    
    class AssistantSession:
        def __init__(self, server_url, api_key=None):
            self.client = McpClient(server_url=server_url, api_key=api_key)
            self.context_manager = RootContextManager(self.client)
    
        async def create_session(self, name, user_info=None):
            """ä¸ºååŠ©ä¼šè¯åˆ›å»ºæ–°æ ¹ä¸Šä¸‹æ–‡"""
            metadata = {
                "session_type": "assistant",
                "created_at": datetime.now().isoformat(),
            }
    
            # æ·»åŠ ç”¨æˆ·ä¿¡æ¯ï¼ˆå¦‚æœæä¾›ï¼‰
            if user_info:
                metadata.update({f"user_{k}": v for k, v in user_info.items()})
    
            # åˆ›å»ºæ ¹ä¸Šä¸‹æ–‡
            context = await self.context_manager.create_root_context(name, metadata)
            return context.id
    
        async def send_message(self, context_id, message, tools=None):
            """åœ¨æ ¹ä¸Šä¸‹æ–‡ä¸­å‘é€æ¶ˆæ¯"""
            # åˆ›å»ºå¸¦ä¸Šä¸‹æ–‡IDçš„é€‰é¡¹
            options = {
                "root_context_id": context_id
            }
    
            # æ·»åŠ å·¥å…·ï¼ˆå¦‚æœæŒ‡å®šï¼‰
            if tools:
                options["allowed_tools"] = tools
    
            # åœ¨ä¸Šä¸‹æ–‡ä¸­å‘é€æç¤º
            response = await self.client.send_prompt(message, options)
    
            # ç”¨å¯¹è¯è¿›åº¦æ›´æ–°ä¸Šä¸‹æ–‡å…ƒæ•°æ®
            await self.context_manager.update_context_metadata(
                context_id,
                {
                    f"message_{datetime.now().timestamp()}": message[:50] + "...",
                    "last_interaction": datetime.now().isoformat()
                }
            )
    
            return response
    
        async def get_conversation_history(self, context_id):
            """ä»ä¸Šä¸‹æ–‡ä¸­æ£€ç´¢å¯¹è¯å†å²"""
            context_info = await self.context_manager.get_context_info(context_id)
            messages = await self.client.get_context_messages(context_id)
    
            return {
                "context_info": context_info,
                "messages": messages
            }
    
        async def end_session(self, context_id):
            """é€šè¿‡å½’æ¡£ä¸Šä¸‹æ–‡ç»“æŸååŠ©ä¼šè¯"""
            # é¦–å…ˆç”Ÿæˆæ‘˜è¦
            summary_response = await self.client.send_prompt(
                "è¯·æ€»ç»“æˆ‘ä»¬çš„å¯¹è¯ä»¥åŠä»»ä½•å…³é”®ç‚¹æˆ–å†³ç­–ã€‚",
                {"root_context_id": context_id}
            )
    
            # åœ¨å…ƒæ•°æ®ä¸­å­˜å‚¨æ‘˜è¦
            await self.context_manager.update_context_metadata(
                context_id,
                {
                    "summary": summary_response.generated_text,
                    "ended_at": datetime.now().isoformat(),
                    "status": "completed"
                }
            )
    
            # å½’æ¡£ä¸Šä¸‹æ–‡
            await self.context_manager.archive_context(context_id)
    
            return {
                "status": "completed",
                "summary": summary_response.generated_text
            }
    
    # ç¤ºä¾‹ç”¨æ³•
    async def demo_assistant_session():
        assistant = AssistantSession("https://mcp-server-example.com")
    
        # 1. åˆ›å»ºä¼šè¯
        context_id = await assistant.create_session(
            "æŠ€æœ¯æ”¯æŒä¼šè¯",
            {"name": "Alex", "technical_level": "é«˜çº§", "product": "äº‘æœåŠ¡"}
        )
        print(f"å·²åˆ›å»ºä¼šè¯ï¼Œä¸Šä¸‹æ–‡ ID: {context_id}")
    
        # 2. é¦–æ¬¡äº¤äº’
        response1 = await assistant.send_message(
            context_id,
            "æˆ‘åœ¨ä½ ä»¬çš„äº‘å¹³å°ä¸­é‡åˆ°è‡ªåŠ¨æ‰©å±•åŠŸèƒ½çš„é—®é¢˜ã€‚",
            ["documentation_search", "diagnostic_tool"]
        )
        print(f"å“åº” 1: {response1.generated_text}")
    
        # åŒä¸€ä¸Šä¸‹æ–‡çš„ç¬¬äºŒæ¬¡äº¤äº’
        response2 = await assistant.send_message(
            context_id,
            "æ˜¯çš„ï¼Œæˆ‘å·²ç»æ£€æŸ¥äº†ä½ æåˆ°çš„é…ç½®è®¾ç½®ï¼Œä½†ä»ç„¶æ— æ³•å·¥ä½œã€‚"
        )
        print(f"å“åº” 2: {response2.generated_text}")
    
        # 3. è·å–å†å²è®°å½•
        history = await assistant.get_conversation_history(context_id)
        print(f"ä¼šè¯æœ‰ {len(history['messages'])} æ¡æ¶ˆæ¯")
    
        # 4. ç»“æŸä¼šè¯
        end_result = await assistant.end_session(context_id)
        print(f"ä¼šè¯ç»“æŸï¼Œæ‘˜è¦: {end_result['summary']}")
    
    if __name__ == "__main__":
        asyncio.run(demo_assistant_session())
        
    
    ```
    

 **æ ¹ä¸Šä¸‹æ–‡æœ€ä½³å®è·µ**

ä»¥ä¸‹æ˜¯æœ‰æ•ˆç®¡ç†æ ¹ä¸Šä¸‹æ–‡çš„æœ€ä½³å®è·µï¼š

- **åˆ›å»ºèšç„¦çš„ä¸Šä¸‹æ–‡**ï¼šä¸ºä¸åŒç›®çš„æˆ–é¢†åŸŸåˆ›å»ºç‹¬ç«‹çš„æ ¹ä¸Šä¸‹æ–‡ä»¥ä¿æŒæ¸…æ™°åº¦
- **è®¾ç½®è¿‡æœŸç­–ç•¥**ï¼šå®æ–½ç­–ç•¥å½’æ¡£æˆ–åˆ é™¤æ—§ä¸Šä¸‹æ–‡ä»¥ç®¡ç†å­˜å‚¨å¹¶ç¬¦åˆæ•°æ®ä¿ç•™æ”¿ç­–
- **å­˜å‚¨ç›¸å…³å…ƒæ•°æ®**ï¼šä½¿ç”¨ä¸Šä¸‹æ–‡å…ƒæ•°æ®å­˜å‚¨å¯¹è¯ä¸­çš„é‡è¦ä¿¡æ¯ä»¥å¤‡åç”¨
- **ä¸€è‡´ä½¿ç”¨ä¸Šä¸‹æ–‡ ID**ï¼šä¸Šä¸‹æ–‡åˆ›å»ºåï¼Œæ‰€æœ‰ç›¸å…³è¯·æ±‚å§‹ç»ˆä½¿ç”¨å…¶ ID ä»¥ä¿æŒè¿ç»­æ€§
- **ç”Ÿæˆæ‘˜è¦**ï¼šå½“ä¸Šä¸‹æ–‡è¿‡å¤§æ—¶ï¼Œè€ƒè™‘ç”Ÿæˆæ‘˜è¦ä»¥æ•è·å…³é”®ä¿¡æ¯
- **å®æ–½è®¿é—®æ§åˆ¶**ï¼šåœ¨å¤šç”¨æˆ·ç³»ç»Ÿä¸­å®æ–½é€‚å½“çš„è®¿é—®æ§åˆ¶ä»¥ç¡®ä¿å¯¹è¯ä¸Šä¸‹æ–‡çš„éšç§å’Œå®‰å…¨
- **å¤„ç†ä¸Šä¸‹æ–‡é™åˆ¶**ï¼šæ³¨æ„ä¸Šä¸‹æ–‡å¤§å°é™åˆ¶ï¼Œå¹¶ä¸ºå¤„ç†è¶…é•¿å¯¹è¯å®æ–½ç­–ç•¥
- **å®Œæˆåå½’æ¡£**ï¼šå¯¹è¯å®Œæˆåå½’æ¡£ä¸Šä¸‹æ–‡ä»¥é‡Šæ”¾èµ„æºåŒæ—¶ä¿ç•™å†å²è®°å½•

## **è·¯ç”±**

- **æ°´å¹³æ‰©å±•**ï¼šåœ¨è´Ÿè½½å‡è¡¡å™¨åéƒ¨ç½²å¤šä¸ª MCP æœåŠ¡å™¨å®ä¾‹ï¼Œå‡åŒ€åˆ†é…ä¼ å…¥è¯·æ±‚
- **å‚ç›´æ‰©å±•**ï¼šé€šè¿‡å¢åŠ èµ„æºï¼ˆCPUã€å†…å­˜ï¼‰å’Œä¼˜åŒ–é…ç½®ï¼Œä¼˜åŒ–å•ä¸ª MCP æœåŠ¡å™¨å®ä¾‹ä»¥å¤„ç†æ›´å¤šè¯·æ±‚
- **èµ„æºä¼˜åŒ–**ï¼šä½¿ç”¨é«˜æ•ˆç®—æ³•ã€ç¼“å­˜å’Œå¼‚æ­¥å¤„ç†æ¥å‡å°‘èµ„æºæ¶ˆè€—å¹¶æé«˜å“åº”æ—¶é—´
- **åˆ†å¸ƒå¼æ¶æ„**ï¼šå®ç°å¤šä¸ª MCP èŠ‚ç‚¹ååŒå·¥ä½œçš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå…±äº«è´Ÿè½½å¹¶æä¾›å†—ä½™

**åŸºäºå†…å®¹çš„è·¯ç”±**

åŸºäºå†…å®¹çš„è·¯ç”±æ ¹æ®è¯·æ±‚å†…å®¹å°†è¯·æ±‚å®šå‘åˆ°ä¸“ç”¨æœåŠ¡ã€‚ä¾‹å¦‚ï¼Œä¸ä»£ç ç”Ÿæˆç›¸å…³çš„è¯·æ±‚å¯ä»¥è·¯ç”±åˆ°ä¸“é—¨çš„ä»£ç æ¨¡å‹ï¼Œè€Œåˆ›æ„å†™ä½œè¯·æ±‚åˆ™å¯ä»¥å‘é€åˆ°åˆ›æ„å†™ä½œæ¨¡å‹ã€‚

ä»¥ä¸‹æ˜¯ä¸åŒç¼–ç¨‹è¯­è¨€çš„å®ç°ç¤ºä¾‹ï¼š

- .NET
    
    ```csharp
    
    ```
    
    - 
    - 
    - 
    - 
    - 
    - 
    - 

### **æ™ºèƒ½è´Ÿè½½å‡è¡¡**

è´Ÿè½½å‡è¡¡ä¼˜åŒ–èµ„æºåˆ©ç”¨å¹¶ç¡®ä¿ MCP æœåŠ¡çš„é«˜å¯ç”¨æ€§ã€‚å®ç°è´Ÿè½½å‡è¡¡æœ‰ä¸åŒæ–¹å¼ï¼Œå¦‚è½®è¯¢ã€åŠ æƒå“åº”æ—¶é—´æˆ–å†…å®¹æ„ŸçŸ¥ç­–ç•¥ã€‚

ä»¥ä¸‹æ˜¯ä½¿ç”¨ä»¥ä¸‹ç­–ç•¥çš„ç¤ºä¾‹å®ç°ï¼š

- **è½®è¯¢ï¼ˆRound Robinï¼‰**ï¼šåœ¨å¯ç”¨æœåŠ¡å™¨é—´å‡åŒ€åˆ†é…è¯·æ±‚
- **åŠ æƒå“åº”æ—¶é—´ï¼ˆWeighted Response Timeï¼‰**ï¼šåŸºäºæœåŠ¡å™¨å¹³å‡å“åº”æ—¶é—´è·¯ç”±è¯·æ±‚
- **å†…å®¹æ„ŸçŸ¥ï¼ˆContent-Awareï¼‰**ï¼šåŸºäºè¯·æ±‚å†…å®¹è·¯ç”±åˆ°ä¸“ç”¨æœåŠ¡å™¨
- Java
    
    ```java
    
    ```
    
    - 
    - 
    - 
    - 
    - 
    - 
    - 
    - 

### **åŠ¨æ€å·¥å…·è·¯ç”±**

å·¥å…·è·¯ç”±ç¡®ä¿å·¥å…·è°ƒç”¨æ ¹æ®ä¸Šä¸‹æ–‡è¢«å®šå‘åˆ°æœ€åˆé€‚çš„æœåŠ¡ã€‚ä¾‹å¦‚ï¼Œå¤©æ°”å·¥å…·è°ƒç”¨å¯èƒ½éœ€è¦åŸºäºç”¨æˆ·ä½ç½®è·¯ç”±åˆ°åŒºåŸŸç«¯ç‚¹ï¼Œæˆ–è®¡ç®—å™¨å·¥å…·å¯èƒ½éœ€è¦ä½¿ç”¨ç‰¹å®šç‰ˆæœ¬çš„ APIã€‚

ä»¥ä¸‹æ˜¯åŸºäºè¯·æ±‚åˆ†æã€åŒºåŸŸç«¯ç‚¹å’Œç‰ˆæœ¬æ”¯æŒçš„åŠ¨æ€å·¥å…·è·¯ç”±ç¤ºä¾‹å®ç°ï¼š

- Python
    
    ```python
    
    ```
    
    - 
    - 
    - 
    - 
    - 

## **é‡‡æ ·**

### **é‡‡æ ·å‚æ•°æ¦‚è§ˆ**

MCP å®šä¹‰äº†ä»¥ä¸‹å¯ä»¥åœ¨å®¢æˆ·ç«¯è¯·æ±‚ä¸­é…ç½®çš„é‡‡æ ·å‚æ•°ï¼š

| å‚æ•° | æè¿° | å…¸å‹èŒƒå›´ |
| --- | --- | --- |
| `temperature` | æ§åˆ¶æ ‡è®°é€‰æ‹©çš„éšæœºæ€§ | 0.0 - 2.0 |
| `top_p` | æ ¸é‡‡æ · - é™åˆ¶æ ‡è®°ä¸ºç´¯ç§¯æ¦‚ç‡æœ€é«˜çš„é€‰é¡¹ | 0.0 - 1.0 |
| `top_k` | é™åˆ¶æ ‡è®°é€‰æ‹©ä¸ºå‰ K ä¸ªé€‰é¡¹ | 1 - 100 |
| `presence_penalty` | åŸºäºæ ‡è®°åœ¨æ–‡æœ¬ä¸­çš„å‡ºç°é¢‘ç‡è¿›è¡Œæƒ©ç½š | -2.0 - 2.0 |
| `frequency_penalty` | åŸºäºæ ‡è®°åœ¨æ–‡æœ¬ä¸­çš„å‡ºç°æ¬¡æ•°è¿›è¡Œæƒ©ç½š | -2.0 - 2.0 |
| `seed` | ç”¨äºå¯é‡ç°ç»“æœçš„ç‰¹å®šéšæœºç§å­ | æ•´æ•°å€¼ |
| `max_tokens` | è¦ç”Ÿæˆçš„æœ€å¤§æ ‡è®°æ•° | æ•´æ•°å€¼ |
| `stop_sequences` | é‡åˆ°æ—¶åœæ­¢ç”Ÿæˆçš„è‡ªå®šä¹‰åºåˆ— | å­—ç¬¦ä¸²æ•°ç»„ |

### **æ¸©åº¦å’Œ Top-K/Top-P é‡‡æ ·**

é‡‡æ ·å‚æ•°å…è®¸å¾®è°ƒè¯­è¨€æ¨¡å‹çš„è¡Œä¸ºï¼Œä»¥åœ¨ç¡®å®šæ€§å’Œåˆ›é€ æ€§è¾“å‡ºä¹‹é—´è¾¾åˆ°æ‰€éœ€çš„å¹³è¡¡ã€‚

ä»¥ä¸‹æ˜¯ä¸åŒç¼–ç¨‹è¯­è¨€ä¸­å¦‚ä½•é…ç½®è¿™äº›å‚æ•°çš„ç¤ºä¾‹ï¼š

- .NET
    
    ```csharp
    
    ```
    
    - 
    - 
    - 
    - 
        - 
        - 
        - 
        - 
        - 
- JavaScript
    
    ```jsx
    
    ```
    
    - 
    - 
    - 
    - 

### **ç¡®å®šæ€§é‡‡æ ·**

å¯¹äºéœ€è¦ä¸€è‡´è¾“å‡ºçš„åº”ç”¨ç¨‹åºï¼Œç¡®å®šæ€§é‡‡æ ·å¯ç¡®ä¿ç»“æœå¯é‡ç°ã€‚è¿™æ˜¯é€šè¿‡ä½¿ç”¨å›ºå®šçš„éšæœºç§å­å¹¶å°†æ¸©åº¦è®¾ç½®ä¸ºé›¶æ¥å®ç°çš„ã€‚

ä»¥ä¸‹æ˜¯ä¸åŒç¼–ç¨‹è¯­è¨€ä¸­å®ç°ç¡®å®šæ€§é‡‡æ ·çš„ç¤ºä¾‹ï¼š

- Java
    
    ```java
    
    ```
    
    - 
    - 
    - 
    - 
- JavaScript
    
    ```jsx
    
    ```
    
    - 
    - 
    - 

### **åŠ¨æ€é‡‡æ ·é…ç½®**

åœ¨å®é™…åº”ç”¨ä¸­ï¼Œé€šå¸¸éœ€è¦æ ¹æ®ä¸Šä¸‹æ–‡åŠ¨æ€è°ƒæ•´é‡‡æ ·å‚æ•°ã€‚ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•æ ¹æ®ç”¨æˆ·è¾“å…¥ç±»å‹è‡ªåŠ¨é€‰æ‹©é‡‡æ ·ç­–ç•¥ï¼š

```python
# Python ç¤ºä¾‹ï¼šåŠ¨æ€é‡‡æ ·é…ç½®def get_sampling_strategy(input_type):
    """
    æ ¹æ®è¾“å…¥ç±»å‹è¿”å›åˆé€‚çš„é‡‡æ ·å‚æ•°
    """
    if input_type == "creative":
        return {
            "temperature": 0.9,
            "top_p": 0.95,
            "frequency_penalty": 0.5,
            "presence_penalty": 0.3
        }
    elif input_type == "technical":
        return {
            "temperature": 0.3,
            "top_p": 0.8,
            "frequency_penalty": 0.2,
            "presence_penalty": 0.1
        }
    elif input_type == "factual":
        return {
            "temperature": 0.1,
            "top_p": 0.7,
            "frequency_penalty": 0.1,
            "presence_penalty": 0.05,
            "seed": 42# å›ºå®šç§å­ç”¨äºç¡®å®šæ€§è¾“å‡º
        }
    else:# é»˜è®¤ç­–ç•¥return {
            "temperature": 0.7,
            "top_p": 0.9,
            "frequency_penalty": 0.3,
            "presence_penalty": 0.2
        }

# ä½¿ç”¨ç¤ºä¾‹
creative_params = get_sampling_strategy("creative")
technical_params = get_sampling_strategy("technical")

```

### **åœæ­¢åºåˆ—å’Œæ ‡è®°é™åˆ¶**

åœæ­¢åºåˆ—å’Œæ ‡è®°é™åˆ¶å¯¹äºæ§åˆ¶è¾“å‡ºé•¿åº¦å’Œæ ¼å¼è‡³å…³é‡è¦ï¼š

```jsx
// JavaScript ç¤ºä¾‹ï¼šä½¿ç”¨åœæ­¢åºåˆ—å’Œæ ‡è®°é™åˆ¶const response = await client.sendPrompt("ç”ŸæˆPythonå‡½æ•°è®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ—", {
  max_tokens: 150,// é™åˆ¶è¾“å‡ºé•¿åº¦stop_sequences: ["\n\n", "def test_"],// é‡åˆ°ç©ºè¡Œæˆ–æµ‹è¯•å‡½æ•°å®šä¹‰æ—¶åœæ­¢temperature: 0.4,
  top_p: 0.9,
});
```

### **é‡‡æ ·ç­–ç•¥åº”ç”¨**

åœ¨ä¸åŒåœºæ™¯ä¸‹çš„æ¨èé‡‡æ ·é…ç½®ï¼š

| åº”ç”¨åœºæ™¯ | æ¨èé…ç½® | è¯´æ˜ |
| --- | --- | --- |
| åˆ›æ„å†™ä½œ | `æ¸©åº¦=0.8-1.2`,Â `top_p=0.9-1.0` | é¼“åŠ±å¤šæ ·æ€§å’Œåˆ›é€ æ€§ |
| æŠ€æœ¯æ–‡æ¡£ç”Ÿæˆ | `æ¸©åº¦=0.3-0.6`,Â `top_p=0.8-0.95` | å¹³è¡¡å‡†ç¡®æ€§å’Œæµç•…æ€§ |
| äº‹å®æ€§é—®ç­” | `æ¸©åº¦=0.1-0.3`,Â `top_p=0.7-0.85`,Â `seed=å›ºå®š` | æœ€å¤§åŒ–å‡†ç¡®æ€§å’Œä¸€è‡´æ€§ |
| ä»£ç ç”Ÿæˆ | `æ¸©åº¦=0.5-0.7`,Â `top_p=0.85-0.95` | ç»“æ„å‡†ç¡®æ€§å…¼é¡¾é€‚åº¦åˆ›é€ æ€§ |
| å¯¹è¯ç³»ç»Ÿ | `æ¸©åº¦=0.7-0.9`,Â `presence_penalty=0.5` | è‡ªç„¶æµç•…åŒæ—¶é¿å…é‡å¤ |

## **æ‰©å±•**

### **å¯æ‰©å±•æ€§ç­–ç•¥**

æœ‰å‡ ç§ç­–ç•¥å¯ä»¥æœ‰æ•ˆæ‰©å±• MCP æœåŠ¡å™¨ï¼š

- **æ°´å¹³æ‰©å±•**ï¼šåœ¨è´Ÿè½½å‡è¡¡å™¨åéƒ¨ç½²å¤šä¸ª MCP æœåŠ¡å™¨å®ä¾‹ï¼Œå‡åŒ€åˆ†é…ä¼ å…¥è¯·æ±‚
- **å‚ç›´æ‰©å±•**ï¼šé€šè¿‡å¢åŠ èµ„æºï¼ˆCPUã€å†…å­˜ï¼‰å’Œä¼˜åŒ–é…ç½®ï¼Œä¼˜åŒ–å•ä¸ª MCP æœåŠ¡å™¨å®ä¾‹ä»¥å¤„ç†æ›´å¤šè¯·æ±‚
- **èµ„æºä¼˜åŒ–**ï¼šä½¿ç”¨é«˜æ•ˆç®—æ³•ã€ç¼“å­˜å’Œå¼‚æ­¥å¤„ç†æ¥å‡å°‘èµ„æºæ¶ˆè€—å¹¶æé«˜å“åº”æ—¶é—´
- **åˆ†å¸ƒå¼æ¶æ„**ï¼šå®ç°å¤šä¸ª MCP èŠ‚ç‚¹ååŒå·¥ä½œçš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå…±äº«è´Ÿè½½å¹¶æä¾›å†—ä½™

### **æ°´å¹³æ‰©å±•**

æ°´å¹³æ‰©å±•æ¶‰åŠéƒ¨ç½²å¤šä¸ª MCP æœåŠ¡å™¨å®ä¾‹ï¼Œå¹¶ä½¿ç”¨è´Ÿè½½å‡è¡¡å™¨åˆ†é…ä¼ å…¥è¯·æ±‚ã€‚è¿™ç§æ–¹æ³•å¯ä»¥åŒæ—¶å¤„ç†æ›´å¤šè¯·æ±‚å¹¶æä¾›å®¹é”™èƒ½åŠ›ã€‚

ä»¥ä¸‹æ˜¯é…ç½®æ°´å¹³æ‰©å±•çš„ç¤ºä¾‹ï¼š

- .NET
    
    ```csharp
    
    ```
    
    - 
    - 
    - 

### **å‚ç›´æ‰©å±•å’Œèµ„æºä¼˜åŒ–**

å‚ç›´æ‰©å±•ä¾§é‡äºä¼˜åŒ–å•ä¸ª MCP æœåŠ¡å™¨å®ä¾‹ä»¥é«˜æ•ˆå¤„ç†æ›´å¤šè¯·æ±‚ã€‚è¿™å¯ä»¥é€šè¿‡ä¼˜åŒ–é…ç½®ã€ä½¿ç”¨é«˜æ•ˆç®—æ³•å’Œæœ‰æ•ˆç®¡ç†èµ„æºæ¥å®ç°ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥è°ƒæ•´çº¿ç¨‹æ± ã€è¯·æ±‚è¶…æ—¶å’Œå†…å­˜é™åˆ¶ä»¥æé«˜æ€§èƒ½ã€‚

ä»¥ä¸‹æ˜¯ä¼˜åŒ– MCP æœåŠ¡å™¨ä»¥å®ç°å‚ç›´æ‰©å±•çš„ç¤ºä¾‹ï¼š

- Java
    
    ```java
    
    ```
    
    - 
    - 
    - 

### **åˆ†å¸ƒå¼æ¶æ„**

åˆ†å¸ƒå¼æ¶æ„æ¶‰åŠå¤šä¸ª MCP èŠ‚ç‚¹ååŒå·¥ä½œæ¥å¤„ç†è¯·æ±‚ã€å…±äº«èµ„æºå¹¶æä¾›å†—ä½™ã€‚è¿™ç§æ–¹æ³•é€šè¿‡å…è®¸èŠ‚ç‚¹é€šè¿‡åˆ†å¸ƒå¼ç³»ç»Ÿè¿›è¡Œé€šä¿¡å’Œåè°ƒï¼Œå¢å¼ºäº†å¯æ‰©å±•æ€§å’Œå®¹é”™èƒ½åŠ›ã€‚

ä»¥ä¸‹æ˜¯ä½¿ç”¨ Redis å®ç°åˆ†å¸ƒå¼ MCP æœåŠ¡å™¨æ¶æ„çš„ç¤ºä¾‹ï¼š

- Python
    
    ```python
    
    ```
    

## **å®‰å…¨**

### **è®¤è¯ä¸æˆæƒ**

è®¤è¯å’Œæˆæƒæ˜¯ä¿æŠ¤ MCP æœåŠ¡å™¨çš„å…³é”®ã€‚è®¤è¯å›ç­”"ä½ æ˜¯è°ï¼Ÿ"çš„é—®é¢˜ï¼Œè€Œæˆæƒå›ç­”"ä½ èƒ½åšä»€ä¹ˆï¼Ÿ"ã€‚

è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åœ¨ .NET å’Œ Java ä¸­ä¸º MCP æœåŠ¡å™¨å®ç°å®‰å…¨çš„è®¤è¯å’Œæˆæƒã€‚

### **.NET Identity é›†æˆ**

ASP .NET Core Identity æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„æ¡†æ¶æ¥ç®¡ç†ç”¨æˆ·è®¤è¯å’Œæˆæƒã€‚æˆ‘ä»¬å¯ä»¥å°†å…¶ä¸ MCP æœåŠ¡å™¨é›†æˆï¼Œä»¥ä¿æŠ¤å¯¹å·¥å…·å’Œèµ„æºçš„è®¿é—®ã€‚

é›†æˆ ASP.NET Core Identity ä¸ MCP æœåŠ¡å™¨æ—¶ï¼Œéœ€è¦ç†è§£ä¸€äº›æ ¸å¿ƒæ¦‚å¿µï¼š

- **èº«ä»½é…ç½®**ï¼šè®¾ç½®åŒ…å«ç”¨æˆ·è§’è‰²å’Œå£°æ˜çš„ ASP.NET Core Identityã€‚å£°æ˜æ˜¯æœ‰å…³ç”¨æˆ·çš„ä¿¡æ¯ç‰‡æ®µï¼Œä¾‹å¦‚ä»–ä»¬çš„è§’è‰²æˆ–æƒé™ï¼ˆå¦‚"Admin"æˆ–"User"ï¼‰
- **JWT è®¤è¯**ï¼šä½¿ç”¨ JSON Web Tokens (JWT) è¿›è¡Œå®‰å…¨çš„ API è®¿é—®ã€‚JWT æ˜¯åœ¨å„æ–¹ä¹‹é—´å®‰å…¨ä¼ è¾“ä¿¡æ¯ä½œä¸º JSON å¯¹è±¡çš„æ ‡å‡†ï¼Œå¯ä»¥éªŒè¯å’Œä¿¡ä»»ï¼Œå› ä¸ºå®ƒæ˜¯æ•°å­—ç­¾åçš„
- **æˆæƒç­–ç•¥**ï¼šå®šä¹‰ç­–ç•¥ä»¥åŸºäºç”¨æˆ·è§’è‰²æ§åˆ¶å¯¹ç‰¹å®šå·¥å…·çš„è®¿é—®ã€‚MCP ä½¿ç”¨æˆæƒç­–ç•¥æ ¹æ®ç”¨æˆ·çš„è§’è‰²å’Œå£°æ˜ç¡®å®šå“ªäº›ç”¨æˆ·å¯ä»¥è®¿é—®å“ªäº›å·¥å…·

```csharp
public class SecureMcpStartup
{
    public void ConfigureServices(IServiceCollection services)
    {
// æ·»åŠ  ASP.NET Core Identity
        services.AddIdentity<ApplicationUser, IdentityRole>()
            .AddEntityFrameworkStores<ApplicationDbContext>()
            .AddDefaultTokenProviders();

// é…ç½® JWT è®¤è¯
        services.AddAuthentication(options =>
        {
            options.DefaultAuthenticateScheme = JwtBearerDefaults.AuthenticationScheme;
            options.DefaultChallengeScheme = JwtBearerDefaults.AuthenticationScheme;
        })
        .AddJwtBearer(options =>
        {
            options.TokenValidationParameters = new TokenValidationParameters
            {
                ValidateIssuer = true,
                ValidateAudience = true,
                ValidateLifetime = true,
                ValidateIssuerSigningKey = true,
                ValidIssuer = Configuration["Jwt:Issuer"],
                ValidAudience = Configuration["Jwt:Audience"],
                IssuerSigningKey = new SymmetricSecurityKey(
                    Encoding.UTF8.GetBytes(Configuration["Jwt:Key"]))
            };
        });

// æ·»åŠ æˆæƒç­–ç•¥
        services.AddAuthorization(options =>
        {
            options.AddPolicy("CanUseAdminTools", policy =>
                policy.RequireRole("Admin"));

            options.AddPolicy("CanUseBasicTools", policy =>
                policy.RequireAuthenticatedUser());
        });

// é…ç½®å¸¦å®‰å…¨çš„ MCP æœåŠ¡å™¨
        services.AddMcpServer(options =>
        {
            options.ServerName = "Secure MCP Server";
            options.ServerVersion = "1.0.0";
            options.RequireAuthentication = true;
        });

// æ³¨å†Œå¸¦æˆæƒè¦æ±‚çš„å·¥å…·
        services.AddMcpTool<BasicTool>(options =>
            options.RequirePolicy("CanUseBasicTools"));

        services.AddMcpTool<AdminTool>(options =>
            options.RequirePolicy("CanUseAdminTools"));
    }

    public void Configure(IApplicationBuilder app)
    {
// ä½¿ç”¨è®¤è¯å’Œæˆæƒ
        app.UseAuthentication();
        app.UseAuthorization();

// ä½¿ç”¨ MCP æœåŠ¡å™¨ä¸­é—´ä»¶
        app.UseMcpServer();
    }
}

```

åœ¨å‰é¢çš„ä»£ç ä¸­ï¼š

- é…ç½®äº†ç”¨äºç”¨æˆ·ç®¡ç†çš„ ASP.NET Core Identity
- è®¾ç½®äº†ç”¨äºå®‰å…¨ API è®¿é—®çš„ JWT è®¤è¯ã€‚æˆ‘ä»¬æŒ‡å®šäº†ä»¤ç‰ŒéªŒè¯å‚æ•°ï¼ŒåŒ…æ‹¬é¢å‘è€…ã€å—ä¼—å’Œç­¾åå¯†é’¥
- å®šä¹‰äº†åŸºäºç”¨æˆ·è§’è‰²æ§åˆ¶å·¥å…·è®¿é—®æƒé™çš„æˆæƒç­–ç•¥ã€‚ä¾‹å¦‚ï¼Œ"CanUseAdminTools"ç­–ç•¥è¦æ±‚ç”¨æˆ·å…·æœ‰"Admin"è§’è‰²ï¼Œè€Œ"CanUseBasic"ç­–ç•¥è¦æ±‚ç”¨æˆ·å·²è®¤è¯
- æ³¨å†Œäº†å…·æœ‰ç‰¹å®šæˆæƒè¦æ±‚çš„ MCP å·¥å…·ï¼Œç¡®ä¿åªæœ‰å…·æœ‰é€‚å½“è§’è‰²çš„ç”¨æˆ·æ‰èƒ½è®¿é—®å®ƒä»¬

### **Java Spring Security é›†æˆ**

å¯¹äº Javaï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Spring Security ä¸º MCP æœåŠ¡å™¨å®ç°å®‰å…¨çš„è®¤è¯å’Œæˆæƒã€‚Spring Security æä¾›äº†ä¸€ä¸ªå…¨é¢çš„å®‰å…¨æ¡†æ¶ï¼Œä¸ Spring åº”ç”¨æ— ç¼é›†æˆã€‚

æ ¸å¿ƒæ¦‚å¿µåŒ…æ‹¬ï¼š

- **Spring Security é…ç½®**ï¼šè®¾ç½®ç”¨äºè®¤è¯å’Œæˆæƒçš„å®‰å…¨é…ç½®
- **OAuth2 èµ„æºæœåŠ¡å™¨**ï¼šä½¿ç”¨ OAuth2 å®‰å…¨è®¿é—® MCP å·¥å…·ã€‚OAuth2 æ˜¯ä¸€ä¸ªæˆæƒæ¡†æ¶ï¼Œå…è®¸ç¬¬ä¸‰æ–¹æœåŠ¡äº¤æ¢è®¿é—®ä»¤ç‰Œä»¥å®‰å…¨è®¿é—® API
- **å®‰å…¨æ‹¦æˆªå™¨**ï¼šå®ç°å®‰å…¨æ‹¦æˆªå™¨ä»¥åœ¨å·¥å…·æ‰§è¡Œæ—¶å¼ºåˆ¶æ‰§è¡Œè®¿é—®æ§åˆ¶
- **åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶**ï¼šä½¿ç”¨è§’è‰²æ§åˆ¶å¯¹ç‰¹å®šå·¥å…·å’Œèµ„æºçš„è®¿é—®
- **å®‰å…¨æ³¨è§£**ï¼šä½¿ç”¨æ³¨è§£ä¿æŠ¤æ–¹æ³•å’Œç«¯ç‚¹

```java
@Configuration
@EnableWebSecurity
public class SecurityConfig extends WebSecurityConfigurerAdapter {

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http
            .csrf().disable()
            .authorizeRequests()
                .antMatchers("/mcp/discovery").permitAll()// å…è®¸å·¥å…·å‘ç°
                .antMatchers("/mcp/tools/**").hasAnyRole("USER", "ADMIN")// è¦æ±‚å·¥å…·è®¤è¯
                .antMatchers("/mcp/admin/**").hasRole("ADMIN")// ä»…ç®¡ç†å‘˜ç«¯ç‚¹
                .anyRequest().authenticated()
            .and()
            .oauth2ResourceServer().jwt();
    }

    @Bean
    public McpSecurityInterceptor mcpSecurityInterceptor() {
        return new McpSecurityInterceptor();
    }
}

// ç”¨äºå·¥å…·æˆæƒçš„ MCP å®‰å…¨æ‹¦æˆªå™¨public class McpSecurityInterceptor implements ToolExecutionInterceptor {
    @Autowired
    private JwtDecoder jwtDecoder;

    @Override
    public void beforeToolExecution(ToolRequest request, Authentication authentication) {
        String toolName = request.getToolName();

// æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰ä½¿ç”¨æ­¤å·¥å…·çš„æƒé™if (toolName.startsWith("admin") && !authentication.getAuthorities().contains("ROLE_ADMIN")) {
            throw new AccessDeniedException("æ— æƒä½¿ç”¨æ­¤å·¥å…·");
        }

// åŸºäºå·¥å…·æˆ–å‚æ•°çš„é¢å¤–å®‰å…¨æ£€æŸ¥if ("sensitiveDataAccess".equals(toolName)) {
            validateDataAccessPermissions(request, authentication);
        }
    }

    private void validateDataAccessPermissions(ToolRequest request, Authentication auth) {
// æ£€æŸ¥ç»†ç²’åº¦æ•°æ®è®¿é—®æƒé™çš„å®ç°
    }
}

```

åœ¨å‰é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ï¼š

- é…ç½®äº† Spring Security æ¥ä¿æŠ¤ MCP ç«¯ç‚¹ï¼Œå…è®¸å…¬å…±è®¿é—®å·¥å…·å‘ç°ï¼ŒåŒæ—¶è¦æ±‚å·¥å…·æ‰§è¡Œè¿›è¡Œè®¤è¯
- ä½¿ç”¨ OAuth2 ä½œä¸ºèµ„æºæœåŠ¡å™¨å¤„ç†å¯¹ MCP å·¥å…·çš„å®‰å…¨è®¿é—®
- å®ç°äº†å®‰å…¨æ‹¦æˆªå™¨ä»¥åœ¨å·¥å…·æ‰§è¡Œæ—¶å¼ºåˆ¶æ‰§è¡Œè®¿é—®æ§åˆ¶ï¼Œæ£€æŸ¥ç”¨æˆ·è§’è‰²å’Œæƒé™åå…è®¸è®¿é—®ç‰¹å®šå·¥å…·
- å®šä¹‰äº†åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼Œæ ¹æ®ç”¨æˆ·è§’è‰²é™åˆ¶å¯¹ç®¡ç†å·¥å…·å’Œæ•æ„Ÿæ•°æ®è®¿é—®çš„è®¿é—®

### **æ•°æ®ä¿æŠ¤ä¸éšç§**

æ•°æ®ä¿æŠ¤å¯¹äºç¡®ä¿æ•æ„Ÿä¿¡æ¯å®‰å…¨å¤„ç†è‡³å…³é‡è¦ã€‚è¿™åŒ…æ‹¬ä¿æŠ¤ä¸ªäººèº«ä»½ä¿¡æ¯ (PII)ã€è´¢åŠ¡æ•°æ®å’Œå…¶ä»–æ•æ„Ÿä¿¡æ¯å…å—æœªç»æˆæƒçš„è®¿é—®å’Œæ³„éœ²ã€‚

### **Python æ•°æ®ä¿æŠ¤ç¤ºä¾‹**

è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªä½¿ç”¨åŠ å¯†å’Œ PII æ£€æµ‹åœ¨ Python ä¸­å®ç°æ•°æ®ä¿æŠ¤çš„ç¤ºä¾‹ã€‚

```python
from mcp_server import McpServer
from mcp_tools import Tool, ToolRequest, ToolResponse
from cryptography.fernet import Fernet
import os
import json
from functools import wraps

# PII æ£€æµ‹å™¨ - è¯†åˆ«å’Œä¿æŠ¤æ•æ„Ÿä¿¡æ¯
class PiiDetector:
    def __init__(self):
        # åŠ è½½ä¸åŒç±»å‹ PII çš„æ¨¡å¼
        with open("pii_patterns.json", "r") as f:
            self.patterns = json.load(f)

    def scan_text(self, text):
        """æ‰«ææ–‡æœ¬ä¸­çš„ PII å¹¶è¿”å›æ£€æµ‹åˆ°çš„ PII ç±»å‹"""
        detected_pii = []
        # ä½¿ç”¨æ­£åˆ™æˆ– ML æ¨¡å‹æ£€æµ‹ PII çš„å®ç°
        return detected_pii

    def scan_parameters(self, parameters):
        """æ‰«æè¯·æ±‚å‚æ•°ä¸­çš„ PII"""
        detected_pii = []
        for key, value in parameters.items():
            if isinstance(value, str):
                pii_in_value = self.scan_text(value)
                if pii_in_value:
                    detected_pii.append((key, pii_in_value))
        return detected_pii

# ä¿æŠ¤æ•æ„Ÿæ•°æ®çš„åŠ å¯†æœåŠ¡
class EncryptionService:
    def __init__(self, key_path=None):
        if key_path and os.path.exists(key_path):
            with open(key_path, "rb") as key_file:
                self.key = key_file.read()
        else:
            self.key = Fernet.generate_key()
            if key_path:
                with open(key_path, "wb") as key_file:
                    key_file.write(self.key)

        self.cipher = Fernet(self.key)

    def encrypt(self, data):
        """åŠ å¯†æ•°æ®"""
        if isinstance(data, str):
            return self.cipher.encrypt(data.encode()).decode()
        else:
            return self.cipher.encrypt(json.dumps(data).encode()).decode()

    def decrypt(self, encrypted_data):
        """è§£å¯†æ•°æ®"""
        if encrypted_data is None:
            return None

        decrypted = self.cipher.decrypt(encrypted_data.encode())
        try:
            return json.loads(decrypted)
        except:
            return decrypted.decode()

# å·¥å…·çš„å®‰å…¨è£…é¥°å™¨
def secure_tool(requires_encryption=False, log_access=True):
    def decorator(cls):
        original_execute = cls.execute_async if hasattr(cls, 'execute_async') else cls.execute

        @wraps(original_execute)
        async def secure_execute(self, request):
            # æ£€æŸ¥è¯·æ±‚ä¸­çš„ PII
            pii_detector = PiiDetector()
            pii_found = pii_detector.scan_parameters(request.parameters)

            # å¦‚æœéœ€è¦åˆ™è®°å½•è®¿é—®
            if log_access:
                tool_name = self.get_name()
                user_id = request.context.get("user_id", "anonymous")
                log_entry = {
                    "timestamp": datetime.now().isoformat(),
                    "tool": tool_name,
                    "user": user_id,
                    "contains_pii": bool(pii_found),
                    "parameters": {k: "***" for k in request.parameters.keys()}  # ä¸è®°å½•å®é™…å€¼
                }
                logging.info(f"å·¥å…·è®¿é—®: {json.dumps(log_entry)}")

            # å¤„ç†æ£€æµ‹åˆ°çš„ PII
            if pii_found:
                # åŠ å¯†æ•æ„Ÿæ•°æ®æˆ–æ‹’ç»è¯·æ±‚
                if requires_encryption:
                    encryption_service = EncryptionService("keys/tool_key.key")
                    for param_name, pii_types in pii_found:
                        # åŠ å¯†æ•æ„Ÿå‚æ•°
                        request.parameters[param_name] = encryption_service.encrypt(
                            request.parameters[param_name]
                        )
                else:
                    # å¦‚æœæ²¡æœ‰åŠ å¯†ä¸”æ£€æµ‹åˆ° PIIï¼Œå¯ä»¥æ‹’ç»è¯·æ±‚
                    raise ToolExecutionException(
                        "è¯·æ±‚åŒ…å«æ— æ³•å®‰å…¨å¤„ç†çš„æ•æ„Ÿæ•°æ®"
                    )

            # æ‰§è¡ŒåŸå§‹æ–¹æ³•
            return await original_execute(self, request)

        # æ›¿æ¢ execute æ–¹æ³•
        if hasattr(cls, 'execute_async'):
            cls.execute_async = secure_execute
        else:
            cls.execute = secure_execute
        return cls

    return decorator

# ä½¿ç”¨è£…é¥°å™¨çš„å®‰å…¨å·¥å…·ç¤ºä¾‹
@secure_tool(requires_encryption=True, log_access=True)
class SecureCustomerDataTool(Tool):
    def get_name(self):
        return "customerData"

    def get_description(self):
        return "å®‰å…¨è®¿é—®å®¢æˆ·æ•°æ®"

    def get_schema(self):
        # æ¨¡å¼å®šä¹‰
        return {}

    async def execute_async(self, request):
        # å®ç°å°†å®‰å…¨åœ°è®¿é—®å®¢æˆ·æ•°æ®
        # ç”±äºæˆ‘ä»¬ä½¿ç”¨äº†è£…é¥°å™¨ï¼ŒPII å·²è¢«æ£€æµ‹å¹¶åŠ å¯†
        return ToolResponse(result={"status": "success"})
```

åœ¨å‰é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ï¼š

- å®ç°äº†Â `PiiDetector`Â ç±»æ¥æ‰«ææ–‡æœ¬å’Œå‚æ•°ä¸­çš„ä¸ªäººèº«ä»½ä¿¡æ¯ (PII)
- åˆ›å»ºäº†Â `EncryptionService`Â ç±»ï¼Œä½¿ç”¨Â `cryptography`Â åº“å¤„ç†æ•æ„Ÿæ•°æ®çš„åŠ å¯†å’Œè§£å¯†
- å®šä¹‰äº†Â `secure_tool`Â è£…é¥°å™¨ï¼ŒåŒ…è£…å·¥å…·æ‰§è¡Œä»¥æ£€æŸ¥ PIIã€è®°å½•è®¿é—®å¹¶åœ¨éœ€è¦æ—¶åŠ å¯†æ•æ„Ÿæ•°æ®
- å°†Â `secure_tool`Â è£…é¥°å™¨åº”ç”¨äºç¤ºä¾‹å·¥å…· (`SecureCustomerDataTool`)ï¼Œç¡®ä¿å…¶å®‰å…¨å¤„ç†æ•æ„Ÿæ•°æ®

## å®æ—¶ Web æœç´¢

- server.py
    
    ```python
    #!/usr/bin/env python3
    """
    Web Search MCP Server
    
    This advanced MCP server demonstrates integration with SerpAPI to provide
    real-time web data to LLMs through four specialized tools:
    - general_search: For broad web search results
    - news_search: For recent news articles
    - product_search: For e-commerce product information
    - qna: For direct question-answer snippets
    
    The server is built using FastMCP and showcases advanced concepts
    like external API integration, structured data parsing, and
    multi-tool orchestration.
    """
    
    import os
    import json
    import httpx
    import logging
    from typing import Dict, Any
    from dotenv import load_dotenv
    from mcp.server.fastmcp import FastMCP, Context
    
    # Configure logging
    logging.basicConfig(
        level=logging.INFO,
        format="%(asctime)s - %(name)s - %(levelname)s - %(message)s"
    )
    logger = logging.getLogger(__name__)
    
    # Load environment variables
    load_dotenv()
    SERPAPI_KEY = os.getenv("SERPAPI_KEY")
    if not SERPAPI_KEY:
        logger.error("SERPAPI_KEY environment variable not found. Please set it in .env file.")
        raise EnvironmentError("SERPAPI_KEY environment variable is required")
    
    # API configuration
    SERPAPI_BASE_URL = "https://serpapi.com/search"
    DEFAULT_TIMEOUT = 10.0  # seconds
    DEFAULT_RESULTS_LIMIT = 5
    
    # Initialize FastMCP server
    mcp = FastMCP("WebSearchServer")
    
    async def make_serpapi_request(ctx: Context, params: Dict[str, Any]) -> Dict[str, Any]:
        """
        Make a request to SerpAPI with the given parameters.
        
        Args:
            ctx: MCP context object for logging
            params: Dictionary of parameters to send to SerpAPI
            
        Returns:
            Dict containing the API response
            
        Raises:
            Exception: If the API request fails
        """
        # Ensure API key is included
        request_params = {**params, "api_key": SERPAPI_KEY}
        
        try:
            async with httpx.AsyncClient(timeout=DEFAULT_TIMEOUT) as client:
                await ctx.info(f"Making SerpAPI request with engine: {params.get('engine', 'google')}")
                response = await client.get(SERPAPI_BASE_URL, params=request_params)
                response.raise_for_status()
                data = response.json()
                await ctx.info("SerpAPI request successful")
                return data
        except httpx.TimeoutException:
            await ctx.error("SerpAPI request timed out")
            raise Exception("Search request timed out. Please try again.")
        except httpx.RequestError as e:
            await ctx.error(f"SerpAPI request error: {e}")
            raise Exception(f"Failed to fetch data from search API: {e}")
        except httpx.HTTPStatusError as e:
            await ctx.error(f"SerpAPI HTTP error: {e.response.status_code} - {e.response.text}")
            raise Exception(f"Search API returned error status: {e.response.status_code}")
        except json.JSONDecodeError:
            await ctx.error("Failed to parse SerpAPI response as JSON")
            raise Exception("Failed to parse search results")
    
    # Tool for general web search
    @mcp.tool()
    async def general_search(query: str, num_results: int = DEFAULT_RESULTS_LIMIT, ctx: Context = None) -> str:
        """
        Perform a general web search and return formatted results.
        
        Args:
            query: The search query
            num_results: Number of results to return (default: 5)
            ctx: MCP context object
            
        Returns:
            Formatted search results as a string
        """
        await ctx.info(f"Performing general search for: {query}")
        
        try:
            # Prepare parameters for SerpAPI
            params = {
                "q": query,
                "num": num_results,
                "engine": "google",
            }
            
            # Make the API request
            response_data = await make_serpapi_request(ctx, params)
            
            # Extract organic results
            organic_results = response_data.get("organic_results", [])
            if not organic_results:
                await ctx.info("No general search results found")
                return "No search results found."
            
            # Format results for return
            formatted_results = []
            for i, result in enumerate(organic_results[:num_results]):
                formatted_results.append(
                    f"## {i+1}. {result.get('title', 'No title')}\n"
                    f"**Link**: {result.get('link', 'No link')}\n"
                    f"**Snippet**: {result.get('snippet', 'No description')}\n"
                )
            
            await ctx.info(f"Returning {len(formatted_results)} general search results")
            return "\n\n".join(formatted_results)
        except Exception as e:
            await ctx.error(f"General search failed: {str(e)}")
            return f"Error: Unable to fetch results. {str(e)}"
    
    # Tool for news search
    @mcp.tool()
    async def news_search(query: str, num_results: int = DEFAULT_RESULTS_LIMIT, ctx: Context = None) -> str:
        """
        Search for recent news articles related to a query.
        
        Args:
            query: The search query
            num_results: Number of news articles to return (default: 5)
            ctx: MCP context object
            
        Returns:
            Formatted news search results as a string
        """
        await ctx.info(f"Performing news search for: {query}")
        
        try:
            # Prepare parameters for SerpAPI
            params = {
                "q": query,
                "num": num_results,
                "engine": "google_news",
            }
            
            # Make the API request
            response_data = await make_serpapi_request(ctx, params)
            
            # Extract news results
            news_results = response_data.get("news_results", [])
            if not news_results:
                await ctx.info("No news articles found")
                return "No news articles found."
            
            # Format results for return
            formatted_results = []
            for i, result in enumerate(news_results[:num_results]):
                formatted_results.append(
                    f"## {i+1}. {result.get('title', 'No title')}\n"
                    f"**Source**: {result.get('source', 'Unknown source')} | "
                    f"**Date**: {result.get('date', 'Unknown date')}\n"
                    f"**Link**: {result.get('link', 'No link')}\n"
                    f"**Snippet**: {result.get('snippet', 'No description')}\n"
                )
            
            await ctx.info(f"Returning {len(formatted_results)} news results")
            return "\n\n".join(formatted_results)
        except Exception as e:
            await ctx.error(f"News search failed: {str(e)}")
            return f"Error: Unable to fetch news. {str(e)}"
    
    # Tool for product search
    @mcp.tool()
    async def product_search(query: str, num_results: int = DEFAULT_RESULTS_LIMIT, ctx: Context = None) -> str:
        """
        Search for products matching a query.
        
        Args:
            query: The product search query
            num_results: Number of product results to return (default: 5)
            ctx: MCP context object
            
        Returns:
            Formatted product search results as a string
        """
        await ctx.info(f"Performing product search for: {query}")
        
        try:
            # Prepare parameters for SerpAPI
            params = {
                "q": query,
                "engine": "google_shopping",
                "shopping_intent": "high",
                "num": num_results
            }
            
            # Make the API request
            response_data = await make_serpapi_request(ctx, params)
            
            # Extract shopping results
            shopping_results = response_data.get("shopping_results", [])
            if not shopping_results:
                await ctx.info("No product results found")
                return "No product results found."
            
            # Format results for return
            formatted_results = []
            for i, result in enumerate(shopping_results[:num_results]):
                formatted_results.append(
                    f"## {i+1}. {result.get('title', 'No title')}\n"
                    f"**Price**: {result.get('price', 'Unknown price')}\n"
                    f"**Rating**: {result.get('rating', 'No rating')} "
                    f"({result.get('reviews', 'No')} reviews)\n"
                    f"**Source**: {result.get('source', 'Unknown source')}\n"
                    f"**Link**: {result.get('link', 'No link')}\n"
                )
            
            await ctx.info(f"Returning {len(formatted_results)} product results")
            return "\n\n".join(formatted_results)
        except Exception as e:
            await ctx.error(f"Product search failed: {str(e)}")
            return f"Error: Unable to fetch products. {str(e)}"
    
    # Tool for Q&A search
    @mcp.tool()
    async def qna(question: str, ctx: Context = None) -> str:
        """
        Get direct answers to questions from search engines.
        
        Args:
            question: The question to find an answer for
            ctx: MCP context object
            
        Returns:
            Answer snippet as a string
        """
        await ctx.info(f"Searching for answer to: {question}")
        
        try:
            # Prepare parameters for SerpAPI
            params = {
                "q": question,
                "engine": "google",
            }
            
            # Make the API request
            response_data = await make_serpapi_request(ctx, params)
            
            # Try to extract answer box first (direct answer)
            answer_box = response_data.get("answer_box", {})
            if answer_box:
                await ctx.info("Found answer in answer box")
                if "answer" in answer_box:
                    return f"**Answer**: {answer_box['answer']}"
                elif "snippet" in answer_box:
                    return f"**Answer**: {answer_box['snippet']}"
                elif "snippet_highlighted_words" in answer_box:
                    return f"**Answer**: {' '.join(answer_box['snippet_highlighted_words'])}"
            
            # Try knowledge graph if no answer box
            knowledge_graph = response_data.get("knowledge_graph", {})
            if knowledge_graph and "description" in knowledge_graph:
                await ctx.info("Found answer in knowledge graph")
                return f"**Answer**: {knowledge_graph['description']}"
            
            # Try featured snippet
            if "featured_snippet" in response_data:
                await ctx.info("Found answer in featured snippet")
                snippet = response_data["featured_snippet"]
                if "snippet" in snippet:
                    return f"**Answer**: {snippet['snippet']}"
            
            # Try related questions
            related_questions = response_data.get("related_questions", [])
            if related_questions:
                await ctx.info("Found answer in related questions")
                formatted = []
                for i, question in enumerate(related_questions[:3]):
                    formatted.append(
                        f"**Question**: {question.get('question', 'Unknown question')}\n"
                        f"**Answer**: {question.get('snippet', 'No answer available')}\n"
                        f"**Source**: {question.get('source', {}).get('link', 'No source')}"
                    )
                return "\n\n".join(formatted)
            
            # Fallback to first organic result snippet
            organic_results = response_data.get("organic_results", [])
            if organic_results and "snippet" in organic_results[0]:
                await ctx.info("No direct answer found, using first organic result")
                return f"**Possible answer**: {organic_results[0]['snippet']}"
            
            await ctx.info("No answer found")
            return "No direct answer found for your question."
        except Exception as e:
            await ctx.error(f"Q&A search failed: {str(e)}")
            return f"Error: Unable to find an answer. {str(e)}"
            
    @mcp.resource("readme://")
    async def get_readme() -> str:
        """Get README information for the Web Search MCP Server"""
        return """
        # Web Search MCP Server
        
        This MCP server provides tools for integrating web search capabilities into LLMs using SerpAPI.
        
        ## Available Tools:
        
        1. `general_search(query, num_results=5)` - Perform a general web search
        2. `news_search(query, num_results=5)` - Search for recent news articles
        3. `product_search(query, num_results=5)` - Search for products
        4. `qna(question)` - Get direct answers to questions
        
        ## Usage:
        
        Call these tools from an MCP client to retrieve real-time web data.
        """
    
    if __name__ == "__main__":
        mcp.run()
    ```
    
- client.py
    
    ```python
    #!/usr/bin/env python3
    """
    Web Search MCP Client
    
    This client demonstrates how to interact with the Web Search MCP Server
    by calling its various tools for retrieving real-time web data.
    
    The client connects to the MCP server via stdio communication and
    shows how to call each of the four specialized search tools:
    - general_search: For broad web search results
    - news_search: For recent news articles
    - product_search: For e-commerce product information
    - qna: For direct question-answer snippets
    
    Quick Start:
    
    1. Get a free API key from SerpAPI (https://serpapi.com/), then create a `.env` file in this folder with:
       SERPAPI_KEY=your_serpapi_key_here
    2. Install dependencies:
       pip install -r ../../requirements.txt
    3. Start the server:
       python server.py
    4. In a new terminal, run the client:
       python client.py
       # Or for interactive mode:
       python client.py --interactive
    """
    
    import asyncio
    import argparse
    import logging
    import sys
    from typing import Dict, Any
    from mcp import ClientSession, StdioServerParameters
    from mcp.client.stdio import stdio_client
    from mcp.types import TextContent, TextResourceContents
    from dotenv import load_dotenv
    
    # Configure logging
    logging.basicConfig(
        level=logging.INFO,
        format="%(asctime)s - %(name)s - %(levelname)s - %(message)s"
    )
    logger = logging.getLogger(__name__)
    
    async def call_tool(session: ClientSession, tool_name: str, params: Dict[str, Any]) -> None:
        """
        Call a tool on the MCP server and print the results.
        
        Args:
            session: MCP client session
            tool_name: Name of the tool to call
            params: Parameters to pass to the tool
        """
        logger.info(f"Calling {tool_name} with params: {params}")
        
        try:
            result = await session.call_tool(tool_name, arguments=params)
            
            if result and result.content:
                text_content = next((content for content in result.content 
                                  if isinstance(content, TextContent)), None)
                
                if text_content:
                    print(f"\n{'='*50}")
                    print(f"{tool_name.upper()} RESULTS:")
                    print(f"{'='*50}")
                    print(text_content.text)
                    print(f"{'='*50}\n")
                    
                    logger.info(f"Successfully called {tool_name}")
                else:
                    logger.warning(f"No text content returned from {tool_name}")
                    print(f"No text content returned from {tool_name}")
            else:
                logger.warning(f"No content returned from {tool_name}")
                print(f"No content returned from {tool_name}")
        except Exception as e:
            logger.error(f"Error calling {tool_name}: {e}")
            print(f"Error calling {tool_name}: {e}")
    
    async def run_interactive_demo(session: ClientSession) -> None:
        """
        Run an interactive demo that lets the user try different search tools.
        
        Args:
            session: MCP client session
        """
        print("\n=== Web Search MCP Interactive Demo ===\n")
        try:
            # Get list of available tools
            logger.info("Getting list of tools")
            tools_response = await session.list_tools()
            tool_names = [tool.name for tool in tools_response.tools]
            
            print(f"Connected to server")
            print(f"Available tools: {', '.join(tool_names)}")
            
            while True:
                print("\nOptions:")
                print("1. General Web Search")
                print("2. News Search")
                print("3. Product Search")
                print("4. Question & Answer")
                print("5. Exit")
                
                choice = input("\nEnter your choice (1-5): ")
                
                if choice == "5":
                    print("Exiting demo. Goodbye!")
                    break
                    
                query = input("Enter your search query: ")
                
                if not query:
                    print("Query cannot be empty. Please try again.")
                    continue
                    
                if choice == "1":
                    await call_tool(session, "general_search", {"query": query})
                elif choice == "2":
                    await call_tool(session, "news_search", {"query": query})
                elif choice == "3":                await call_tool(session, "product_search", {"query": query})
                elif choice == "4":
                    await call_tool(session, "qna", {"question": query})
                else:
                    print("Invalid choice. Please enter a number between 1 and 5.")
        except Exception as e:
            logger.error(f"Error in interactive demo: {e}")
            print(f"Error: {e}")
    
    async def run_all_tools_demo(session: ClientSession) -> None:
        """Run a demonstration of all available tools with preset queries."""
        print("\n=== Running All Tools Demo ===\n")
        
        try:
            # Get the README resource
            logger.info("Getting README resource")
            readme_response = await session.read_resource("readme://")
            if readme_response and readme_response.contents:
                text_resource = next((content for content in readme_response.contents 
                                    if isinstance(content, TextResourceContents)), None)
                if text_resource:
                    print(f"\n{'='*50}")
                    print(f"README RESOURCE:")
                    print(f"{'='*50}")
                    print(text_resource.text)
                    print(f"{'='*50}\n")
            
            # Test the general_search tool
            await call_tool(session, "general_search", {"query": "latest AI trends 2025", "num_results": 3})
            
            # Test the news_search tool
            await call_tool(session, "news_search", {"query": "AI policy updates", "num_results": 3})
            
            # Test the product_search tool
            await call_tool(session, "product_search", {"query": "best AI gadgets 2025", "num_results": 3})
            
            # Test the qna tool
            await call_tool(session, "qna", {"question": "what is artificial intelligence"})
            
        except Exception as e:
            logger.error(f"Error running tools demo: {e}")
            print(f"Error: {e}")
    
    async def main() -> None:
        """Main entry point for the client."""
        # Load environment variables if dotenv module is available
        try:
            load_dotenv()
        except:
            pass
        
        parser = argparse.ArgumentParser(description="Web Search MCP Client")
        parser.add_argument(
            "--interactive", 
            action="store_true",
            help="Run in interactive mode"
        )
        
        args = parser.parse_args()
        
        logger.info("Starting Web Search MCP client")
        
        server_params = StdioServerParameters(
            command="python",
            args=["server.py"]
        )
        
        try:
            logger.info("Connecting to server...")
            async with stdio_client(server_params) as (reader, writer):
                async with ClientSession(reader, writer) as session:
                    logger.info("Initializing session")
                    await session.initialize()
                    
                    if args.interactive:
                        await run_interactive_demo(session)
                    else:
                        await run_all_tools_demo(session)
        
        except KeyboardInterrupt:
            print("\nClient terminated by user.")
        except Exception as e:
            logger.error(f"Error during client execution: {e}")
            import traceback
            logger.error(f"Traceback: {traceback.format_exc()}")
            print(f"Error: {e}")
            sys.exit(1)
    
    if __name__ == "__main__":
        asyncio.run(main())
    ```
    

```bash
mcp run server
```

## æ¨¡å‹ä¸Šä¸‹æ–‡åè®®æœåŠ¡å™¨çš„ Entra ID èº«ä»½éªŒè¯

### **Microsoft Entra ID ç®€ä»‹**

[**Microsoft Entra ID**](https://adoption.microsoft.com/microsoft-security/entra/)Â æ˜¯ä¸€ç§åŸºäºäº‘çš„èº«ä»½å’Œè®¿é—®ç®¡ç†æœåŠ¡ã€‚å¯ä»¥æŠŠå®ƒçœ‹ä½œæ˜¯åº”ç”¨ç¨‹åºçš„é€šç”¨å®‰å…¨å«å£«ã€‚å®ƒå¤„ç†éªŒè¯ç”¨æˆ·èº«ä»½ï¼ˆèº«ä»½éªŒè¯ï¼‰å’Œç¡®å®šä»–ä»¬è¢«å…è®¸åšä»€ä¹ˆï¼ˆæˆæƒï¼‰çš„å¤æ‚è¿‡ç¨‹ã€‚

é€šè¿‡ä½¿ç”¨ Entra IDï¼Œå¯ä»¥ï¼š

- ä¸ºç”¨æˆ·å¯ç”¨å®‰å…¨ç™»å½•ã€‚
- ä¿æŠ¤ API å’ŒæœåŠ¡ã€‚
- ä»ä¸€ä¸ªä¸­å¿ƒä½ç½®ç®¡ç†è®¿é—®ç­–ç•¥ã€‚

å¯¹äº MCP æœåŠ¡å™¨ï¼ŒEntra ID æä¾›äº†ä¸€ä¸ªå¼ºå¤§ä¸”å¹¿å—ä¿¡èµ–çš„è§£å†³æ–¹æ¡ˆæ¥ç®¡ç†è°å¯ä»¥è®¿é—®æœåŠ¡å™¨çš„åŠŸèƒ½ã€‚

### **èº«ä»½éªŒè¯æµç¨‹**

ä»¥ä¸‹æ˜¯è¯¥è¿‡ç¨‹åœ¨å®è·µä¸­çš„å·¥ä½œæ–¹å¼ï¼š

```mermaid
sequenceDiagram
    actor User as ğŸ‘¤ ç”¨æˆ·
    participant Client as ğŸ–¥ï¸ MCP å®¢æˆ·ç«¯
    participant Entra as ğŸ” Microsoft Entra ID
    participant Server as ğŸ”§ MCP æœåŠ¡å™¨

    Client->>+User: è¯·ç™»å½•ä»¥ç»§ç»­ã€‚
    User->>+Entra: è¾“å…¥å‡­æ®ï¼ˆç”¨æˆ·å/å¯†ç ï¼‰ã€‚
    Entra-->>Client: è¿™æ˜¯çš„è®¿é—®ä»¤ç‰Œã€‚
    User-->>-Client: ï¼ˆè¿”å›åˆ°åº”ç”¨ç¨‹åºï¼‰

    Client->>+Server: æˆ‘éœ€è¦ä½¿ç”¨ä¸€ä¸ªå·¥å…·ã€‚è¿™æ˜¯æˆ‘çš„è®¿é—®ä»¤ç‰Œã€‚
    Server->>+Entra: è¿™ä¸ªè®¿é—®ä»¤ç‰Œæœ‰æ•ˆå—ï¼Ÿ
    Entra-->>-Server: æ˜¯çš„ï¼Œæœ‰æ•ˆã€‚
    Server-->>-Client: ä»¤ç‰Œæœ‰æ•ˆã€‚è¿™æ˜¯å·¥å…·çš„ç»“æœã€‚

```

### **ä»‹ç» Microsoft èº«ä»½éªŒè¯åº“ (MSAL)**

MSAL æ˜¯ç”± Microsoft å¼€å‘çš„ä¸€ä¸ªåº“ï¼Œå®ƒä½¿å¼€å‘äººå‘˜æ›´å®¹æ˜“å¤„ç†èº«ä»½éªŒè¯ã€‚ä¸å¿…ç¼–å†™æ‰€æœ‰å¤æ‚çš„ä»£ç æ¥å¤„ç†å®‰å…¨ä»¤ç‰Œã€ç®¡ç†ç™»å½•å’Œåˆ·æ–°ä¼šè¯ï¼ŒMSAL ä¼šä¸ºå¤„ç†è¿™äº›ç¹é‡çš„å·¥ä½œã€‚

å¼ºçƒˆå»ºè®®ä½¿ç”¨åƒ MSAL è¿™æ ·çš„åº“ï¼Œå› ä¸ºï¼š

- **å®ƒå¾ˆå®‰å…¨ï¼š**Â å®ƒå®ç°äº†è¡Œä¸šæ ‡å‡†åè®®å’Œå®‰å…¨æœ€ä½³å®è·µï¼Œé™ä½äº†ä»£ç ä¸­å‡ºç°æ¼æ´çš„é£é™©ã€‚
- **å®ƒç®€åŒ–äº†å¼€å‘ï¼š**Â å®ƒæŠ½è±¡äº† OAuth 2.0 å’Œ OpenID Connect åè®®çš„å¤æ‚æ€§ï¼Œè®©åªéœ€å‡ è¡Œä»£ç å³å¯ä¸ºçš„åº”ç”¨ç¨‹åºæ·»åŠ å¼ºå¤§çš„èº«ä»½éªŒè¯åŠŸèƒ½ã€‚
- **å®ƒå¾—åˆ°ç»´æŠ¤ï¼š**Â Microsoft ä¼šç§¯æç»´æŠ¤å’Œæ›´æ–° MSALï¼Œä»¥åº”å¯¹æ–°çš„å®‰å…¨å¨èƒå’Œå¹³å°å˜åŒ–ã€‚

MSAL æ”¯æŒå¤šç§è¯­è¨€å’Œåº”ç”¨ç¨‹åºæ¡†æ¶ï¼ŒåŒ…æ‹¬ .NETã€JavaScript/TypeScriptã€Pythonã€Javaã€Go ä»¥åŠ iOS å’Œ Android ç­‰ç§»åŠ¨å¹³å°ã€‚è¿™æ„å‘³ç€å¯ä»¥åœ¨æ•´ä¸ªæŠ€æœ¯æ ˆä¸­ä½¿ç”¨ç›¸åŒçš„ä¸€è‡´èº«ä»½éªŒè¯æ¨¡å¼ã€‚

## **ä½¿ç”¨ Entra ID ä¿æŠ¤çš„ MCP æœåŠ¡å™¨ï¼šåˆ†æ­¥æŒ‡å—**

### **åœºæ™¯ 1ï¼šä¿æŠ¤æœ¬åœ° MCP æœåŠ¡å™¨ï¼ˆä½¿ç”¨å…¬å…±å®¢æˆ·ç«¯ï¼‰**

åœ¨æ­¤åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å°†ç ”ç©¶ä¸€ä¸ªåœ¨æœ¬åœ°è¿è¡Œã€é€šè¿‡Â `stdio`Â é€šä¿¡å¹¶ä½¿ç”¨ Entra ID åœ¨å…è®¸è®¿é—®å…¶å·¥å…·ä¹‹å‰å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯çš„ MCP æœåŠ¡å™¨ã€‚è¯¥æœåŠ¡å™¨å°†æœ‰ä¸€ä¸ªå·¥å…·ï¼Œç”¨äºä» Microsoft Graph API è·å–ç”¨æˆ·çš„ä¸ªäººèµ„æ–™ä¿¡æ¯ã€‚

### **1. åœ¨ Entra ID ä¸­è®¾ç½®åº”ç”¨ç¨‹åº**

åœ¨ç¼–å†™ä»»ä½•ä»£ç ä¹‹å‰ï¼Œéœ€è¦åœ¨ Microsoft Entra ID ä¸­æ³¨å†Œçš„åº”ç”¨ç¨‹åºã€‚è¿™ä¼šå‘ŠçŸ¥ Entra ID çš„åº”ç”¨ç¨‹åºï¼Œå¹¶æˆäºˆå…¶ä½¿ç”¨èº«ä»½éªŒè¯æœåŠ¡çš„æƒé™ã€‚

1. å¯¼èˆªåˆ°Â [**Microsoft Entra é—¨æˆ·**](https://entra.microsoft.com/)ã€‚
2. è½¬åˆ°**åº”ç”¨æ³¨å†Œ**å¹¶å•å‡»**æ–°å»ºæ³¨å†Œ**ã€‚
3. ä¸ºçš„åº”ç”¨ç¨‹åºå‘½åï¼ˆä¾‹å¦‚ï¼Œâ€œæˆ‘çš„æœ¬åœ° MCP æœåŠ¡å™¨â€ï¼‰ã€‚
4. å¯¹äº**æ”¯æŒçš„å¸æˆ·ç±»å‹**ï¼Œé€‰æ‹©**ä»…é™æ­¤ç»„ç»‡ç›®å½•ä¸­çš„å¸æˆ·**ã€‚
5. å¯¹äºæ­¤ç¤ºä¾‹ï¼Œå¯ä»¥å°†**é‡å®šå‘ URI**Â ç•™ç©ºã€‚
6. å•å‡»**æ³¨å†Œ**ã€‚

æ³¨å†Œåï¼Œè®°ä¸‹**åº”ç”¨ç¨‹åºï¼ˆå®¢æˆ·ç«¯ï¼‰ID**Â å’Œ**ç›®å½•ï¼ˆç§Ÿæˆ·ï¼‰ID**ã€‚å°†åœ¨ä»£ç ä¸­éœ€è¦å®ƒä»¬ã€‚

### **2. ä»£ç ï¼šåˆ†è§£**

è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¤„ç†èº«ä»½éªŒè¯çš„ä»£ç çš„å…³é”®éƒ¨åˆ†ã€‚æ­¤ç¤ºä¾‹çš„å®Œæ•´ä»£ç å¯åœ¨Â [mcp-auth-servers GitHub å­˜å‚¨åº“](https://github.com/Azure-Samples/mcp-auth-servers)Â çš„Â [Entra ID - Local - WAM](https://github.com/Azure-Samples/mcp-auth-servers/tree/main/src/entra-id-local-wam)Â æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°ã€‚

**`AuthenticationService.cs`**

æ­¤ç±»è´Ÿè´£å¤„ç†ä¸ Entra ID çš„äº¤äº’ã€‚

- **`CreateAsync`**ï¼šæ­¤æ–¹æ³•ä» MSALï¼ˆMicrosoft èº«ä»½éªŒè¯åº“ï¼‰åˆå§‹åŒ–Â `PublicClientApplication`ã€‚å®ƒä½¿ç”¨çš„åº”ç”¨ç¨‹åºçš„Â `clientId`Â å’ŒÂ `tenantId`Â è¿›è¡Œé…ç½®ã€‚
- **`WithBroker`**ï¼šè¿™å¯ç”¨äº†ä»£ç†ï¼ˆå¦‚ Windows Web å¸æˆ·ç®¡ç†å™¨ï¼‰çš„ä½¿ç”¨ï¼Œä»è€Œæä¾›äº†æ›´å®‰å…¨ã€æ›´æ— ç¼çš„å•ç‚¹ç™»å½•ä½“éªŒã€‚
- **`AcquireTokenAsync`**ï¼šè¿™æ˜¯æ ¸å¿ƒæ–¹æ³•ã€‚å®ƒé¦–å…ˆå°è¯•ä»¥é™é»˜æ–¹å¼è·å–ä»¤ç‰Œï¼ˆè¿™æ„å‘³ç€å¦‚æœç”¨æˆ·å·²ç»æœ‰æœ‰æ•ˆçš„ä¼šè¯ï¼Œåˆ™æ— éœ€å†æ¬¡ç™»å½•ï¼‰ã€‚å¦‚æœæ— æ³•è·å–é™é»˜ä»¤ç‰Œï¼Œå®ƒå°†æç¤ºç”¨æˆ·ä»¥äº¤äº’æ–¹å¼ç™»å½•ã€‚

```csharp
// ä¸ºæ¸…æ™°èµ·è§è¿›è¡Œäº†ç®€åŒ–public static async Task<AuthenticationService> CreateAsync(ILogger<AuthenticationService> logger)
{
    var msalClient = PublicClientApplicationBuilder
        .Create(_clientId)// çš„åº”ç”¨ç¨‹åºï¼ˆå®¢æˆ·ç«¯ï¼‰ID
        .WithAuthority(AadAuthorityAudience.AzureAdMyOrg)
        .WithTenantId(_tenantId)// çš„ç›®å½•ï¼ˆç§Ÿæˆ·ï¼‰ID
        .WithBroker(new BrokerOptions(BrokerOptions.OperatingSystems.Windows))
        .Build();

// ... ç¼“å­˜æ³¨å†Œ ...return new AuthenticationService(logger, msalClient);
}

public async Task<string> AcquireTokenAsync()
{
    try
    {
// é¦–å…ˆå°è¯•é™é»˜èº«ä»½éªŒè¯var accounts = await _msalClient.GetAccountsAsync();
        var account = accounts.FirstOrDefault();

        AuthenticationResult? result = null;

        if (account != null)
        {
            result = await _msalClient.AcquireTokenSilent(_scopes, account).ExecuteAsync();
        }
        else
        {
// å¦‚æœæ²¡æœ‰å¸æˆ·ï¼Œæˆ–è€…é™é»˜å¤±è´¥ï¼Œåˆ™è¿›è¡Œäº¤äº’å¼æ“ä½œ
            result = await _msalClient.AcquireTokenInteractive(_scopes).ExecuteAsync();
        }

        return result.AccessToken;
    }
    catch (Exception ex)
    {
        _logger.LogError(ex, "è·å–ä»¤ç‰Œæ—¶å‘ç”Ÿé”™è¯¯ã€‚");
        throw;// å¯é€‰æ‹©é‡æ–°æŠ›å‡ºå¼‚å¸¸ä»¥è¿›è¡Œæ›´é«˜çº§åˆ«çš„å¤„ç†
    }
}

```

**`Program.cs`**

è¿™æ˜¯è®¾ç½® MCP æœåŠ¡å™¨å¹¶é›†æˆèº«ä»½éªŒè¯æœåŠ¡çš„åœ°æ–¹ã€‚

- **`AddSingleton<AuthenticationService>`**ï¼šè¿™å°†Â `AuthenticationService`Â æ³¨å†Œåˆ°ä¾èµ–æ³¨å…¥å®¹å™¨ä¸­ï¼Œä»¥ä¾¿åº”ç”¨ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†ï¼ˆå¦‚æˆ‘ä»¬çš„å·¥å…·ï¼‰å¯ä»¥ä½¿ç”¨å®ƒã€‚
- **`GetUserDetailsFromGraph`Â å·¥å…·**ï¼šæ­¤å·¥å…·éœ€è¦Â `AuthenticationService`Â çš„å®ä¾‹ã€‚åœ¨æ‰§è¡Œä»»ä½•æ“ä½œä¹‹å‰ï¼Œå®ƒä¼šè°ƒç”¨Â `authService.AcquireTokenAsync()`Â æ¥è·å–æœ‰æ•ˆçš„è®¿é—®ä»¤ç‰Œã€‚å¦‚æœèº«ä»½éªŒè¯æˆåŠŸï¼Œå®ƒå°†ä½¿ç”¨è¯¥ä»¤ç‰Œè°ƒç”¨ Microsoft Graph API å¹¶è·å–ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ã€‚

```csharp
// ä¸ºæ¸…æ™°èµ·è§è¿›è¡Œäº†ç®€åŒ–
[McpServerTool(Name = "GetUserDetailsFromGraph")]
public static async Task<string> GetUserDetailsFromGraph(
    AuthenticationService authService)
{
    try
    {
// è¿™å°†è§¦å‘èº«ä»½éªŒè¯æµç¨‹var accessToken = await authService.AcquireTokenAsync();

// ä½¿ç”¨ä»¤ç‰Œåˆ›å»º GraphServiceClientvar graphClient = new GraphServiceClient(
            new BaseBearerTokenAuthenticationProvider(new TokenProvider(authService)));

        var user = await graphClient.Me.GetAsync();

        return System.Text.Json.JsonSerializer.Serialize(user);
    }
    catch (Exception ex)
    {
        return $"é”™è¯¯ï¼š{ex.Message}";
    }
}

```

### **3. å®ƒä»¬å¦‚ä½•ååŒå·¥ä½œ**

1. å½“ MCP å®¢æˆ·ç«¯å°è¯•ä½¿ç”¨Â `GetUserDetailsFromGraph`Â å·¥å…·æ—¶ï¼Œè¯¥å·¥å…·é¦–å…ˆè°ƒç”¨Â `AcquireTokenAsync`ã€‚
2. `AcquireTokenAsync`Â è§¦å‘ MSAL åº“æ£€æŸ¥æœ‰æ•ˆä»¤ç‰Œã€‚
3. å¦‚æœæœªæ‰¾åˆ°ä»¤ç‰Œï¼ŒMSAL å°†é€šè¿‡ä»£ç†æç¤ºç”¨æˆ·ä½¿ç”¨å…¶ Entra ID å¸æˆ·ç™»å½•ã€‚
4. ç”¨æˆ·ç™»å½•åï¼ŒEntra ID ä¼šé¢å‘ä¸€ä¸ªè®¿é—®ä»¤ç‰Œã€‚
5. è¯¥å·¥å…·æ¥æ”¶ä»¤ç‰Œå¹¶ä½¿ç”¨å®ƒå¯¹ Microsoft Graph API è¿›è¡Œå®‰å…¨è°ƒç”¨ã€‚
6. ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯å°†è¿”å›ç»™ MCP å®¢æˆ·ç«¯ã€‚

æ­¤è¿‡ç¨‹å¯ç¡®ä¿åªæœ‰ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·æ‰èƒ½ä½¿ç”¨è¯¥å·¥å…·ï¼Œä»è€Œæœ‰æ•ˆåœ°ä¿æŠ¤çš„æœ¬åœ° MCP æœåŠ¡å™¨ã€‚

### **åœºæ™¯ 2ï¼šä¿æŠ¤è¿œç¨‹ MCP æœåŠ¡å™¨ï¼ˆä½¿ç”¨æœºå¯†å®¢æˆ·ç«¯ï¼‰**

å½“çš„ MCP æœåŠ¡å™¨åœ¨è¿œç¨‹è®¡ç®—æœºï¼ˆå¦‚äº‘æœåŠ¡å™¨ï¼‰ä¸Šè¿è¡Œå¹¶é€šè¿‡ HTTP Streaming ç­‰åè®®è¿›è¡Œé€šä¿¡æ—¶ï¼Œå®‰å…¨è¦æ±‚ä¼šæœ‰æ‰€ä¸åŒã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåº”è¯¥ä½¿ç”¨**æœºå¯†å®¢æˆ·ç«¯**å’Œ**æˆæƒç æµ**ã€‚è¿™æ˜¯ä¸€ç§æ›´å®‰å…¨çš„æ–¹æ³•ï¼Œå› ä¸ºåº”ç”¨ç¨‹åºçš„æœºå¯†æ°¸è¿œä¸ä¼šæš´éœ²ç»™æµè§ˆå™¨ã€‚

æ­¤ç¤ºä¾‹ä½¿ç”¨åŸºäº TypeScript çš„ MCP æœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨ä½¿ç”¨ Express.js å¤„ç† HTTP è¯·æ±‚ã€‚

### **1. åœ¨ Entra ID ä¸­è®¾ç½®åº”ç”¨ç¨‹åº**

åœ¨ Entra ID ä¸­çš„è®¾ç½®ä¸å…¬å…±å®¢æˆ·ç«¯ç±»ä¼¼ï¼Œä½†æœ‰ä¸€ä¸ªå…³é”®åŒºåˆ«ï¼šéœ€è¦åˆ›å»ºä¸€ä¸ª**å®¢æˆ·ç«¯å¯†ç **ã€‚

1. å¯¼èˆªåˆ°Â [**Microsoft Entra é—¨æˆ·**](https://entra.microsoft.com/)ã€‚
2. åœ¨çš„åº”ç”¨æ³¨å†Œä¸­ï¼Œè½¬åˆ°**è¯ä¹¦å’Œå¯†ç **é€‰é¡¹å¡ã€‚
3. å•å‡»**æ–°å»ºå®¢æˆ·ç«¯å¯†ç **ï¼Œä¸ºå…¶æŒ‡å®šæè¿°ï¼Œç„¶åå•å‡»**æ·»åŠ **ã€‚
4. **é‡è¦æç¤ºï¼š**Â ç«‹å³å¤åˆ¶å¯†ç å€¼ã€‚å°†æ— æ³•å†æ¬¡çœ‹åˆ°å®ƒã€‚
5. è¿˜éœ€è¦é…ç½®ä¸€ä¸ª**é‡å®šå‘ URI**ã€‚è½¬åˆ°**èº«ä»½éªŒè¯**é€‰é¡¹å¡ï¼Œå•å‡»**æ·»åŠ å¹³å°**ï¼Œé€‰æ‹©Â **Web**ï¼Œç„¶åè¾“å…¥çš„åº”ç”¨ç¨‹åºçš„é‡å®šå‘ URIï¼ˆä¾‹å¦‚ï¼Œ`http://localhost:3001/auth/callback`ï¼‰ã€‚

> âš ï¸ é‡è¦å®‰å…¨è¯´æ˜ï¼šÂ å¯¹äºç”Ÿäº§åº”ç”¨ç¨‹åºï¼ŒMicrosoft å¼ºçƒˆå»ºè®®ä½¿ç”¨æ— å¯†ç èº«ä»½éªŒè¯æ–¹æ³•ï¼Œä¾‹å¦‚æ‰˜ç®¡æ ‡è¯†æˆ–å·¥ä½œè´Ÿè½½æ ‡è¯†è”åˆï¼Œè€Œä¸æ˜¯å®¢æˆ·ç«¯å¯†ç ã€‚å®¢æˆ·ç«¯å¯†ç ä¼šå¸¦æ¥å®‰å…¨é£é™©ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½ä¼šè¢«æš´éœ²æˆ–æ³„éœ²ã€‚æ‰˜ç®¡æ ‡è¯†é€šè¿‡æ¶ˆé™¤åœ¨ä»£ç æˆ–é…ç½®ä¸­å­˜å‚¨å‡­æ®çš„éœ€è¦ï¼Œæä¾›äº†ä¸€ç§æ›´å®‰å…¨çš„æ–¹æ³•ã€‚
> 
> 
> æœ‰å…³æ‰˜ç®¡æ ‡è¯†ä»¥åŠå¦‚ä½•å®ç°å®ƒä»¬çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…Â [Azure èµ„æºçš„æ‰˜ç®¡æ ‡è¯†æ¦‚è¿°](https://learn.microsoft.com/entra/identity/managed-identities-azure-resources/overview)ã€‚
> 

### **2. ä»£ç ï¼šåˆ†è§£**

æ­¤ç¤ºä¾‹ä½¿ç”¨åŸºäºä¼šè¯çš„æ–¹æ³•ã€‚å½“ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯æ—¶ï¼ŒæœåŠ¡å™¨ä¼šå°†è®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œå­˜å‚¨åœ¨ä¼šè¯ä¸­ï¼Œå¹¶å‘ç”¨æˆ·æä¾›ä¸€ä¸ªä¼šè¯ä»¤ç‰Œã€‚ç„¶åï¼Œæ­¤ä¼šè¯ä»¤ç‰Œå°†ç”¨äºåç»­è¯·æ±‚ã€‚æ­¤ç¤ºä¾‹çš„å®Œæ•´ä»£ç å¯åœ¨Â [mcp-auth-servers GitHub å­˜å‚¨åº“](https://github.com/Azure-Samples/mcp-auth-servers)Â çš„Â [Entra ID - Confidential client](https://github.com/Azure-Samples/mcp-auth-servers/tree/main/src/entra-id-cca-session)Â æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°ã€‚

**`Server.ts`**

æ­¤æ–‡ä»¶è®¾ç½® Express æœåŠ¡å™¨å’Œ MCP ä¼ è¾“å±‚ã€‚

- **`requireBearerAuth`**ï¼šè¿™æ˜¯ä¸€ä¸ªä¸­é—´ä»¶ï¼Œç”¨äºä¿æŠ¤Â `/sse`Â å’ŒÂ `/message`Â ç«¯ç‚¹ã€‚å®ƒä¼šæ£€æŸ¥è¯·æ±‚çš„Â `Authorization`Â æ ‡å¤´ä¸­æ˜¯å¦å­˜åœ¨æœ‰æ•ˆçš„æŒæœ‰è€…ä»¤ç‰Œã€‚
- **`EntraIdServerAuthProvider`**ï¼šè¿™æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰ç±»ï¼Œå®ç°äº†Â `McpServerAuthorizationProvider`Â æ¥å£ã€‚å®ƒè´Ÿè´£å¤„ç† OAuth 2.0 æµç¨‹ã€‚
- **`/auth/callback`**ï¼šæ­¤ç«¯ç‚¹å¤„ç†ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯åä» Entra ID çš„é‡å®šå‘ã€‚å®ƒå°†æˆæƒç äº¤æ¢ä¸ºè®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œã€‚

```tsx
// ä¸ºæ¸…æ™°èµ·è§è¿›è¡Œäº†ç®€åŒ–const app = express();
const { server } = createServer();
const provider = new EntraIdServerAuthProvider();

// ä¿æŠ¤ SSE ç«¯ç‚¹
app.get("/sse", requireBearerAuth({
  provider,
  requiredScopes: ["User.Read"]
}), async (req, res) => {
// ... è¿æ¥åˆ°ä¼ è¾“ ...
});

// ä¿æŠ¤æ¶ˆæ¯ç«¯ç‚¹
app.post("/message", requireBearerAuth({
  provider,
  requiredScopes: ["User.Read"]
}), async (req, res) => {
// ... å¤„ç†æ¶ˆæ¯ ...
});

// å¤„ç† OAuth 2.0 å›è°ƒ
app.get("/auth/callback", (req, res) => {
  provider.handleCallback(req.query.code, req.query.state)
    .then(result => {
// ... å¤„ç†æˆåŠŸæˆ–å¤±è´¥ ...
    });
});

```

**`Tools.ts`**

æ­¤æ–‡ä»¶å®šä¹‰äº† MCP æœåŠ¡å™¨æä¾›çš„å·¥å…·ã€‚`getUserDetails`Â å·¥å…·ä¸å‰ä¸€ä¸ªç¤ºä¾‹ä¸­çš„å·¥å…·ç±»ä¼¼ï¼Œä½†å®ƒä»ä¼šè¯ä¸­è·å–è®¿é—®ä»¤ç‰Œã€‚

```tsx
// ä¸ºæ¸…æ™°èµ·è§è¿›è¡Œäº†ç®€åŒ–
server.setRequestHandler(CallToolRequestSchema, async (request) => {
  const { name } = request.params;
  const context = request.params?.context as { token?: string } | undefined;
  const sessionToken = context?.token;

  if (name === ToolName.GET_USER_DETAILS) {
    if (!sessionToken) {
      throw new AuthenticationError("èº«ä»½éªŒè¯ä»¤ç‰Œä¸¢å¤±æˆ–æ— æ•ˆã€‚è¯·ç¡®ä¿åœ¨è¯·æ±‚ä¸Šä¸‹æ–‡ä¸­æä¾›äº†ä»¤ç‰Œã€‚");
    }

// ä»ä¼šè¯å­˜å‚¨ä¸­è·å– Entra ID ä»¤ç‰Œconst tokenData = tokenStore.getToken(sessionToken);
    const entraIdToken = tokenData.accessToken;

    const graphClient = Client.init({
      authProvider: (done) => {
        done(null, entraIdToken);
      }
    });

    const user = await graphClient.api('/me').get();

// ... è¿”å›ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ ...
  }
});

```

**`auth/EntraIdServerAuthProvider.ts`**

æ­¤ç±»å¤„ç†ä»¥ä¸‹é€»è¾‘ï¼š

- å°†ç”¨æˆ·é‡å®šå‘åˆ° Entra ID ç™»å½•é¡µé¢ã€‚
- å°†æˆæƒç äº¤æ¢ä¸ºè®¿é—®ä»¤ç‰Œã€‚
- å°†ä»¤ç‰Œå­˜å‚¨åœ¨Â `tokenStore`Â ä¸­ã€‚
- åœ¨è®¿é—®ä»¤ç‰Œè¿‡æœŸæ—¶åˆ·æ–°å®ƒã€‚

### **3. å®ƒä»¬å¦‚ä½•ååŒå·¥ä½œ**

1. å½“ç”¨æˆ·é¦–æ¬¡å°è¯•è¿æ¥åˆ° MCP æœåŠ¡å™¨æ—¶ï¼Œ`requireBearerAuth`Â ä¸­é—´ä»¶å°†çœ‹åˆ°ä»–ä»¬æ²¡æœ‰æœ‰æ•ˆçš„ä¼šè¯ï¼Œå¹¶å°†ä»–ä»¬é‡å®šå‘åˆ° Entra ID ç™»å½•é¡µé¢ã€‚
2. ç”¨æˆ·ä½¿ç”¨å…¶ Entra ID å¸æˆ·ç™»å½•ã€‚
3. Entra ID å°†ç”¨æˆ·é‡å®šå‘å›å¸¦æœ‰æˆæƒç çš„Â `/auth/callback`Â ç«¯ç‚¹ã€‚
4. æœåŠ¡å™¨å°†ä»£ç äº¤æ¢ä¸ºè®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œï¼Œå­˜å‚¨å®ƒä»¬ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªå‘é€ç»™å®¢æˆ·ç«¯çš„ä¼šè¯ä»¤ç‰Œã€‚
5. å®¢æˆ·ç«¯ç°åœ¨å¯ä»¥åœ¨æ‰€æœ‰æœªæ¥å¯¹ MCP æœåŠ¡å™¨çš„è¯·æ±‚çš„Â `Authorization`Â æ ‡å¤´ä¸­ä½¿ç”¨æ­¤ä¼šè¯ä»¤ç‰Œã€‚
6. å½“è°ƒç”¨Â `getUserDetails`Â å·¥å…·æ—¶ï¼Œå®ƒä½¿ç”¨ä¼šè¯ä»¤ç‰ŒæŸ¥æ‰¾ Entra ID è®¿é—®ä»¤ç‰Œï¼Œç„¶åä½¿ç”¨è¯¥ä»¤ç‰Œè°ƒç”¨ Microsoft Graph APIã€‚

æ­¤æµç¨‹æ¯”å…¬å…±å®¢æˆ·ç«¯æµç¨‹æ›´å¤æ‚ï¼Œä½†æ˜¯é¢å‘äº’è”ç½‘çš„ç«¯ç‚¹æ‰€å¿…éœ€çš„ã€‚ç”±äºè¿œç¨‹ MCP æœåŠ¡å™¨å¯é€šè¿‡å…¬å…±äº’è”ç½‘è®¿é—®ï¼Œå› æ­¤å®ƒä»¬éœ€è¦æ›´å¼ºçš„å®‰å…¨æªæ–½æ¥é˜²æ­¢æœªç»æˆæƒçš„è®¿é—®å’Œæ½œåœ¨çš„æ”»å‡»ã€‚

### **å®‰å…¨æœ€ä½³å®è·µ**

- **å§‹ç»ˆä½¿ç”¨ HTTPS**ï¼šåŠ å¯†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ï¼Œä»¥é˜²æ­¢ä»¤ç‰Œè¢«æ‹¦æˆªã€‚
- **å®æ–½åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (RBAC)**ï¼šä¸è¦åªæ£€æŸ¥ç”¨æˆ·*æ˜¯å¦*ç»è¿‡èº«ä»½éªŒè¯ï¼›è¿˜è¦æ£€æŸ¥ä»–ä»¬æœ‰æƒ*åšä»€ä¹ˆ*ã€‚å¯ä»¥åœ¨ Entra ID ä¸­å®šä¹‰è§’è‰²ï¼Œå¹¶åœ¨çš„ MCP æœåŠ¡å™¨ä¸­æ£€æŸ¥å®ƒä»¬ã€‚
- **ç›‘æ§å’Œå®¡è®¡**ï¼šè®°å½•æ‰€æœ‰èº«ä»½éªŒè¯äº‹ä»¶ï¼Œä»¥ä¾¿å¯ä»¥æ£€æµ‹å¹¶å“åº”å¯ç–‘æ´»åŠ¨ã€‚
- **å¤„ç†é€Ÿç‡é™åˆ¶å’ŒèŠ‚æµ**ï¼šMicrosoft Graph å’Œå…¶ä»– API ä¼šå®æ–½é€Ÿç‡é™åˆ¶ä»¥é˜²æ­¢æ»¥ç”¨ã€‚åœ¨çš„ MCP æœåŠ¡å™¨ä¸­å®æ–½æŒ‡æ•°é€€é¿å’Œé‡è¯•é€»è¾‘ï¼Œä»¥ä¼˜é›…åœ°å¤„ç† HTTP 429ï¼ˆè¯·æ±‚è¿‡å¤šï¼‰å“åº”ã€‚è€ƒè™‘ç¼“å­˜é¢‘ç¹è®¿é—®çš„æ•°æ®ä»¥å‡å°‘ API è°ƒç”¨ã€‚
- **å®‰å…¨ä»¤ç‰Œå­˜å‚¨**ï¼šå®‰å…¨åœ°å­˜å‚¨è®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œã€‚å¯¹äºæœ¬åœ°åº”ç”¨ç¨‹åºï¼Œè¯·ä½¿ç”¨ç³»ç»Ÿçš„å®‰å…¨å­˜å‚¨æœºåˆ¶ã€‚å¯¹äºæœåŠ¡å™¨åº”ç”¨ç¨‹åºï¼Œè¯·è€ƒè™‘ä½¿ç”¨åŠ å¯†å­˜å‚¨æˆ– Azure Key Vault ç­‰å®‰å…¨å¯†é’¥ç®¡ç†æœåŠ¡ã€‚
- **ä»¤ç‰Œè¿‡æœŸå¤„ç†**ï¼šè®¿é—®ä»¤ç‰Œçš„ç”Ÿå‘½å‘¨æœŸæœ‰é™ã€‚ä½¿ç”¨åˆ·æ–°ä»¤ç‰Œå®æ–½è‡ªåŠ¨ä»¤ç‰Œåˆ·æ–°ï¼Œä»¥ç»´æŒæ— ç¼çš„ç”¨æˆ·ä½“éªŒï¼Œè€Œæ— éœ€é‡æ–°è¿›è¡Œèº«ä»½éªŒè¯ã€‚
- **è€ƒè™‘ä½¿ç”¨ Azure API ç®¡ç†**ï¼šè™½ç„¶ç›´æ¥åœ¨çš„ MCP æœåŠ¡å™¨ä¸­å®æ–½å®‰å…¨æ€§å¯ä»¥ä¸ºæä¾›ç²¾ç»†çš„æ§åˆ¶ï¼Œä½†åƒ Azure API ç®¡ç†è¿™æ ·çš„ API ç½‘å…³å¯ä»¥è‡ªåŠ¨å¤„ç†è®¸å¤šè¿™äº›å®‰å…¨é—®é¢˜ï¼ŒåŒ…æ‹¬èº«ä»½éªŒè¯ã€æˆæƒã€é€Ÿç‡é™åˆ¶å’Œç›‘æ§ã€‚å®ƒä»¬æä¾›äº†ä¸€ä¸ªä½äºçš„å®¢æˆ·ç«¯å’Œ MCP æœåŠ¡å™¨ä¹‹é—´çš„é›†ä¸­å¼å®‰å…¨å±‚ã€‚æœ‰å…³å°† API ç½‘å…³ä¸ MCP ç»“åˆä½¿ç”¨çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…æˆ‘ä»¬çš„Â [Azure API ç®¡ç†ï¼šçš„ MCP æœåŠ¡å™¨çš„èº«ä»½éªŒè¯ç½‘å…³](https://techcommunity.microsoft.com/blog/integrationsonazureblog/azure-api-management-your-auth-gateway-for-mcp-servers/4402690)ã€‚

## Azure AI Foundry ä»£ç†é›†æˆ

### **ä»€ä¹ˆæ˜¯æ¨¡å‹ä¸Šä¸‹æ–‡åè®® (MCP)ï¼Ÿ**

æ¨¡å‹ä¸Šä¸‹æ–‡åè®®æ˜¯ AI åº”ç”¨ç¨‹åºè¿æ¥åˆ°å¤–éƒ¨æ•°æ®æºå’Œå·¥å…·çš„æ ‡å‡†åŒ–æ–¹å¼ã€‚ä¸»è¦ä¼˜åŠ¿åŒ…æ‹¬ï¼š

- **æ ‡å‡†åŒ–é›†æˆ**ï¼šè·¨ä¸åŒå·¥å…·å’ŒæœåŠ¡çš„ä¸€è‡´æ¥å£
- **å®‰å…¨æ€§**ï¼šå®‰å…¨èº«ä»½éªŒè¯å’Œæˆæƒæœºåˆ¶
- **çµæ´»æ€§**ï¼šæ”¯æŒå„ç§æ•°æ®æºã€API å’Œè‡ªå®šä¹‰å·¥å…·
- **å¯æ‰©å±•æ€§**ï¼šæ˜“äºæ·»åŠ æ–°åŠŸèƒ½å’Œé›†æˆ

### **ä½¿ç”¨ Azure AI Foundry è®¾ç½® MCP**

### **1. ç¯å¢ƒé…ç½®**

é¦–å…ˆï¼Œè®¾ç½®çš„ç¯å¢ƒå˜é‡å’Œä¾èµ–é¡¹ï¼š

```python
import os
import time
import json
from azure.ai.agents.models import MessageTextContent, ListSortOrder
from azure.ai.projects import AIProjectClient
from azure.identity import DefaultAzureCredential

### 1. åˆå§‹åŒ– AI é¡¹ç›®å®¢æˆ·ç«¯

```python
project_client = AIProjectClient(
    endpoint="https://your-project-endpoint.services.ai.azure.com/api/projects/your-project",
    credential=DefaultAzureCredential(),
)

```

### **2. åˆ›å»ºå…·æœ‰ MCP å·¥å…·çš„ä»£ç†**

é…ç½®å…·æœ‰ MCP æœåŠ¡å™¨é›†æˆçš„ä»£ç†ï¼š

```python
with project_client:
    agent = project_client.agents.create_agent(
        model="gpt-4.1-nano",
        name="mcp_agent",
        instructions="æ˜¯ä¸€ä¸ªä¹äºåŠ©äººçš„åŠ©æ‰‹ã€‚ä½¿ç”¨æä¾›çš„å·¥å…·æ¥å›ç­”é—®é¢˜ã€‚è¯·åŠ¡å¿…å¼•ç”¨çš„æ¥æºã€‚",
        tools=[
            {
                "type": "mcp",
                "server_label": "microsoft_docs",
                "server_url": "https://learn.microsoft.com/api/mcp",
                "require_approval": "never"
            }
        ],
        tool_resources=None
    )
    print(f"å·²åˆ›å»ºä»£ç†ï¼Œä»£ç† IDï¼š{agent.id}")

```

### **MCP å·¥å…·é…ç½®é€‰é¡¹**

åœ¨ä¸ºçš„ä»£ç†é…ç½® MCP å·¥å…·æ—¶ï¼Œå¯ä»¥æŒ‡å®šå‡ ä¸ªé‡è¦å‚æ•°ï¼š

### **é…ç½®**

```python
mcp_tool = {
    "type": "mcp",
    "server_label": "unique_server_name",# MCP æœåŠ¡å™¨çš„æ ‡è¯†ç¬¦"server_url": "https://api.example.com/mcp",# MCP æœåŠ¡å™¨ç«¯ç‚¹"require_approval": "never"# æ‰¹å‡†ç­–ç•¥ï¼šç›®å‰ä»…æ”¯æŒ "never"
}

```

### **å®Œæ•´ç¤ºä¾‹ï¼šä½¿ç”¨ Microsoft Learn MCP æœåŠ¡å™¨**

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹ï¼Œæ¼”ç¤ºäº†å¦‚ä½•åˆ›å»ºå…·æœ‰ MCP é›†æˆçš„ä»£ç†å¹¶å¤„ç†å¯¹è¯ï¼š

```python
import time
import json
import os
from azure.ai.agents.models import MessageTextContent, ListSortOrder
from azure.ai.projects import AIProjectClient
from azure.identity import DefaultAzureCredential

def create_mcp_agent_example():

    project_client = AIProjectClient(
        endpoint="https://your-endpoint.services.ai.azure.com/api/projects/your-project",
        credential=DefaultAzureCredential(),
    )

    with project_client:
# åˆ›å»ºå…·æœ‰ MCP å·¥å…·çš„ä»£ç†
        agent = project_client.agents.create_agent(
            model="gpt-4.1-nano",
            name="documentation_assistant",
            instructions="æ˜¯ä¸€ä¸ªä¸“é—¨ç ”ç©¶ Microsoft æ–‡æ¡£çš„ä¹äºåŠ©äººçš„åŠ©æ‰‹ã€‚ä½¿ç”¨ Microsoft Learn MCP æœåŠ¡å™¨æœç´¢å‡†ç¡®ã€æœ€æ–°çš„ä¿¡æ¯ã€‚å§‹ç»ˆå¼•ç”¨çš„æ¥æºã€‚",
            tools=[
                {
                    "type": "mcp",
                    "server_label": "mslearn",
                    "server_url": "https://learn.microsoft.com/api/mcp",
                    "require_approval": "never"
                }
            ],
            tool_resources=None
        )
        print(f"å·²åˆ›å»ºä»£ç†ï¼Œä»£ç† IDï¼š{agent.id}")

# åˆ›å»ºå¯¹è¯çº¿ç¨‹
        thread = project_client.agents.threads.create()
        print(f"å·²åˆ›å»ºçº¿ç¨‹ï¼Œçº¿ç¨‹ IDï¼š{thread.id}")

# å‘é€æ¶ˆæ¯
        message = project_client.agents.messages.create(
            thread_id=thread.id,
            role="user",
            content="ä»€ä¹ˆæ˜¯ .NET MAUIï¼Ÿå®ƒä¸ Xamarin.Forms ç›¸æ¯”å¦‚ä½•ï¼Ÿ",
        )
        print(f"å·²åˆ›å»ºæ¶ˆæ¯ï¼Œæ¶ˆæ¯ IDï¼š{message.id}")

# è¿è¡Œä»£ç†
        run = project_client.agents.runs.create(thread_id=thread.id, agent_id=agent.id)

# è½®è¯¢å®Œæˆæƒ…å†µwhile run.status in ["queued", "in_progress", "requires_action"]:
            time.sleep(1)
            run = project_client.agents.runs.get(thread_id=thread.id, run_id=run.id)
            print(f"è¿è¡ŒçŠ¶æ€ï¼š{run.status}")

# æ£€æŸ¥è¿è¡Œæ­¥éª¤å’Œå·¥å…·è°ƒç”¨
        run_steps = project_client.agents.run_steps.list(thread_id=thread.id, run_id=run.id)
        for step in run_steps:
            print(f"è¿è¡Œæ­¥éª¤ï¼š{step.id}ï¼ŒçŠ¶æ€ï¼š{step.status}ï¼Œç±»å‹ï¼š{step.type}")
            if step.type == "tool_calls":
                print("å·¥å…·è°ƒç”¨è¯¦ç»†ä¿¡æ¯ï¼š")
                for tool_call in step.step_details.tool_calls:
                    print(json.dumps(tool_call.as_dict(), indent=2))

# æ˜¾ç¤ºå¯¹è¯
        messages = project_client.agents.messages.list(thread_id=thread.id, order=ListSortOrder.ASCENDING)
        for data_point in messages:
            last_message_content = data_point.content[-1]
            if isinstance(last_message_content, MessageTextContent):
                print(f"{data_point.role}: {last_message_content.text.value}")

        return agent.id, thread.id

if __name__ == "__main__":
    create_mcp_agent_example()

```

### **è§£å†³å¸¸è§é—®é¢˜**

### **1. è¿æ¥é—®é¢˜**

- éªŒè¯ MCP æœåŠ¡å™¨ URL æ˜¯å¦å¯è®¿é—®
- æ£€æŸ¥èº«ä»½éªŒè¯å‡­æ®
- ç¡®ä¿ç½‘ç»œè¿æ¥

### **2. å·¥å…·è°ƒç”¨å¤±è´¥**

- æŸ¥çœ‹å·¥å…·å‚æ•°å’Œæ ¼å¼
- æ£€æŸ¥æœåŠ¡å™¨ç‰¹å®šè¦æ±‚
- å®ç°æ­£ç¡®çš„é”™è¯¯å¤„ç†

### **3. æ€§èƒ½é—®é¢˜**

- ä¼˜åŒ–å·¥å…·è°ƒç”¨é¢‘ç‡
- åœ¨é€‚å½“çš„åœ°æ–¹å®ç°ç¼“å­˜
- ç›‘æ§æœåŠ¡å™¨å“åº”æ—¶é—´

# **06-ç¤¾åŒºè´¡çŒ®**

## **MCP ç¤¾åŒºç”Ÿæ€ç³»ç»Ÿ**

MCP ç”Ÿæ€ç³»ç»Ÿç”±å…±åŒæ¨è¿›åè®®å‘å±•çš„å„ç§ç»„ä»¶å’Œå‚ä¸è€…ç»„æˆã€‚

### **å…³é”®ç¤¾åŒºç»„ä»¶**

1. **æ ¸å¿ƒåè®®ç»´æŠ¤è€…**ï¼šç»´æŠ¤æ ¸å¿ƒ MCP è§„èŒƒå’Œå‚è€ƒå®ç°çš„ Microsoft å’Œå…¶ä»–ç»„ç»‡
2. **å·¥å…·å¼€å‘è€…**ï¼šåˆ›å»º MCP å·¥å…·çš„ä¸ªäººå’Œå›¢é˜Ÿ
3. **é›†æˆæä¾›å•†**ï¼šå°† MCP é›†æˆåˆ°å…¶äº§å“å’ŒæœåŠ¡ä¸­çš„å…¬å¸
4. **æœ€ç»ˆç”¨æˆ·**ï¼šåœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ MCP çš„å¼€å‘è€…å’Œç»„ç»‡
5. **è´¡çŒ®è€…**ï¼šè´¡çŒ®ä»£ç ã€æ–‡æ¡£æˆ–å…¶ä»–èµ„æºçš„ç¤¾åŒºæˆå‘˜

### **ç¤¾åŒºèµ„æº**

### **å®˜æ–¹æ¸ é“**

- [MCP GitHub ä»“åº“](https://github.com/modelcontextprotocol)
- [MCP æ–‡æ¡£](https://modelcontextprotocol.io/)
- [MCP è§„èŒƒ](https://spec.modelcontextprotocol.io/)
- [GitHub è®¨è®ºåŒº](https://github.com/orgs/modelcontextprotocol/discussions)

### **ç¤¾åŒºé©±åŠ¨èµ„æº**

- ç‰¹å®šè¯­è¨€ SDK å®ç°
- æœåŠ¡å™¨å®ç°å’Œå·¥å…·åº“
- åšå®¢æ–‡ç« å’Œæ•™ç¨‹
- ç¤¾åŒºè®ºå›å’Œç¤¾äº¤åª’ä½“è®¨è®º

## **ä¸º MCP åšè´¡çŒ®**

### **è´¡çŒ®ç±»å‹**

MCP ç”Ÿæ€ç³»ç»Ÿæ¬¢è¿å„ç§ç±»å‹çš„è´¡çŒ®ï¼š

1. **ä»£ç è´¡çŒ®**ï¼š
    - æ ¸å¿ƒåè®®å¢å¼º
    - é”™è¯¯ä¿®å¤
    - å·¥å…·å®ç°
    - ä¸åŒè¯­è¨€çš„å®¢æˆ·ç«¯/æœåŠ¡å™¨åº“
2. **æ–‡æ¡£**ï¼š
    - æ”¹è¿›ç°æœ‰æ–‡æ¡£
    - åˆ›å»ºæ•™ç¨‹å’ŒæŒ‡å—
    - ç¿»è¯‘æ–‡æ¡£
    - åˆ›å»ºç¤ºä¾‹å’Œç¤ºä¾‹åº”ç”¨ç¨‹åº
3. **ç¤¾åŒºæ”¯æŒ**ï¼š
    - åœ¨è®ºå›ä¸Šå›ç­”é—®é¢˜
    - æµ‹è¯•å’ŒæŠ¥å‘Šé—®é¢˜
    - ç»„ç»‡ç¤¾åŒºæ´»åŠ¨
    - æŒ‡å¯¼æ–°è´¡çŒ®è€…

### **è´¡çŒ®æµç¨‹ï¼šæ ¸å¿ƒåè®®**

è¦ä¸ºæ ¸å¿ƒ MCP åè®®æˆ–å®˜æ–¹å®ç°åšè´¡çŒ®ï¼š

### **Python ç¤ºä¾‹ï¼šä¸ºæ ‡å‡†åº“è´¡çŒ®æ–°å·¥å…·**

- python
    
    ```python
    # ç¤ºä¾‹è´¡çŒ®ï¼šç”¨äº MCP æ ‡å‡†åº“çš„ CSV æ•°æ®å¤„ç†å·¥å…·
    from mcp_tools import Tool, ToolRequest, ToolResponse, ToolExecutionException
    import pandas as pd
    import io
    import json
    from typing import Dict, Any, List, Optional
    
    class CsvProcessingTool(Tool):
        """
        ç”¨äºå¤„ç†å’Œè§£æ CSV æ•°æ®çš„å·¥å…·ã€‚
    
        æ­¤å·¥å…·å…è®¸æ¨¡å‹ä» CSV æ–‡ä»¶ä¸­æå–ä¿¡æ¯ï¼Œ
        è¿è¡ŒåŸºæœ¬åˆ†æï¼Œå¹¶åœ¨ä¸åŒæ ¼å¼ä¹‹é—´è½¬æ¢æ•°æ®ã€‚
        """
    
        def get_name(self):
            return "csvProcessor"
    
        def get_description(self):
            return "å¤„ç†å’Œè§£æ CSV æ•°æ®"
    
        def get_schema(self):
            return {
                "type": "object",
                "properties": {
                    "csvData": {
                        "type": "string",
                        "description": "ä½œä¸ºå­—ç¬¦ä¸²çš„ CSV æ•°æ®"
                    },
                    "csvUrl": {
                        "type": "string",
                        "description": "CSV æ–‡ä»¶çš„ URLï¼ˆcsvData çš„æ›¿ä»£æ–¹æ¡ˆï¼‰"
                    },
                    "operation": {
                        "type": "string",
                        "enum": ["summary", "filter", "transform", "convert"],
                        "description": "å¯¹ CSV æ•°æ®æ‰§è¡Œçš„æ“ä½œ"
                    },
                    "filterColumn": {
                        "type": "string",
                        "description": "è¦è¿‡æ»¤çš„åˆ—ï¼ˆç”¨äºè¿‡æ»¤æ“ä½œï¼‰"
                    },
                    "filterValue": {
                        "type": "string",
                        "description": "è¦è¿‡æ»¤çš„å€¼ï¼ˆç”¨äºè¿‡æ»¤æ“ä½œï¼‰"
                    },
                    "outputFormat": {
                        "type": "string",
                        "enum": ["json", "csv", "markdown"],
                        "default": "json",
                        "description": "å¤„ç†åæ•°æ®çš„è¾“å‡ºæ ¼å¼"
                    }
                },
                "oneOf": [
                    {"required": ["csvData", "operation"]},
                    {"required": ["csvUrl", "operation"]}
                ]
            }
    
        async def execute_async(self, request: ToolRequest) -> ToolResponse:
            try:
    # æå–å‚æ•°
                operation = request.parameters.get("operation")
                output_format = request.parameters.get("outputFormat", "json")
    
    # ä»ç›´æ¥æ•°æ®æˆ– URL è·å– CSV æ•°æ®
                df = await self._get_dataframe(request)
    
    # æ ¹æ®è¯·æ±‚çš„æ“ä½œè¿›è¡Œå¤„ç†
                result = {}
    
                if operation == "summary":
                    result = self._generate_summary(df)
                elif operation == "filter":
                    column = request.parameters.get("filterColumn")
                    value = request.parameters.get("filterValue")
                    if not column:
                        raise ToolExecutionException("è¿‡æ»¤æ“ä½œéœ€è¦ filterColumn")
                    result = self._filter_data(df, column, value)
                elif operation == "transform":
                    result = self._transform_data(df, request.parameters)
                elif operation == "convert":
                    result = self._convert_format(df, output_format)
                else:
                    raise ToolExecutionException(f"æœªçŸ¥æ“ä½œ: {operation}")
    
                return ToolResponse(result=result)
    
            except Exception as e:
                raise ToolExecutionException(f"CSV å¤„ç†å¤±è´¥: {str(e)}")
    
        async def _get_dataframe(self, request: ToolRequest) -> pd.DataFrame:
            """ä» CSV æ•°æ®æˆ– URL è·å– pandas DataFrame"""
            if "csvData" in request.parameters:
                csv_data = request.parameters.get("csvData")
                return pd.read_csv(io.StringIO(csv_data))
            elif "csvUrl" in request.parameters:
                csv_url = request.parameters.get("csvUrl")
                return pd.read_csv(csv_url)
            else:
                raise ToolExecutionException("å¿…é¡»æä¾› csvData æˆ– csvUrl")
    
        def _generate_summary(self, df: pd.DataFrame) -> Dict[str, Any]:
            """ç”Ÿæˆ CSV æ•°æ®çš„æ‘˜è¦"""
            return {
                "columns": df.columns.tolist(),
                "rowCount": len(df),
                "columnCount": len(df.columns),
                "numericColumns": df.select_dtypes(include=['number']).columns.tolist(),
                "categoricalColumns": df.select_dtypes(include=['object']).columns.tolist(),
                "sampleRows": json.loads(df.head(5).to_json(orient="records")),
                "statistics": json.loads(df.describe().to_json())
            }
    
        def _filter_data(self, df: pd.DataFrame, column: str, value: str) -> Dict[str, Any]:
            """æŒ‰åˆ—å€¼è¿‡æ»¤ DataFrame"""
            if column not in df.columns:
                raise ToolExecutionException(f"æœªæ‰¾åˆ°åˆ— '{column}'")
    
            filtered_df = df[df[column].astype(str).str.contains(value)]
    
            return {
                "originalRowCount": len(df),
                "filteredRowCount": len(filtered_df),
                "data": json.loads(filtered_df.to_json(orient="records"))
            }
    
        def _transform_data(self, df: pd.DataFrame, params: Dict[str, Any]) -> Dict[str, Any]:
            """æ ¹æ®å‚æ•°è½¬æ¢æ•°æ®"""
    # å®ç°å°†åŒ…æ‹¬å„ç§è½¬æ¢return {
                "status": "success",
                "message": "å·²åº”ç”¨è½¬æ¢"
            }
    
        def _convert_format(self, df: pd.DataFrame, format: str) -> Dict[str, Any]:
            """å°† DataFrame è½¬æ¢ä¸ºä¸åŒæ ¼å¼"""
            if format == "json":
                return {
                    "data": json.loads(df.to_json(orient="records")),
                    "format": "json"
                }
            elif format == "csv":
                return {
                    "data": df.to_csv(index=False),
                    "format": "csv"
                }
            elif format == "markdown":
                return {
                    "data": df.to_markdown(),
                    "format": "markdown"
                }
            else:
                raise ToolExecutionException(f"ä¸æ”¯æŒçš„è¾“å‡ºæ ¼å¼: {format}")
    
    ```
    

### **è´¡çŒ®æŒ‡å—**

è¦æˆåŠŸä¸º MCP é¡¹ç›®åšå‡ºè´¡çŒ®ï¼š

1. **ä»å°å¤„ç€æ‰‹**ï¼šä»æ–‡æ¡£ã€é”™è¯¯ä¿®å¤æˆ–å°æ”¹è¿›å¼€å§‹
2. **éµå¾ªé£æ ¼æŒ‡å—**ï¼šéµå®ˆé¡¹ç›®çš„ç¼–ç é£æ ¼å’Œçº¦å®š
3. **ç¼–å†™æµ‹è¯•**ï¼šä¸ºä»£ç è´¡çŒ®åŒ…å«å•å…ƒæµ‹è¯•
4. **è®°å½•å·¥ä½œ**ï¼šä¸ºæ–°åŠŸèƒ½æˆ–æ›´æ”¹æ·»åŠ æ¸…æ™°çš„æ–‡æ¡£
5. **æäº¤æœ‰é’ˆå¯¹æ€§çš„ PR**ï¼šä¿æŒæ‹‰å–è¯·æ±‚ä¸“æ³¨äºå•ä¸ªé—®é¢˜æˆ–åŠŸèƒ½
6. **å‚ä¸åé¦ˆ**ï¼šç§¯æå“åº”è´¡çŒ®åé¦ˆ

### **ç¤ºä¾‹è´¡çŒ®å·¥ä½œæµ**

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/microsoft/mcp-for-beginners.git
cd mcp-for-beginners

# ä¸ºè´¡çŒ®åˆ›å»ºæ–°åˆ†æ”¯
git checkout -b feature/my-contribution

# è¿›è¡Œæ›´æ”¹# ...# è¿è¡Œæµ‹è¯•ç¡®ä¿æ›´æ”¹ä¸ä¼šç ´åç°æœ‰åŠŸèƒ½
dotnet test# .NET é¡¹ç›®
mvn test# Java é¡¹ç›®
pytest# Python é¡¹ç›®# æäº¤æ›´æ”¹å¹¶é™„å¸¦æè¿°æ€§ä¿¡æ¯
git commit -am "åœ¨åè®®ä¸­æ·»åŠ å¯¹äºŒè¿›åˆ¶æ•°æ®æµçš„æ”¯æŒ"

# å°†åˆ†æ”¯æ¨é€åˆ°çš„ fork
git push origin feature/my-contribution

# ä»çš„åˆ†æ”¯åˆ°ä¸»ä»“åº“åˆ›å»ºæ‹‰å–è¯·æ±‚# ç„¶åæ ¹æ®éœ€è¦å‚ä¸åé¦ˆå¹¶è¿­ä»£ PR
```

## **åˆ›å»ºå’Œåˆ†äº«è‡ªå®šä¹‰ MCP å·¥å…·**

ä¸º MCP ç”Ÿæ€ç³»ç»Ÿåšå‡ºè´¡çŒ®æœ€æœ‰ä»·å€¼çš„æ–¹å¼ä¹‹ä¸€æ˜¯åˆ›å»ºå’Œåˆ†äº«è‡ªå®šä¹‰å·¥å…·ã€‚

### **å¼€å‘å¯åˆ†äº«çš„å·¥å…·**

### **Python ç¤ºä¾‹ï¼šå‘å¸ƒ PyPI åŒ…**

- python
    
    ```python
    # PyPI åŒ…çš„ç›®å½•ç»“æ„ï¼š# mcp_nlp_tools/# â”œâ”€â”€ LICENSE# â”œâ”€â”€ README.md# â”œâ”€â”€ setup.py# â”œâ”€â”€ mcp_nlp_tools/# â”‚   â”œâ”€â”€ __init__.py# â”‚   â”œâ”€â”€ sentiment_tool.py# â”‚   â””â”€â”€ translation_tool.py# ç¤ºä¾‹ setup.py"""
    from setuptools import setup, find_packages
    
    setup(
        name="mcp_nlp_tools",
        version="0.1.0",
        packages=find_packages(),
        install_requires=[
            "mcp_server>=1.0.0",
            "transformers>=4.0.0",
            "torch>=1.8.0"
        ],
        author="Your Name",
        author_email="your.email@example.com",
        description="ç”¨äºè‡ªç„¶è¯­è¨€å¤„ç†ä»»åŠ¡çš„ MCP å·¥å…·",
        long_description=open("README.md").read(),
        long_description_content_type="text/markdown",
        url="ættps://github.com/username/mcp_nlp_tools",
        classifiers=[
            "Programming Language :: Python :: 3",
            "License :: OSI Approved :: MIT License",
            "Operating System :: OS Independent",
        ],
        python_requires=">=3.8",
    )
    """
    
    # ç¤ºä¾‹ NLP å·¥å…·å®ç° (sentiment_tool.py)from mcp_tools import Tool, ToolRequest, ToolResponse, ToolExecutionException
    from transformers import pipeline
    import torch
    
    class SentimentAnalysisTool(Tool):
        """ç”¨äºæ–‡æœ¬æƒ…æ„Ÿåˆ†æçš„ MCP å·¥å…·"""
    
        def __init__(self, model_name="distilbert-base-uncased-finetuned-sst-2-english"):
    # åŠ è½½æƒ…æ„Ÿåˆ†ææ¨¡å‹
            self.sentiment_analyzer = pipeline("sentiment-analysis", model=model_name)
    
        def get_name(self):
            return "sentimentAnalysis"
    
        def get_description(self):
            return "åˆ†ææ–‡æœ¬æƒ…æ„Ÿï¼Œå°†å…¶åˆ†ç±»ä¸ºç§¯ææˆ–æ¶ˆæ"
    
        def get_schema(self):
            return {
                "type": "object",
                "properties": {
                    "text": {
                        "type": "string",
                        "description": "è¦åˆ†ææƒ…æ„Ÿçš„æ–‡æœ¬"
                    },
                    "includeScore": {
                        "type": "boolean",
                        "description": "æ˜¯å¦åŒ…å«ç½®ä¿¡åº¦åˆ†æ•°",
                        "default": True
                    }
                },
                "required": ["text"]
            }
    
        async def execute_async(self, request: ToolRequest) -> ToolResponse:
            try:
    # æå–å‚æ•°
                text = request.parameters.get("text")
                include_score = request.parameters.get("includeScore", True)
    
    # åˆ†ææƒ…æ„Ÿ
                sentiment_result = self.sentiment_analyzer(text)[0]
    
    # æ ¼å¼åŒ–ç»“æœ
                result = {
                    "sentiment": sentiment_result["label"],
                    "text": text
                }
    
                if include_score:
                    result["score"] = sentiment_result["score"]
    
    # è¿”å›ç»“æœreturn ToolResponse(result=result)
    
            except Exception as e:
                raise ToolExecutionException(f"æƒ…æ„Ÿåˆ†æå¤±è´¥: {str(e)}")
    
    # å‘å¸ƒï¼š# python setup.py sdist bdist_wheel# python -m twine upload dist/*
    ```
    

### **åˆ†äº«æœ€ä½³å®è·µ**

ä¸ç¤¾åŒºåˆ†äº« MCP å·¥å…·æ—¶ï¼š

1. **å®Œæ•´æ–‡æ¡£**ï¼š
    - è®°å½•ç›®çš„ã€ä½¿ç”¨æ–¹æ³•å’Œç¤ºä¾‹
    - è§£é‡Šå‚æ•°å’Œè¿”å›å€¼
    - è®°å½•æ‰€æœ‰å¤–éƒ¨ä¾èµ–é¡¹
2. **é”™è¯¯å¤„ç†**ï¼š
    - å®ç°å¥å£®çš„é”™è¯¯å¤„ç†
    - æä¾›æœ‰ç”¨çš„é”™è¯¯ä¿¡æ¯
    - ä¼˜é›…åœ°å¤„ç†è¾¹ç¼˜æƒ…å†µ
3. **æ€§èƒ½è€ƒè™‘**ï¼š
    - ä¼˜åŒ–é€Ÿåº¦å’Œèµ„æºä½¿ç”¨
    - é€‚å½“æ—¶å®æ–½ç¼“å­˜
    - è€ƒè™‘å¯æ‰©å±•æ€§
4. **å®‰å…¨æ€§**ï¼š
    - ä½¿ç”¨å®‰å…¨çš„ API å¯†é’¥å’Œèº«ä»½éªŒè¯
    - éªŒè¯å’Œæ¸…ç†è¾“å…¥
    - ä¸ºå¤–éƒ¨ API è°ƒç”¨å®æ–½é€Ÿç‡é™åˆ¶
5. **æµ‹è¯•**ï¼š
    - åŒ…å«å…¨é¢çš„æµ‹è¯•è¦†ç›–
    - ä½¿ç”¨ä¸åŒç±»å‹è¾“å…¥å’Œè¾¹ç¼˜æƒ…å†µè¿›è¡Œæµ‹è¯•
    - è®°å½•æµ‹è¯•è¿‡ç¨‹

## **ç¤¾åŒºåä½œä¸æœ€ä½³å®è·µ**

æœ‰æ•ˆçš„åä½œæ˜¯è“¬å‹ƒå‘å±•çš„ MCP ç”Ÿæ€ç³»ç»Ÿçš„å…³é”®ã€‚

### **æ²Ÿé€šæ¸ é“**

- GitHub Issues å’Œ Discussions
- Microsoft Tech Community
- Discord å’Œ Slack é¢‘é“
- Stack Overflow (æ ‡ç­¾:Â `model-context-protocol`Â æˆ–Â `mcp`)

### **ä»£ç å®¡æŸ¥**

å®¡æŸ¥ MCP è´¡çŒ®æ—¶ï¼š

1. **æ¸…æ™°åº¦**ï¼šä»£ç æ˜¯å¦æ¸…æ™°ä¸”æ–‡æ¡£é½å…¨ï¼Ÿ
2. **æ­£ç¡®æ€§**ï¼šæ˜¯å¦æŒ‰é¢„æœŸå·¥ä½œï¼Ÿ
3. **ä¸€è‡´æ€§**ï¼šæ˜¯å¦éµå¾ªé¡¹ç›®çº¦å®šï¼Ÿ
4. **å®Œæ•´æ€§**ï¼šæ˜¯å¦åŒ…å«æµ‹è¯•å’Œæ–‡æ¡£ï¼Ÿ
5. **å®‰å…¨æ€§**ï¼šæ˜¯å¦å­˜åœ¨å®‰å…¨é—®é¢˜ï¼Ÿ

### **ç‰ˆæœ¬å…¼å®¹æ€§**

ä¸º MCP å¼€å‘æ—¶ï¼š

1. **åè®®ç‰ˆæœ¬æ§åˆ¶**ï¼šéµå®ˆå·¥å…·æ”¯æŒçš„ MCP åè®®ç‰ˆæœ¬
2. **å®¢æˆ·ç«¯å…¼å®¹æ€§**ï¼šè€ƒè™‘å‘åå…¼å®¹æ€§
3. **æœåŠ¡å™¨å…¼å®¹æ€§**ï¼šéµå¾ªæœåŠ¡å™¨å®ç°æŒ‡å—
4. **ç ´åæ€§å˜æ›´**ï¼šæ˜ç¡®è®°å½•ä»»ä½•ç ´åæ€§å˜æ›´

## **ç¤ºä¾‹ç¤¾åŒºé¡¹ç›®ï¼šMCP å·¥å…·æ³¨å†Œè¡¨**

ä¸€ä¸ªé‡è¦çš„ç¤¾åŒºè´¡çŒ®å¯èƒ½æ˜¯å¼€å‘ MCP å·¥å…·çš„å…¬å…±æ³¨å†Œè¡¨ã€‚

```python
# ç¤¾åŒºå·¥å…·æ³¨å†Œè¡¨ API çš„ç¤ºä¾‹æ¨¡å¼
from fastapi import FastAPI, HTTPException, Depends
from pydantic import BaseModel, Field, HttpUrl
from typing import List, Optional
import datetime
import uuid

# å·¥å…·æ³¨å†Œè¡¨çš„æ¨¡å‹
class ToolSchema(BaseModel):
    """å·¥å…·çš„ JSON æ¨¡å¼"""
    type: str
    properties: dict
    required: List[str] = []

class ToolRegistration(BaseModel):
    """æ³¨å†Œå·¥å…·çš„ä¿¡æ¯"""
    name: str = Field(..., description="å·¥å…·çš„å”¯ä¸€åç§°")
    description: str = Field(..., description="å·¥å…·åŠŸèƒ½çš„æè¿°")
    version: str = Field(..., description="å·¥å…·çš„è¯­ä¹‰ç‰ˆæœ¬")
    schema: ToolSchema = Field(..., description="å·¥å…·å‚æ•°çš„ JSON æ¨¡å¼")
    author:æ str = Field(..., description="å·¥å…·ä½œè€…")
    repository: Optional[HttpUrl] = Field(None, description="ä»“åº“ URL")
    documentation: Optional[HttpUrl] = Field(None, description="æ–‡æ¡£ URL")
    package: Optional[HttpUrl] = Field(None, description="åŒ… URL")
    tags: List[str] = Field(default_factory=list, description="ç”¨äºåˆ†ç±»çš„æ ‡ç­¾")
    examples: List[dict] = Field(default_factory=list, description="ä½¿ç”¨ç¤ºä¾‹")

class Tool(ToolRegistration):
    """å¸¦æ³¨å†Œå…ƒæ•°æ®çš„å·¥å…·"""
    id: uuid.UUID = Field(default_factory=uuid.uuid4)
    created_at: datetime.datetime = Field(default_factory=datetime.datetime.now)
    updated_at: datetime.datetime = Field(default_factory=datetime.datetime.now)
    downloads: int = Field(default=0)
    rating: float = Field(default=0.0)
    ratings_count: int = Field(default=0)

# æ³¨å†Œè¡¨çš„ FastAPI åº”ç”¨
app = FastAPI(title="MCP å·¥å…·æ³¨å†Œè¡¨")

# æ­¤ç¤ºä¾‹çš„å†…å­˜æ•°æ®åº“
tools_db = {}

@app.post("/tools", response_model=Tool)
async def register_tool(tool: ToolRegistration):
    """åœ¨æ³¨å†Œè¡¨ä¸­æ³¨å†Œæ–°å·¥å…·"""
    if tool.name in tools_db:
        raise HTTPException(status_code=400, detail=f"å·¥å…· '{tool.name}' å·²å­˜åœ¨")

    new_tool = Tool(**tool.dict())
    tools_db[tool.name] = new_tool
    return new_tool

@app.get("/tools", response_model=List[Tool])
async def list_tools(tag: Optional[str] = None):
    """åˆ—å‡ºæ‰€æœ‰æ³¨å†Œå·¥å…·ï¼Œå¯æŒ‰æ ‡ç­¾è¿‡æ»¤"""
    if tag:
        return [tool for tool in tools_db.values() if tag in tool.tags]
    return list(tools_db.values())

@app.get("/tools/{tool_name}", response_model=Tool)
async def get_tool(tool_name: str):
    """è·å–ç‰¹å®šå·¥å…·çš„ä¿¡æ¯"""
    if tool_name not in tools_db:
        raise HTTPException(status_code=404, detail=f"å·¥å…· '{tool_name}' æœªæ‰¾åˆ°")
    return tools_db[tool_name]

@app.delete("/tools/{tool_name}")
async def delete_tool(tool_name: str):
    """ä»æ³¨å†Œè¡¨ä¸­åˆ é™¤å·¥å…·"""
    if tool_name not in tools_db:
        raise HTTPException(status_code=404, detail=f"å·¥å…· '{tool_name}' æœªæ‰¾åˆ°")
    del tools_db[tool_name]
    return {"message": f"å·¥å…· '{tool_name}' å·²åˆ é™¤"}

```

## **å…³é”®è¦ç‚¹**

- MCP ç¤¾åŒºå¤šå…ƒåŒ–ï¼Œæ¬¢è¿å„ç§ç±»å‹çš„è´¡çŒ®
- ä¸º MCP åšè´¡çŒ®çš„èŒƒå›´å¯ä»¥ä»æ ¸å¿ƒåè®®å¢å¼ºåˆ°è‡ªå®šä¹‰å·¥å…·
- éµå¾ªè´¡çŒ®æŒ‡å—å¯æé«˜ PR è¢«æ¥å—çš„æœºä¼š
- åˆ›å»ºå’Œåˆ†äº« MCP å·¥å…·æ˜¯å¢å¼ºç”Ÿæ€ç³»ç»Ÿçš„å®è´µæ–¹å¼
- ç¤¾åŒºåä½œå¯¹äº MCP çš„å‘å±•å’Œæ”¹è¿›è‡³å…³é‡è¦

# **07-æ—©æœŸé‡‡ç”¨ç»éªŒåˆ†äº«**

## **çœŸå®çš„ MCP å®æ–½**

### **æ¡ˆä¾‹ç ”ç©¶ 1ï¼šä¼ä¸šå®¢æˆ·æ”¯æŒè‡ªåŠ¨åŒ–**

ä¸€å®¶è·¨å›½å…¬å¸å®æ–½äº†åŸºäº MCP çš„è§£å†³æ–¹æ¡ˆï¼Œä»¥æ ‡å‡†åŒ–å…¶å®¢æˆ·æ”¯æŒç³»ç»Ÿä¸­çš„ AI äº¤äº’ã€‚è¿™ä½¿ä»–ä»¬èƒ½å¤Ÿï¼š

- ä¸ºå¤šä¸ª LLM æä¾›å•†åˆ›å»ºç»Ÿä¸€çš„ç•Œé¢
- åœ¨å„éƒ¨é—¨ä¹‹é—´ä¿æŒä¸€è‡´çš„æç¤ºç®¡ç†
- å®æ–½å¼ºå¤§çš„å®‰å…¨å’Œåˆè§„æ€§æ§åˆ¶
- æ ¹æ®ç‰¹å®šéœ€æ±‚è½»æ¾åœ¨ä¸åŒçš„ AI æ¨¡å‹ä¹‹é—´åˆ‡æ¢

**æŠ€æœ¯å®ç°ï¼š**

- python
    
    ```python
    # ç”¨äºå®¢æˆ·æ”¯æŒçš„ Python MCP æœåŠ¡å™¨å®ç°
    import logging
    import asyncio
    from modelcontextprotocol import create_server, ServerConfig
    from modelcontextprotocol.server import MCPServer
    from modelcontextprotocol.transports import create_http_transport
    from modelcontextprotocol.resources import ResourceDefinition
    from modelcontextprotocol.prompts import PromptDefinition
    from modelcontextprotocol.tool import ToolDefinition
    
    # é…ç½®æ—¥å¿—è®°å½•
    logging.basicConfig(level=logging.INFO)
    
    async def main():
        # åˆ›å»ºæœåŠ¡å™¨é…ç½®
        config = ServerConfig(
            name="Enterprise Customer Support Server",
            version="1.0.0",
            description="MCP server for handling customer support inquiries"
        )
    
        # åˆå§‹åŒ– MCP æœåŠ¡å™¨
        server = create_server(config)
    
    # æ³¨å†ŒçŸ¥è¯†åº“èµ„æº
        server.resources.register(
            ResourceDefinition(
                name="customer_kb",
                description="Customer knowledge base documentation"
            ),
            lambda params: get_customer_documentation(params)
        )
    
    # æ³¨å†Œæç¤ºæ¨¡æ¿
        server.prompts.register(
            PromptDefinition(
                name="support_template",
                description="Templates for customer support responses"
            ),
            lambda params: get_support_templates(params)
        )
    
    		# æ³¨å†Œæ”¯æŒå·¥å…·
        server.tools.register(
            ToolDefinition(
                name="ticketing",
                description="Create and update support tickets"
            ),
            handle_ticketing_operations
        )
    
    		# ä½¿ç”¨ HTTP ä¼ è¾“å¯åŠ¨æœåŠ¡å™¨
        transport = create_http_transport(port=8080)
        await server.run(transport)
    
    if __name__ == "__main__":
        asyncio.run(main())
    
    ```
    

**ç»“æœï¼š**Â æ¨¡å‹æˆæœ¬é™ä½ 30%ï¼Œå“åº”ä¸€è‡´æ€§æé«˜ 45%ï¼Œå…¨çƒè¿è¥çš„åˆè§„æ€§å¾—åˆ°å¢å¼ºã€‚

### **æ¡ˆä¾‹ç ”ç©¶ 2ï¼šåŒ»ç–—ä¿å¥è¯Šæ–­åŠ©æ‰‹**

ä¸€å®¶åŒ»ç–—ä¿å¥æä¾›å•†å¼€å‘äº† MCP åŸºç¡€è®¾æ–½ï¼Œä»¥é›†æˆå¤šä¸ªä¸“é—¨çš„åŒ»ç–— AI æ¨¡å‹ï¼ŒåŒæ—¶ç¡®ä¿æ•æ„Ÿçš„æ‚£è€…æ•°æ®å¾—åˆ°ä¿æŠ¤ï¼š

- åœ¨é€šç”¨å’Œä¸“ç§‘åŒ»ç–—æ¨¡å‹ä¹‹é—´æ— ç¼åˆ‡æ¢
- ä¸¥æ ¼çš„éšç§æ§åˆ¶å’Œå®¡è®¡è·Ÿè¸ª
- ä¸ç°æœ‰çš„ç”µå­å¥åº·è®°å½• (EHR) ç³»ç»Ÿé›†æˆ
- é’ˆå¯¹åŒ»å­¦æœ¯è¯­çš„ä¸€è‡´æç¤ºå·¥ç¨‹

**æŠ€æœ¯å®ç°ï¼š**

- c#
    
    ```csharp
    // C# MCP ä¸»æœºåº”ç”¨ç¨‹åºåœ¨åŒ»ç–—ä¿å¥åº”ç”¨ç¨‹åºä¸­çš„å®ç°
    using Microsoft.Extensions.DependencyInjection;
    using ModelContextProtocol.SDK.Client;
    using ModelContextProtocol.SDK.Security;
    using ModelContextProtocol.SDK.Resources;
    
    public class DiagnosticAssistant
    {
        private readonly MCPHostClient _mcpClient;
        private readonly PatientContext _patientContext;
    
        public DiagnosticAssistant(PatientContext patientContext)
        {
            _patientContext = patientContext;
    
    // ä½¿ç”¨ç‰¹å®šäºåŒ»ç–—ä¿å¥çš„è®¾ç½®é…ç½® MCP å®¢æˆ·ç«¯var clientOptions = new ClientOptions
            {
                Name = "Healthcare Diagnostic Assistant",
                Version = "1.0.0",
                Security = new SecurityOptions
                {
                    Encryption = EncryptionLevel.Medical,
                    AuditEnabled = true
                }
            };
    
            _mcpClient = new MCPHostClientBuilder()
                .WithOptions(clientOptions)
                .WithTransport(new HttpTransport("https://healthcare-mcp.example.org"))
                .WithAuthentication(new HIPAACompliantAuthProvider())
                .Build();
        }
    
        public async Task<DiagnosticSuggestion> GetDiagnosticAssistance(
            string symptoms, string patientHistory)
        {
    				// ä½¿ç”¨é€‚å½“çš„èµ„æºå’Œå·¥å…·è®¿é—®æƒé™åˆ›å»ºè¯·æ±‚var resourceRequest = new ResourceRequest
            {
                Name = "patient_records",
                Parameters = new Dictionary<string, object>
                {
                    ["patientId"] = _patientContext.PatientId,
                    ["requestingProvider"] = _patientContext.ProviderId
                }
            };
    
    						// ä½¿ç”¨é€‚å½“çš„æç¤ºè¯·æ±‚è¯Šæ–­å¸®åŠ©var response = await _mcpClient.SendPromptRequestAsync(
                promptName: "diagnostic_assistance",
                parameters: new Dictionary<string, object>
                {
                    ["symptoms"] = symptoms,
                    patientHistory = patientHistory,
                    relevantGuidelines = _patientContext.GetRelevantGuidelines()
                });
    
            return DiagnosticSuggestion.FromMCPResponse(response);
        }
    }
    
    ```
    

**ç»“æœï¼š**Â æ”¹è¿›äº†å¯¹åŒ»ç”Ÿçš„è¯Šæ–­å»ºè®®ï¼ŒåŒæ—¶ä¿æŒäº†å®Œå…¨çš„ HIPAA åˆè§„æ€§ï¼Œå¹¶æ˜¾ç€å‡å°‘äº†ç³»ç»Ÿä¹‹é—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚

### **æ¡ˆä¾‹ç ”ç©¶ 3ï¼šé‡‘èæœåŠ¡é£é™©åˆ†æ**

ä¸€å®¶é‡‘èæœºæ„å®æ–½äº† MCPï¼Œä»¥æ ‡å‡†åŒ–å…¶ä¸åŒéƒ¨é—¨çš„é£é™©åˆ†ææµç¨‹ï¼š

- ä¸ºä¿¡ç”¨é£é™©ã€æ¬ºè¯ˆæ£€æµ‹å’ŒæŠ•èµ„é£é™©æ¨¡å‹åˆ›å»ºäº†ç»Ÿä¸€çš„ç•Œé¢
- å®æ–½äº†ä¸¥æ ¼çš„è®¿é—®æ§åˆ¶å’Œæ¨¡å‹ç‰ˆæœ¬æ§åˆ¶
- ç¡®ä¿äº†æ‰€æœ‰ AI å»ºè®®çš„å¯å®¡è®¡æ€§
- åœ¨ä¸åŒç³»ç»Ÿä¹‹é—´ä¿æŒä¸€è‡´çš„æ•°æ®æ ¼å¼

**æŠ€æœ¯å®ç°ï¼š**

- java
    
    ```java
    // ç”¨äºé‡‘èé£é™©è¯„ä¼°çš„ Java MCP æœåŠ¡å™¨import org.mcp.server.*;
    import org.mcp.security.*;
    
    public class FinancialRiskMCPServer {
        public static void main(String[] args) {
    // åˆ›å»ºå…·æœ‰é‡‘èåˆè§„åŠŸèƒ½çš„ MCP æœåŠ¡å™¨MCPServer server = new MCPServerBuilder()
                .withModelProviders(
                    new ModelProvider("risk-assessment-primary", new AzureOpenAIProvider()),
                    new ModelProvider("risk-assessment-audit", new LocalLlamaProvider())
                )
                .withPromptTemplateDirectory("./compliance/templates")
                .withAccessControls(new SOCCompliantAccessControl())
                .withDataEncryption(EncryptionStandard.FINANCIAL_GRADE)
                .withVersionControl(true)
                .withAuditLogging(new DatabaseAuditLogger())
                .build();
    
            server.addRequestValidator(new FinancialDataValidator());
            server.addResponseFilter(new PII_RedactionFilter());
    
            server.start(9000);
    
            System.out.println("Financial Risk MCP Server running on port 9000");
        }
    }
    
    ```
    

**ç»“æœï¼š**Â å¢å¼ºäº†æ³•è§„éµä»æ€§ï¼Œæ¨¡å‹éƒ¨ç½²å‘¨æœŸåŠ å¿«äº† 40%ï¼Œå¹¶æé«˜äº†å„éƒ¨é—¨é£é™©è¯„ä¼°çš„ä¸€è‡´æ€§ã€‚

### **æ¡ˆä¾‹ç ”ç©¶ 4ï¼šç”¨äºæµè§ˆå™¨è‡ªåŠ¨åŒ–çš„ Microsoft Playwright MCP æœåŠ¡å™¨**

å¾®è½¯å¼€å‘äº†Â [Playwright MCP æœåŠ¡å™¨](https://github.com/microsoft/playwright-mcp)ï¼Œä»¥é€šè¿‡æ¨¡å‹ä¸Šä¸‹æ–‡åè®®å®ç°å®‰å…¨ã€æ ‡å‡†åŒ–çš„æµè§ˆå™¨è‡ªåŠ¨åŒ–ã€‚è¯¥è§£å†³æ–¹æ¡ˆå…è®¸ AI ä»£ç†å’Œ LLM ä»¥å—æ§ã€å¯å®¡è®¡å’Œå¯æ‰©å±•çš„æ–¹å¼ä¸ Web æµè§ˆå™¨äº¤äº’ï¼Œä»è€Œæ”¯æŒè‡ªåŠ¨åŒ– Web æµ‹è¯•ã€æ•°æ®æå–å’Œç«¯åˆ°ç«¯å·¥ä½œæµç­‰ç”¨ä¾‹ã€‚

- å°†æµè§ˆå™¨è‡ªåŠ¨åŒ–åŠŸèƒ½ï¼ˆå¯¼èˆªã€è¡¨å•å¡«å†™ã€å±å¹•æˆªå›¾æ•è·ç­‰ï¼‰å…¬å¼€ä¸º MCP å·¥å…·
- å®æ–½ä¸¥æ ¼çš„è®¿é—®æ§åˆ¶å’Œæ²™ç›’æœºåˆ¶ï¼Œä»¥é˜²æ­¢æœªç»æˆæƒçš„æ“ä½œ
- ä¸ºæ‰€æœ‰æµè§ˆå™¨äº¤äº’æä¾›è¯¦ç»†çš„å®¡è®¡æ—¥å¿—
- æ”¯æŒä¸ Azure OpenAI å’Œå…¶ä»– LLM æä¾›å•†é›†æˆï¼Œä»¥å®ç°ä»£ç†é©±åŠ¨çš„è‡ªåŠ¨åŒ–

**æŠ€æœ¯å®ç°ï¼š**

- node
    
    ```tsx
    // TypeScriptï¼šåœ¨ MCP æœåŠ¡å™¨ä¸­æ³¨å†Œ Playwright æµè§ˆå™¨è‡ªåŠ¨åŒ–å·¥å…·import { createServer, ToolDefinition } from 'modelcontextprotocol';
    import { launch } from 'playwright';
    
    const server = createServer({
      name: 'Playwright MCP Server',
      version: '1.0.0',
      description: 'MCP server for browser automation using Playwright'
    });
    
    // æ³¨å†Œä¸€ä¸ªç”¨äºå¯¼èˆªåˆ° URL å¹¶æ•è·å±å¹•æˆªå›¾çš„å·¥å…·
    server.tools.register(
      new ToolDefinition({
        name: 'navigate_and_screenshot',
        description: 'Navigate to a URL and capture a screenshot',
        parameters: {
          url: { type: 'string', description: 'The URL to visit' }
        }
      }),
      async ({ url }) => {
        const browser = await launch();
        const page = await browser.newPage();
        await page.goto(url);
        const screenshot = await page.screenshot();
        await browser.close();
        return { screenshot };
      }
    );
    
    // å¯åŠ¨ MCP æœåŠ¡å™¨
    server.listen(8080);
    
    ```
    

**ç»“æœï¼š**

- ä¸º AI ä»£ç†å’Œ LLM å¯ç”¨äº†å®‰å…¨ã€ç¨‹åºåŒ–çš„æµè§ˆå™¨è‡ªåŠ¨åŒ–
- å‡å°‘äº†æ‰‹åŠ¨æµ‹è¯•å·¥ä½œé‡ï¼Œæé«˜äº† Web åº”ç”¨ç¨‹åºçš„æµ‹è¯•è¦†ç›–ç‡
- ä¸ºä¼ä¸šç¯å¢ƒä¸­åŸºäºæµè§ˆå™¨çš„å·¥å…·é›†æˆæä¾›äº†å¯é‡ç”¨ã€å¯æ‰©å±•çš„æ¡†æ¶

**å‚è€ƒèµ„æ–™ï¼š**

- [Playwright MCP æœåŠ¡å™¨ GitHub å­˜å‚¨åº“](https://github.com/microsoft/playwright-mcp)
- [Microsoft AI å’Œè‡ªåŠ¨åŒ–è§£å†³æ–¹æ¡ˆ](https://azure.microsoft.com/en-us/products/ai-services/)

### **æ¡ˆä¾‹ç ”ç©¶ 5ï¼šAzure MCP â€“ ä¼ä¸šçº§æ¨¡å‹ä¸Šä¸‹æ–‡åè®®å³æœåŠ¡**

Azure MCP ([https://aka.ms/azmcp](https://aka.ms/azmcp)) æ˜¯å¾®è½¯æ‰˜ç®¡çš„ä¼ä¸šçº§æ¨¡å‹ä¸Šä¸‹æ–‡åè®®å®ç°ï¼Œæ—¨åœ¨ä½œä¸ºäº‘æœåŠ¡æä¾›å¯æ‰©å±•ã€å®‰å…¨å’Œåˆè§„çš„ MCP æœåŠ¡å™¨åŠŸèƒ½ã€‚Azure MCP ä½¿ç»„ç»‡èƒ½å¤Ÿå¿«é€Ÿéƒ¨ç½²ã€ç®¡ç† MCP æœåŠ¡å™¨å¹¶å°†å…¶ä¸ Azure AIã€æ•°æ®å’Œå®‰å…¨æœåŠ¡é›†æˆï¼Œä»è€Œå‡å°‘è¿è¥å¼€é”€å¹¶åŠ é€Ÿ AI çš„é‡‡ç”¨ã€‚

- å®Œå…¨æ‰˜ç®¡çš„ MCP æœåŠ¡å™¨æ‰˜ç®¡ï¼Œå…·æœ‰å†…ç½®çš„æ‰©å±•ã€ç›‘æ§å’Œå®‰å…¨æ€§
- ä¸ Azure OpenAIã€Azure AI æœç´¢å’Œå…¶ä»– Azure æœåŠ¡çš„æœ¬æœºé›†æˆ
- é€šè¿‡ Microsoft Entra ID è¿›è¡Œä¼ä¸šèº«ä»½éªŒè¯å’Œæˆæƒ
- æ”¯æŒè‡ªå®šä¹‰å·¥å…·ã€æç¤ºæ¨¡æ¿å’Œèµ„æºè¿æ¥å™¨
- ç¬¦åˆä¼ä¸šå®‰å…¨å’Œæ³•è§„è¦æ±‚

**æŠ€æœ¯å®ç°ï¼š**

```yaml
# ç¤ºä¾‹ï¼šAzure MCP æœåŠ¡å™¨éƒ¨ç½²é…ç½® (YAML)
apiVersion: mcp.microsoft.com/v1
kind: McpServer
metadata:
  name: enterprise-mcp-server
spec:
  modelProviders:
    - name: azure-openai
      type: AzureOpenAI
      endpoint: https://<your-openai-resource>.openai.azure.com/
      apiKeySecret: <your-azure-keyvault-secret>
  tools:
    - name: document_search
      type: AzureAISearch
      endpoint: https://<your-search-resource>.search.windows.net/
      apiKeySecret: <your-azure-keyvault-secret>
  authentication:
    type: EntraID
    tenantId: <your-tenant-id>
  monitoring:
    enabled: true
    logAnalyticsWorkspace: <your-log-analytics-id>

```

**ç»“æœï¼š**

- é€šè¿‡æä¾›å³ç”¨å‹ã€åˆè§„çš„ MCP æœåŠ¡å™¨å¹³å°ï¼Œç¼©çŸ­äº†ä¼ä¸š AI é¡¹ç›®çš„ä»·å€¼å®ç°æ—¶é—´
- ç®€åŒ–äº† LLMã€å·¥å…·å’Œä¼ä¸šæ•°æ®æºçš„é›†æˆ
- å¢å¼ºäº† MCP å·¥ä½œè´Ÿè½½çš„å®‰å…¨æ€§ã€å¯è§‚å¯Ÿæ€§å’Œè¿è¥æ•ˆç‡

**å‚è€ƒèµ„æ–™ï¼š**

- [Azure MCP æ–‡æ¡£](https://aka.ms/azmcp)
- [Azure AI æœåŠ¡](https://azure.microsoft.com/en-us/products/ai-services/)

### **æ¡ˆä¾‹ç ”ç©¶ 6ï¼šNLWeb**

MCPï¼ˆæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼‰æ˜¯ä¸€ç§æ–°å…´åè®®ï¼Œç”¨äºèŠå¤©æœºå™¨äººå’Œ AI åŠ©æ‰‹ä¸å·¥å…·è¿›è¡Œäº¤äº’ã€‚æ¯ä¸ª NLWeb å®ä¾‹ä¹Ÿæ˜¯ä¸€ä¸ª MCP æœåŠ¡å™¨ï¼Œå®ƒæ”¯æŒä¸€ä¸ªæ ¸å¿ƒæ–¹æ³• askï¼Œç”¨äºä»¥è‡ªç„¶è¯­è¨€å‘ç½‘ç«™æé—®ã€‚è¿”å›çš„å“åº”åˆ©ç”¨ schema.orgï¼Œè¿™æ˜¯ä¸€ä¸ªå¹¿æ³›ç”¨äºæè¿° Web æ•°æ®çš„è¯æ±‡è¡¨ã€‚ä¸ä¸¥æ ¼åœ°è¯´ï¼ŒMCP ä¹‹äº NLWeb å°±åƒ Http ä¹‹äº HTMLã€‚NLWeb ç»“åˆäº†åè®®ã€Schema.org æ ¼å¼å’Œç¤ºä¾‹ä»£ç ï¼Œä»¥å¸®åŠ©ç½‘ç«™å¿«é€Ÿåˆ›å»ºè¿™äº›ç«¯ç‚¹ï¼Œé€šè¿‡å¯¹è¯ç•Œé¢ä½¿äººç±»å—ç›Šï¼Œå¹¶é€šè¿‡è‡ªç„¶çš„ä»£ç†åˆ°ä»£ç†äº¤äº’ä½¿æœºå™¨å—ç›Šã€‚

NLWeb æœ‰ä¸¤ä¸ªä¸åŒçš„ç»„ä»¶ã€‚

- ä¸€ç§åè®®ï¼Œæœ€åˆéå¸¸ç®€å•ï¼Œç”¨äºä»¥è‡ªç„¶è¯­è¨€ä¸ç½‘ç«™äº¤äº’ï¼Œä»¥åŠä¸€ç§åˆ©ç”¨ json å’Œ schema.org è·å–è¿”å›ç­”æ¡ˆçš„æ ¼å¼ã€‚æœ‰å…³ REST API çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…æ–‡æ¡£ã€‚
- (1) çš„ä¸€ä¸ªç®€å•å®ç°ï¼Œå®ƒåˆ©ç”¨ç°æœ‰æ ‡è®°ï¼Œé€‚ç”¨äºå¯ä»¥æŠ½è±¡ä¸ºé¡¹ç›®åˆ—è¡¨ï¼ˆäº§å“ã€é£Ÿè°±ã€æ™¯ç‚¹ã€è¯„è®ºç­‰ï¼‰çš„ç½‘ç«™ã€‚ç»“åˆä¸€ç»„ç”¨æˆ·ç•Œé¢å°éƒ¨ä»¶ï¼Œç½‘ç«™å¯ä»¥è½»æ¾åœ°ä¸ºå…¶å†…å®¹æä¾›å¯¹è¯ç•Œé¢ã€‚æœ‰å…³å…¶å·¥ä½œåŸç†çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…æœ‰å…³èŠå¤©æŸ¥è¯¢ç”Ÿå‘½å‘¨æœŸçš„æ–‡æ¡£ã€‚

**å‚è€ƒèµ„æ–™ï¼š**

- [Azure MCP æ–‡æ¡£](https://aka.ms/azmcp)
- [NLWeb](https://github.com/microsoft/NlWeb)

### **æ¡ˆä¾‹ç ”ç©¶ 7ï¼šç”¨äº Foundry çš„ MCP â€“ é›†æˆ Azure AI ä»£ç†**

Azure AI Foundry MCP æœåŠ¡å™¨æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ MCP åœ¨ä¼ä¸šç¯å¢ƒä¸­ç¼–æ’å’Œç®¡ç† AI ä»£ç†å’Œå·¥ä½œæµã€‚é€šè¿‡å°† MCP ä¸ Azure AI Foundry é›†æˆï¼Œç»„ç»‡å¯ä»¥æ ‡å‡†åŒ–ä»£ç†äº¤äº’ï¼Œåˆ©ç”¨ Foundry çš„å·¥ä½œæµç®¡ç†ï¼Œå¹¶ç¡®ä¿å®‰å…¨ã€å¯æ‰©å±•çš„éƒ¨ç½²ã€‚è¿™ç§æ–¹æ³•å¯ä»¥å®ç°å¿«é€ŸåŸå‹è®¾è®¡ã€å¼ºå¤§çš„ç›‘æ§ä»¥åŠä¸ Azure AI æœåŠ¡çš„æ— ç¼é›†æˆï¼Œä»è€Œæ”¯æŒçŸ¥è¯†ç®¡ç†å’Œä»£ç†è¯„ä¼°ç­‰é«˜çº§æ–¹æ¡ˆã€‚å¼€å‘äººå‘˜å¯ä»¥ä»ç”¨äºæ„å»ºã€éƒ¨ç½²å’Œç›‘æ§ä»£ç†ç®¡é“çš„ç»Ÿä¸€ç•Œé¢ä¸­å—ç›Šï¼Œè€Œ IT å›¢é˜Ÿåˆ™å¯ä»¥è·å¾—æ›´é«˜çš„å®‰å…¨æ€§ã€åˆè§„æ€§å’Œè¿è¥æ•ˆç‡ã€‚è¯¥è§£å†³æ–¹æ¡ˆéå¸¸é€‚åˆå¯»æ±‚åŠ é€Ÿ AI é‡‡ç”¨å¹¶ä¿æŒå¯¹å¤æ‚ä»£ç†é©±åŠ¨æµç¨‹æ§åˆ¶çš„ä¼ä¸šã€‚

**å‚è€ƒèµ„æ–™ï¼š**

- [MCP Foundry GitHub å­˜å‚¨åº“](https://github.com/azure-ai-foundry/mcp-foundry)
- [å°† Azure AI ä»£ç†ä¸ MCP é›†æˆ (Microsoft Foundry åšå®¢)](https://devblogs.microsoft.com/foundry/integrating-azure-ai-agents-mcp/)

### **æ¡ˆä¾‹ç ”ç©¶ 8ï¼šFoundry MCP Playground â€“ å®éªŒå’ŒåŸå‹è®¾è®¡**

Foundry MCP Playground æä¾›äº†ä¸€ä¸ªå³ç”¨å‹ç¯å¢ƒï¼Œç”¨äºè¯•éªŒ MCP æœåŠ¡å™¨å’Œ Azure AI Foundry é›†æˆã€‚å¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨ Azure AI Foundry ç›®å½•å’Œå®éªŒå®¤ä¸­çš„èµ„æºå¿«é€Ÿå¯¹ AI æ¨¡å‹å’Œä»£ç†å·¥ä½œæµè¿›è¡ŒåŸå‹è®¾è®¡ã€æµ‹è¯•å’Œè¯„ä¼°ã€‚è¯¥ playground ç®€åŒ–äº†è®¾ç½®ï¼Œæä¾›äº†ç¤ºä¾‹é¡¹ç›®ï¼Œå¹¶æ”¯æŒåä½œå¼€å‘ï¼Œä»è€Œå¯ä»¥è½»æ¾åœ°ä»¥æœ€å°‘çš„å¼€é”€æ¢ç´¢æœ€ä½³å®è·µå’Œæ–°æ–¹æ¡ˆã€‚å¯¹äºå¸Œæœ›éªŒè¯æƒ³æ³•ã€åˆ†äº«å®éªŒå’ŒåŠ é€Ÿå­¦ä¹ è€Œæ— éœ€å¤æ‚åŸºç¡€è®¾æ–½çš„å›¢é˜Ÿæ¥è¯´ï¼Œå®ƒå°¤å…¶æœ‰ç”¨ã€‚é€šè¿‡é™ä½è¿›å…¥é—¨æ§›ï¼Œè¯¥ playground æœ‰åŠ©äºåœ¨ MCP å’Œ Azure AI Foundry ç”Ÿæ€ç³»ç»Ÿä¸­ä¿ƒè¿›åˆ›æ–°å’Œç¤¾åŒºè´¡çŒ®ã€‚

**å‚è€ƒèµ„æ–™ï¼š**

- [Foundry MCP Playground GitHub å­˜å‚¨åº“](https://github.com/azure-ai-foundry/foundry-mcp-playground)

### **æ¡ˆä¾‹ç ”ç©¶ 9. Microsoft Docs MCP æœåŠ¡å™¨ - å­¦ä¹ å’ŒæŠ€èƒ½æå‡**

Microsoft Docs MCP æœåŠ¡å™¨å®ç°äº†æ¨¡å‹ä¸Šä¸‹æ–‡åè®® (MCP) æœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨ä¸º AI åŠ©æ‰‹æä¾›å¯¹ Microsoft å®˜æ–¹æ–‡æ¡£çš„å®æ—¶è®¿é—®ã€‚å¯¹ Microsoft å®˜æ–¹æŠ€æœ¯æ–‡æ¡£æ‰§è¡Œè¯­ä¹‰æœç´¢ã€‚

**å‚è€ƒèµ„æ–™ï¼š**

- [Microsoft Learn Docs MCP æœåŠ¡å™¨](https://github.com/MicrosoftDocs/mcp)

## **åŠ¨æ‰‹é¡¹ç›® TODO**

### **é¡¹ç›® 1ï¼šæ„å»ºä¸€ä¸ªå¤šæä¾›å•† MCP æœåŠ¡å™¨**

**ç›®æ ‡ï¼š**Â åˆ›å»ºä¸€ä¸ª MCP æœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨å¯ä»¥æ ¹æ®ç‰¹å®šæ ‡å‡†å°†è¯·æ±‚è·¯ç”±åˆ°å¤šä¸ª AI æ¨¡å‹æä¾›å•†ã€‚

**è¦æ±‚ï¼š**

- æ”¯æŒè‡³å°‘ä¸‰ä¸ªä¸åŒçš„æ¨¡å‹æä¾›å•†ï¼ˆä¾‹å¦‚ï¼ŒOpenAIã€Anthropicã€æœ¬åœ°æ¨¡å‹ï¼‰
- æ ¹æ®è¯·æ±‚å…ƒæ•°æ®å®æ–½è·¯ç”±æœºåˆ¶
- åˆ›å»ºç”¨äºç®¡ç†æä¾›å•†å‡­æ®çš„é…ç½®ç³»ç»Ÿ
- æ·»åŠ ç¼“å­˜ä»¥ä¼˜åŒ–æ€§èƒ½å’Œæˆæœ¬
- æ„å»ºä¸€ä¸ªç”¨äºç›‘æ§ä½¿ç”¨æƒ…å†µçš„ç®€å•ä»ªè¡¨æ¿

**å®æ–½æ­¥éª¤ï¼š**

1. è®¾ç½®åŸºæœ¬çš„ MCP æœåŠ¡å™¨åŸºç¡€è®¾æ–½
2. ä¸ºæ¯ä¸ª AI æ¨¡å‹æœåŠ¡å®æ–½æä¾›å•†é€‚é…å™¨
3. æ ¹æ®è¯·æ±‚å±æ€§åˆ›å»ºè·¯ç”±é€»è¾‘
4. ä¸ºé¢‘ç¹è¯·æ±‚æ·»åŠ ç¼“å­˜æœºåˆ¶
5. å¼€å‘ç›‘æ§ä»ªè¡¨æ¿
6. ä½¿ç”¨å„ç§è¯·æ±‚æ¨¡å¼è¿›è¡Œæµ‹è¯•

**æŠ€æœ¯ï¼š**Â æ ¹æ®çš„åå¥½é€‰æ‹© Pythonï¼ˆ.NET/Java/Pythonï¼‰ï¼Œä½¿ç”¨ Redis è¿›è¡Œç¼“å­˜ï¼Œå¹¶ä½¿ç”¨ä¸€ä¸ªç®€å•çš„ Web æ¡†æ¶æ¥æ„å»ºä»ªè¡¨æ¿ã€‚

### **é¡¹ç›® 2ï¼šä¼ä¸šæç¤ºç®¡ç†ç³»ç»Ÿ**

**ç›®æ ‡ï¼š**Â å¼€å‘ä¸€ä¸ªåŸºäº MCP çš„ç³»ç»Ÿï¼Œç”¨äºåœ¨æ•´ä¸ªç»„ç»‡å†…ç®¡ç†ã€ç‰ˆæœ¬æ§åˆ¶å’Œéƒ¨ç½²æç¤ºæ¨¡æ¿ã€‚

**è¦æ±‚ï¼š**

- åˆ›å»ºä¸€ä¸ªç”¨äºæç¤ºæ¨¡æ¿çš„é›†ä¸­å¼å­˜å‚¨åº“
- å®æ–½ç‰ˆæœ¬æ§åˆ¶å’Œå®¡æ‰¹å·¥ä½œæµ
- ä½¿ç”¨ç¤ºä¾‹è¾“å…¥æ„å»ºæ¨¡æ¿æµ‹è¯•åŠŸèƒ½
- å¼€å‘åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶
- åˆ›å»ºç”¨äºæ¨¡æ¿æ£€ç´¢å’Œéƒ¨ç½²çš„ API

**å®æ–½æ­¥éª¤ï¼š**

1. è®¾è®¡ç”¨äºæ¨¡æ¿å­˜å‚¨çš„æ•°æ®åº“æ¨¡å¼
2. åˆ›å»ºç”¨äºæ¨¡æ¿ CRUD æ“ä½œçš„æ ¸å¿ƒ API
3. å®æ–½ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ
4. æ„å»ºå®¡æ‰¹å·¥ä½œæµ
5. å¼€å‘æµ‹è¯•æ¡†æ¶
6. åˆ›å»ºä¸€ä¸ªç”¨äºç®¡ç†çš„ç®€å• Web ç•Œé¢
7. ä¸ MCP æœåŠ¡å™¨é›†æˆ

**æŠ€æœ¯ï¼š**Â é€‰æ‹©çš„åç«¯æ¡†æ¶ã€SQL æˆ– NoSQL æ•°æ®åº“ï¼Œä»¥åŠç”¨äºç®¡ç†ç•Œé¢çš„å‰ç«¯æ¡†æ¶ã€‚

### **é¡¹ç›® 3ï¼šåŸºäº MCP çš„å†…å®¹ç”Ÿæˆå¹³å°**

**ç›®æ ‡ï¼š**Â æ„å»ºä¸€ä¸ªå†…å®¹ç”Ÿæˆå¹³å°ï¼Œè¯¥å¹³å°åˆ©ç”¨ MCP åœ¨ä¸åŒå†…å®¹ç±»å‹ä¹‹é—´æä¾›ä¸€è‡´çš„ç»“æœã€‚

**è¦æ±‚ï¼š**

- æ”¯æŒå¤šç§å†…å®¹æ ¼å¼ï¼ˆåšå®¢æ–‡ç« ã€ç¤¾äº¤åª’ä½“ã€è¥é”€æ–‡æ¡ˆï¼‰
- å®æ–½å…·æœ‰è‡ªå®šä¹‰é€‰é¡¹çš„åŸºäºæ¨¡æ¿çš„ç”Ÿæˆ
- åˆ›å»ºå†…å®¹å®¡æŸ¥å’Œåé¦ˆç³»ç»Ÿ
- è·Ÿè¸ªå†…å®¹æ€§èƒ½æŒ‡æ ‡
- æ”¯æŒå†…å®¹ç‰ˆæœ¬æ§åˆ¶å’Œè¿­ä»£

**å®æ–½æ­¥éª¤ï¼š**

1. è®¾ç½® MCP å®¢æˆ·ç«¯åŸºç¡€è®¾æ–½
2. ä¸ºä¸åŒçš„å†…å®¹ç±»å‹åˆ›å»ºæ¨¡æ¿
3. æ„å»ºå†…å®¹ç”Ÿæˆç®¡é“
4. å®æ–½å®¡æŸ¥ç³»ç»Ÿ
5. å¼€å‘æŒ‡æ ‡è·Ÿè¸ªç³»ç»Ÿ
6. åˆ›å»ºç”¨äºæ¨¡æ¿ç®¡ç†å’Œå†…å®¹ç”Ÿæˆçš„ç”¨æˆ·ç•Œé¢

**æŠ€æœ¯ï¼š**Â é¦–é€‰çš„ç¼–ç¨‹è¯­è¨€ã€Web æ¡†æ¶å’Œæ•°æ®åº“ç³»ç»Ÿã€‚

## **MCP æŠ€æœ¯çš„æœªæ¥æ–¹å‘**

### **æ–°å…´è¶‹åŠ¿**

1. **å¤šæ¨¡å¼ MCP**
    - å°† MCP æ‰©å±•åˆ°æ ‡å‡†åŒ–ä¸å›¾åƒã€éŸ³é¢‘å’Œè§†é¢‘æ¨¡å‹çš„äº¤äº’
    - å¼€å‘è·¨æ¨¡å¼æ¨ç†èƒ½åŠ›
    - é’ˆå¯¹ä¸åŒæ¨¡å¼çš„æ ‡å‡†åŒ–æç¤ºæ ¼å¼
2. **è”åˆ MCP åŸºç¡€è®¾æ–½**
    - å¯ä»¥åœ¨ç»„ç»‡ä¹‹é—´å…±äº«èµ„æºçš„åˆ†å¸ƒå¼ MCP ç½‘ç»œ
    - ç”¨äºå®‰å…¨æ¨¡å‹å…±äº«çš„æ ‡å‡†åŒ–åè®®
    - ä¿æŠ¤éšç§çš„è®¡ç®—æŠ€æœ¯
3. **MCP å¸‚åœº**
    - ç”¨äºå…±äº«å’Œè´§å¸åŒ– MCP æ¨¡æ¿å’Œæ’ä»¶çš„ç”Ÿæ€ç³»ç»Ÿ
    - è´¨é‡ä¿è¯å’Œè®¤è¯æµç¨‹
    - ä¸æ¨¡å‹å¸‚åœºé›†æˆ
4. **ç”¨äºè¾¹ç¼˜è®¡ç®—çš„ MCP**
    - é’ˆå¯¹èµ„æºå—é™çš„è¾¹ç¼˜è®¾å¤‡è°ƒæ•´ MCP æ ‡å‡†
    - é’ˆå¯¹ä½å¸¦å®½ç¯å¢ƒä¼˜åŒ–çš„åè®®
    - é’ˆå¯¹ç‰©è”ç½‘ç”Ÿæ€ç³»ç»Ÿçš„ä¸“é—¨ MCP å®ç°
5. **ç›‘ç®¡æ¡†æ¶**
    - å¼€å‘ç”¨äºæ³•è§„éµä»æ€§çš„ MCP æ‰©å±•
    - æ ‡å‡†åŒ–çš„å®¡è®¡è·Ÿè¸ªå’Œå¯è§£é‡Šæ€§æ¥å£
    - ä¸æ–°å…´çš„ AI æ²»ç†æ¡†æ¶é›†æˆ

### **æ¥è‡ªå¾®è½¯çš„ MCP è§£å†³æ–¹æ¡ˆ**

å¾®è½¯å’Œ Azure å¼€å‘äº†å‡ ä¸ªå¼€æºå­˜å‚¨åº“ï¼Œä»¥å¸®åŠ©å¼€å‘äººå‘˜åœ¨å„ç§åœºæ™¯ä¸­å®æ–½ MCPï¼š

### **å¾®è½¯ç»„ç»‡**

1. [playwright-mcp](https://github.com/microsoft/playwright-mcp)Â - ç”¨äºæµè§ˆå™¨è‡ªåŠ¨åŒ–å’Œæµ‹è¯•çš„ Playwright MCP æœåŠ¡å™¨
2. [files-mcp-server](https://github.com/microsoft/files-mcp-server)Â - ç”¨äºæœ¬åœ°æµ‹è¯•å’Œç¤¾åŒºè´¡çŒ®çš„ OneDrive MCP æœåŠ¡å™¨å®ç°
3. [NLWeb](https://github.com/microsoft/NlWeb)Â - NLWeb æ˜¯ä¸€ç»„å¼€æ”¾åè®®å’Œç›¸å…³çš„å¼€æºå·¥å…·ã€‚å…¶ä¸»è¦é‡ç‚¹æ˜¯ä¸º AI Web å»ºç«‹ä¸€ä¸ªåŸºç¡€å±‚

### **Azure-Samples ç»„ç»‡**

1. [mcp](https://github.com/Azure-Samples/mcp)Â - æŒ‡å‘ä½¿ç”¨å¤šç§è¯­è¨€åœ¨ Azure ä¸Šæ„å»ºå’Œé›†æˆ MCP æœåŠ¡å™¨çš„ç¤ºä¾‹ã€å·¥å…·å’Œèµ„æºçš„é“¾æ¥
2. [mcp-auth-servers](https://github.com/Azure-Samples/mcp-auth-servers)Â - æ¼”ç¤ºä½¿ç”¨å½“å‰æ¨¡å‹ä¸Šä¸‹æ–‡åè®®è§„èŒƒè¿›è¡Œèº«ä»½éªŒè¯çš„å‚è€ƒ MCP æœåŠ¡å™¨
3. [remote-mcp-functions](https://github.com/Azure-Samples/remote-mcp-functions)Â - Azure Functions ä¸­è¿œç¨‹ MCP æœåŠ¡å™¨å®ç°çš„ç™»é™†é¡µé¢ï¼Œå…¶ä¸­åŒ…å«æŒ‡å‘ç‰¹å®šè¯­è¨€å­˜å‚¨åº“çš„é“¾æ¥
4. [remote-mcp-functions-python](https://github.com/Azure-Samples/remote-mcp-functions-python)Â - ä½¿ç”¨ Python åœ¨ Azure Functions ä¸­æ„å»ºå’Œéƒ¨ç½²è‡ªå®šä¹‰è¿œç¨‹ MCP æœåŠ¡å™¨çš„å¿«é€Ÿå…¥é—¨æ¨¡æ¿
5. [remote-mcp-functions-dotnet](https://github.com/Azure-Samples/remote-mcp-functions-dotnet)Â - ä½¿ç”¨ .NET/C# åœ¨ Azure Functions ä¸­æ„å»ºå’Œéƒ¨ç½²è‡ªå®šä¹‰è¿œç¨‹ MCP æœåŠ¡å™¨çš„å¿«é€Ÿå…¥é—¨æ¨¡æ¿
6. [remote-mcp-functions-typescript](https://github.com/Azure-Samples/remote-mcp-functions-typescript)Â - ä½¿ç”¨ TypeScript åœ¨ Azure Functions ä¸­æ„å»ºå’Œéƒ¨ç½²è‡ªå®šä¹‰è¿œç¨‹ MCP æœåŠ¡å™¨çš„å¿«é€Ÿå…¥é—¨æ¨¡æ¿
7. [remote-mcp-apim-functions-python](https://github.com/Azure-Samples/remote-mcp-apim-functions-python)Â - ä½¿ç”¨ Python å°† Azure API ç®¡ç†ä½œä¸º AI ç½‘å…³è¿æ¥åˆ°è¿œç¨‹ MCP æœåŠ¡å™¨
8. [AI-Gateway](https://github.com/Azure-Samples/AI-Gateway)Â - APIM â¤ï¸ AI å®éªŒï¼ŒåŒ…æ‹¬ MCP åŠŸèƒ½ï¼Œä¸ Azure OpenAI å’Œ AI Foundry é›†æˆ

è¿™äº›å­˜å‚¨åº“æä¾›äº†ç”¨äºåœ¨ä¸åŒç¼–ç¨‹è¯­è¨€å’Œ Azure æœåŠ¡ä¸­ä½¿ç”¨æ¨¡å‹ä¸Šä¸‹æ–‡åè®®çš„å„ç§å®ç°ã€æ¨¡æ¿å’Œèµ„æºã€‚å®ƒä»¬æ¶µç›–äº†ä»åŸºæœ¬æœåŠ¡å™¨å®ç°åˆ°èº«ä»½éªŒè¯ã€äº‘éƒ¨ç½²å’Œä¼ä¸šé›†æˆåœºæ™¯çš„å„ç§ç”¨ä¾‹ã€‚

### **MCP èµ„æºç›®å½•**

å®˜æ–¹ Microsoft MCP å­˜å‚¨åº“ä¸­çš„Â [MCP èµ„æºç›®å½•](https://github.com/microsoft/mcp/tree/main/Resources)Â æä¾›äº†ä¸€ç»„ç²¾é€‰çš„ç¤ºä¾‹èµ„æºã€æç¤ºæ¨¡æ¿å’Œå·¥å…·å®šä¹‰ï¼Œå¯ä¸æ¨¡å‹ä¸Šä¸‹æ–‡åè®®æœåŠ¡å™¨ä¸€èµ·ä½¿ç”¨ã€‚è¯¥ç›®å½•æ—¨åœ¨é€šè¿‡ä¸ºä»¥ä¸‹æ–¹é¢æä¾›å¯é‡ç”¨çš„æ„å»ºå—å’Œæœ€ä½³å®è·µç¤ºä¾‹æ¥å¸®åŠ©å¼€å‘äººå‘˜å¿«é€Ÿå¼€å§‹ä½¿ç”¨ MCPï¼š

- **æç¤ºæ¨¡æ¿ï¼š**Â é€‚ç”¨äºå¸¸è§ AI ä»»åŠ¡å’Œåœºæ™¯çš„å³ç”¨å‹æç¤ºæ¨¡æ¿ï¼Œå¯ä»¥é’ˆå¯¹è‡ªå·±çš„ MCP æœåŠ¡å™¨å®ç°è¿›è¡Œè°ƒæ•´ã€‚
- **å·¥å…·å®šä¹‰ï¼š**Â ç¤ºä¾‹å·¥å…·æ¨¡å¼å’Œå…ƒæ•°æ®ï¼Œç”¨äºåœ¨ä¸åŒ MCP æœåŠ¡å™¨ä¹‹é—´æ ‡å‡†åŒ–å·¥å…·é›†æˆå’Œè°ƒç”¨ã€‚
- **èµ„æºç¤ºä¾‹ï¼š**Â ç”¨äºåœ¨ MCP æ¡†æ¶å†…è¿æ¥åˆ°æ•°æ®æºã€API å’Œå¤–éƒ¨æœåŠ¡çš„ç¤ºä¾‹èµ„æºå®šä¹‰ã€‚
- **å‚è€ƒå®ç°ï¼š**Â æ¼”ç¤ºå¦‚ä½•åœ¨å®é™… MCP é¡¹ç›®ä¸­ç»„ç»‡å’Œå®‰æ’èµ„æºã€æç¤ºå’Œå·¥å…·çš„å®ç”¨ç¤ºä¾‹ã€‚

è¿™äº›èµ„æºå¯ä»¥åŠ é€Ÿå¼€å‘ï¼Œä¿ƒè¿›æ ‡å‡†åŒ–ï¼Œå¹¶æœ‰åŠ©äºç¡®ä¿åœ¨æ„å»ºå’Œéƒ¨ç½²åŸºäº MCP çš„è§£å†³æ–¹æ¡ˆæ—¶éµå¾ªæœ€ä½³å®è·µã€‚

### **MCP èµ„æºç›®å½•**

- [MCP èµ„æºï¼ˆç¤ºä¾‹æç¤ºã€å·¥å…·å’Œèµ„æºå®šä¹‰ï¼‰](https://github.com/microsoft/mcp/tree/main/Resources)

### **ç ”ç©¶æœºä¼š**

- MCP æ¡†æ¶å†…çš„é«˜æ•ˆæç¤ºä¼˜åŒ–æŠ€æœ¯
- å¤šç§Ÿæˆ· MCP éƒ¨ç½²çš„å®‰å…¨æ¨¡å‹
- ä¸åŒ MCP å®ç°çš„æ€§èƒ½åŸºå‡†æµ‹è¯•
- MCP æœåŠ¡å™¨çš„å½¢å¼éªŒè¯æ–¹æ³•

## **å…¶ä»–èµ„æº**

- [MCP Foundry GitHub å­˜å‚¨åº“](https://github.com/azure-ai-foundry/mcp-foundry)
- [Foundry MCP Playground](https://github.com/azure-ai-foundry/foundry-mcp-playground)
- [å°† Azure AI ä»£ç†ä¸ MCP é›†æˆ (Microsoft Foundry åšå®¢)](https://devblogs.microsoft.com/foundry/integrating-azure-ai-agents-mcp/)
- [MCP GitHub å­˜å‚¨åº“ (Microsoft)](https://github.com/microsoft/mcp)
- [MCP èµ„æºç›®å½•ï¼ˆç¤ºä¾‹æç¤ºã€å·¥å…·å’Œèµ„æºå®šä¹‰ï¼‰](https://github.com/microsoft/mcp/tree/main/Resources)
- [MCP ç¤¾åŒºå’Œæ–‡æ¡£](https://modelcontextprotocol.io/introduction)
- [Azure MCP æ–‡æ¡£](https://aka.ms/azmcp)
- [Playwright MCP æœåŠ¡å™¨ GitHub å­˜å‚¨åº“](https://github.com/microsoft/playwright-mcp)
- [æ–‡ä»¶ MCP æœåŠ¡å™¨ (OneDrive)](https://github.com/microsoft/files-mcp-server)
- [Azure-Samples MCP](https://github.com/Azure-Samples/mcp)
- [MCP Auth æœåŠ¡å™¨ (Azure-Samples)](https://github.com/Azure-Samples/mcp-auth-servers)
- [è¿œç¨‹ MCP å‡½æ•° (Azure-Samples)](https://github.com/Azure-Samples/remote-mcp-functions)
- [è¿œç¨‹ MCP å‡½æ•° Python (Azure-Samples)](https://github.com/Azure-Samples/remote-mcp-functions-python)
- [è¿œç¨‹ MCP å‡½æ•° .NET (Azure-Samples)](https://github.com/Azure-Samples/remote-mcp-functions-dotnet)
- [è¿œç¨‹ MCP å‡½æ•° TypeScript (Azure-Samples)](https://github.com/Azure-Samples/remote-mcp-functions-typescript)
- [è¿œç¨‹ MCP APIM å‡½æ•° Python (Azure-Samples)](https://github.com/Azure-Samples/remote-mcp-apim-functions-python)
- [AI-Gateway (Azure-Samples)](https://github.com/Azure-Samples/AI-Gateway)
- [Microsoft AI å’Œè‡ªåŠ¨åŒ–è§£å†³æ–¹æ¡ˆ](https://azure.microsoft.com/en-us/products/ai-services/)

# **08-MCP æœ€ä½³å®è·µ**

## **MCP å·¥å…·å¼€å‘æœ€ä½³å®è·µ**

### **æ¶æ„åŸåˆ™**

### **1. å•ä¸€èŒè´£åŸåˆ™**

æ¯ä¸ª MCP åŠŸèƒ½éƒ½åº”æœ‰æ˜ç¡®ã€é›†ä¸­çš„ç”¨é€”ã€‚ä¸å…¶åˆ›å»ºè¯•å›¾å¤„ç†å¤šä¸ªé—®é¢˜çš„å•ä½“å·¥å…·ï¼Œä¸å¦‚å¼€å‘ä¸“é—¨ç”¨äºç‰¹å®šä»»åŠ¡çš„ä¸“ç”¨å·¥å…·ã€‚

**å¥½çš„ä¾‹å­ï¼š**

- C#
    
    ```csharp
    // ä¸€ä¸ªä¸“æ³¨äºåšå¥½ä¸€ä»¶äº‹çš„å·¥å…·public class WeatherForecastTool : ITool
    {
        private readonly IWeatherService _weatherService;
    
        public WeatherForecastTool(IWeatherService weatherService)
        {
            _weatherService = weatherService;
        }
    
        public string Name => "weatherForecast";
        public string Description => "è·å–ç‰¹å®šä½ç½®çš„å¤©æ°”é¢„æŠ¥";
    
        public ToolDefinition GetDefinition()
        {
            return new ToolDefinition
            {
                Name = Name,
                Description = Description,
                Parameters = new Dictionary<string, ParameterDefinition>
                {
                    ["location"] = new ParameterDefinition
                    {
                        Type = ParameterType.String,
                        Description = "åŸå¸‚æˆ–ä½ç½®åç§°"
                    },
                    ["days"] = new ParameterDefinition
                    {
                        Type = ParameterType.Integer,
                        Description = "é¢„æŠ¥å¤©æ•°",
                        Default = 3
                    }
                },
                Required = new[] { "location" }
            };
        }
          public async Task<ToolResponse> ExecuteAsync(IDictionary<string, object> parameters)
        {
            var location = parameters["location"].ToString();
            var days = parameters.ContainsKey("days")
                ? Convert.ToInt32(parameters["days"])
                : 3;
    
            var forecast = await _weatherService.GetForecastAsync(location, days);
    
            return new ToolResponse
            {
                Content = new List<ContentItem>
                {
                    new TextContent(JsonSerializer.Serialize(forecast))
                }
            };
        }
    }
    
    ```
    

**ä¸å¥½çš„ä¾‹å­ï¼š**

- C#
    
    ```csharp
    // ä¸€ä¸ªè¯•å›¾åšå¤ªå¤šäº‹æƒ…çš„å·¥å…·public class WeatherToolSuite : ITool
    {
        public string Name => "weather";
        public string Description => "ä¸å¤©æ°”ç›¸å…³çš„åŠŸèƒ½";
    
        public ToolDefinition GetDefinition()
        {
            return new ToolDefinition
            {
                Name = Name,
                Description = Description,
                Parameters = new Dictionary<string, ParameterDefinition>
                {
                    ["action"] = new ParameterDefinition
                    {
                        Type = ParameterType.String,
                        Description = "è¦æ‰§è¡Œçš„å¤©æ°”æ“ä½œ",
                        Enum = new[] { "forecast", "history", "alerts", "radar" }
                    },
                    ["location"] = new ParameterDefinition
                    {
                        Type = ParameterType.String,
                        Description = "åŸå¸‚æˆ–ä½ç½®åç§°"
                    },
    // æ›´å¤šç”¨äºä¸åŒæ“ä½œçš„å±æ€§...
                },
                required = new[] { "action", "location" }
            };
        }
    
        public async Task<ToolResponse> ExecuteAsync(ToolRequest request)
        {
    // å¤„ç†ä¸åŒæ“ä½œçš„å¤æ‚æ¡ä»¶é€»è¾‘var action = request.Parameters.GetProperty("action").GetString();
            var location = request.Parameters.GetProperty("location").GetString();
    
            switch (action)
            {
                case "forecast":
    // é¢„æŠ¥é€»è¾‘break;
                case "history":
    // å†å²æ•°æ®é€»è¾‘break;
    // æ›´å¤šæƒ…å†µ...default:
                    throw new ToolExecutionException($"æœªçŸ¥æ“ä½œ: {action}");
            }
    
    // ç»“æœå¤„ç†// ...
        }
    }
    
    ```
    

### **2. ä¾èµ–æ³¨å…¥å’Œå¯æµ‹è¯•æ€§**

è®¾è®¡å·¥å…·ä»¥é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥æ¥æ”¶å…¶ä¾èµ–é¡¹ï¼Œä½¿å…¶å¯æµ‹è¯•å’Œå¯é…ç½®ï¼š

```java
// å¸¦æœ‰ä¾èµ–æ³¨å…¥çš„ Java ç¤ºä¾‹public class CurrencyConversionTool implements Tool {
    private final ExchangeRateService exchangeService;
    private final CacheService cacheService;
    private final Logger logger;

// é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ä¾èµ–é¡¹public CurrencyConversionTool(
            ExchangeRateService exchangeService,
            CacheService cacheService,
            Logger logger) {
        this.exchangeService = exchangeService;
        this.cacheService = cacheService;
        this.logger = logger;
    }

// å·¥å…·å®ç°// ...
}
```

### **3. å¯ç»„åˆå·¥å…·**

è®¾è®¡å¯ä»¥ç»„åˆåœ¨ä¸€èµ·ä»¥åˆ›å»ºæ›´å¤æ‚å·¥ä½œæµçš„å·¥å…·ï¼š

```python
# æ˜¾ç¤ºå¯ç»„åˆå·¥å…·çš„ Python ç¤ºä¾‹class DataFetchTool(Tool):
    def get_name(self):
        return "dataFetch"

# å®ç°...class DataAnalysisTool(Tool):
    def get_name(self):
        return "dataAnalysis"

# æ­¤å·¥å…·å¯ä»¥ä½¿ç”¨æ¥è‡ª dataFetch å·¥å…·çš„ç»“æœasync def execute_async(self, request):
# å®ç°...pass

class DataVisualizationTool(Tool):
    def get_name(self):
        return "dataVisualize"

# æ­¤å·¥å…·å¯ä»¥ä½¿ç”¨æ¥è‡ª dataAnalysis å·¥å…·çš„ç»“æœasync def execute_async(self, request):
# å®ç°...pass

# è¿™äº›å·¥å…·å¯ä»¥ç‹¬ç«‹ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºå·¥ä½œæµçš„ä¸€éƒ¨åˆ†ä½¿ç”¨
```

### **æ¨¡å¼è®¾è®¡æœ€ä½³å®è·µ**

æ¨¡å¼æ˜¯æ¨¡å‹å’Œå·¥å…·ä¹‹é—´çš„å¥‘çº¦ã€‚ç²¾å¿ƒè®¾è®¡çš„æ¨¡å¼å¯ä»¥æé«˜å·¥å…·çš„å¯ç”¨æ€§ã€‚

### **1. æ¸…æ™°çš„å‚æ•°æè¿°**

å§‹ç»ˆä¸ºæ¯ä¸ªå‚æ•°åŒ…å«æè¿°æ€§ä¿¡æ¯ï¼š

```csharp
public object GetSchema()
{
    return new {
        type = "object",
        properties = {
            query = new {
                type = "string",
                description = "æœç´¢æŸ¥è¯¢æ–‡æœ¬ã€‚ä½¿ç”¨ç²¾ç¡®çš„å…³é”®å­—ä»¥è·å¾—æ›´å¥½çš„ç»“æœã€‚"
            },
            filters = new {
                type = "object",
                description = "ç”¨äºç¼©å°æœç´¢ç»“æœçš„å¯é€‰ç­›é€‰å™¨",
                properties = {
                    dateRange = new {
                        type = "string",
                        description = "æ—¥æœŸèŒƒå›´ï¼Œæ ¼å¼ä¸º YYYY-MM-DD:YYYY-MM-DD"
                    },
                    category = new {
                        type = "string",
                        description = "ç”¨äºç­›é€‰çš„ç±»åˆ«åç§°"
                    }
                }
            },
            limit = new {
                type = "integer",
                description = "è¦è¿”å›çš„æœ€å¤§ç»“æœæ•° (1-50)",
                default = 10
            }
        },
        required = new[] { "query" }
    };
}

```

### **2. éªŒè¯çº¦æŸ**

åŒ…å«éªŒè¯çº¦æŸä»¥é˜²æ­¢æ— æ•ˆè¾“å…¥ï¼š

```java
Map<String, Object> getSchema() {
    Map<String, Object> schema = new HashMap<>();
    schema.put("type", "object");

    Map<String, Object> properties = new HashMap<>();

// å¸¦æœ‰æ ¼å¼éªŒè¯çš„ç”µå­é‚®ä»¶å±æ€§
    Map<String, Object> email = new HashMap<>();
    email.put("type", "string");
    email.put("format", "email");
    email.put("description", "ç”¨æˆ·ç”µå­é‚®ä»¶åœ°å€");

// å¸¦æœ‰æ•°å­—çº¦æŸçš„å¹´é¾„å±æ€§
    Map<String, Object> age = new HashMap<>();
    age.put("type", "integer");
    age.put("minimum", 13);
    age.put("maximum", 120);
    age.put("description", "ç”¨æˆ·å¹´é¾„ï¼ˆå²ï¼‰");

// æšä¸¾å±æ€§
    Map<String, Object> subscription = new HashMap<>();
    subscription.put("type", "string");
    subscription.put("enum", Arrays.asList("free", "basic", "premium"));
    subscription.put("default", "free");
    subscription.put("description", "è®¢é˜…å±‚çº§");

    properties.put("email", email);
    properties.put("age", age);
    properties.put("subscription", subscription);

    schema.put("properties", properties);
    schema.put("required", Arrays.asList("email"));

    return schema;
}

```

### **3. ä¸€è‡´çš„è¿”å›ç»“æ„**

åœ¨å“åº”ç»“æ„ä¸­ä¿æŒä¸€è‡´æ€§ï¼Œä»¥ä¾¿æ¨¡å‹æ›´å®¹æ˜“è§£é‡Šç»“æœï¼š

```python
async def execute_async(self, request):
    try:
# å¤„ç†è¯·æ±‚
        results = await self._search_database(request.parameters["query"])

# å§‹ç»ˆè¿”å›ä¸€è‡´çš„ç»“æ„return ToolResponse(
            result={
                "matches": [self._format_item(item) for item in results],
                "totalCount": len(results),
                "queryTime": calculation_time_ms,
                "status": "success"
            }
        )
    except Exception as e:
        return ToolResponse(
            result={
                "matches": [],
                "totalCount": 0,
                "queryTime": 0,
                "status": "error",
                "error": str(e)
            }
        )

def _format_item(self, item):
    """ç¡®ä¿æ¯ä¸ªé¡¹ç›®éƒ½æœ‰ä¸€ä¸ªä¸€è‡´çš„ç»“æ„"""
    return {
        "id": item.id,
        "title": item.title,
        "summary": item.summary[:100] + "..." if len(item.summary) > 100 else item.summary,
        "url": item.url,
        "relevance": item.score
    }

```

### **é”™è¯¯å¤„ç†**

å¼ºå¤§çš„é”™è¯¯å¤„ç†å¯¹äº MCP å·¥å…·ä¿æŒå¯é æ€§è‡³å…³é‡è¦ã€‚

### **1. ä¼˜é›…çš„é”™è¯¯å¤„ç†**

åœ¨é€‚å½“çš„çº§åˆ«å¤„ç†é”™è¯¯å¹¶æä¾›ä¿¡æ¯æ€§æ¶ˆæ¯ï¼š

```csharp
public async Task<ToolResponse> ExecuteAsync(ToolRequest request)
{
    try
    {
        string fileId = request.Parameters.GetProperty("fileId").GetString();

        try
        {
            var fileData = await _fileService.GetFileAsync(fileId);
            return new ToolResponse {
                Result = JsonSerializer.SerializeToElement(fileData)
            };
        }
        catch (FileNotFoundException)
        {
            throw new ToolExecutionException($"æœªæ‰¾åˆ°æ–‡ä»¶: {fileId}");
        }
        catch (UnauthorizedAccessException)
        {
            throw new ToolExecutionException("æ— æƒè®¿é—®æ­¤æ–‡ä»¶");
        }
        catch (Exception ex) when (ex is IOException || ex is TimeoutException)
        {
            _logger.LogError(ex, "è®¿é—®æ–‡ä»¶ {FileId} æ—¶å‡ºé”™", fileId);
            throw new ToolExecutionException("è®¿é—®æ–‡ä»¶æ—¶å‡ºé”™ï¼šæœåŠ¡æš‚æ—¶ä¸å¯ç”¨");
        }
    }
    catch (JsonException)
    {
        throw new ToolExecutionException("æ— æ•ˆçš„æ–‡ä»¶ ID æ ¼å¼");
    }
    catch (Exception ex)
    {
        _logger.LogError(ex, "FileAccessTool ä¸­å‘ç”Ÿæ„å¤–é”™è¯¯");
        throw new ToolExecutionException("å‘ç”Ÿæ„å¤–é”™è¯¯");
    }
}

```

### **2. ç»“æ„åŒ–é”™è¯¯å“åº”**

å°½å¯èƒ½è¿”å›ç»“æ„åŒ–çš„é”™è¯¯ä¿¡æ¯ï¼š

```java
@Override
public ToolResponse execute(ToolRequest request) {
    try {
// å®ç°
    } catch (Exception ex) {
        Map<String, Object> errorResult = new HashMap<>();

        errorResult.put("success", false);

        if (ex instanceof ValidationException) {
            ValidationException validationEx = (ValidationException) ex;

            errorResult.put("errorType", "validation");
            errorResult.put("errorMessage", validationEx.getMessage());
            errorResult.put("validationErrors", validationEx.getErrors());

            return new ToolResponse.Builder()
                .setResult(errorResult)
                .build();
        }

// å°†å…¶ä»–å¼‚å¸¸é‡æ–°æŠ›å‡ºä¸º ToolExecutionExceptionthrow new ToolExecutionException("å·¥å…·æ‰§è¡Œå¤±è´¥: " + ex.getMessage(), ex);
    }
}

```

### **3. é‡è¯•é€»è¾‘**

ä¸ºç¬æ—¶æ•…éšœå®æ–½é€‚å½“çš„é‡è¯•é€»è¾‘ï¼š

```python
async def execute_async(self, request):
    max_retries = 3
    retry_count = 0
    base_delay = 1# ç§’

    while retry_count < max_retries:
        try:
# è°ƒç”¨å¤–éƒ¨ APIreturn await self._call_api(request.parameters)
        except TransientError as e:
            retry_count += 1
            if retry_count >= max_retries:
                raise ToolExecutionException(f"æ“ä½œåœ¨ {max_retries} æ¬¡å°è¯•åå¤±è´¥: {str(e)}")

# æŒ‡æ•°é€€é¿
            delay = base_delay * (2 ** (retry_count - 1))
            logging.warning(f"ç¬æ—¶é”™è¯¯ï¼Œåœ¨ {delay}s åé‡è¯•: {str(e)}")
            await asyncio.sleep(delay)
        except Exception as e:
# éç¬æ—¶é”™è¯¯ï¼Œä¸é‡è¯•raise ToolExecutionException(f"æ“ä½œå¤±è´¥: {str(e)}")

```

### **æ€§èƒ½ä¼˜åŒ–**

### **1. ç¼“å­˜**

ä¸ºæ˜‚è´µçš„æ“ä½œå®æ–½ç¼“å­˜ï¼š

```csharp
public class CachedDataTool : IMcpTool
{
    private readonly IDatabase _database;
    private readonly IMemoryCache _cache;

    public CachedDataTool(IDatabase database, IMemoryCache cache)
    {
        _database = database;
        _cache = cache;
    }

    public async Task<ToolResponse> ExecuteAsync(ToolRequest request)
    {
        var query = request.Parameters.GetProperty("query").GetString();

// æ ¹æ®å‚æ•°åˆ›å»ºç¼“å­˜é”®var cacheKey = $"data_query_{ComputeHash(query)}";

// é¦–å…ˆå°è¯•ä»ç¼“å­˜ä¸­è·å–if (_cache.TryGetValue(cacheKey, out var cachedResult))
        {
            return new ToolResponse { Result = cachedResult };
        }

// ç¼“å­˜æœªå‘½ä¸­ - æ‰§è¡Œå®é™…æŸ¥è¯¢var result = await _database.QueryAsync(query);

// å­˜å‚¨åœ¨ç¼“å­˜ä¸­å¹¶è®¾ç½®è¿‡æœŸæ—¶é—´var cacheOptions = new MemoryCacheEntryOptions()
            .SetAbsoluteExpiration(TimeSpan.FromMinutes(15));

        _cache.Set(cacheKey, JsonSerializer.SerializeToElement(result), cacheOptions);

        return new ToolResponse { Result = JsonSerializer.SerializeToElement(result) };
    }

    private string ComputeHash(string input)
    {
// ç”Ÿæˆç¨³å®šå“ˆå¸Œä»¥ç”¨ä½œç¼“å­˜é”®çš„å®ç°
    }
}

```

### **2. å¼‚æ­¥å¤„ç†**

å¯¹ I/O å¯†é›†å‹æ“ä½œä½¿ç”¨å¼‚æ­¥ç¼–ç¨‹æ¨¡å¼ï¼š

```java
public class AsyncDocumentProcessingTool implements Tool {
    private final DocumentService documentService;
    private final ExecutorService executorService;

    @Override
    public ToolResponse execute(ToolRequest request) {
        String documentId = request.getParameters().get("documentId").asText();

// å¯¹äºé•¿æ—¶é—´è¿è¡Œçš„æ“ä½œï¼Œç«‹å³è¿”å›ä¸€ä¸ªå¤„ç† IDString processId = UUID.randomUUID().toString();

// å¯åŠ¨å¼‚æ­¥å¤„ç†
        CompletableFuture.runAsync(() -> {
            try {
// æ‰§è¡Œé•¿æ—¶é—´è¿è¡Œçš„æ“ä½œ
                documentService.processDocument(documentId);

// æ›´æ–°çŠ¶æ€ï¼ˆé€šå¸¸ä¼šå­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼‰
                processStatusRepository.updateStatus(processId, "completed");
            } catch (Exception ex) {
                processStatusRepository.updateStatus(processId, "failed", ex.getMessage());
            }
        }, executorService);

// è¿”å›å¸¦æœ‰å¤„ç† ID çš„å³æ—¶å“åº”
        Map<String, Object> result = new HashMap<>();
        result.put("processId", processId);
        result.put("status", "processing");
        result.put("estimatedCompletionTime", ZonedDateTime.now().plusMinutes(5));

        return new ToolResponse.Builder().setResult(result).build();
    }

// é…å¥—çš„çŠ¶æ€æ£€æŸ¥å·¥å…·public class ProcessStatusTool implements Tool {
        @Override
        public ToolResponse execute(ToolRequest request) {
            String processId = request.getParameters().get("processId").asText();
            ProcessStatus status = processStatusRepository.getStatus(processId);

            return new ToolResponse.Builder().setResult(status).build();
        }
    }
}

```

### **3. èµ„æºé™åˆ¶**

å®æ–½èµ„æºé™åˆ¶ä»¥é˜²æ­¢è¿‡è½½ï¼š

```python
class ThrottledApiTool(Tool):
    def __init__(self):
        self.rate_limiter = TokenBucketRateLimiter(
            tokens_per_second=5,# å…è®¸æ¯ç§’ 5 ä¸ªè¯·æ±‚
            bucket_size=10# å…è®¸æœ€å¤š 10 ä¸ªè¯·æ±‚çš„çªå‘
        )

    async def execute_async(self, request):
# æ£€æŸ¥æˆ‘ä»¬æ˜¯å¦å¯ä»¥ç»§ç»­æˆ–éœ€è¦ç­‰å¾…
        delay = self.rate_limiter.get_delay_time()

        if delay > 0:
            if delay > 2.0:# å¦‚æœç­‰å¾…æ—¶é—´å¤ªé•¿raise ToolExecutionException(
                    f"è¶…å‡ºé€Ÿç‡é™åˆ¶ã€‚è¯·åœ¨ {delay:.1f} ç§’åé‡è¯•ã€‚"
                )
            else:
# ç­‰å¾…é€‚å½“çš„å»¶è¿Ÿæ—¶é—´await asyncio.sleep(delay)

# æ¶ˆè€—ä¸€ä¸ªä»¤ç‰Œå¹¶ç»§ç»­å¤„ç†è¯·æ±‚
        self.rate_limiter.consume()

# è°ƒç”¨ API
        result = await self._call_api(request.parameters)
        return ToolResponse(result=result)

class TokenBucketRateLimiter:
    def __init__(self, tokens_per_second, bucket_size):
        self.tokens_per_second = tokens_per_second
        self.bucket_size = bucket_size
        self.tokens = bucket_size
        self.last_refill = time.time()
        self.lock = asyncio.Lock()

    async def get_delay_time(self):
        async with self.lock:
            self._refill()
            if self.tokens >= 1:
                return 0

# è®¡ç®—ä¸‹ä¸€ä¸ªå¯ç”¨ä»¤ç‰Œçš„æ—¶é—´return (1 - self.tokens) / self.tokens_per_second

    async def consume(self):
        async with self.lock:
            self._refill()
            self.tokens -= 1

    def _refill(self):
        now = time.time()
        elapsed = now - self.last_refill

# æ ¹æ®ç»è¿‡çš„æ—¶é—´æ·»åŠ æ–°ä»¤ç‰Œ
        new_tokens = elapsed * self.tokens_per_second
        self.tokens = min(self.bucket_size, self.tokens + new_tokens)
        self.last_refill = now

```

### **å®‰å…¨æœ€ä½³å®è·µ**

### **1. è¾“å…¥éªŒè¯**

å§‹ç»ˆå½»åº•éªŒè¯è¾“å…¥å‚æ•°ï¼š

```csharp
public async Task<ToolResponse> ExecuteAsync(ToolRequest request)
{
// éªŒè¯å‚æ•°æ˜¯å¦å­˜åœ¨if (!request.Parameters.TryGetProperty("query", out var queryProp))
    {
        throw new ToolExecutionException("ç¼ºå°‘å¿…éœ€å‚æ•°: query");
    }

// éªŒè¯æ­£ç¡®çš„ç±»å‹if (queryProp.ValueKind != JsonValueKind.String)
    {
        throw new ToolExecutionException("æŸ¥è¯¢å‚æ•°å¿…é¡»æ˜¯å­—ç¬¦ä¸²");
    }

    var query = queryProp.GetString();

// éªŒè¯å­—ç¬¦ä¸²å†…å®¹if (string.IsNullOrWhiteSpace(query))
    {
        throw new ToolExecutionException("æŸ¥è¯¢å‚æ•°ä¸èƒ½ä¸ºç©º");
    }

    if (query.Length > 500)
    {
        throw new ToolExecutionException("æŸ¥è¯¢å‚æ•°è¶…è¿‡æœ€å¤§é•¿åº¦ 500 ä¸ªå­—ç¬¦");
    }

// å¦‚æœé€‚ç”¨ï¼Œæ£€æŸ¥ SQL æ³¨å…¥æ”»å‡»if (ContainsSqlInjection(query))
    {
        throw new ToolExecutionException("æ— æ•ˆæŸ¥è¯¢ï¼šåŒ…å«å¯èƒ½ä¸å®‰å…¨çš„ SQL");
    }

// ç»§ç»­æ‰§è¡Œ// ...
}

```

### **2. æˆæƒæ£€æŸ¥**

å®æ–½é€‚å½“çš„æˆæƒæ£€æŸ¥ï¼š

```java
@Override
public ToolResponse execute(ToolRequest request) {
// ä»è¯·æ±‚ä¸­è·å–ç”¨æˆ·ä¸Šä¸‹æ–‡UserContext user = request.getContext().getUserContext();

// æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å…·æœ‰æ‰€éœ€æƒé™if (!authorizationService.hasPermission(user, "documents:read")) {
        throw new ToolExecutionException("ç”¨æˆ·æ— æƒè®¿é—®æ–‡æ¡£");
    }

// å¯¹äºç‰¹å®šèµ„æºï¼Œæ£€æŸ¥å¯¹è¯¥èµ„æºçš„è®¿é—®æƒé™String documentId = request.getParameters().get("documentId").asText();
    if (!documentService.canUserAccess(user.getId(), documentId)) {
        throw new ToolExecutionException("æ‹’ç»è®¿é—®æ‰€è¯·æ±‚çš„æ–‡æ¡£");
    }

// ç»§ç»­æ‰§è¡Œå·¥å…·// ...
}

```

### **3. æ•æ„Ÿæ•°æ®å¤„ç†**

å°å¿ƒå¤„ç†æ•æ„Ÿæ•°æ®ï¼š

```python
class SecureDataTool(Tool):
    def get_schema(self):
        return {
            "type": "object",
            "properties": {
                "userId": {"type": "string"},
                "includeSensitiveData": {"type": "boolean", "default": False}
            },
            "required": ["userId"]
        }

    async def execute_async(self, request):
        user_id = request.parameters["userId"]
        include_sensitive = request.parameters.get("includeSensitiveData", False)

# è·å–ç”¨æˆ·æ•°æ®
        user_data = await self.user_service.get_user_data(user_id);

# é™¤éæ˜ç¡®è¯·æ±‚å¹¶è·å¾—æˆæƒï¼Œå¦åˆ™ç­›é€‰æ•æ„Ÿå­—æ®µif not include_sensitive or not self._is_authorized_for_sensitive_data(request):
            user_data = self._redact_sensitive_fields(user_data)

        return ToolResponse(result=user_data)

    def _is_authorized_for_sensitive_data(self, request):
# æ£€æŸ¥è¯·æ±‚ä¸Šä¸‹æ–‡ä¸­çš„æˆæƒçº§åˆ«
        auth_level = request.context.get("authorizationLevel")
        return auth_level == "admin"

    def _redact_sensitive_fields(self, user_data):
# åˆ›å»ºä¸€ä¸ªå‰¯æœ¬ä»¥é¿å…ä¿®æ”¹åŸå§‹æ•°æ®
        redacted = user_data.copy()

# ç¼–è¾‘ç‰¹å®šçš„æ•æ„Ÿå­—æ®µ
        sensitive_fields = ["ssn", "creditCardNumber", "password"]
        for field in sensitive_fields:
            if field in redacted:
                redacted[field] = "REDACTED"

# ç¼–è¾‘åµŒå¥—çš„æ•æ„Ÿæ•°æ®if "financialInfo" in redacted:
            redacted["financialInfo"] = {"available": True, "accessRestricted": True}

        return redacted

```

## **MCP å·¥å…·æµ‹è¯•æœ€ä½³å®è·µ**

å…¨é¢çš„æµ‹è¯•å¯ç¡®ä¿ MCP å·¥å…·æ­£å¸¸è¿è¡Œã€å¤„ç†è¾¹ç¼˜æƒ…å†µå¹¶ä¸ç³»ç»Ÿçš„å…¶ä½™éƒ¨åˆ†æ­£ç¡®é›†æˆã€‚

### **å•å…ƒæµ‹è¯•**

### **1. éš”ç¦»æµ‹è¯•æ¯ä¸ªå·¥å…·**

ä¸ºæ¯ä¸ªå·¥å…·çš„åŠŸèƒ½åˆ›å»ºé›†ä¸­çš„æµ‹è¯•ï¼š

```csharp
[Fact]
public async Task WeatherTool_ValidLocation_ReturnsCorrectForecast()
{
// å®‰æ’var mockWeatherService = new Mock<IWeatherService>();
    mockWeatherService
        .Setup(s => s.GetForecastAsync("Seattle", 3))
        .ReturnsAsync(new WeatherForecast(/* æµ‹è¯•æ•°æ® */));

    var tool = new WeatherForecastTool(mockWeatherService.Object);

    var request = new ToolRequest(
        toolName: "weatherForecast",
        parameters: JsonSerializer.SerializeToElement(new {
            location = "Seattle",
            days = 3
        })
    );

// æ“ä½œvar response = await tool.ExecuteAsync(request);

// æ–­è¨€
    Assert.NotNull(response);
    var result = JsonSerializer.Deserialize<WeatherForecast>(response.Result);
    Assert.Equal("Seattle", result.Location);
    Assert.Equal(3, result.DailyForecasts.Count);
}

[Fact]
public async Task WeatherTool_InvalidLocation_ThrowsToolExecutionException()
{
// å®‰æ’var mockWeatherService = new Mock<IWeatherService>();
    mockWeatherService
        .Setup(s => s.GetForecastAsync("InvalidLocation", It.IsAny<int>()))
        .ThrowsAsync(new LocationNotFoundException("æœªæ‰¾åˆ°ä½ç½®"));

    var tool = new WeatherForecastTool(mockWeatherService.Object);

    var request = new ToolRequest(
        toolName: "weatherForecast",
        parameters: JsonSerializer.SerializeToElement(new {
            location = "InvalidLocation",
            days = 3
        })
    );

// æ“ä½œå’Œæ–­è¨€var exception = await Assert.ThrowsAsync<ToolExecutionException>(
        () => tool.ExecuteAsync(request)
    );

    Assert.Contains("æœªæ‰¾åˆ°ä½ç½®", exception.Message);
}

```

### **2. æ¨¡å¼éªŒè¯æµ‹è¯•**

æµ‹è¯•æ¨¡å¼æ˜¯å¦æœ‰æ•ˆå¹¶æ­£ç¡®å¼ºåˆ¶æ‰§è¡Œçº¦æŸï¼š

```java
@Test
public void testSchemaValidation() {
// åˆ›å»ºå·¥å…·å®ä¾‹SearchTool searchTool = new SearchTool();

// è·å–æ¨¡å¼Object schema = searchTool.getSchema();

// å°†æ¨¡å¼è½¬æ¢ä¸º JSON ä»¥è¿›è¡ŒéªŒè¯String schemaJson = objectMapper.writeValueAsString(schema);

// éªŒè¯æ¨¡å¼æ˜¯å¦ä¸ºæœ‰æ•ˆçš„ JSONSchemaJsonSchemaFactory factory = JsonSchemaFactory.byDefault();
    JsonSchema jsonSchema = factory.getJsonSchema(schemaJson);

// æµ‹è¯•æœ‰æ•ˆå‚æ•°JsonNode validParams = objectMapper.createObjectNode()
        .put("query", "test query")
        .put("limit", 5);

    ProcessingReport validReport = jsonSchema.validate(validParams);
    assertTrue(validReport.isSuccess());

// æµ‹è¯•ç¼ºå°‘å¿…éœ€å‚æ•°JsonNode missingRequired = objectMapper.createObjectNode()
        .put("limit", 5);

    ProcessingReport missingReport = jsonSchema.validate(missingRequired);
    assertFalse(missingReport.isSuccess());

// æµ‹è¯•æ— æ•ˆå‚æ•°ç±»å‹JsonNode invalidType = objectMapper.createObjectNode()
        .put("query", "test")
        .put("limit", "not-a-number");

    ProcessingReport invalidReport = jsonSchema.validate(invalidType);
    assertFalse(invalidReport.isSuccess());
}

```

### **3. é”™è¯¯å¤„ç†æµ‹è¯•**

ä¸ºé”™è¯¯æ¡ä»¶åˆ›å»ºç‰¹å®šçš„æµ‹è¯•ï¼š

```python
@pytest.mark.asyncio
async def test_api_tool_handles_timeout():
# å®‰æ’
    tool = ApiTool(timeout=0.1);# éå¸¸çŸ­çš„è¶…æ—¶

# æ¨¡æ‹Ÿä¸€ä¸ªä¼šè¶…æ—¶çš„è¯·æ±‚with aioresponses() as mocked:
        mocked.get(
            "https://api.example.com/data",
            callback=lambda *args, **kwargs: asyncio.sleep(0.5)# æ¯”è¶…æ—¶æ—¶é—´é•¿
        )

        request = ToolRequest(
            tool_name="apiTool",
            parameters={"url": "https://api.example.com/data"}
        )

# æ“ä½œå’Œæ–­è¨€with pytest.raises(ToolExecutionException) as exc_info:
            await tool.execute_async(request)

# éªŒè¯å¼‚å¸¸æ¶ˆæ¯assert "timed out" in str(exc_info.value).lower()

@pytest.mark.asyncio
async def test_api_tool_handles_rate_limiting():
# å®‰æ’
    tool = ApiTool();

# æ¨¡æ‹Ÿä¸€ä¸ªé€Ÿç‡å—é™çš„å“åº”with aioresponses() as mocked:
        mocked.get(
            "https://api.example.com/data",
            status=429,
            headers={"Retry-After": "2"},
            body=json.dumps({"error": "Rate limit exceeded"})
        )

        request = ToolRequest(
            tool_name="apiTool",
            parameters={"url": "https://api.example.com/data"}
        )

# æ“ä½œå’Œæ–­è¨€with pytest.raises(ToolExecutionException) as exc_info:
            await tool.execute_async(request)

# éªŒè¯å¼‚å¸¸åŒ…å«é€Ÿç‡é™åˆ¶ä¿¡æ¯
        error_msg = str(exc_info.value).lower()
        assert "rate limit" in error_msg
        assert "try again" in error_msg

```

### **é›†æˆæµ‹è¯•**

### **1. å·¥å…·é“¾æµ‹è¯•**

æµ‹è¯•å·¥å…·åœ¨é¢„æœŸç»„åˆä¸­ååŒå·¥ä½œï¼š

```csharp
[Fact]
public async Task DataProcessingWorkflow_CompletesSuccessfully()
{
// å®‰æ’var dataFetchTool = new DataFetchTool(mockDataService.Object);
    var analysisTools = new DataAnalysisTool(mockAnalysisService.Object);
    var visualizationTool = new DataVisualizationTool(mockVisualizationService.Object);

    var toolRegistry = new ToolRegistry();
    toolRegistry.RegisterTool(dataFetchTool);
    toolRegistry.RegisterTool(analysisTools);
    toolRegistry.RegisterTool(visualizationTool);

    var workflowExecutor = new WorkflowExecutor(toolRegistry);

// æ“ä½œvar result = await workflowExecutor.ExecuteWorkflowAsync(new[] {
        new ToolCall("dataFetch", new { source = "sales2023" }),
        new ToolCall("dataAnalysis", ctx => new {
            data = ctx.GetResult("dataFetch"),
            analysis = "trend"
        }),
        new ToolCall("dataVisualize", ctx => new {
            analysisResult = ctx.GetResult("dataAnalysis"),
            type = "line-chart"
        })
    });

// æ–­è¨€
    Assert.NotNull(result);
    Assert.True(result.Success);
    Assert.NotNull(result.GetResult("dataVisualize"));
    Assert.Contains("chartUrl", result.GetResult("dataVisualize").ToString());
}

```

### **2. MCP æœåŠ¡å™¨æµ‹è¯•**

æµ‹è¯•å…·æœ‰å®Œæ•´å·¥å…·æ³¨å†Œå’Œæ‰§è¡Œçš„ MCP æœåŠ¡å™¨ï¼š

```java
@SpringBootTest
@AutoConfigureMockMvc
public class McpServerIntegrationTest {

    @Autowired
    private MockMvc mockMvc;

    @Autowired
    private ObjectMapper objectMapper;

    @Test
    public void testToolDiscovery() throws Exception {
// æµ‹è¯•å‘ç°ç«¯ç‚¹
        mockMvc.perform(get("/mcp/tools"))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$.tools").isArray())
            .andExpect(jsonPath("$.tools[*].name").value(hasItems(
                "weatherForecast", "calculator", "documentSearch"
            )));
    }

    @Test
    public void testToolExecution() throws Exception {
// åˆ›å»ºå·¥å…·è¯·æ±‚
        Map<String, Object> request = new HashMap<>();
        request.put("toolName", "calculator");

        Map<String, Object> parameters = new HashMap<>();
        parameters.put("operation", "add");
        parameters.put("a", 5);
        parameters.put("b", 7);
        request.put("parameters", parameters);

// å‘é€è¯·æ±‚å¹¶éªŒè¯å“åº”
        mockMvc.perform(post("/mcp/execute")
            .contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(request)))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$.result.value").value(12));
    }

    @Test
    public void testToolValidation() throws Exception {
// åˆ›å»ºæ— æ•ˆçš„å·¥å…·è¯·æ±‚
        Map<String, Object> request = new HashMap<>();
        request.put("toolName", "calculator");

        Map<String, Object> parameters = new HashMap<>();
        parameters.put("operation", "divide");
        parameters.put("a", 10);
// ç¼ºå°‘å‚æ•° "b"
        request.put("parameters", parameters);

// å‘é€è¯·æ±‚å¹¶éªŒè¯é”™è¯¯å“åº”
        mockMvc.perform(post("/mcp/execute")
            .contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(request)))
            .andExpect(status().isBadRequest())
            .andExpect(jsonPath("$.error").exists());
    }
}

```

### **3. ç«¯åˆ°ç«¯æµ‹è¯•**

æµ‹è¯•ä»æ¨¡å‹æç¤ºåˆ°å·¥å…·æ‰§è¡Œçš„å®Œæ•´å·¥ä½œæµï¼š

```python
@pytest.mark.asyncio
async def test_model_interaction_with_tool():
# å®‰æ’ - è®¾ç½® MCP å®¢æˆ·ç«¯å’Œæ¨¡æ‹Ÿæ¨¡å‹
    mcp_client = McpClient(server_url="http://localhost:5000");

# æ¨¡æ‹Ÿæ¨¡å‹å“åº”
    mock_model = MockLanguageModel([
        MockResponse(
            "What's the weather in Seattle?",
            tool_calls=[
                {
                    "tool_name": "weatherForecast",
                    "parameters": {"location": "Seattle", "days": 3}
                }
            ]
        ),
        MockResponse(
            "Here's the weather forecast for Seattle:\n- Today: 65Â°F, Partly Cloudy\n- Tomorrow: 68Â°F, Sunny\n- Day after: 62Â°F, Rain",
            tool_calls=[]
        )
    ]);

# æ¨¡æ‹Ÿå¤©æ°”å·¥å…·å“åº”with aioresponses() as mocked:
        mocked.post(
            "http://localhost:5000/mcp/execute",
            payload={
                "result": {
                    "location": "Seattle",
                    "forecast": [
                        {"date": "2023-06-01", "temperature": 65, "conditions": "Partly Cloudy"},
                        {"date": "2023-06-02", "temperature": 68, "conditions": "Sunny"},
                        {"date": "2023-06-03", "temperature": 62, "conditions": "Rain"}
                    ]
                }
            }
        )

# æ“ä½œ
        response = await mcp_client.send_prompt(
            "What's the weather in Seattle?",
            model=mock_model,
            allowed_tools=["weatherForecast"]
        )

# æ–­è¨€assert "Seattle" in response.generated_text
        assert "65" in response.generated_text
        assert "Sunny" in response.generated_text
        assert "Rain" in response.generated_text
        assert len(response.tool_calls) == 1
        assert response.tool_calls[0].tool_name == "weatherForecast"

```

### **æ€§èƒ½æµ‹è¯•**

### **1. è´Ÿè½½æµ‹è¯•**

æµ‹è¯•çš„ MCP æœåŠ¡å™¨å¯ä»¥å¤„ç†å¤šå°‘å¹¶å‘è¯·æ±‚ï¼š

```csharp
[Fact]
public async Task McpServer_HandlesHighConcurrency()
{
// å®‰æ’var server = new McpServer(
        name: "TestServer",
        version: "1.0",
        maxConcurrentRequests: 100
    );

    server.RegisterTool(new FastExecutingTool());
    await server.StartAsync();

    var client = new McpClient("http://localhost:5000");

// æ“ä½œvar tasks = new List<Task<McpResponse>>();
    for (int i = 0; i < 1000; i++)
    {
        tasks.Add(client.ExecuteToolAsync("fastTool", new { iteration = i }));
    }

    var results = await Task.WhenAll(tasks);

// æ–­è¨€
    Assert.Equal(1000, results.Length);
    Assert.All(results, r => Assert.NotNull(r));
}

```

### **2. å‹åŠ›æµ‹è¯•**

åœ¨æç«¯è´Ÿè½½ä¸‹æµ‹è¯•ç³»ç»Ÿï¼š

```java
@Test
public void testServerUnderStress() {
    int maxUsers = 1000;
    int rampUpTimeSeconds = 60;
    int testDurationSeconds = 300;

// è®¾ç½® JMeter è¿›è¡Œå‹åŠ›æµ‹è¯•StandardJMeterEngine jmeter = new StandardJMeterEngine();

// é…ç½® JMeter æµ‹è¯•è®¡åˆ’HashTree testPlanTree = new HashTree();

// åˆ›å»ºæµ‹è¯•è®¡åˆ’ã€çº¿ç¨‹ç»„ã€é‡‡æ ·å™¨ç­‰ã€‚TestPlan testPlan = new TestPlan("MCP Server Stress Test");
    testPlanTree.add(testPlan);

    ThreadGroup threadGroup = new ThreadGroup();
    threadGroup.setNumThreads(maxUsers);
    threadGroup.setRampUp(rampUpTimeSeconds);
    threadGroup.setScheduler(true);
    threadGroup.setDuration(testDurationSeconds);

    testPlanTree.add(threadGroup);

// æ·»åŠ ç”¨äºå·¥å…·æ‰§è¡Œçš„ HTTP é‡‡æ ·å™¨HTTPSampler toolExecutionSampler = new HTTPSampler();
    toolExecutionSampler.setDomain("localhost");
    toolExecutionSampler.setPort(5000);
    toolExecutionSampler.setPath("/mcp/execute");
    toolExecutionSampler.setMethod("POST");
    toolExecutionSampler.addArgument("toolName", "calculator");
    toolExecutionSampler.addArgument("parameters", "{\"operation\":\"add\",\"a\":5,\"b\":7}");

    threadGroup.add(toolExecutionSampler);

// æ·»åŠ ä¾¦å¬å™¨SummaryReport summaryReport = new SummaryReport();
    threadGroup.add(summaryReport);

// è¿è¡Œæµ‹è¯•
    jmeter.configure(testPlanTree);
    jmeter.run();

// éªŒè¯ç»“æœ
    assertEquals(0, summaryReport.getErrorCount());
    assertTrue(summaryReport.getAverage() < 200);// å¹³å‡å“åº”æ—¶é—´ < 200ms
    assertTrue(summaryReport.getPercentile(90.0) < 500);// 90% ç™¾åˆ†ä½ < 500ms
}

```

### **3. ç›‘æ§å’Œåˆ†æ**

è®¾ç½®ç›‘æ§ä»¥è¿›è¡Œé•¿æœŸæ€§èƒ½åˆ†æï¼š

```python
# ä¸º MCP æœåŠ¡å™¨é…ç½®ç›‘æ§def configure_monitoring(server):
# è®¾ç½® Prometheus æŒ‡æ ‡
    prometheus_metrics = {
        "request_count": Counter("mcp_requests_total", "æ€» MCP è¯·æ±‚æ•°"),
        "request_latency": Histogram(
            "mcp_request_duration_seconds",
            "è¯·æ±‚æŒç»­æ—¶é—´ï¼ˆç§’ï¼‰",
            buckets=[0.01, 0.05, 0.1, 0.5, 1.0, 2.5, 5.0, 10.0]
        ),
        "tool_execution_count": Counter(
            "mcp_tool_executions_total",
            "å·¥å…·æ‰§è¡Œæ¬¡æ•°",
            labelnames=["tool_name"]
        ),
        "tool_execution_latency": Histogram(
            "mcp_tool_duration_seconds",
            "å·¥å…·æ‰§è¡ŒæŒç»­æ—¶é—´ï¼ˆç§’ï¼‰",
            labelnames=["tool_name"],
            buckets=[0.01, 0.05, 0.1, 0.5, 1.0, 2.5, 5.0, 10.0]
        ),
        "tool_errors": Counter(
            "mcp_tool_errors_total",
            "å·¥å…·æ‰§è¡Œé”™è¯¯",
            labelnames=["tool_name", "error_type"]
        )
    }

# æ·»åŠ ç”¨äºè®¡æ—¶å’Œè®°å½•æŒ‡æ ‡çš„ä¸­é—´ä»¶
    server.add_middleware(PrometheusMiddleware(prometheus_metrics))

# å…¬å¼€æŒ‡æ ‡ç«¯ç‚¹    @server.router.get("/metrics")
    async def metrics():
        return generate_latest()

    return server

```

## **MCP å·¥ä½œæµè®¾è®¡æ¨¡å¼**

ç²¾å¿ƒè®¾è®¡çš„ MCP å·¥ä½œæµå¯ä»¥æé«˜æ•ˆç‡ã€å¯é æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ä»¥ä¸‹æ˜¯éœ€è¦éµå¾ªçš„å…³é”®æ¨¡å¼ï¼š

### **1. å·¥å…·é“¾æ¨¡å¼**

å°†å¤šä¸ªå·¥å…·æŒ‰é¡ºåºè¿æ¥èµ·æ¥ï¼Œå…¶ä¸­æ¯ä¸ªå·¥å…·çš„è¾“å‡ºéƒ½æˆä¸ºä¸‹ä¸€ä¸ªå·¥å…·çš„è¾“å…¥ï¼š

```python
# Python å·¥å…·é“¾å®ç°class ChainWorkflow:
    def __init__(self, tools_chain):
        self.tools_chain = tools_chain# æŒ‰é¡ºåºæ‰§è¡Œçš„å·¥å…·åç§°åˆ—è¡¨

    async def execute(self, mcp_client, initial_input):
        current_result = initial_input
        all_results = {"input": initial_input}

        for tool_name in self.tools_chain:
# æ‰§è¡Œé“¾ä¸­çš„æ¯ä¸ªå·¥å…·ï¼Œä¼ é€’ä¸Šä¸€ä¸ªç»“æœ
            response = await mcp_client.execute_tool(tool_name, current_result)

# å­˜å‚¨ç»“æœå¹¶ç”¨ä½œä¸‹ä¸€ä¸ªå·¥å…·çš„è¾“å…¥
            all_results[tool_name] = response.result
            current_result = response.result

        return {
            "final_result": current_result,
            "all_results": all_results
        }

# ç”¨æ³•ç¤ºä¾‹
data_processing_chain = ChainWorkflow([
    "dataFetch",
    "dataCleaner",
    "dataAnalyzer",
    "dataVisualizer"
])

result = await data_processing_chain.execute(
    mcp_client,
    {"source": "sales_database", "table": "transactions"}
)

```

### **2. è°ƒåº¦å™¨æ¨¡å¼**

ä½¿ç”¨ä¸€ä¸ªä¸­å¤®å·¥å…·ï¼Œæ ¹æ®è¾“å…¥åˆ†æ´¾ç»™ä¸“é—¨çš„å·¥å…·ï¼š

```csharp
public class ContentDispatcherTool : IMcpTool
{
    private readonly IMcpClient _mcpClient;

    public ContentDispatcherTool(IMcpClient mcpClient)
    {
        _mcpClient = mcpClient;
    }

    public string Name => "contentProcessor";
    public string Description => "å¤„ç†å„ç§ç±»å‹çš„å†…å®¹";

    public object GetSchema()
    {
        return {
            type = "object",
            properties = {
                content = new { type = "string" },
                contentType = new {
                    type = "string",
                    enum = new[] { "text", "html", "markdown", "csv", "code" }
                },
                operation = new {
                    type = "string",
                    enum = new[] { "summarize", "analyze", "extract", "convert" }
                }
            },
            required = new[] { "content", "contentType", "operation" }
        };
    }

    public async Task<ToolResponse> ExecuteAsync(ToolRequest request)
    {
        var content = request.Parameters.GetProperty("content").GetString();
        var contentType = request.Parameters.GetProperty("contentType").GetString();
        var operation = request.Parameters.GetProperty("operation").GetString();

// ç¡®å®šè¦ä½¿ç”¨çš„ä¸“ç”¨å·¥å…·string targetTool = DetermineTargetTool(contentType, operation);

// è½¬å‘åˆ°ä¸“ç”¨å·¥å…·var specializedResponse = await _mcpClient.ExecuteToolAsync(
            targetTool,
            new { content, options = GetOptionsForTool(targetTool, operation) }
        );

        return new ToolResponse { Result = specializedResponse.Result };
    }

    private string DetermineTargetTool(string contentType, string operation)
    {
        return (contentType, operation) switch
        {
            ("text", "summarize") => "textSummarizer",
            ("text", "analyze") => "textAnalyzer",
            ("html", _) => "htmlProcessor",
            ("markdown", _) => "markdownProcessor",
            ("csv", _) => "csvProcessor",
            ("code", _) => "codeAnalyzer",
            _ => throw new ToolExecutionException($"æ²¡æœ‰å¯ç”¨äº {contentType}/{operation} çš„å·¥å…·")
        };
    }

    private object GetOptionsForTool(string toolName, string operation)
    {
// ä¸ºæ¯ä¸ªä¸“ç”¨å·¥å…·è¿”å›é€‚å½“çš„é€‰é¡¹return toolName switch
        {
            "textSummarizer" => new { length = "medium" },
            "htmlProcessor" => new { cleanUp = true, operation },
// å…¶ä»–å·¥å…·çš„é€‰é¡¹...
            _ => { }
        };
    }
}

```

### **3. å¹¶è¡Œå¤„ç†æ¨¡å¼**

ä¸ºäº†æé«˜æ•ˆç‡ï¼ŒåŒæ—¶æ‰§è¡Œå¤šä¸ªå·¥å…·ï¼š

```java
public class ParallelDataProcessingWorkflow {
    private final McpClient mcpClient;

    public ParallelDataProcessingWorkflow(McpClient mcpClient) {
        this.mcpClient = mcpClient;
    }

    public WorkflowResult execute(String datasetId) {
// æ­¥éª¤ 1ï¼šè·å–æ•°æ®é›†å…ƒæ•°æ®ï¼ˆåŒæ­¥ï¼‰ToolResponse metadataResponse = mcpClient.executeTool("datasetMetadata",
            Map.of("datasetId", datasetId));

// æ­¥éª¤ 2ï¼šå¹¶è¡Œå¯åŠ¨å¤šä¸ªåˆ†æ
        CompletableFuture<ToolResponse> statisticalAnalysis = CompletableFuture.supplyAsync(() ->
            mcpClient.executeTool("statisticalAnalysis", Map.of(
                "datasetId", datasetId,
                "type", "comprehensive"
            ))
        );

        CompletableFuture<ToolResponse> correlationAnalysis = CompletableFuture.supplyAsync(() ->
            mcpClient.executeTool("correlationAnalysis", Map.of(
                "datasetId", datasetId,
                "method", "pearson"
            ))
        );

        CompletableFuture<ToolResponse> outlierDetection = CompletableFuture.supplyAsync(() ->
            mcpClient.executeTool("outlierDetection", Map.of(
                "datasetId", datasetId,
                "sensitivity", "medium"
            ))
        );

// ç­‰å¾…æ‰€æœ‰å¹¶è¡Œä»»åŠ¡å®Œæˆ
        CompletableFuture<Void> allAnalyses = CompletableFuture.allOf(
            statisticalAnalysis, correlationAnalysis, outlierDetection
        );

        allAnalyses.join();// ç­‰å¾…å®Œæˆ

// æ­¥éª¤ 3ï¼šåˆå¹¶ç»“æœ
        Map<String, Object> combinedResults = new HashMap<>();
        combinedResults.put("metadata", metadataResponse.getResult());
        combinedResults.put("statistics", statisticalAnalysis.join().getResult());
        combinedResults.put("correlations", correlationAnalysis.join().getResult());
        combinedResults.put("outliers", outlierDetection.join().getResult());

// æ­¥éª¤ 4ï¼šç”Ÿæˆæ‘˜è¦æŠ¥å‘ŠToolResponse summaryResponse = mcpClient.executeTool("reportGenerator",
            Map.of("analysisResults", combinedResults));

// è¿”å›å®Œæ•´çš„å·¥ä½œæµç»“æœWorkflowResult result = new WorkflowResult();
        result.setDatasetId(datasetId);
        result.setAnalysisResults(combinedResults);
        result.setSummaryReport(summaryResponse.getResult());

        return result;
    }
}

```

### **4. é”™è¯¯æ¢å¤æ¨¡å¼**

ä¸ºå·¥å…·æ•…éšœå®æ–½ä¼˜é›…çš„å›é€€ï¼š

```python
class ResilientWorkflow:
    def __init__(self, mcp_client):
        self.client = mcp_client

    async def execute_with_fallback(self, primary_tool, fallback_tool, parameters):
        try:
# é¦–å…ˆå°è¯•ä¸»å·¥å…·
            response = await self.client.execute_tool(primary_tool, parameters)
            return {
                "result": response.result,
                "source": "primary",
                "tool": primary_tool
            }
        except ToolExecutionException as e:
# è®°å½•å¤±è´¥
            logging.warning(f"ä¸»å·¥å…· '{primary_tool}' å¤±è´¥: {str(e)}")

# å›é€€åˆ°è¾…åŠ©å·¥å…·try:
# å¯èƒ½éœ€è¦ä¸ºå›é€€å·¥å…·è½¬æ¢å‚æ•°
                fallback_params = self._adapt_parameters(parameters, primary_tool, fallback_tool)

                response = await self.client.execute_tool(fallback_tool, fallback_params)
                return {
                    "result": response.result,
                    "source": "fallback",
                    "tool": fallback_tool,
                    "primaryError": str(e)
                }
            except ToolExecutionException as fallback_error:
# ä¸¤ä¸ªå·¥å…·éƒ½å¤±è´¥äº†
                logging.error(f"ä¸»å·¥å…·å’Œå›é€€å·¥å…·éƒ½å¤±è´¥äº†ã€‚å›é€€é”™è¯¯: {str(fallback_error)}")
                raise WorkflowExecutionException(
                    f"å·¥ä½œæµå¤±è´¥ï¼šä¸»é”™è¯¯: {str(e)}; å›é€€é”™è¯¯: {str(fallback_error)}"
                )

    def _adapt_parameters(self, params, from_tool, to_tool):
        """å¦‚æœéœ€è¦ï¼Œåœ¨ä¸åŒå·¥å…·ä¹‹é—´è°ƒæ•´å‚æ•°"""
# æ­¤å®ç°å°†å–å†³äºå…·ä½“çš„å·¥å…·# å¯¹äºæ­¤ç¤ºä¾‹ï¼Œæˆ‘ä»¬å°†åªè¿”å›åŸå§‹å‚æ•°return params

# ç”¨æ³•ç¤ºä¾‹async def get_weather(workflow, location):
    return await workflow.execute_with_fallback(
        "premiumWeatherService",# ä¸»ï¼ˆä»˜è´¹ï¼‰å¤©æ°” API"basicWeatherService",# å›é€€ï¼ˆå…è´¹ï¼‰å¤©æ°” API
        {"location": location}
    )

```

### **5. å·¥ä½œæµç»„åˆæ¨¡å¼**

é€šè¿‡ç»„åˆæ›´ç®€å•çš„å·¥ä½œæµæ¥æ„å»ºå¤æ‚çš„å·¥ä½œæµï¼š

```csharp
public class CompositeWorkflow : IWorkflow
{
    private readonly List<IWorkflow> _workflows;

    public CompositeWorkflow(IEnumerable<IWorkflow> workflows)
    {
        _workflows = new List<IWorkflow>(workflows);
    }

    public async Task<WorkflowResult> ExecuteAsync(WorkflowContext context)
    {
        var results = new Dictionary<string, object>();

        foreach (var workflow in _workflows)
        {
            var workflowResult = await workflow.ExecuteAsync(context);

// å­˜å‚¨æ¯ä¸ªå·¥ä½œæµçš„ç»“æœ
            results[workflow.Name] = workflowResult;

// ä½¿ç”¨ç»“æœæ›´æ–°ä¸Šä¸‹æ–‡ä»¥ç”¨äºä¸‹ä¸€ä¸ªå·¥ä½œæµ
            context = context.WithResult(workflow.Name, workflowResult);
        }

        return new WorkflowResult(results);
    }

    public string Name => "CompositeWorkflow";
    public string Description => "æŒ‰é¡ºåºæ‰§è¡Œå¤šä¸ªå·¥ä½œæµ";
}

// ç”¨æ³•ç¤ºä¾‹var documentWorkflow = new CompositeWorkflow(new IWorkflow[] {
    new DocumentFetchWorkflow(),
    new DocumentProcessingWorkflow(),
    new InsightGenerationWorkflow(),
    new ReportGenerationWorkflow()
});

var result = await documentWorkflow.ExecuteAsync(new WorkflowContext {
    Parameters = new { documentId = "12345" }
});

```

# **æµ‹è¯• MCP æœåŠ¡å™¨ï¼šæœ€ä½³å®è·µå’Œé‡è¦æç¤º**

## **æ¦‚è¿°**

æµ‹è¯•æ˜¯å¼€å‘å¯é ã€é«˜è´¨é‡ MCP æœåŠ¡å™¨çš„å…³é”®ç¯èŠ‚ã€‚æœ¬æŒ‡å—æä¾›äº†åœ¨æ•´ä¸ªå¼€å‘ç”Ÿå‘½å‘¨æœŸä¸­æµ‹è¯• MCP æœåŠ¡å™¨çš„å…¨é¢æœ€ä½³å®è·µå’ŒæŠ€å·§ï¼Œä»å•å…ƒæµ‹è¯•åˆ°é›†æˆæµ‹è¯•å’Œç«¯åˆ°ç«¯éªŒè¯ã€‚

## **ä¸ºä»€ä¹ˆæµ‹è¯•å¯¹ MCP æœåŠ¡å™¨å¾ˆé‡è¦**

MCP æœåŠ¡å™¨æ˜¯ AI æ¨¡å‹å’Œå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä¹‹é—´çš„å…³é”®ä¸­é—´ä»¶ã€‚å…¨é¢çš„æµ‹è¯•å¯ç¡®ä¿ï¼š

- åœ¨ç”Ÿäº§ç¯å¢ƒä¸­çš„å¯é æ€§
- å‡†ç¡®å¤„ç†è¯·æ±‚å’Œå“åº”
- æ­£ç¡®å®æ–½ MCP è§„
- åº”å¯¹æ•…éšœå’Œè¾¹ç¼˜æƒ…å†µçš„å¼¹æ€§
- åœ¨å„ç§è´Ÿè½½ä¸‹ä¿æŒä¸€è‡´çš„æ€§èƒ½

## **MCP æœåŠ¡å™¨çš„å•å…ƒæµ‹è¯•**

### **å•å…ƒæµ‹è¯•ï¼ˆåŸºç¡€ï¼‰**

å•å…ƒæµ‹è¯•å¯ç‹¬ç«‹éªŒè¯ MCP æœåŠ¡å™¨çš„å„ä¸ªç»„ä»¶ã€‚

### **æµ‹è¯•å†…å®¹**

1. **èµ„æºå¤„ç†ç¨‹åº**ï¼šç‹¬ç«‹æµ‹è¯•æ¯ä¸ªèµ„æºå¤„ç†ç¨‹åºçš„é€»è¾‘
2. **å·¥å…·å®ç°**ï¼šä½¿ç”¨å„ç§è¾“å…¥éªŒè¯å·¥å…·è¡Œä¸º
3. **æç¤ºæ¨¡æ¿**ï¼šç¡®ä¿æç¤ºæ¨¡æ¿æ­£ç¡®å‘ˆç°
4. **æ¨¡å¼éªŒè¯**ï¼šæµ‹è¯•å‚æ•°éªŒè¯é€»è¾‘
5. **é”™è¯¯å¤„ç†**ï¼šéªŒè¯æ— æ•ˆè¾“å…¥çš„é”™è¯¯å“åº”

### **å•å…ƒæµ‹è¯•æœ€ä½³å®è·µ**

```csharp
// C# ä¸­è®¡ç®—å™¨å·¥å…·çš„å•å…ƒæµ‹è¯•ç¤ºä¾‹
[Fact]
public async Task CalculatorTool_Add_ReturnsCorrectSum()
{
// å®‰æ’var calculator = new CalculatorTool();
    var parameters = new Dictionary<string, object>
    {
        ["operation"] = "add",
        ["a"] = 5,
        ["b"] = 7
    };

// æ“ä½œvar response = await calculator.ExecuteAsync(parameters);
    var result = JsonSerializer.Deserialize<CalculationResult>(response.Content[0].ToString());

// æ–­è¨€
    Assert.Equal(12, result.Value);
}

```

```python
# Python ä¸­è®¡ç®—å™¨å·¥å…·çš„å•å…ƒæµ‹è¯•ç¤ºä¾‹def test_calculator_tool_add():
# å®‰æ’
    calculator = CalculatorTool();
    parameters = {
        "operation": "add",
        "a": 5,
        "b": 7
    };

# æ“ä½œ
    response = calculator.execute(parameters);
    result = json.loads(response.content[0].text);

# æ–­è¨€assert result["value"] == 12

```

### **é›†æˆæµ‹è¯•ï¼ˆä¸­é—´å±‚ï¼‰**

é›†æˆæµ‹è¯•éªŒè¯ MCP æœåŠ¡å™¨ç»„ä»¶ä¹‹é—´çš„äº¤äº’ã€‚

### **æµ‹è¯•å†…å®¹**

1. **æœåŠ¡å™¨åˆå§‹åŒ–**ï¼šä½¿ç”¨å„ç§é…ç½®æµ‹è¯•æœåŠ¡å™¨å¯åŠ¨
2. **è·¯ç”±æ³¨å†Œ**ï¼šéªŒè¯æ‰€æœ‰ç«¯ç‚¹æ˜¯å¦æ­£ç¡®æ³¨å†Œ
3. **è¯·æ±‚å¤„ç†**ï¼šæµ‹è¯•å®Œæ•´çš„è¯·æ±‚-å“åº”å‘¨æœŸ
4. **é”™è¯¯ä¼ æ’­**ï¼šç¡®ä¿é”™è¯¯åœ¨ç»„ä»¶ä¹‹é—´å¾—åˆ°æ­£ç¡®å¤„ç†
5. **èº«ä»½éªŒè¯å’Œæˆæƒ**ï¼šæµ‹è¯•å®‰å…¨æœºåˆ¶

### **é›†æˆæµ‹è¯•æœ€ä½³å®è·µ**

```csharp
// C# ä¸­ MCP æœåŠ¡å™¨çš„é›†æˆæµ‹è¯•ç¤ºä¾‹
[Fact]
public async Task Server_ProcessToolRequest_ReturnsValidResponse()
{
// å®‰æ’var server = new McpServer();
    server.RegisterTool(new CalculatorTool());
    await server.StartAsync();

    var request = new McpRequest
    {
        Tool = "calculator",
        Parameters = new Dictionary<string, object>
        {
            ["operation"] = "multiply",
            ["a"] = 6,
            ["b"] = 7
        }
    };

// æ“ä½œvar response = await server.ProcessRequestAsync(request);

// æ–­è¨€
    Assert.NotNull(response);
    Assert.Equal(McpStatusCodes.Success, response.StatusCode);
// å¯¹å“åº”å†…å®¹çš„å…¶ä»–æ–­è¨€

// æ¸…ç†await server.StopAsync();
}

```

### **ç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆé¡¶å±‚ï¼‰**

ç«¯åˆ°ç«¯æµ‹è¯•éªŒè¯ä»å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨çš„å®Œæ•´ç³»ç»Ÿè¡Œä¸ºã€‚

### **æµ‹è¯•å†…å®¹**

1. **å®¢æˆ·ç«¯-æœåŠ¡å™¨é€šä¿¡**ï¼šæµ‹è¯•å®Œæ•´çš„è¯·æ±‚-å“åº”å‘¨æœŸ
2. **çœŸå®å®¢æˆ·ç«¯ SDK**ï¼šä½¿ç”¨å®é™…çš„å®¢æˆ·ç«¯å®ç°è¿›è¡Œæµ‹è¯•
3. **è´Ÿè½½ä¸‹çš„æ€§èƒ½**ï¼šéªŒè¯å¤šä¸ªå¹¶å‘è¯·æ±‚ä¸‹çš„è¡Œä¸º
4. **é”™è¯¯æ¢å¤**ï¼šæµ‹è¯•ç³»ç»Ÿä»æ•…éšœä¸­æ¢å¤çš„èƒ½åŠ›
5. **é•¿æ—¶é—´è¿è¡Œçš„æ“ä½œ**ï¼šéªŒè¯æµå¼å¤„ç†å’Œé•¿æ—¶é—´è¿è¡Œæ“ä½œçš„å¤„ç†

### **E2E æµ‹è¯•æœ€ä½³å®è·µ**

```tsx
// ä½¿ç”¨ TypeScript å®¢æˆ·ç«¯çš„ E2E æµ‹è¯•ç¤ºä¾‹describe('MCP Server E2E Tests', () => {
  let client: McpClient;

  beforeAll(async () => {
// åœ¨æµ‹è¯•ç¯å¢ƒä¸­å¯åŠ¨æœåŠ¡å™¨await startTestServer();
    client = new McpClient('http://localhost:5000');
  });

  afterAll(async () => {
    await stopTestServer();
  });

  test('å®¢æˆ·ç«¯å¯ä»¥è°ƒç”¨è®¡ç®—å™¨å·¥å…·å¹¶è·å¾—æ­£ç¡®çš„ç»“æœ', async () => {
// æ“ä½œconst response = await client.invokeToolAsync('calculator', {
      operation: 'divide',
      a: 20,
      b: 4
    });

// æ–­è¨€expect(response.statusCode).toBe(200);
    expect(response.content[0].text).toContain('5');
  });
});

```

## **MCP æµ‹è¯•çš„æ¨¡æ‹Ÿç­–ç•¥**

æ¨¡æ‹Ÿå¯¹äºåœ¨æµ‹è¯•æœŸé—´éš”ç¦»ç»„ä»¶è‡³å…³é‡è¦ã€‚

### **è¦æ¨¡æ‹Ÿçš„ç»„ä»¶**

1. **å¤–éƒ¨ AI æ¨¡å‹**ï¼šæ¨¡æ‹Ÿæ¨¡å‹å“åº”ä»¥è¿›è¡Œå¯é¢„æµ‹çš„æµ‹è¯•
2. **å¤–éƒ¨æœåŠ¡**ï¼šæ¨¡æ‹Ÿ API ä¾èµ–é¡¹ï¼ˆæ•°æ®åº“ã€ç¬¬ä¸‰æ–¹æœåŠ¡ï¼‰
3. **èº«ä»½éªŒè¯æœåŠ¡**ï¼šæ¨¡æ‹Ÿèº«ä»½æä¾›ç¨‹åº
4. **èµ„æºæä¾›ç¨‹åº**ï¼šæ¨¡æ‹Ÿæ˜‚è´µçš„èµ„æºå¤„ç†ç¨‹åº

### **ç¤ºä¾‹ï¼šæ¨¡æ‹Ÿ AI æ¨¡å‹å“åº”**

```csharp
// ä½¿ç”¨ Moq çš„ C# ç¤ºä¾‹var mockModel = new Mock<ILanguageModel>();
mockModel
    .Setup(m => m.GenerateResponseAsync(
        It.IsAny<string>(),
        It.IsAny<McpRequestContext>()))
    .ReturnsAsync(new ModelResponse {
        Text = "æ¨¡æ‹Ÿçš„æ¨¡å‹å“åº”",
        FinishReason = FinishReason.Completed
    });

var server = new McpServer(modelClient: mockModel.Object);

```

```python
# ä½¿ç”¨ unittest.mock çš„ Python ç¤ºä¾‹@patch('mcp_server.models.OpenAIModel')
def test_with_mock_model(mock_model):
# é…ç½®æ¨¡æ‹Ÿ
    mock_model.return_value.generate_response.return_value = {
        "text": "æ¨¡æ‹Ÿçš„æ¨¡å‹å“åº”",
        "finish_reason": "completed"
    };

# åœ¨æµ‹è¯•ä¸­ä½¿ç”¨æ¨¡æ‹Ÿ
    server = McpServer(model_client=mock_model);
# ç»§ç»­æµ‹è¯•
```

## **æ€§èƒ½æµ‹è¯•**

æ€§èƒ½æµ‹è¯•å¯¹äºç”Ÿäº§ MCP æœåŠ¡å™¨è‡³å…³é‡è¦ã€‚

### **æµ‹é‡å†…å®¹**

1. **å»¶è¿Ÿ**ï¼šè¯·æ±‚çš„å“åº”æ—¶é—´
2. **ååé‡**ï¼šæ¯ç§’å¤„ç†çš„è¯·æ±‚æ•°
3. **èµ„æºåˆ©ç”¨ç‡**ï¼šCPUã€å†…å­˜ã€ç½‘ç»œä½¿ç”¨æƒ…å†µ
4. **å¹¶å‘å¤„ç†**ï¼šå¹¶è¡Œè¯·æ±‚ä¸‹çš„è¡Œä¸º
5. **æ‰©å±•ç‰¹æ€§**ï¼šè´Ÿè½½å¢åŠ æ—¶çš„æ€§èƒ½

### **æ€§èƒ½æµ‹è¯•å·¥å…·**

- **k6**ï¼šå¼€æºè´Ÿè½½æµ‹è¯•å·¥å…·
- **JMeter**ï¼šå…¨é¢çš„æ€§èƒ½æµ‹è¯•
- **Locust**ï¼šåŸºäº Python çš„è´Ÿè½½æµ‹è¯•
- **Azure è´Ÿè½½æµ‹è¯•**ï¼šåŸºäºäº‘çš„æ€§èƒ½æµ‹è¯•

### **ç¤ºä¾‹ï¼šä½¿ç”¨ k6 è¿›è¡ŒåŸºæœ¬è´Ÿè½½æµ‹è¯•**

```jsx
// ç”¨äºå¯¹ MCP æœåŠ¡å™¨è¿›è¡Œè´Ÿè½½æµ‹è¯•çš„ k6 è„šæœ¬import http from 'k6/http';
import { check, sleep } from 'k6';

export const options = {
  vus: 10,// 10 ä¸ªè™šæ‹Ÿç”¨æˆ·duration: '30s',
};

export default function () {
  const payload = JSON.stringify({
    tool: 'calculator',
    parameters: {
      operation: 'add',
      a: Math.floor(Math.random() * 100),
      b: Math.floor(Math.random() * 100)
    }
  });

  const params = {
    headers: {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer test-token'
    },
  };

  const res = http.post('http://localhost:5000/api/tools/invoke', payload, params);

  check(res, {
    'status is 200': (r) => r.status === 200,
    'response time < 500ms': (r) => r.timings.duration < 500,
  });

  sleep(1);
}

```

## **MCP æœåŠ¡å™¨çš„æµ‹è¯•è‡ªåŠ¨åŒ–**

è‡ªåŠ¨åŒ–æµ‹è¯•å¯ç¡®ä¿ä¸€è‡´çš„è´¨é‡å’Œæ›´å¿«çš„åé¦ˆå¾ªç¯ã€‚

### **CI/CD é›†æˆ**

1. **åœ¨æ‹‰å–è¯·æ±‚ä¸Šè¿è¡Œå•å…ƒæµ‹è¯•**ï¼šç¡®ä¿ä»£ç æ›´æ”¹ä¸ä¼šç ´åç°æœ‰åŠŸèƒ½
2. **åœ¨æš‚å­˜ç¯å¢ƒä¸­è¿›è¡Œé›†æˆæµ‹è¯•**ï¼šåœ¨é¢„ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œé›†æˆæµ‹è¯•
3. **æ€§èƒ½åŸºå‡†**ï¼šç»´æŠ¤æ€§èƒ½åŸºå‡†ä»¥æ•è·å›å½’
4. **å®‰å…¨æ‰«æ**ï¼šå°†å®‰å…¨æµ‹è¯•è‡ªåŠ¨åŒ–ä¸ºç®¡é“çš„ä¸€éƒ¨åˆ†

### **CI ç®¡é“ç¤ºä¾‹ (GitHub Actions)**

```yaml
name: MCP æœåŠ¡å™¨æµ‹è¯•

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2

    - name: è®¾ç½®è¿è¡Œæ—¶
      uses: actions/setup-dotnet@v1
      with:
        dotnet-version: '8.0.x'

    - name: è¿˜åŸä¾èµ–é¡¹
      run: dotnet restore

    - name: æ„å»º
      run: dotnet build --no-restore

    - name: å•å…ƒæµ‹è¯•
      run: dotnet test --no-build --filter Category=Unit

    - name: é›†æˆæµ‹è¯•
      run: dotnet test --no-build --filter Category=Integration

    - name: æ€§èƒ½æµ‹è¯•
      run: dotnet run --project tests/PerformanceTests/PerformanceTests.csproj

```

## **æµ‹è¯•æ˜¯å¦ç¬¦åˆ MCP è§„èŒƒ**

éªŒè¯çš„æœåŠ¡å™¨æ˜¯å¦æ­£ç¡®å®æ–½äº† MCP è§„èŒƒã€‚

### **å…³é”®åˆè§„é¢†åŸŸ**

1. **API ç«¯ç‚¹**ï¼šæµ‹è¯•å¿…éœ€çš„ç«¯ç‚¹ï¼ˆ/resourcesã€/tools ç­‰ï¼‰
2. **è¯·æ±‚/å“åº”æ ¼å¼**ï¼šéªŒè¯æ¨¡å¼åˆè§„æ€§
3. **é”™è¯¯ä»£ç **ï¼šéªŒè¯å„ç§åœºæ™¯çš„æ­£ç¡®çŠ¶æ€ä»£ç 
4. **å†…å®¹ç±»å‹**ï¼šæµ‹è¯•ä¸åŒå†…å®¹ç±»å‹çš„å¤„ç†
5. **èº«ä»½éªŒè¯æµç¨‹**ï¼šéªŒè¯ç¬¦åˆè§„èŒƒçš„èº«ä»½éªŒè¯æœºåˆ¶

### **åˆè§„æ€§æµ‹è¯•å¥—ä»¶**

```csharp
[Fact]
public async Task Server_ResourceEndpoint_ReturnsCorrectSchema()
{
// å®‰æ’var client = new HttpClient();
    client.DefaultRequestHeaders.Add("Authorization", "Bearer test-token");

// æ“ä½œvar response = await client.GetAsync("http://localhost:5000/api/resources");
    var content = await response.Content.ReadAsStringAsync();
    var resources = JsonSerializer.Deserialize<ResourceList>(content);

// æ–­è¨€
    Assert.Equal(HttpStatusCode.OK, response.StatusCode);
    Assert.NotNull(resources);
    Assert.All(resources.Resources, resource =>
    {
        Assert.NotNull(resource.Id);
        Assert.NotNull(resource.Type);
// å…¶ä»–æ¨¡å¼éªŒè¯
    });
}

```

## **æœ‰æ•ˆ MCP æœåŠ¡å™¨æµ‹è¯•çš„ 10 å¤§æŠ€å·§**

1. **å•ç‹¬æµ‹è¯•å·¥å…·å®šä¹‰**ï¼šç‹¬ç«‹äºå·¥å…·é€»è¾‘éªŒè¯æ¨¡å¼å®šä¹‰
2. **ä½¿ç”¨å‚æ•°åŒ–æµ‹è¯•**ï¼šä½¿ç”¨å„ç§è¾“å…¥ï¼ˆåŒ…æ‹¬è¾¹ç¼˜æƒ…å†µï¼‰æµ‹è¯•å·¥å…·
3. **æ£€æŸ¥é”™è¯¯å“åº”**ï¼šéªŒè¯æ‰€æœ‰å¯èƒ½é”™è¯¯æ¡ä»¶çš„æ­£ç¡®é”™è¯¯å¤„ç†
4. **æµ‹è¯•æˆæƒé€»è¾‘**ï¼šç¡®ä¿å¯¹ä¸åŒç”¨æˆ·è§’è‰²çš„æ­£ç¡®è®¿é—®æ§åˆ¶
5. **ç›‘æ§æµ‹è¯•è¦†ç›–ç‡**ï¼šåŠ›æ±‚å…³é”®è·¯å¾„ä»£ç çš„é«˜è¦†ç›–ç‡
6. **æµ‹è¯•æµå¼å“åº”**ï¼šéªŒè¯æµå¼å†…å®¹çš„æ­£ç¡®å¤„ç†
7. **æ¨¡æ‹Ÿç½‘ç»œé—®é¢˜**ï¼šåœ¨æ¶åŠ£çš„ç½‘ç»œæ¡ä»¶ä¸‹æµ‹è¯•è¡Œä¸º
8. **æµ‹è¯•èµ„æºé™åˆ¶**ï¼šéªŒè¯è¾¾åˆ°é…é¢æˆ–é€Ÿç‡é™åˆ¶æ—¶çš„è¡Œä¸º
9. **è‡ªåŠ¨åŒ–å›å½’æµ‹è¯•**ï¼šæ„å»ºä¸€ä¸ªåœ¨æ¯æ¬¡ä»£ç æ›´æ”¹æ—¶è¿è¡Œçš„å¥—ä»¶
10. **è®°å½•æµ‹è¯•ç”¨ä¾‹**ï¼šç»´æŠ¤æ¸…æ™°çš„æµ‹è¯•åœºæ™¯æ–‡æ¡£

## **å¸¸è§çš„æµ‹è¯•é™·é˜±**

- **è¿‡åº¦ä¾èµ–â€œæ­£å¸¸è·¯å¾„â€æµ‹è¯•**ï¼šç¡®ä¿å½»åº•æµ‹è¯•é”™è¯¯æƒ…å†µ
- **å¿½ç•¥æ€§èƒ½æµ‹è¯•**ï¼šåœ¨å½±å“ç”Ÿäº§ä¹‹å‰è¯†åˆ«ç“¶é¢ˆ
- **ä»…åœ¨éš”ç¦»ç¯å¢ƒä¸­æµ‹è¯•**ï¼šç»“åˆå•å…ƒã€é›†æˆå’Œ E2E æµ‹è¯•
- **API è¦†ç›–ä¸å®Œæ•´**ï¼šç¡®ä¿æµ‹è¯•æ‰€æœ‰ç«¯ç‚¹å’ŒåŠŸèƒ½
- **æµ‹è¯•ç¯å¢ƒä¸ä¸€è‡´**ï¼šä½¿ç”¨å®¹å™¨ç¡®ä¿ä¸€è‡´çš„æµ‹è¯•ç¯å¢ƒ

## **ç»“è®º**

å…¨é¢çš„æµ‹è¯•ç­–ç•¥å¯¹äºå¼€å‘å¯é ã€é«˜è´¨é‡çš„ MCP æœåŠ¡å™¨è‡³å…³é‡è¦ã€‚é€šè¿‡å®æ–½æœ¬æŒ‡å—ä¸­æ¦‚è¿°çš„æœ€ä½³å®è·µå’ŒæŠ€å·§ï¼Œå¯ä»¥ç¡®ä¿çš„ MCP å®æ–½ç¬¦åˆæœ€é«˜çš„è´¨é‡ã€å¯é æ€§å’Œæ€§èƒ½æ ‡å‡†ã€‚

## **å…³é”®è¦ç‚¹**

1. **å·¥å…·è®¾è®¡**ï¼šéµå¾ªå•ä¸€èŒè´£åŸåˆ™ï¼Œä½¿ç”¨ä¾èµ–æ³¨å…¥ï¼Œå¹¶ä¸ºå¯ç»„åˆæ€§è¿›è¡Œè®¾è®¡
2. **æ¨¡å¼è®¾è®¡**ï¼šåˆ›å»ºå…·æœ‰é€‚å½“éªŒè¯çº¦æŸçš„æ¸…æ™°ã€æ–‡æ¡£é½å…¨çš„æ¨¡å¼
3. **é”™è¯¯å¤„ç†**ï¼šå®æ–½ä¼˜é›…çš„é”™è¯¯å¤„ç†ã€ç»“æ„åŒ–çš„é”™è¯¯å“åº”å’Œé‡è¯•é€»è¾‘
4. **æ€§èƒ½**ï¼šä½¿ç”¨ç¼“å­˜ã€å¼‚æ­¥å¤„ç†å’Œèµ„æºé™åˆ¶
5. **å®‰å…¨**ï¼šåº”ç”¨å½»åº•çš„è¾“å…¥éªŒè¯ã€æˆæƒæ£€æŸ¥å’Œæ•æ„Ÿæ•°æ®å¤„ç†
6. **æµ‹è¯•**ï¼šåˆ›å»ºå…¨é¢çš„å•å…ƒã€é›†æˆå’Œç«¯åˆ°ç«¯æµ‹è¯•
7. **å·¥ä½œæµæ¨¡å¼**ï¼šåº”ç”¨æ—¢å®šçš„æ¨¡å¼ï¼Œå¦‚é“¾ã€è°ƒåº¦ç¨‹åºå’Œå¹¶è¡Œå¤„ç†

# **09-MCP æ¡ˆä¾‹ç ”ç©¶**

## **ç‰¹è‰²æ¡ˆä¾‹ç ”ç©¶**

### **1.Â Azure AI æ—…è¡Œç¤¾ â€“ å‚è€ƒå®ç°**

æœ¬æ¡ˆä¾‹ç ”ç©¶æ¢è®¨äº†å¾®è½¯çš„ç»¼åˆå‚è€ƒè§£å†³æ–¹æ¡ˆï¼Œè¯¥è§£å†³æ–¹æ¡ˆæ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ MCPã€Azure OpenAI å’Œ Azure AI æœç´¢æ„å»ºä¸€ä¸ªå¤šä»£ç†ã€AI é©±åŠ¨çš„æ—…è¡Œè®¡åˆ’åº”ç”¨ç¨‹åºã€‚è¯¥é¡¹ç›®å±•ç¤ºäº†ï¼š

- é€šè¿‡ MCP è¿›è¡Œå¤šä»£ç†ç¼–æ’
- ä¸ Azure AI æœç´¢çš„ä¼ä¸šæ•°æ®é›†æˆ
- ä½¿ç”¨ Azure æœåŠ¡çš„å®‰å…¨ã€å¯æ‰©å±•çš„æ¶æ„
- å¸¦æœ‰å¯é‡ç”¨ MCP ç»„ä»¶çš„å¯æ‰©å±•å·¥å…·
- ç”± Azure OpenAI æä¾›æ”¯æŒçš„å¯¹è¯å¼ç”¨æˆ·ä½“éªŒ

æ¶æ„å’Œå®æ–½ç»†èŠ‚ä¸ºä½¿ç”¨ MCP ä½œä¸ºåè°ƒå±‚æ„å»ºå¤æ‚çš„å¤šä»£ç†ç³»ç»Ÿæä¾›äº†å®è´µçš„è§è§£ã€‚

### **2.Â ä» YouTube æ•°æ®æ›´æ–° Azure DevOps å·¥ä½œé¡¹**

æœ¬æ¡ˆä¾‹ç ”ç©¶æ¼”ç¤ºäº† MCP åœ¨è‡ªåŠ¨åŒ–å·¥ä½œæµæµç¨‹æ–¹é¢çš„å®é™…åº”ç”¨ã€‚å®ƒå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ MCP å·¥å…·æ¥ï¼š

- ä»åœ¨çº¿å¹³å° (YouTube) æå–æ•°æ®
- æ›´æ–° Azure DevOps ç³»ç»Ÿä¸­çš„å·¥ä½œé¡¹
- åˆ›å»ºå¯é‡å¤çš„è‡ªåŠ¨åŒ–å·¥ä½œæµ
- é›†æˆä¸åŒç³»ç»Ÿä¹‹é—´çš„æ•°æ®

æ­¤ç¤ºä¾‹è¯´æ˜äº†å³ä½¿æ˜¯ç›¸å¯¹ç®€å•çš„ MCP å®æ–½ä¹Ÿå¯ä»¥é€šè¿‡è‡ªåŠ¨åŒ–å¸¸è§„ä»»åŠ¡å’Œæé«˜è·¨ç³»ç»Ÿæ•°æ®çš„ä¸€è‡´æ€§æ¥æ˜¾ç€æé«˜æ•ˆç‡ã€‚

### **3.Â ä½¿ç”¨ MCP è¿›è¡Œå®æ—¶æ–‡æ¡£æ£€ç´¢**

æœ¬æ¡ˆä¾‹ç ”ç©¶å°†æŒ‡å¯¼å°† Python æ§åˆ¶å°å®¢æˆ·ç«¯è¿æ¥åˆ°æ¨¡å‹ä¸Šä¸‹æ–‡åè®® (MCP) æœåŠ¡å™¨ï¼Œä»¥æ£€ç´¢å’Œè®°å½•å®æ—¶ã€ä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„ Microsoft æ–‡æ¡£ã€‚å°†å­¦ä¹ å¦‚ä½•ï¼š

- ä½¿ç”¨ Python å®¢æˆ·ç«¯å’Œå®˜æ–¹ MCP SDK è¿æ¥åˆ° MCP æœåŠ¡å™¨
- ä½¿ç”¨æµå¼ HTTP å®¢æˆ·ç«¯è¿›è¡Œé«˜æ•ˆã€å®æ—¶çš„æ•°æ®æ£€ç´¢
- åœ¨æœåŠ¡å™¨ä¸Šè°ƒç”¨æ–‡æ¡£å·¥å…·å¹¶å°†å“åº”ç›´æ¥è®°å½•åˆ°æ§åˆ¶å°
- æ— éœ€ç¦»å¼€ç»ˆç«¯å³å¯å°†æœ€æ–°çš„ Microsoft æ–‡æ¡£é›†æˆåˆ°çš„å·¥ä½œæµä¸­

### **4.Â ä½¿ç”¨ MCP çš„äº¤äº’å¼å­¦ä¹ è®¡åˆ’ç”Ÿæˆå™¨ Web åº”ç”¨**

æœ¬æ¡ˆä¾‹ç ”ç©¶æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Chainlit å’Œæ¨¡å‹ä¸Šä¸‹æ–‡åè®® (MCP) æ„å»ºä¸€ä¸ªäº¤äº’å¼ Web åº”ç”¨ç¨‹åºï¼Œä¸ºä»»ä½•ä¸»é¢˜ç”Ÿæˆä¸ªæ€§åŒ–çš„å­¦ä¹ è®¡åˆ’ã€‚ç”¨æˆ·å¯ä»¥æŒ‡å®šä¸€ä¸ªä¸»é¢˜ï¼ˆä¾‹å¦‚â€œAI-900 è®¤è¯â€ï¼‰å’Œä¸€ä¸ªå­¦ä¹ æ—¶é•¿ï¼ˆä¾‹å¦‚ 8 å‘¨ï¼‰ï¼Œåº”ç”¨ç¨‹åºå°†æä¾›æ¯å‘¨æ¨èå†…å®¹çš„ç»†åˆ†ã€‚Chainlit æ”¯æŒå¯¹è¯å¼èŠå¤©ç•Œé¢ï¼Œä½¿ä½“éªŒå¼•äººå…¥èƒœä¸”å…·æœ‰é€‚åº”æ€§ã€‚

- ç”± Chainlit æä¾›æ”¯æŒçš„å¯¹è¯å¼ Web åº”ç”¨
- ç”¨æˆ·é©±åŠ¨çš„æœ‰å…³ä¸»é¢˜å’Œæ—¶é•¿çš„æç¤º
- ä½¿ç”¨ MCP çš„æ¯å‘¨å†…å®¹æ¨è
- åœ¨èŠå¤©ç•Œé¢ä¸­æä¾›å®æ—¶ã€è‡ªé€‚åº”çš„å“åº”

è¯¥é¡¹ç›®è¯´æ˜äº†å¦‚ä½•å°†å¯¹è¯å¼ AI å’Œ MCP ç›¸ç»“åˆï¼Œåœ¨ç°ä»£ Web ç¯å¢ƒä¸­åˆ›å»ºåŠ¨æ€ã€ç”¨æˆ·é©±åŠ¨çš„æ•™è‚²å·¥å…·ã€‚

### **5.Â åœ¨ VS Code ä¸­ä½¿ç”¨ MCP æœåŠ¡å™¨çš„ç¼–è¾‘å™¨å†…æ–‡æ¡£**

æœ¬æ¡ˆä¾‹ç ”ç©¶æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ MCP æœåŠ¡å™¨å°† Microsoft Learn æ–‡æ¡£ç›´æ¥å¼•å…¥çš„ VS Code ç¯å¢ƒâ€”â€”å†ä¹Ÿä¸ç”¨åˆ‡æ¢æµè§ˆå™¨é€‰é¡¹å¡äº†ï¼å°†çœ‹åˆ°å¦‚ä½•ï¼š

- ä½¿ç”¨ MCP é¢æ¿æˆ–å‘½ä»¤é¢æ¿åœ¨ VS Code ä¸­å³æ—¶æœç´¢å’Œé˜…è¯»æ–‡æ¡£
- ç›´æ¥åœ¨çš„è‡ªè¿°æ–‡ä»¶æˆ–è¯¾ç¨‹é™ä»·æ–‡ä»¶ä¸­å¼•ç”¨æ–‡æ¡£å¹¶æ’å…¥é“¾æ¥
- å°† GitHub Copilot å’Œ MCP ç»“åˆä½¿ç”¨ï¼Œå®ç°æ— ç¼ã€AI é©±åŠ¨çš„æ–‡æ¡£å’Œä»£ç å·¥ä½œæµ
- é€šè¿‡å®æ—¶åé¦ˆå’Œ Microsoft æä¾›çš„å‡†ç¡®æ€§æ¥éªŒè¯å’Œå¢å¼ºçš„æ–‡æ¡£
- å°† MCP ä¸ GitHub å·¥ä½œæµé›†æˆä»¥è¿›è¡ŒæŒç»­çš„æ–‡æ¡£éªŒè¯

å®æ–½åŒ…æ‹¬ï¼š

- ç”¨äºè½»æ¾è®¾ç½®çš„ç¤ºä¾‹Â `.vscode/mcp.json`Â é…ç½®
- åŸºäºå±å¹•æˆªå›¾çš„ç¼–è¾‘å™¨å†…ä½“éªŒæ¼”ç»ƒ
- ç»“åˆä½¿ç”¨ Copilot å’Œ MCP ä»¥å®ç°æœ€é«˜ç”Ÿäº§åŠ›çš„æŠ€å·§

æ­¤åœºæ™¯éå¸¸é€‚åˆå¸Œæœ›åœ¨ç¼–è¾‘å™¨ä¸­ä¸“æ³¨äºå¤„ç†æ–‡æ¡£ã€Copilot å’ŒéªŒè¯å·¥å…·çš„è¯¾ç¨‹ä½œè€…ã€æ–‡æ¡£ç¼–å†™è€…å’Œå¼€å‘äººå‘˜â€”â€”æ‰€æœ‰è¿™äº›éƒ½ç”± MCP æä¾›æ”¯æŒã€‚

### **6.Â åˆ›å»º APIM MCP æœåŠ¡å™¨**

æœ¬æ¡ˆä¾‹ç ”ç©¶æä¾›äº†æœ‰å…³å¦‚ä½•ä½¿ç”¨ Azure API ç®¡ç† (APIM) åˆ›å»º MCP æœåŠ¡å™¨çš„åˆ†æ­¥æŒ‡å—ã€‚å®ƒæ¶µç›–äº†ï¼š

- åœ¨ Azure API ç®¡ç†ä¸­è®¾ç½® MCP æœåŠ¡å™¨
- å°† API æ“ä½œå…¬å¼€ä¸º MCP å·¥å…·
- é…ç½®é€Ÿç‡é™åˆ¶å’Œå®‰å…¨ç­–ç•¥
- ä½¿ç”¨ Visual Studio Code å’Œ GitHub Copilot æµ‹è¯• MCP æœåŠ¡å™¨

æ­¤ç¤ºä¾‹è¯´æ˜äº†å¦‚ä½•åˆ©ç”¨ Azure çš„åŠŸèƒ½æ¥åˆ›å»ºä¸€ä¸ªå¼ºå¤§çš„ MCP æœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨å¯ç”¨äºå„ç§åº”ç”¨ç¨‹åºï¼Œä»è€Œå¢å¼º AI ç³»ç»Ÿä¸ä¼ä¸š API çš„é›†æˆã€‚

## **ç»“è®º**

è¿™äº›æ¡ˆä¾‹ç ”ç©¶çªå‡ºäº†æ¨¡å‹ä¸Šä¸‹æ–‡åè®®åœ¨çœŸå®ä¸–ç•Œåœºæ™¯ä¸­çš„å¤šåŠŸèƒ½æ€§å’Œå®é™…åº”ç”¨ã€‚ä»å¤æ‚çš„å¤šä»£ç†ç³»ç»Ÿåˆ°æœ‰é’ˆå¯¹æ€§çš„è‡ªåŠ¨åŒ–å·¥ä½œæµï¼ŒMCP æä¾›äº†ä¸€ç§æ ‡å‡†åŒ–çš„æ–¹å¼æ¥å°† AI ç³»ç»Ÿä¸å®ƒä»¬æä¾›ä»·å€¼æ‰€éœ€çš„å·¥å…·å’Œæ•°æ®è¿æ¥èµ·æ¥ã€‚

é€šè¿‡ç ”ç©¶è¿™äº›å®æ–½ï¼Œå¯ä»¥æ·±å…¥äº†è§£å¯åº”ç”¨äºè‡ªå·±çš„ MCP é¡¹ç›®çš„æ¶æ„æ¨¡å¼ã€å®æ–½ç­–ç•¥å’Œæœ€ä½³å®è·µã€‚è¿™äº›ç¤ºä¾‹è¡¨æ˜ï¼ŒMCP ä¸ä»…ä»…æ˜¯ä¸€ä¸ªç†è®ºæ¡†æ¶ï¼Œè€Œä¸”æ˜¯è§£å†³å®é™…ä¸šåŠ¡æŒ‘æˆ˜çš„å®ç”¨è§£å†³æ–¹æ¡ˆã€‚

# **10-ç®€åŒ– AI å·¥ä½œæµç¨‹ï¼šä½¿ç”¨ AI å·¥å…·åŒ…æ„å»º MCP æœåŠ¡å™¨**

## Lab-1

### **ğŸ§  AI å·¥å…·åŒ… (AITK) ç®€ä»‹**

**Visual Studio Code çš„ AI å·¥å…·åŒ…**Â æ˜¯å¾®è½¯çš„æ——èˆ°æ‰©å±•ï¼Œå®ƒå°† VS Code è½¬å˜ä¸ºä¸€ä¸ªå…¨é¢çš„äººå·¥æ™ºèƒ½å¼€å‘ç¯å¢ƒã€‚å®ƒå¼¥åˆäº†äººå·¥æ™ºèƒ½ç ”ç©¶ä¸å®é™…åº”ç”¨å¼€å‘ä¹‹é—´çš„å·®è·ï¼Œä½¿å„ç§æŠ€èƒ½æ°´å¹³çš„å¼€å‘äººå‘˜éƒ½èƒ½ä½¿ç”¨ç”Ÿæˆå¼äººå·¥æ™ºèƒ½ã€‚

### **ğŸŒŸ å…³é”®åŠŸèƒ½**

| åŠŸèƒ½ | æè¿° | ç”¨ä¾‹ |
| --- | --- | --- |
| **ğŸ—‚ï¸ æ¨¡å‹ç›®å½•** | è®¿é—®æ¥è‡ª GitHubã€ONNXã€OpenAIã€Anthropicã€Google çš„ 100 å¤šä¸ªæ¨¡å‹ | æ¨¡å‹å‘ç°å’Œé€‰æ‹© |
| **ğŸ”Œ BYOM æ”¯æŒ** | é›†æˆè‡ªå·±çš„æ¨¡å‹ï¼ˆæœ¬åœ°/è¿œç¨‹ï¼‰ | è‡ªå®šä¹‰æ¨¡å‹éƒ¨ç½² |
| **ğŸ® äº¤äº’å¼ Playground** | é€šè¿‡èŠå¤©ç•Œé¢è¿›è¡Œå®æ—¶æ¨¡å‹æµ‹è¯• | å¿«é€ŸåŸå‹è®¾è®¡å’Œæµ‹è¯• |
| **ğŸ“ å¤šæ¨¡æ€æ”¯æŒ** | å¤„ç†æ–‡æœ¬ã€å›¾åƒå’Œé™„ä»¶ | å¤æ‚çš„äººå·¥æ™ºèƒ½åº”ç”¨ |
| **âš¡ æ‰¹é‡å¤„ç†** | åŒæ—¶è¿è¡Œå¤šä¸ªæç¤º | é«˜æ•ˆçš„æµ‹è¯•å·¥ä½œæµ |
| **ğŸ“Š æ¨¡å‹è¯„ä¼°** | å†…ç½®æŒ‡æ ‡ï¼ˆF1ã€ç›¸å…³æ€§ã€ç›¸ä¼¼æ€§ã€è¿è´¯æ€§ï¼‰ | æ€§èƒ½è¯„ä¼° |

### **ğŸ¯ AI å·¥å…·åŒ…ä¸ºä½•é‡è¦**

- **ğŸš€ åŠ é€Ÿå¼€å‘**ï¼šåœ¨å‡ åˆ†é’Ÿå†…ä»æƒ³æ³•åˆ°åŸå‹
- **ğŸ”„ ç»Ÿä¸€å·¥ä½œæµ**ï¼šä¸€ä¸ªç•Œé¢é€‚ç”¨äºå¤šä¸ª AI æä¾›å•†
- **ğŸ§ª è½»æ¾å®éªŒ**ï¼šæ— éœ€å¤æ‚è®¾ç½®å³å¯æ¯”è¾ƒæ¨¡å‹
- **ğŸ“ˆ ç”Ÿäº§å°±ç»ª**ï¼šä»åŸå‹åˆ°éƒ¨ç½²çš„æ— ç¼è¿‡æ¸¡

### **ğŸ› ï¸ å…ˆå†³æ¡ä»¶å’Œè®¾ç½®**

### **ğŸ“¦ å®‰è£… AI å·¥å…·åŒ…æ‰©å±•**

**æ­¥éª¤ 1ï¼šè®¿é—®æ‰©å±•å¸‚åœº**

1. æ‰“å¼€ Visual Studio Code
2. å¯¼èˆªåˆ°æ‰©å±•è§†å›¾ï¼ˆ`Ctrl+Shift+X`Â æˆ–Â `Cmd+Shift+X`ï¼‰
3. æœç´¢ "AI Toolkit"

**æ­¥éª¤ 2ï¼šé€‰æ‹©çš„ç‰ˆæœ¬**

- **ğŸŸ¢ å‘å¸ƒç‰ˆ**ï¼šå»ºè®®ç”¨äºç”Ÿäº§ç¯å¢ƒ
- **ğŸ”¶ é¢„å‘å¸ƒç‰ˆ**ï¼šæŠ¢å…ˆä½“éªŒå‰æ²¿åŠŸèƒ½

**æ­¥éª¤ 3ï¼šå®‰è£…å¹¶æ¿€æ´»**

![image.png](../images/mcp_image_10.png)

### **ğŸ§ª åŠ¨æ‰‹ç»ƒä¹  1ï¼šæ¢ç´¢ GitHub æ¨¡å‹**

**ğŸ¯ ç›®æ ‡**ï¼šæŒæ¡æ¨¡å‹ç›®å½•å¹¶æµ‹è¯•çš„ç¬¬ä¸€ä¸ª AI æ¨¡å‹

### **ğŸ“Š æ­¥éª¤ 1ï¼šæµè§ˆæ¨¡å‹ç›®å½•**

æ¨¡å‹ç›®å½•æ˜¯é€šå¾€ AI ç”Ÿæ€ç³»ç»Ÿçš„é—¨æˆ·ã€‚å®ƒèšåˆäº†æ¥è‡ªå¤šä¸ªæä¾›å•†çš„æ¨¡å‹ï¼Œä½¿å‘ç°å’Œæ¯”è¾ƒé€‰é¡¹å˜å¾—å®¹æ˜“ã€‚

**ğŸ” å¯¼èˆªæŒ‡å—ï¼š**

åœ¨ AI å·¥å…·åŒ…ä¾§è¾¹æ ä¸­ç‚¹å‡»Â **MODELS - Catalog**

![image.png](../images/mcp_image_11.png)

**ğŸ’¡ ä¸“ä¸šæç¤º**ï¼šå¯»æ‰¾å…·æœ‰ä¸çš„ç”¨ä¾‹ç›¸åŒ¹é…çš„ç‰¹å®šåŠŸèƒ½çš„æ¨¡å‹ï¼ˆä¾‹å¦‚ï¼Œä»£ç ç”Ÿæˆã€åˆ›æ„å†™ä½œã€åˆ†æï¼‰ã€‚

**âš ï¸ æ³¨æ„**ï¼šGitHub æ‰˜ç®¡çš„æ¨¡å‹ï¼ˆå³ GitHub æ¨¡å‹ï¼‰å¯å…è´¹ä½¿ç”¨ï¼Œä½†è¯·æ±‚å’Œä»¤ç‰Œæœ‰é€Ÿç‡é™åˆ¶ã€‚å¦‚æœæƒ³è®¿é—®é GitHub æ¨¡å‹ï¼ˆå³é€šè¿‡ Azure AI æˆ–å…¶ä»–ç«¯ç‚¹æ‰˜ç®¡çš„å¤–éƒ¨æ¨¡å‹ï¼‰ï¼Œåˆ™éœ€è¦æä¾›ç›¸åº”çš„ API å¯†é’¥æˆ–èº«ä»½éªŒè¯ã€‚

### **ğŸš€ æ­¥éª¤ 2ï¼šæ·»åŠ å’Œé…ç½®çš„ç¬¬ä¸€ä¸ªæ¨¡å‹**

**æ¨¡å‹é€‰æ‹©ç­–ç•¥ï¼š**

- **GPT-4.1**ï¼šæœ€é€‚åˆå¤æ‚çš„æ¨ç†å’Œåˆ†æ
- **Phi-4-mini**ï¼šè½»é‡çº§ï¼Œé€‚ç”¨äºç®€å•ä»»åŠ¡çš„å¿«é€Ÿå“åº”

**ğŸ”§ é…ç½®è¿‡ç¨‹ï¼š**

1. ä»ç›®å½•ä¸­é€‰æ‹©Â **OpenAI GPT-4.1**
2. ç‚¹å‡»Â **Add to My Models**Â - è¿™å°†æ³¨å†Œæ¨¡å‹ä»¥ä¾›ä½¿ç”¨
3. é€‰æ‹©Â **Try in Playground**Â å¯åŠ¨æµ‹è¯•ç¯å¢ƒ
4. ç­‰å¾…æ¨¡å‹åˆå§‹åŒ–ï¼ˆé¦–æ¬¡è®¾ç½®å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ï¼‰

![image.png](../images/mcp_image_12.png)

**âš™ï¸ ç†è§£æ¨¡å‹å‚æ•°ï¼š**

- **Temperature**ï¼šæ§åˆ¶åˆ›é€ åŠ›ï¼ˆ0 = ç¡®å®šæ€§ï¼Œ1 = åˆ›é€ æ€§ï¼‰
- **Max Tokens**ï¼šæœ€å¤§å“åº”é•¿åº¦
- **Top-p**ï¼šç”¨äºå“åº”å¤šæ ·æ€§çš„æ ¸å¿ƒé‡‡æ ·

### **ğŸ¯ æ­¥éª¤ 3ï¼šæŒæ¡ Playground ç•Œé¢**

Playground æ˜¯çš„ AI å®éªŒå®éªŒå®¤ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•æœ€å¤§é™åº¦åœ°å‘æŒ¥å…¶æ½œåŠ›ï¼š

**ğŸ¨ æç¤ºå·¥ç¨‹æœ€ä½³å®è·µï¼š**

1. **å…·ä½“**ï¼šæ¸…æ™°ã€è¯¦ç»†çš„æŒ‡ä»¤ä¼šäº§ç”Ÿæ›´å¥½çš„ç»“æœ
2. **æä¾›ä¸Šä¸‹æ–‡**ï¼šåŒ…å«ç›¸å…³çš„èƒŒæ™¯ä¿¡æ¯
3. **ä½¿ç”¨ç¤ºä¾‹**ï¼šé€šè¿‡ç¤ºä¾‹å‘æ¨¡å‹å±•ç¤ºæƒ³è¦ä»€ä¹ˆ
4. **è¿­ä»£**ï¼šæ ¹æ®åˆæ­¥ç»“æœä¼˜åŒ–æç¤º

**ğŸ§ª æµ‹è¯•åœºæ™¯ï¼š**

```markdown
# ç¤ºä¾‹ 1ï¼šä»£ç ç”Ÿæˆ
"ç¼–å†™ä¸€ä¸ªä½¿ç”¨é€’å½’è®¡ç®—æ•°å­—é˜¶ä¹˜çš„ Python å‡½æ•°ã€‚åŒ…æ‹¬é”™è¯¯å¤„ç†å’Œæ–‡æ¡£å­—ç¬¦ä¸²ã€‚"

# ç¤ºä¾‹ 2ï¼šåˆ›æ„å†™ä½œ
"å†™ä¸€å°ä¸“ä¸šçš„ç”µå­é‚®ä»¶ç»™å®¢æˆ·ï¼Œè§£é‡Šé¡¹ç›®å»¶è¿Ÿï¼Œåœ¨ä¿æŒç§¯æåŸºè°ƒçš„åŒæ—¶ï¼Œå¦è¯šåœ°è¯´æ˜æŒ‘æˆ˜ã€‚"

# ç¤ºä¾‹ 3ï¼šæ•°æ®åˆ†æ
"åˆ†ææ­¤é”€å”®æ•°æ®å¹¶æä¾›è§è§£ï¼š[ç²˜è´´çš„æ•°æ®]ã€‚é‡ç‚¹å…³æ³¨è¶‹åŠ¿ã€å¼‚å¸¸å’Œå¯è¡Œçš„å»ºè®®ã€‚"
```

![image.png](../images/mcp_image_13.png)

### **ğŸ† æŒ‘æˆ˜ç»ƒä¹ ï¼šæ¨¡å‹æ€§èƒ½æ¯”è¾ƒ**

**ğŸ¯ ç›®æ ‡**ï¼šä½¿ç”¨ç›¸åŒçš„æç¤ºæ¯”è¾ƒä¸åŒæ¨¡å‹ï¼Œä»¥äº†è§£å®ƒä»¬çš„ä¼˜åŠ¿

**ğŸ“‹ è¯´æ˜ï¼š**

1. å°†Â **Phi-4-mini**Â æ·»åŠ åˆ°çš„å·¥ä½œåŒº
2. å¯¹ GPT-4.1 å’Œ Phi-4-mini ä½¿ç”¨ç›¸åŒçš„æç¤º

![image.png](../images/mcp_image_14.png)

1. æ¯”è¾ƒå“åº”è´¨é‡ã€é€Ÿåº¦å’Œå‡†ç¡®æ€§
2. åœ¨ç»“æœéƒ¨åˆ†è®°å½•çš„å‘ç°

![image.png](../images/mcp_image_15.png)

**ğŸ’¡ å¾…å‘ç°çš„å…³é”®è§è§£ï¼š**

- ä½•æ—¶ä½¿ç”¨ LLM vs SLM
- æˆæœ¬ä¸æ€§èƒ½çš„æƒè¡¡
- ä¸åŒæ¨¡å‹çš„ä¸“ä¸šèƒ½åŠ›

## **ğŸ¤– åŠ¨æ‰‹ç»ƒä¹  2ï¼šä½¿ç”¨ Agent Builder æ„å»ºè‡ªå®šä¹‰ä»£ç†**

**ğŸ¯ ç›®æ ‡**ï¼šåˆ›å»ºé’ˆå¯¹ç‰¹å®šä»»åŠ¡å’Œå·¥ä½œæµçš„ä¸“ç”¨ AI ä»£ç†

### **ğŸ—ï¸ æ­¥éª¤ 1ï¼šç†è§£ Agent Builder**

Agent Builder æ˜¯ AI å·¥å…·åŒ…çœŸæ­£é—ªè€€çš„åœ°æ–¹ã€‚å®ƒå…è®¸åˆ›å»ºä¸“ç”¨çš„ AI åŠ©æ‰‹ï¼Œå°†å¤§å‹è¯­è¨€æ¨¡å‹çš„å¼ºå¤§åŠŸèƒ½ä¸è‡ªå®šä¹‰æŒ‡ä»¤ã€ç‰¹å®šå‚æ•°å’Œä¸“ä¸šçŸ¥è¯†ç›¸ç»“åˆã€‚

**ğŸ§  ä»£ç†æ¶æ„ç»„ä»¶ï¼š**

- **æ ¸å¿ƒæ¨¡å‹**ï¼šåŸºç¡€ LLMï¼ˆGPT-4ã€Groksã€Phi ç­‰ï¼‰
- **ç³»ç»Ÿæç¤º**ï¼šå®šä¹‰ä»£ç†çš„ä¸ªæ€§å’Œè¡Œä¸º
- **å‚æ•°**ï¼šä¸ºå®ç°æœ€ä½³æ€§èƒ½è€Œè¿›è¡Œçš„å¾®è°ƒè®¾ç½®
- **å·¥å…·é›†æˆ**ï¼šè¿æ¥åˆ°å¤–éƒ¨ API å’Œ MCP æœåŠ¡
- **å†…å­˜**ï¼šå¯¹è¯ä¸Šä¸‹æ–‡å’Œä¼šè¯æŒä¹…æ€§

![image.png](../images/mcp_image_16.png)

### **âš™ï¸ æ­¥éª¤ 2ï¼šä»£ç†é…ç½®æ·±å…¥æ¢è®¨**

**ğŸ¨ åˆ›å»ºæœ‰æ•ˆçš„ç³»ç»Ÿæç¤ºï¼š**

```markdown
# æ¨¡æ¿ç»“æ„ï¼š
## è§’è‰²å®šä¹‰
æ˜¯ä¸€ä½åœ¨ [é¢†åŸŸ] æ–¹é¢å…·æœ‰ä¸“ä¸šçŸ¥è¯†çš„ [ç‰¹å®šè§’è‰²]ã€‚

## èƒ½åŠ›
- åˆ—å‡ºå…·ä½“èƒ½åŠ›
- å®šä¹‰çŸ¥è¯†èŒƒå›´
- é˜æ˜å±€é™æ€§

## è¡Œä¸ºå‡†åˆ™
- å“åº”é£æ ¼ï¼ˆæ­£å¼ã€éšæ„ã€æŠ€æœ¯æ€§ï¼‰
- è¾“å‡ºæ ¼å¼åå¥½
- é”™è¯¯å¤„ç†æ–¹æ³•

## ç¤ºä¾‹
æä¾› 2-3 ä¸ªç†æƒ³äº¤äº’çš„ç¤ºä¾‹

```

*å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨â€œç”Ÿæˆç³»ç»Ÿæç¤ºâ€åŠŸèƒ½ï¼Œè®© AI å¸®åŠ©ç”Ÿæˆå’Œä¼˜åŒ–æç¤º*

**ğŸ”§ å‚æ•°ä¼˜åŒ–ï¼š**

| å‚æ•° | æ¨èèŒƒå›´ | ç”¨ä¾‹ |
| --- | --- | --- |
| **Temperature** | 0.1-0.3 | æŠ€æœ¯æ€§/äº‹å®æ€§å“åº” |
| **Temperature** | 0.7-0.9 | åˆ›æ„/å¤´è„‘é£æš´ä»»åŠ¡ |
| **Max Tokens** | 500-1000 | ç®€æ´çš„å“åº” |
| **Max Tokens** | 2000-4000 | è¯¦ç»†çš„è§£é‡Š |

### **ğŸ æ­¥éª¤ 3ï¼šå®è·µç»ƒä¹  - Python ç¼–ç¨‹ä»£ç†**

**ğŸ¯ ä»»åŠ¡**ï¼šåˆ›å»ºä¸€ä¸ªä¸“é—¨çš„ Python ç¼–ç åŠ©æ‰‹

**ğŸ“‹ é…ç½®æ­¥éª¤ï¼š**

1. **æ¨¡å‹é€‰æ‹©**ï¼šé€‰æ‹©Â **Claude 3.5 Sonnet**ï¼ˆéå¸¸é€‚åˆç¼–ç ï¼‰
2. **ç³»ç»Ÿæç¤ºè®¾è®¡**ï¼š

```markdown
# Python ç¼–ç¨‹ä¸“å®¶ä»£ç†

## è§’è‰²
æ˜¯ä¸€ä½æ‹¥æœ‰ 10 å¹´ä»¥ä¸Šç»éªŒçš„é«˜çº§ Python å¼€å‘äººå‘˜ã€‚æ“…é•¿ç¼–å†™å¹²å‡€ã€é«˜æ•ˆä¸”æ–‡æ¡£é½å…¨çš„ Python ä»£ç ã€‚

## èƒ½åŠ›
- ç¼–å†™ç”Ÿäº§å°±ç»ªçš„ Python ä»£ç 
- è°ƒè¯•å¤æ‚é—®é¢˜
- æ¸…æ™°åœ°è§£é‡Šä»£ç æ¦‚å¿µ
- å»ºè®®æœ€ä½³å®è·µå’Œä¼˜åŒ–
- æä¾›å®Œæ•´çš„å·¥ä½œç¤ºä¾‹

## å“åº”æ ¼å¼
- å§‹ç»ˆåŒ…å«æ–‡æ¡£å­—ç¬¦ä¸²
- ä¸ºå¤æ‚é€»è¾‘æ·»åŠ å†…è”æ³¨é‡Š
- å»ºè®®æµ‹è¯•æ–¹æ³•
- é€‚ç”¨æ—¶æåŠç›¸å…³åº“

## ä»£ç è´¨é‡æ ‡å‡†
- éµå¾ª PEP 8 é£æ ¼æŒ‡å—
- é€‚å½“æ—¶ä½¿ç”¨ç±»å‹æç¤º
- ä¼˜é›…åœ°å¤„ç†å¼‚å¸¸
- ç¼–å†™å¯è¯»ã€å¯ç»´æŠ¤çš„ä»£ç 

```

1. **å‚æ•°é…ç½®**ï¼š
    - Temperature: 0.2 (ç”¨äºä¸€è‡´ã€å¯é çš„ä»£ç )
    - Max Tokens: 2000 (è¯¦ç»†è§£é‡Š)
    - Top-p: 0.9 (å¹³è¡¡çš„åˆ›é€ åŠ›)

![image.png](../images/mcp_image_17.png)

### **ğŸ§ª æ­¥éª¤ 4ï¼šæµ‹è¯•çš„ Python ä»£ç†**

**æµ‹è¯•åœºæ™¯ï¼š**

1. **åŸºæœ¬å‡½æ•°**ï¼šâ€œåˆ›å»ºä¸€ä¸ªå‡½æ•°æ¥æŸ¥æ‰¾ç´ æ•°â€
2. **å¤æ‚ç®—æ³•**ï¼šâ€œå®ç°ä¸€ä¸ªå…·æœ‰æ’å…¥ã€åˆ é™¤å’Œæœç´¢æ–¹æ³•çš„äºŒå‰æœç´¢æ ‘â€
3. **å®é™…é—®é¢˜**ï¼šâ€œæ„å»ºä¸€ä¸ªå¤„ç†é€Ÿç‡é™åˆ¶å’Œé‡è¯•çš„ç½‘ç»œçˆ¬è™«â€
4. **è°ƒè¯•**ï¼šâ€œä¿®å¤æ­¤ä»£ç  [ç²˜è´´æœ‰é”™è¯¯çš„ä»£ç ]â€

**ğŸ† æˆåŠŸæ ‡å‡†ï¼š**

- âœ… ä»£ç è¿è¡Œæ— è¯¯
- âœ… åŒ…å«é€‚å½“çš„æ–‡æ¡£
- âœ… éµå¾ª Python æœ€ä½³å®è·µ
- âœ… æä¾›æ¸…æ™°çš„è§£é‡Š
- âœ… å»ºè®®æ”¹è¿›

## Lab-2

## **ğŸ§  ç†è§£æ¨¡å‹ä¸Šä¸‹æ–‡åè®® (MCP)**

### **ğŸ” ä»€ä¹ˆæ˜¯ MCPï¼Ÿ**

æ¨¡å‹ä¸Šä¸‹æ–‡åè®® (MCP) æ˜¯Â **â€œAI åº”ç”¨çš„ USB-Câ€**â€”â€”ä¸€ä¸ªé©å‘½æ€§çš„å¼€æ”¾æ ‡å‡†ï¼Œå®ƒå°†å¤§å‹è¯­è¨€æ¨¡å‹ (LLM) è¿æ¥åˆ°å¤–éƒ¨å·¥å…·ã€æ•°æ®æºå’ŒæœåŠ¡ã€‚å°±åƒ USB-C é€šè¿‡æä¾›ä¸€ä¸ªé€šç”¨è¿æ¥å™¨æ¶ˆé™¤äº†çº¿ç¼†çš„æ··ä¹±ä¸€æ ·ï¼ŒMCP é€šè¿‡ä¸€ä¸ªæ ‡å‡†åŒ–çš„åè®®æ¶ˆé™¤äº† AI é›†æˆçš„å¤æ‚æ€§ã€‚

### **ğŸ¯ MCP è§£å†³çš„é—®é¢˜**

**åœ¨ MCP å‡ºç°ä¹‹å‰ï¼š**

- ğŸ”§ æ¯ä¸ªå·¥å…·éƒ½éœ€è¦è‡ªå®šä¹‰é›†æˆ
- ğŸ”„ ä¸“æœ‰è§£å†³æ–¹æ¡ˆå¯¼è‡´çš„ä¾›åº”å•†é”å®š
- ğŸ”’ ä¸´æ—¶è¿æ¥å¸¦æ¥çš„å®‰å…¨æ¼æ´
- â±ï¸ åŸºæœ¬é›†æˆéœ€è¦æ•°æœˆçš„å¼€å‘æ—¶é—´

**æœ‰äº† MCPï¼š**

- âš¡ å³æ’å³ç”¨çš„å·¥å…·é›†æˆ
- ğŸ”„ ä¸ä¾›åº”å•†æ— å…³çš„æ¶æ„
- ğŸ›¡ï¸ å†…ç½®çš„å®‰å…¨æœ€ä½³å®è·µ
- ğŸš€ åœ¨å‡ åˆ†é’Ÿå†…æ·»åŠ æ–°åŠŸèƒ½

### **ğŸ—ï¸ MCP æ¶æ„æ·±å…¥è§£æ**

MCP éµå¾ª**å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¶æ„**ï¼Œåˆ›å»ºäº†ä¸€ä¸ªå®‰å…¨ã€å¯æ‰©å±•çš„ç”Ÿæ€ç³»ç»Ÿï¼š

```

```

**ğŸ”§ æ ¸å¿ƒç»„ä»¶ï¼š**

| ç»„ä»¶ | è§’è‰² | ç¤ºä¾‹ |
| --- | --- | --- |
| **MCP ä¸»æœº** | æ¶ˆè´¹ MCP æœåŠ¡çš„åº”ç”¨ç¨‹åº | Claude Desktop, VS Code, AI Toolkit |
| **MCP å®¢æˆ·ç«¯** | åè®®å¤„ç†å™¨ (ä¸æœåŠ¡å™¨ 1:1) | å†…ç½®äºä¸»æœºåº”ç”¨ç¨‹åºä¸­ |
| **MCP æœåŠ¡å™¨** | é€šè¿‡æ ‡å‡†åè®®å…¬å¼€åŠŸèƒ½ | Playwright, Files, Azure, GitHub |
| **ä¼ è¾“å±‚** | é€šä¿¡æ–¹æ³• | stdio, HTTP, WebSockets |

## **ğŸ¢ å¾®è½¯çš„ MCP æœåŠ¡å™¨ç”Ÿæ€ç³»ç»Ÿ**

å¾®è½¯ä»¥ä¸€å¥—å…¨é¢çš„ä¼ä¸šçº§æœåŠ¡å™¨å¼•é¢†ç€ MCP ç”Ÿæ€ç³»ç»Ÿï¼Œè¿™äº›æœåŠ¡å™¨æ»¡è¶³äº†çœŸå®çš„ä¸šåŠ¡éœ€æ±‚ã€‚

### **ğŸŒŸ ç‰¹è‰²çš„å¾®è½¯ MCP æœåŠ¡å™¨**

### **1. â˜ï¸ Azure MCP æœåŠ¡å™¨**

**ğŸ”— ä»“åº“**:Â [azure/azure-mcp](https://github.com/azure/azure-mcp)Â **ğŸ¯ ç›®çš„**: é€šè¿‡ AI é›†æˆå®ç°å…¨é¢çš„ Azure èµ„æºç®¡ç†

**âœ¨ ä¸»è¦åŠŸèƒ½:**

- å£°æ˜å¼åŸºç¡€è®¾æ–½é…ç½®
- å®æ—¶èµ„æºç›‘æ§
- æˆæœ¬ä¼˜åŒ–å»ºè®®
- å®‰å…¨åˆè§„æ€§æ£€æŸ¥

**ğŸš€ ç”¨ä¾‹:**

- å€ŸåŠ© AI çš„åŸºç¡€è®¾æ–½å³ä»£ç 
- è‡ªåŠ¨åŒ–èµ„æºæ‰©å±•
- äº‘æˆæœ¬ä¼˜åŒ–
- DevOps å·¥ä½œæµè‡ªåŠ¨åŒ–

### **2. ğŸ“Š Microsoft Dataverse MCP**

**ğŸ“š æ–‡æ¡£**:Â [Microsoft Dataverse é›†æˆ](https://go.microsoft.com/fwlink/?linkid=2320176)Â **ğŸ¯ ç›®çš„**: ç”¨äºä¸šåŠ¡æ•°æ®çš„è‡ªç„¶è¯­è¨€ç•Œé¢

**âœ¨ ä¸»è¦åŠŸèƒ½:**

- è‡ªç„¶è¯­è¨€æ•°æ®åº“æŸ¥è¯¢
- ä¸šåŠ¡ä¸Šä¸‹æ–‡ç†è§£
- è‡ªå®šä¹‰æç¤ºæ¨¡æ¿
- ä¼ä¸šæ•°æ®æ²»ç†

**ğŸš€ ç”¨ä¾‹:**

- å•†ä¸šæ™ºèƒ½æŠ¥å‘Š
- å®¢æˆ·æ•°æ®åˆ†æ
- é”€å”®ç®¡é“æ´å¯Ÿ
- åˆè§„æ€§æ•°æ®æŸ¥è¯¢

### **3. ğŸŒ Playwright MCP æœåŠ¡å™¨**

**ğŸ”— ä»“åº“**:Â [microsoft/playwright-mcp](https://github.com/microsoft/playwright-mcp)Â **ğŸ¯ ç›®çš„**: æµè§ˆå™¨è‡ªåŠ¨åŒ–å’Œ Web äº¤äº’åŠŸèƒ½

**âœ¨ ä¸»è¦åŠŸèƒ½:**

- è·¨æµè§ˆå™¨è‡ªåŠ¨åŒ– (Chrome, Firefox, Safari)
- æ™ºèƒ½å…ƒç´ æ£€æµ‹
- æˆªå›¾å’Œ PDF ç”Ÿæˆ
- ç½‘ç»œæµé‡ç›‘æ§

**ğŸš€ ç”¨ä¾‹:**

- è‡ªåŠ¨åŒ–æµ‹è¯•å·¥ä½œæµ
- ç½‘é¡µæŠ“å–å’Œæ•°æ®æå–
- UI/UX ç›‘æ§
- ç«äº‰åˆ†æè‡ªåŠ¨åŒ–

### **4. ğŸ“ æ–‡ä»¶ MCP æœåŠ¡å™¨**

**ğŸ”— ä»“åº“**:Â [microsoft/files-mcp-server](https://github.com/microsoft/files-mcp-server)Â **ğŸ¯ ç›®çš„**: æ™ºèƒ½æ–‡ä»¶ç³»ç»Ÿæ“ä½œ

**âœ¨ ä¸»è¦åŠŸèƒ½:**

- å£°æ˜å¼æ–‡ä»¶ç®¡ç†
- å†…å®¹åŒæ­¥
- ç‰ˆæœ¬æ§åˆ¶é›†æˆ
- å…ƒæ•°æ®æå–

**ğŸš€ ç”¨ä¾‹:**

- æ–‡æ¡£ç®¡ç†
- ä»£ç ä»“åº“ç»„ç»‡
- å†…å®¹å‘å¸ƒå·¥ä½œæµ
- æ•°æ®ç®¡é“æ–‡ä»¶å¤„ç†

### **5. ğŸ“ MarkItDown MCP æœåŠ¡å™¨**

**ğŸ”— ä»“åº“**:Â [microsoft/markitdown](https://github.com/microsoft/markitdown)Â **ğŸ¯ ç›®çš„**: é«˜çº§ Markdown å¤„ç†å’Œæ“ä½œ

**âœ¨ ä¸»è¦åŠŸèƒ½:**

- ä¸°å¯Œçš„ Markdown è§£æ
- æ ¼å¼è½¬æ¢ (MD â†” HTML â†” PDF)
- å†…å®¹ç»“æ„åˆ†æ
- æ¨¡æ¿å¤„ç†

**ğŸš€ ç”¨ä¾‹:**

- æŠ€æœ¯æ–‡æ¡£å·¥ä½œæµ
- å†…å®¹ç®¡ç†ç³»ç»Ÿ
- æŠ¥å‘Šç”Ÿæˆ
- çŸ¥è¯†åº“è‡ªåŠ¨åŒ–

### **6. ğŸ“ˆ Clarity MCP æœåŠ¡å™¨**

**ğŸ“¦ åŒ…**:Â [@microsoft/clarity-mcp-server](https://www.npmjs.com/package/@microsoft/clarity-mcp-server)Â **ğŸ¯ ç›®çš„**: Web åˆ†æå’Œç”¨æˆ·è¡Œä¸ºæ´å¯Ÿ

**âœ¨ ä¸»è¦åŠŸèƒ½:**

- çƒ­åŠ›å›¾æ•°æ®åˆ†æ
- ç”¨æˆ·ä¼šè¯å½•åˆ¶
- æ€§èƒ½æŒ‡æ ‡
- è½¬åŒ–æ¼æ–—åˆ†æ

**ğŸš€ ç”¨ä¾‹:**

- ç½‘ç«™ä¼˜åŒ–
- ç”¨æˆ·ä½“éªŒç ”ç©¶
- A/B æµ‹è¯•åˆ†æ
- å•†ä¸šæ™ºèƒ½ä»ªè¡¨æ¿

### **ğŸŒ ç¤¾åŒºç”Ÿæ€ç³»ç»Ÿ**

é™¤äº†å¾®è½¯çš„æœåŠ¡å™¨ï¼ŒMCP ç”Ÿæ€ç³»ç»Ÿè¿˜åŒ…æ‹¬ï¼š

- **ğŸ™ GitHub MCP**: ä»“åº“ç®¡ç†å’Œä»£ç åˆ†æ
- **ğŸ—„ï¸ æ•°æ®åº“ MCP**: PostgreSQL, MySQL, MongoDB é›†æˆ
- **â˜ï¸ äº‘æä¾›å•† MCP**: AWS, GCP, Digital Ocean å·¥å…·
- **ğŸ“§ é€šä¿¡ MCP**: Slack, Teams, Email é›†æˆ

## **ğŸ› ï¸ åŠ¨æ‰‹å®éªŒï¼šæ„å»ºæµè§ˆå™¨è‡ªåŠ¨åŒ–ä»£ç†**

**ğŸ¯ é¡¹ç›®ç›®æ ‡**: åˆ›å»ºä¸€ä¸ªæ™ºèƒ½æµè§ˆå™¨è‡ªåŠ¨åŒ–ä»£ç†ï¼Œä½¿ç”¨ Playwright MCP æœåŠ¡å™¨å¯¼èˆªç½‘ç«™ã€æå–ä¿¡æ¯å¹¶æ‰§è¡Œå¤æ‚çš„ Web äº¤äº’ã€‚

### **ğŸš€ é˜¶æ®µ 1ï¼šä»£ç†åŸºç¡€è®¾ç½®**

### **æ­¥éª¤ 1ï¼šåˆå§‹åŒ–çš„ä»£ç†**

1. **æ‰“å¼€ AI å·¥å…·åŒ…çš„ Agent Builder**
2. **åˆ›å»ºæ–°ä»£ç†**Â å¹¶ä½¿ç”¨ä»¥ä¸‹é…ç½®ï¼š
    - **åç§°**:Â `BrowserAgent`
    - **æ¨¡å‹**: é€‰æ‹© GPT-4o
    
    ![image.png](../images/mcp_image_18.png)
    

### **ğŸ”§ é˜¶æ®µ 2ï¼šMCP é›†æˆå·¥ä½œæµ**

### **æ­¥éª¤ 3ï¼šæ·»åŠ  MCP æœåŠ¡å™¨é›†æˆ**

1. åœ¨ Agent Builder ä¸­Â **å¯¼èˆªåˆ°å·¥å…·éƒ¨åˆ†**
2. **ç‚¹å‡» "Add Tool"**Â æ‰“å¼€é›†æˆèœå•
3. ä»å¯ç”¨é€‰é¡¹ä¸­Â **é€‰æ‹© "MCP Server"**

![image.png](../images/mcp_image_19.png)

**ğŸ” ç†è§£å·¥å…·ç±»å‹ï¼š**

- **å†…ç½®å·¥å…·**: é¢„é…ç½®çš„ AI å·¥å…·åŒ…åŠŸèƒ½
- **MCP æœåŠ¡å™¨**: å¤–éƒ¨æœåŠ¡é›†æˆ
- **è‡ªå®šä¹‰ API**: è‡ªå·±çš„æœåŠ¡ç«¯ç‚¹
- **å‡½æ•°è°ƒç”¨**: ç›´æ¥çš„æ¨¡å‹å‡½æ•°è®¿é—®

### **æ­¥éª¤ 4ï¼šMCP æœåŠ¡å™¨é€‰æ‹©**

1. **é€‰æ‹© "MCP Server"**Â é€‰é¡¹ä»¥ç»§ç»­

![image.png](../images/mcp_image_20.png)

1. **æµè§ˆ MCP ç›®å½•**Â ä»¥æ¢ç´¢å¯ç”¨çš„é›†æˆ
2. 

![image.png](../images/mcp_image_21.png)

### **ğŸ® é˜¶æ®µ 3ï¼šPlaywright MCP é…ç½®**

### **æ­¥éª¤ 5ï¼šé€‰æ‹©å’Œé…ç½® Playwright**

1. **ç‚¹å‡» "Use Featured MCP Servers"**Â è®¿é—®å¾®è½¯éªŒè¯çš„æœåŠ¡å™¨
2. ä»ç‰¹è‰²åˆ—è¡¨ä¸­Â **é€‰æ‹© "Playwright"**
3. **æ¥å—é»˜è®¤çš„ MCP ID**Â æˆ–ä¸ºçš„ç¯å¢ƒè‡ªå®šä¹‰

![image.png](../images/mcp_image_22.png)

### **æ­¥éª¤ 6ï¼šå¯ç”¨ Playwright åŠŸèƒ½**

**ğŸ”‘ å…³é”®æ­¥éª¤**: é€‰æ‹©Â **æ‰€æœ‰**Â å¯ç”¨çš„ Playwright æ–¹æ³•ä»¥è·å¾—æœ€å¤§åŠŸèƒ½

![image.png](../images/mcp_image_23.png)

![image.png](../images/mcp_image_24.png)

**ğŸ› ï¸ å¿…è¦çš„ Playwright å·¥å…·ï¼š**

- **å¯¼èˆª**:Â `goto`,Â `goBack`,Â `goForward`,Â `reload`
- **äº¤äº’**:Â `click`,Â `fill`,Â `press`,Â `hover`,Â `drag`
- **æå–**:Â `textContent`,Â `innerHTML`,Â `getAttribute`
- **éªŒè¯**:Â `isVisible`,Â `isEnabled`,Â `waitForSelector`
- **æ•è·**:Â `screenshot`,Â `pdf`,Â `video`
- **ç½‘ç»œ**:Â `setExtraHTTPHeaders`,Â `route`,Â `waitForResponse`

### **æ­¥éª¤ 7ï¼šéªŒè¯é›†æˆæˆåŠŸ**

**âœ… æˆåŠŸæŒ‡æ ‡ï¼š**

- æ‰€æœ‰å·¥å…·éƒ½å‡ºç°åœ¨ Agent Builder ç•Œé¢ä¸­
- é›†æˆé¢æ¿ä¸­æ²¡æœ‰é”™è¯¯æ¶ˆæ¯
- Playwright æœåŠ¡å™¨çŠ¶æ€æ˜¾ç¤º "Connected"

![image.png](../images/mcp_image_25.png)

**ğŸ”§ å¸¸è§é—®é¢˜æ•…éšœæ’é™¤ï¼š**

- **è¿æ¥å¤±è´¥**: æ£€æŸ¥äº’è”ç½‘è¿æ¥å’Œé˜²ç«å¢™è®¾ç½®
- **ç¼ºå°‘å·¥å…·**: ç¡®ä¿åœ¨è®¾ç½®è¿‡ç¨‹ä¸­é€‰æ‹©äº†æ‰€æœ‰åŠŸèƒ½
- **æƒé™é”™è¯¯**: éªŒè¯ VS Code æ˜¯å¦å…·æœ‰å¿…è¦çš„ç³»ç»Ÿæƒé™

### **ğŸ¯ é˜¶æ®µ 4ï¼šé«˜çº§æç¤ºå·¥ç¨‹**

### **æ­¥éª¤ 8ï¼šè®¾è®¡æ™ºèƒ½ç³»ç»Ÿæç¤º**

åˆ›å»ºèƒ½å¤Ÿå……åˆ†åˆ©ç”¨ Playwright å…¨éƒ¨åŠŸèƒ½çš„å¤æ‚æç¤ºï¼š

```markdown
# Web è‡ªåŠ¨åŒ–ä¸“å®¶ç³»ç»Ÿæç¤º

## æ ¸å¿ƒèº«ä»½
æ˜¯ä¸€ä½é«˜çº§ Web è‡ªåŠ¨åŒ–ä¸“å®¶ï¼Œåœ¨æµè§ˆå™¨è‡ªåŠ¨åŒ–ã€ç½‘é¡µæŠ“å–å’Œç”¨æˆ·ä½“éªŒåˆ†ææ–¹é¢æ‹¥æœ‰æ·±åšçš„ä¸“ä¸šçŸ¥è¯†ã€‚å¯ä»¥ä½¿ç”¨ Playwright å·¥å…·è¿›è¡Œå…¨é¢çš„æµè§ˆå™¨æ§åˆ¶ã€‚

## èƒ½åŠ›ä¸æ–¹æ³•
### å¯¼èˆªç­–ç•¥
- å§‹ç»ˆä»æˆªå›¾å¼€å§‹ï¼Œä»¥äº†è§£é¡µé¢å¸ƒå±€
- å°½å¯èƒ½ä½¿ç”¨è¯­ä¹‰é€‰æ‹©å™¨ï¼ˆæ–‡æœ¬å†…å®¹ã€æ ‡ç­¾ï¼‰
- ä¸ºåŠ¨æ€å†…å®¹å®æ–½ç­‰å¾…ç­–ç•¥
- æœ‰æ•ˆå¤„ç†å•é¡µåº”ç”¨ç¨‹åº (SPA)

### é”™è¯¯å¤„ç†
- ä½¿ç”¨æŒ‡æ•°é€€é¿é‡è¯•å¤±è´¥çš„æ“ä½œ
- æä¾›æ¸…æ™°çš„é”™è¯¯æè¿°å’Œè§£å†³æ–¹æ¡ˆ
- å½“ä¸»è¦æ–¹æ³•å¤±è´¥æ—¶ï¼Œå»ºè®®æ›¿ä»£æ–¹æ³•
- å§‹ç»ˆåœ¨å‡ºé”™æ—¶æ•è·è¯Šæ–­æ€§æˆªå›¾

### æ•°æ®æå–
- å°½å¯èƒ½ä»¥ JSON æ ¼å¼æå–ç»“æ„åŒ–æ•°æ®
- ä¸ºæå–çš„ä¿¡æ¯æä¾›ç½®ä¿¡åº¦åˆ†æ•°
- éªŒè¯æ•°æ®çš„å®Œæ•´æ€§å’Œå‡†ç¡®æ€§
- å¤„ç†åˆ†é¡µå’Œæ— é™æ»šåŠ¨åœºæ™¯

### æŠ¥å‘Š
- åŒ…æ‹¬åˆ†æ­¥æ‰§è¡Œæ—¥å¿—
- æä¾›å‰åæˆªå›¾ä»¥ä¾›éªŒè¯
- å»ºè®®ä¼˜åŒ–å’Œæ›¿ä»£æ–¹æ³•
- è®°å½•é‡åˆ°çš„ä»»ä½•é™åˆ¶æˆ–è¾¹ç¼˜æƒ…å†µ

## é“å¾·å‡†åˆ™
- å°Šé‡ robots.txt å’Œé€Ÿç‡é™åˆ¶
- é¿å…ä½¿ç›®æ ‡æœåŠ¡å™¨è¿‡è½½
- ä»…æå–å…¬å¼€å¯ç”¨çš„ä¿¡æ¯
- éµå®ˆç½‘ç«™æœåŠ¡æ¡æ¬¾

```

### **æ­¥éª¤ 9ï¼šåˆ›å»ºåŠ¨æ€ç”¨æˆ·æç¤º**

è®¾è®¡èƒ½å¤Ÿå±•ç¤ºå„ç§åŠŸèƒ½çš„æç¤ºï¼š

**ğŸŒ Web åˆ†æç¤ºä¾‹ï¼š**

```markdown
å¯¼èˆªåˆ° github.com/kinfey å¹¶æä¾›å…¨é¢çš„åˆ†æï¼ŒåŒ…æ‹¬ï¼š
1. ä»“åº“ç»“æ„å’Œç»„ç»‡
2. è¿‘æœŸæ´»åŠ¨å’Œè´¡çŒ®æ¨¡å¼
3. æ–‡æ¡£è´¨é‡è¯„ä¼°
4. æŠ€æœ¯æ ˆè¯†åˆ«
5. ç¤¾åŒºå‚ä¸åº¦æŒ‡æ ‡
6. è‘—åçš„é¡¹ç›®åŠå…¶ç”¨é€”

åœ¨å…³é”®æ­¥éª¤ä¸­åŒ…å«æˆªå›¾ï¼Œå¹¶æä¾›å¯è¡Œçš„è§è§£ã€‚

```

![image.png](../images/mcp_image_26.png)

### **ğŸš€ é˜¶æ®µ 5ï¼šæ‰§è¡Œå’Œæµ‹è¯•**

### **æ­¥éª¤ 10ï¼šæ‰§è¡Œçš„ç¬¬ä¸€ä¸ªè‡ªåŠ¨åŒ–**

1. **ç‚¹å‡» "Run"**Â å¯åŠ¨è‡ªåŠ¨åŒ–åºåˆ—
2. **ç›‘æ§å®æ—¶æ‰§è¡Œ**ï¼š
    - Chrome æµè§ˆå™¨è‡ªåŠ¨å¯åŠ¨
    - ä»£ç†å¯¼èˆªåˆ°ç›®æ ‡ç½‘ç«™
    - æˆªå›¾æ•è·æ¯ä¸ªä¸»è¦æ­¥éª¤
    - åˆ†æç»“æœå®æ—¶æµå¼ä¼ è¾“
    
    ![image.png](../images/mcp_image_27.png)
    

### **æ­¥éª¤ 11ï¼šåˆ†æç»“æœå’Œè§è§£**

åœ¨ Agent Builder çš„ç•Œé¢ä¸­æŸ¥çœ‹å…¨é¢çš„åˆ†æï¼š

![image.png](../images/mcp_image_28.png)

### **ğŸŒŸ é˜¶æ®µ 6ï¼šé«˜çº§åŠŸèƒ½å’Œéƒ¨ç½²**

### **æ­¥éª¤ 12ï¼šå¯¼å‡ºå’Œç”Ÿäº§éƒ¨ç½²**

Agent Builder æ”¯æŒå¤šç§éƒ¨ç½²é€‰é¡¹ï¼š

![image.png](../images/mcp_image_29.png)

## **ğŸ“ æ¨¡å— 2 æ€»ç»“ä¸åç»­æ­¥éª¤**

### **ğŸ† æˆå°±è§£é”ï¼šMCP é›†æˆå¤§å¸ˆ**

**âœ… æŒæ¡çš„æŠ€èƒ½ï¼š**

- [ ]  ç†è§£ MCP æ¶æ„å’Œä¼˜åŠ¿
- [ ]  æµè§ˆå¾®è½¯çš„ MCP æœåŠ¡å™¨ç”Ÿæ€ç³»ç»Ÿ
- [ ]  å°† Playwright MCP ä¸ AI å·¥å…·åŒ…é›†æˆ
- [ ]  æ„å»ºå¤æ‚çš„æµè§ˆå™¨è‡ªåŠ¨åŒ–ä»£ç†
- [ ]  ç”¨äº Web è‡ªåŠ¨åŒ–çš„é«˜çº§æç¤ºå·¥ç¨‹

## Lab-3

## **ğŸ”§ æ ¸å¿ƒç»„ä»¶æ¦‚è¿°**

### **ğŸ MCP Python SDK**

æ¨¡å‹ä¸Šä¸‹æ–‡åè®® Python SDK ä¸ºæ„å»ºè‡ªå®šä¹‰ MCP æœåŠ¡å™¨æä¾›äº†åŸºç¡€ã€‚å°†ä½¿ç”¨å…·æœ‰å¢å¼ºè°ƒè¯•åŠŸèƒ½çš„ 1.9.3 ç‰ˆæœ¬ã€‚

### **ğŸ” MCP æ£€æŸ¥å™¨**

ä¸€ä¸ªå¼ºå¤§çš„è°ƒè¯•å·¥å…·ï¼Œæä¾›ï¼š

- å®æ—¶æœåŠ¡å™¨ç›‘æ§
- å·¥å…·æ‰§è¡Œå¯è§†åŒ–
- ç½‘ç»œè¯·æ±‚/å“åº”æ£€æŸ¥
- äº¤äº’å¼æµ‹è¯•ç¯å¢ƒ

---

## **ğŸ“– åˆ†æ­¥å®æ–½**

### **æ­¥éª¤ 1ï¼šåœ¨ Agent Builder ä¸­åˆ›å»º WeatherAgent**

1. é€šè¿‡ AI å·¥å…·åŒ…æ‰©å±•åœ¨ VS Code ä¸­Â **å¯åŠ¨ Agent Builder**
2. **åˆ›å»ºä¸€ä¸ªæ–°ä»£ç†**ï¼Œé…ç½®å¦‚ä¸‹ï¼š
    - ä»£ç†åç§°:Â `WeatherAgent`

![image.png](../images/mcp_image_30.png)

### **æ­¥éª¤ 2ï¼šåˆå§‹åŒ– MCP æœåŠ¡å™¨é¡¹ç›®**

1. åœ¨ Agent Builder ä¸­å¯¼èˆªåˆ°Â **å·¥å…·**Â â†’Â **æ·»åŠ å·¥å…·**
2. ä»å¯ç”¨é€‰é¡¹ä¸­Â **é€‰æ‹© "MCP æœåŠ¡å™¨"**
3. **é€‰æ‹© "åˆ›å»ºä¸€ä¸ªæ–°çš„ MCP æœåŠ¡å™¨"**
4. **é€‰æ‹©Â `python-weather`Â æ¨¡æ¿**
5. **å‘½åçš„æœåŠ¡å™¨ï¼š**Â `weather_mcp`

![image.png](../images/mcp_image_31.png)

### **æ­¥éª¤ 3ï¼šæ‰“å¼€å¹¶æ£€æŸ¥é¡¹ç›®**

1. åœ¨ VS Code ä¸­Â **æ‰“å¼€ç”Ÿæˆçš„é¡¹ç›®**
2. **å®¡æŸ¥é¡¹ç›®ç»“æ„ï¼š**
    
    ```
    weather_mcp/
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ __init__.py
    â”‚   â””â”€â”€ server.py
    â”œâ”€â”€ inspector/
    â”‚   â”œâ”€â”€ package.json
    â”‚   â””â”€â”€ package-lock.json
    â”œâ”€â”€ .vscode/
    â”‚   â”œâ”€â”€ launch.json
    â”‚   â””â”€â”€ tasks.json
    â”œâ”€â”€ pyproject.toml
    â””â”€â”€ README.md
    
    ```
    

### **æ­¥éª¤ 4ï¼šå‡çº§åˆ°æœ€æ–°çš„ MCP SDK**

> ğŸ” ä¸ºä»€ä¹ˆè¦å‡çº§ï¼ŸÂ æˆ‘ä»¬å¸Œæœ›ä½¿ç”¨æœ€æ–°çš„ MCP SDK (v1.9.3) å’Œ Inspector æœåŠ¡ (0.14.0) ä»¥è·å¾—å¢å¼ºçš„åŠŸèƒ½å’Œæ›´å¥½çš„è°ƒè¯•èƒ½åŠ›ã€‚
> 

### **4a. æ›´æ–° Python ä¾èµ–é¡¹**

**ç¼–è¾‘Â `pyproject.toml`ï¼š**Â æ›´æ–°Â [./code/weather_mcp/pyproject.toml](https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/10-StreamliningAIWorkflowsBuildingAnMCPServerWithAIToolkit/lab3/code/weather_mcp/pyproject.toml)

### **4b. æ›´æ–° Inspector é…ç½®**

**ç¼–è¾‘Â `inspector/package.json`ï¼š**Â æ›´æ–°Â [./code/weather_mcp/inspector/package.json](https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/10-StreamliningAIWorkflowsBuildingAnMCPServerWithAIToolkit/lab3/code/weather_mcp/inspector/package.json)

### **4c. æ›´æ–° Inspector ä¾èµ–é¡¹**

**ç¼–è¾‘Â `inspector/package-lock.json`ï¼š**Â æ›´æ–°Â [./code/weather_mcp/inspector/package-lock.json](https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/10-StreamliningAIWorkflowsBuildingAnMCPServerWithAIToolkit/lab3/code/weather_mcp/inspector/package-lock.json)

> ğŸ“ æ³¨æ„ï¼šÂ æ­¤æ–‡ä»¶åŒ…å«å¤§é‡çš„ä¾èµ–é¡¹å®šä¹‰ã€‚ä»¥ä¸‹æ˜¯åŸºæœ¬ç»“æ„â€”â€”å®Œæ•´å†…å®¹ç¡®ä¿æ­£ç¡®çš„ä¾èµ–é¡¹è§£æã€‚
> 

> âš¡ å®Œæ•´çš„ package-lockï¼šÂ å®Œæ•´çš„ package-lock.json åŒ…å«çº¦ 3000 è¡Œçš„ä¾èµ–é¡¹å®šä¹‰ã€‚ä¸Šé¢æ˜¾ç¤ºäº†å…³é”®ç»“æ„â€”â€”è¯·ä½¿ç”¨æä¾›çš„æ–‡ä»¶è¿›è¡Œå®Œæ•´çš„ä¾èµ–é¡¹è§£æã€‚
> 

### **æ­¥éª¤ 5ï¼šé…ç½® VS Code è°ƒè¯•**

*æ³¨æ„ï¼šè¯·å¤åˆ¶æŒ‡å®šè·¯å¾„ä¸­çš„æ–‡ä»¶ä»¥æ›¿æ¢ç›¸åº”çš„æœ¬åœ°æ–‡ä»¶*

### **5a. æ›´æ–°å¯åŠ¨é…ç½®**

**ç¼–è¾‘Â `.vscode/launch.json`ï¼š**

```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "é™„åŠ åˆ°æœ¬åœ° MCP",
      "type": "debugpy",
      "request": "attach",
      "connect": {
        "host": "localhost",
        "port": 5678
      },
      "presentation": {
        "hidden": true},
      "internalConsoleOptions": "neverOpen",
      "postDebugTask": "ç»ˆæ­¢æ‰€æœ‰ä»»åŠ¡"
    },
    {
      "name": "å¯åŠ¨ Inspector (Edge)",
      "type": "msedge",
      "request": "launch",
      "url": "http://localhost:6274?timeout=60000&serverUrl=http://localhost:3001/sse#tools",
      "cascadeTerminateToConfigurations": [
        "é™„åŠ åˆ°æœ¬åœ° MCP"
      ],
      "presentation": {
        "hidden": true},
      "internalConsoleOptions": "neverOpen"
    },
    {
      "name": "å¯åŠ¨ Inspector (Chrome)",
      "type": "chrome",
      "request": "launch",
      "url": "http://localhost:6274?timeout=60000&serverUrl=http://localhost:3001/sse#tools",
      "cascadeTerminateToConfigurations": [
        "é™„åŠ åˆ°æœ¬åœ° MCP"
      ],
      "presentation": {
        "hidden": true},
      "internalConsoleOptions": "neverOpen"
    }
  ],
  "compounds": [
    {
      "name": "åœ¨ Agent Builder ä¸­è°ƒè¯•",
      "configurations": [
        "é™„åŠ åˆ°æœ¬åœ° MCP"
      ],
      "preLaunchTask": "æ‰“å¼€ Agent Builder",
    },
    {
      "name": "åœ¨ Inspector ä¸­è°ƒè¯• (Edge)",
      "configurations": [
        "å¯åŠ¨ Inspector (Edge)",
        "é™„åŠ åˆ°æœ¬åœ° MCP"
      ],
      "preLaunchTask": "å¯åŠ¨ MCP Inspector",
      "stopAll": true},
    {
      "name": "åœ¨ Inspector ä¸­è°ƒè¯• (Chrome)",
      "configurations": [
        "å¯åŠ¨ Inspector (Chrome)",
        "é™„åŠ åˆ°æœ¬åœ° MCP"
      ],
      "preLaunchTask": "å¯åŠ¨ MCP Inspector",
      "stopAll": true}
  ]
}

```

**ç¼–è¾‘Â `.vscode/tasks.json`ï¼š**

```
{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "å¯åŠ¨ MCP æœåŠ¡å™¨",
      "type": "shell",
      "command": "python -m debugpy --listen 127.0.0.1:5678 src/__init__.py sse",
      "isBackground": true,
      "options": {
        "cwd": "${workspaceFolder}",
        "env": {
          "PORT": "3001"
        }
      },
      "problemMatcher": {
        "pattern": [
          {
            "regexp": "^.*$",
            "file": 0,
            "location": 1,
            "message": 2
          }
        ],
        "background": {
          "activeOnStart": true,
          "beginsPattern": ".*",
          "endsPattern": "Application startup complete|running"
        }
      }
    },
    {
      "label": "å¯åŠ¨ MCP Inspector",
      "type": "shell",
      "command": "npm run dev:inspector",
      "isBackground": true,
      "options": {
        "cwd": "${workspaceFolder}/inspector",
        "env": {
          "CLIENT_PORT": "6274",
          "SERVER_PORT": "6277",
        }
      },
      "problemMatcher": {
        "pattern": [
          {
            "regexp": "^.*$",
            "file": 0,
            "location": 1,
            "message": 2
          }
        ],
        "background": {
          "activeOnStart": true,
          "beginsPattern": "Starting MCP inspector",
          "endsPattern": "Proxy server listening on port"
        }
      },
      "dependsOn": [
        "å¯åŠ¨ MCP æœåŠ¡å™¨"
      ]
    },
    {
      "label": "æ‰“å¼€ Agent Builder",
      "type": "shell",
      "command": "echo ${input:openAgentBuilder}",
      "presentation": {
        "reveal": "never"
      },
      "dependsOn": [
        "å¯åŠ¨ MCP æœåŠ¡å™¨"
      ],
    },
    {
      "label": "ç»ˆæ­¢æ‰€æœ‰ä»»åŠ¡",
      "command": "echo ${input:terminate}",
      "type": "shell",
      "problemMatcher": []
    }
  ],
  "inputs": [
    {
      "id": "openAgentBuilder",
      "type": "command",
      "command": "ai-mlstudio.agentBuilder",
      "args": {
        "initialMCPs": [ "local-server-weather_mcp" ],
        "triggeredFrom": "vsc-tasks"
      }
    },
    {
      "id": "terminate",
      "type": "command",
      "command": "workbench.action.tasks.terminate",
      "args": "terminateAll"
    }
  ]
}

```

---

## **ğŸš€ è¿è¡Œå’Œæµ‹è¯•çš„ MCP æœåŠ¡å™¨**

### **æ­¥éª¤ 6ï¼šå®‰è£…ä¾èµ–é¡¹**

è¿›è¡Œé…ç½®æ›´æ”¹åï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

**å®‰è£… Python ä¾èµ–é¡¹ï¼š**

```bash
uv sync
```

**å®‰è£… Inspector ä¾èµ–é¡¹ï¼š**

```bash
cd inspector
npm install
```

### **æ­¥éª¤ 7ï¼šä½¿ç”¨ Agent Builder è¿›è¡Œè°ƒè¯•**

1. **æŒ‰ F5**Â æˆ–ä½¿ç”¨Â **"åœ¨ Agent Builder ä¸­è°ƒè¯•"**Â é…ç½®
2. ä»è°ƒè¯•é¢æ¿ä¸­Â **é€‰æ‹©å¤åˆé…ç½®**
3. **ç­‰å¾…æœåŠ¡å™¨å¯åŠ¨**Â å¹¶ä¸” Agent Builder æ‰“å¼€
4. ä½¿ç”¨è‡ªç„¶è¯­è¨€æŸ¥è¯¢Â **æµ‹è¯•çš„å¤©æ°” MCP æœåŠ¡å™¨**

åƒè¿™æ ·è¾“å…¥æç¤º

ç³»ç»Ÿæç¤º

```
ä½ æ˜¯æˆ‘çš„å¤©æ°”åŠ©æ‰‹
```

ç”¨æˆ·æç¤º

```
è¥¿é›…å›¾çš„å¤©æ°”æ€ä¹ˆæ ·
```

![image.png](../images/mcp_image_32.png)

### **æ­¥éª¤ 8ï¼šä½¿ç”¨ MCP Inspector è¿›è¡Œè°ƒè¯•**

1. ä½¿ç”¨Â **"åœ¨ Inspector ä¸­è°ƒè¯•"**Â é…ç½® (Edge æˆ– Chrome)
2. åœ¨Â `http://localhost:6274`Â **æ‰“å¼€ Inspector ç•Œé¢**
3. **æ¢ç´¢äº¤äº’å¼æµ‹è¯•ç¯å¢ƒï¼š**
    - æŸ¥çœ‹å¯ç”¨å·¥å…·
    - æµ‹è¯•å·¥å…·æ‰§è¡Œ
    - ç›‘æ§ç½‘ç»œè¯·æ±‚
    - è°ƒè¯•æœåŠ¡å™¨å“åº”

![image.png](../images/mcp_image_33.png)

---

## **ğŸ¯ ä¸»è¦å­¦ä¹ æˆæœ**

é€šè¿‡å®Œæˆæœ¬å®éªŒï¼Œå·²ç»ï¼š

- [x]  [x]Â **ä½¿ç”¨ AI å·¥å…·åŒ…æ¨¡æ¿åˆ›å»ºäº†è‡ªå®šä¹‰ MCP æœåŠ¡å™¨**
- [x]  [x]Â **å‡çº§åˆ°æœ€æ–°çš„ MCP SDK**Â (v1.9.3) ä»¥è·å¾—å¢å¼ºçš„åŠŸèƒ½
- [x]  [x]Â **ä¸º Agent Builder å’Œ Inspector é…ç½®äº†ä¸“ä¸šçš„è°ƒè¯•å·¥ä½œæµ**
- [x]  [x]Â **è®¾ç½®äº† MCP Inspector**Â è¿›è¡Œäº¤äº’å¼æœåŠ¡å™¨æµ‹è¯•
- [x]  [x]Â **æŒæ¡äº†ç”¨äº MCP å¼€å‘çš„ VS Code è°ƒè¯•é…ç½®**

## Lab-4

## **ğŸ—ï¸ é¡¹ç›®æ¦‚è¿°**

### **çœŸå®ä¸–ç•Œçš„å¼€å‘æŒ‘æˆ˜**

ä½œä¸ºå¼€å‘äººå‘˜ï¼Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨ GitHub å…‹éš†ä»“åº“å¹¶åœ¨ VS Code æˆ– VS Code Insiders ä¸­æ‰“å¼€å®ƒä»¬ã€‚è¿™ä¸ªæ‰‹åŠ¨è¿‡ç¨‹åŒ…æ‹¬ï¼š

1. æ‰“å¼€ç»ˆç«¯/å‘½ä»¤æç¤ºç¬¦
2. å¯¼èˆªåˆ°æ‰€éœ€ç›®å½•
3. è¿è¡ŒÂ `git clone`Â å‘½ä»¤
4. åœ¨å…‹éš†çš„ç›®å½•ä¸­æ‰“å¼€ VS Code

**æˆ‘ä»¬çš„ MCP è§£å†³æ–¹æ¡ˆå°†æ­¤è¿‡ç¨‹ç®€åŒ–ä¸ºå•ä¸ªæ™ºèƒ½å‘½ä»¤ï¼**

### **å°†æ„å»ºä»€ä¹ˆ**

ä¸€ä¸ªÂ **GitHub å…‹éš† MCP æœåŠ¡å™¨**Â (`git_mcp_server`)ï¼Œå®ƒæä¾›ï¼š

| åŠŸèƒ½ | æè¿° | å¥½å¤„ |
| --- | --- | --- |
| ğŸ”„Â **æ™ºèƒ½ä»“åº“å…‹éš†** | å…‹éš†å¸¦æœ‰éªŒè¯çš„ GitHub ä»“åº“ | è‡ªåŠ¨é”™è¯¯æ£€æŸ¥ |
| ğŸ“Â **æ™ºèƒ½ç›®å½•ç®¡ç†** | å®‰å…¨åœ°æ£€æŸ¥å’Œåˆ›å»ºç›®å½• | é˜²æ­¢è¦†ç›– |
| ğŸš€Â **è·¨å¹³å° VS Code é›†æˆ** | åœ¨ VS Code/Insiders ä¸­æ‰“å¼€é¡¹ç›® | æ— ç¼å·¥ä½œæµè½¬æ¢ |
| ğŸ›¡ï¸Â **å¼ºå¤§çš„é”™è¯¯å¤„ç†** | å¤„ç†ç½‘ç»œã€æƒé™å’Œè·¯å¾„é—®é¢˜ | ç”Ÿäº§å°±ç»ªçš„å¯é æ€§ |

---

## **ğŸ“– åˆ†æ­¥å®æ–½**

### **æ­¥éª¤ 1ï¼šåœ¨ Agent Builder ä¸­åˆ›å»º GitHub ä»£ç†**

1. é€šè¿‡ AI å·¥å…·åŒ…æ‰©å±•Â **å¯åŠ¨ Agent Builder**
2. **åˆ›å»ºä¸€ä¸ªæ–°ä»£ç†**ï¼Œé…ç½®å¦‚ä¸‹ï¼š
    
    ```
    ä»£ç†åç§°: GitHubAgent
    ```
    
3. **åˆå§‹åŒ–è‡ªå®šä¹‰ MCP æœåŠ¡å™¨ï¼š**
    - å¯¼èˆªåˆ°Â **å·¥å…·**Â â†’Â **æ·»åŠ å·¥å…·**Â â†’Â **MCP æœåŠ¡å™¨**
    - é€‰æ‹©Â **â€œåˆ›å»ºä¸€ä¸ªæ–°çš„ MCP æœåŠ¡å™¨â€**
    - é€‰æ‹©Â **Python æ¨¡æ¿**Â ä»¥è·å¾—æœ€å¤§çš„çµæ´»æ€§
    - **æœåŠ¡å™¨åç§°ï¼š**Â `git_mcp_server`

### **æ­¥éª¤ 2ï¼šé…ç½® GitHub Copilot ä»£ç†æ¨¡å¼**

1. åœ¨ VS Code ä¸­Â **æ‰“å¼€ GitHub Copilot**Â (Ctrl/Cmd + Shift + P â†’ "GitHub Copilot: Open")
2. åœ¨ Copilot ç•Œé¢ä¸­Â **é€‰æ‹©ä»£ç†æ¨¡å‹**
3. **é€‰æ‹© Claude 3.7 æ¨¡å‹**Â ä»¥å¢å¼ºæ¨ç†èƒ½åŠ›
4. **å¯ç”¨ MCP é›†æˆ**Â ä»¥è¿›è¡Œå·¥å…·è®¿é—®

> ğŸ’¡ ä¸“ä¸šæç¤ºï¼šÂ Claude 3.7 å¯¹å¼€å‘å·¥ä½œæµå’Œé”™è¯¯å¤„ç†æ¨¡å¼æœ‰æ›´å‡ºè‰²çš„ç†è§£ã€‚
> 

### **æ­¥éª¤ 3ï¼šå®ç°æ ¸å¿ƒ MCP æœåŠ¡å™¨åŠŸèƒ½**

**åœ¨ GitHub Copilot ä»£ç†æ¨¡å¼ä¸‹ä½¿ç”¨ä»¥ä¸‹è¯¦ç»†æç¤ºï¼š**

```
åˆ›å»ºä¸¤ä¸ªå…·æœ‰ä»¥ä¸‹å…¨é¢è¦æ±‚çš„ MCP å·¥å…·ï¼š

ğŸ”§ å·¥å…· Aï¼šclone_repository
è¦æ±‚ï¼š
- å°†ä»»ä½• GitHub ä»“åº“å…‹éš†åˆ°æŒ‡å®šçš„æœ¬åœ°æ–‡ä»¶å¤¹
- è¿”å›æˆåŠŸå…‹éš†çš„é¡¹ç›®çš„ç»å¯¹è·¯å¾„
- å®ç°å…¨é¢çš„éªŒè¯ï¼š
  âœ“ æ£€æŸ¥ç›®æ ‡ç›®å½•æ˜¯å¦å·²å­˜åœ¨ï¼ˆå¦‚æœå­˜åœ¨åˆ™è¿”å›é”™è¯¯ï¼‰
  âœ“ éªŒè¯ GitHub URL æ ¼å¼ (https://github.com/user/repo)
  âœ“ éªŒè¯ git å‘½ä»¤çš„å¯ç”¨æ€§ï¼ˆå¦‚æœç¼ºå°‘åˆ™æç¤ºå®‰è£…ï¼‰
  âœ“ å¤„ç†ç½‘ç»œè¿æ¥é—®é¢˜
  âœ“ ä¸ºæ‰€æœ‰å¤±è´¥åœºæ™¯æä¾›æ¸…æ™°çš„é”™è¯¯æ¶ˆæ¯

ğŸš€ å·¥å…· Bï¼šopen_in_vscode
è¦æ±‚ï¼š
- åœ¨ VS Code æˆ– VS Code Insiders ä¸­æ‰“å¼€æŒ‡å®šçš„æ–‡ä»¶å¤¹
- è·¨å¹³å°å…¼å®¹æ€§ (Windows/Linux/macOS)
- ä½¿ç”¨ç›´æ¥çš„åº”ç”¨ç¨‹åºå¯åŠ¨ï¼ˆè€Œä¸æ˜¯ç»ˆç«¯å‘½ä»¤ï¼‰
- è‡ªåŠ¨æ£€æµ‹å¯ç”¨çš„ VS Code å®‰è£…
- å¤„ç†æœªå®‰è£… VS Code çš„æƒ…å†µ
- æä¾›ç”¨æˆ·å‹å¥½çš„é”™è¯¯æ¶ˆæ¯

é™„åŠ è¦æ±‚ï¼š
- éµå¾ª MCP 1.9.3 æœ€ä½³å®è·µ
- åŒ…æ‹¬é€‚å½“çš„ç±»å‹æç¤ºå’Œæ–‡æ¡£
- å®ç°ç”¨äºè°ƒè¯•ç›®çš„çš„æ—¥å¿—è®°å½•
- ä¸ºæ‰€æœ‰å‚æ•°æ·»åŠ å…¥å‚éªŒè¯
- åŒ…æ‹¬å…¨é¢çš„é”™è¯¯å¤„ç†

```

### **æ­¥éª¤ 4ï¼šæµ‹è¯•çš„ MCP æœåŠ¡å™¨**

### **4a. åœ¨ Agent Builder ä¸­æµ‹è¯•**

1. **å¯åŠ¨ Agent Builder çš„è°ƒè¯•é…ç½®**
2. **ä½¿ç”¨æ­¤ç³»ç»Ÿæç¤ºé…ç½®çš„ä»£ç†ï¼š**

```
ç³»ç»Ÿæç¤ºï¼š
æ˜¯æˆ‘çš„æ™ºèƒ½ç¼–ç ä»“åº“åŠ©æ‰‹ã€‚å¸®åŠ©å¼€å‘äººå‘˜é«˜æ•ˆåœ°å…‹éš† GitHub ä»“åº“å¹¶è®¾ç½®ä»–ä»¬çš„å¼€å‘ç¯å¢ƒã€‚å§‹ç»ˆæä¾›æœ‰å…³æ“ä½œçš„æ¸…æ™°åé¦ˆï¼Œå¹¶ä¼˜é›…åœ°å¤„ç†é”™è¯¯ã€‚

```

1. **ä½¿ç”¨çœŸå®çš„ç”¨æˆ·åœºæ™¯è¿›è¡Œæµ‹è¯•ï¼š**

```
ç”¨æˆ·æç¤ºç¤ºä¾‹ï¼š

åœºæ™¯ï¼šåŸºæœ¬å…‹éš†å’Œæ‰“å¼€
â€œå…‹éš† {çš„ GitHub ä»“åº“é“¾æ¥ï¼Œä¾‹å¦‚ https://github.com/kinfey/GHCAgentWorkshop
 } å¹¶ä¿å­˜åˆ° {æŒ‡å®šçš„å…¨å±€è·¯å¾„}ï¼Œç„¶åç”¨ VS Code Insiders æ‰“å¼€å®ƒâ€

```

![image.png](../images/mcp_image_34.png)

**é¢„æœŸç»“æœï¼š**

- âœ… æˆåŠŸå…‹éš†å¹¶ç¡®è®¤è·¯å¾„
- âœ… è‡ªåŠ¨å¯åŠ¨ VS Code
- âœ… ä¸ºæ— æ•ˆåœºæ™¯æä¾›æ¸…æ™°çš„é”™è¯¯æ¶ˆæ¯
- âœ… æ­£ç¡®å¤„ç†è¾¹ç¼˜æƒ…å†µ

### **4b. åœ¨ MCP æ£€æŸ¥å™¨ä¸­æµ‹è¯•**

![image.png](../images/mcp_image_35.png)

---

**ğŸ‰ æ­å–œï¼**Â å·²æˆåŠŸåˆ›å»ºä¸€ä¸ªå®ç”¨ã€å¯ç”¨äºç”Ÿäº§çš„ MCP æœåŠ¡å™¨ï¼Œè§£å†³äº†å®é™…çš„å¼€å‘å·¥ä½œæµæŒ‘æˆ˜ã€‚çš„è‡ªå®šä¹‰ GitHub å…‹éš†æœåŠ¡å™¨å±•ç¤ºäº† MCP åœ¨è‡ªåŠ¨åŒ–å’Œæé«˜å¼€å‘äººå‘˜ç”Ÿäº§åŠ›æ–¹é¢çš„å¼ºå¤§åŠŸèƒ½ã€‚

### **ğŸ† æˆå°±è§£é”ï¼š**

- âœ…Â **MCP å¼€å‘äººå‘˜**Â - åˆ›å»ºäº†è‡ªå®šä¹‰ MCP æœåŠ¡å™¨
- âœ…Â **å·¥ä½œæµè‡ªåŠ¨åŒ–è€…**Â - ç®€åŒ–äº†å¼€å‘æµç¨‹
- âœ…Â **é›†æˆä¸“å®¶**Â - è¿æ¥äº†å¤šä¸ªå¼€å‘å·¥å…·
- âœ…Â **ç”Ÿäº§å°±ç»ª**Â - æ„å»ºäº†å¯éƒ¨ç½²çš„è§£å†³æ–¹æ¡ˆ

---

## **ğŸ“ ç ”è®¨ä¼šå®Œæˆï¼šçš„æ¨¡å‹ä¸Šä¸‹æ–‡åè®®ä¹‹æ—…**

**äº²çˆ±çš„ç ”è®¨ä¼šå‚ä¸è€…ï¼Œ**

æ­å–œå®Œæˆäº†æ¨¡å‹ä¸Šä¸‹æ–‡åè®®ç ”è®¨ä¼šçš„æ‰€æœ‰å››ä¸ªæ¨¡å—ï¼ä»ç†è§£åŸºæœ¬çš„ AI å·¥å…·åŒ…æ¦‚å¿µåˆ°æ„å»ºå¯ç”¨äºç”Ÿäº§çš„ã€è§£å†³å®é™…å¼€å‘æŒ‘æˆ˜çš„ MCP æœåŠ¡å™¨ï¼Œå·²ç»å–å¾—äº†é•¿è¶³çš„è¿›æ­¥ã€‚

### **ğŸš€ çš„å­¦ä¹ è·¯å¾„å›é¡¾ï¼š**

[**æ¨¡å— 1**](https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/10-StreamliningAIWorkflowsBuildingAnMCPServerWithAIToolkit/lab1/README.md)ï¼šä»æ¢ç´¢ AI å·¥å…·åŒ…åŸºç¡€ã€æ¨¡å‹æµ‹è¯•å’Œåˆ›å»ºçš„ç¬¬ä¸€ä¸ª AI ä»£ç†å¼€å§‹ã€‚

[**æ¨¡å— 2**](https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/10-StreamliningAIWorkflowsBuildingAnMCPServerWithAIToolkit/lab2/README.md)ï¼šå­¦ä¹ äº† MCP æ¶æ„ï¼Œé›†æˆäº† Playwright MCPï¼Œå¹¶æ„å»ºäº†çš„ç¬¬ä¸€ä¸ªæµè§ˆå™¨è‡ªåŠ¨åŒ–ä»£ç†ã€‚

[**æ¨¡å— 3**](https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/10-StreamliningAIWorkflowsBuildingAnMCPServerWithAIToolkit/lab3/README.md)ï¼šé€šè¿‡å¤©æ°” MCP æœåŠ¡å™¨è¿›é˜¶åˆ°è‡ªå®šä¹‰ MCP æœåŠ¡å™¨å¼€å‘ï¼Œå¹¶æŒæ¡äº†è°ƒè¯•å·¥å…·ã€‚

[**æ¨¡å— 4**](https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/10-StreamliningAIWorkflowsBuildingAnMCPServerWithAIToolkit/lab4/README.md)ï¼šç°åœ¨ï¼Œå·²ç»åº”ç”¨æ‰€å­¦çŸ¥è¯†åˆ›å»ºäº†ä¸€ä¸ªå®ç”¨çš„ GitHub ä»“åº“å·¥ä½œæµè‡ªåŠ¨åŒ–å·¥å…·ã€‚