<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 5.14.1"/><style data-href="/styles.91d60bbab44133089581.css" data-identity="gatsby-global-css">*,:after,:before{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/*
! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com
*/*,:after,:before{border:0 solid #e5e7eb;box-sizing:border-box}:after,:before{--tw-content:""}:host,html{-webkit-text-size-adjust:100%;font-feature-settings:normal;-webkit-tap-highlight-color:transparent;font-family:ui-sans-serif,system-ui,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;font-variation-settings:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4}body{line-height:inherit}hr{border-top-width:1px;color:inherit;height:0}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}code,kbd,pre,samp{font-feature-settings:normal;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-variation-settings:normal}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{border-collapse:collapse;border-color:inherit;text-indent:0}button,input,optgroup,select,textarea{font-feature-settings:inherit;color:inherit;font-family:inherit;font-size:100%;font-variation-settings:inherit;font-weight:inherit;letter-spacing:inherit;line-height:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0}fieldset,legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:#9ca3af;opacity:1}input::placeholder,textarea::placeholder{color:#9ca3af;opacity:1}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{height:auto;max-width:100%}[hidden]:where(:not([hidden=until-found])){display:none}.prose{color:var(--tw-prose-body);max-width:65ch}.prose :where(p):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:1.25em;margin-top:1.25em}.prose :where([class~=lead]):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-lead);font-size:1.25em;line-height:1.6;margin-bottom:1.2em;margin-top:1.2em}.prose :where(a):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-links);font-weight:500;text-decoration:underline}.prose :where(strong):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-bold);font-weight:600}.prose :where(a strong):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit}.prose :where(blockquote strong):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit}.prose :where(thead th strong):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit}.prose :where(ol):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:decimal;margin-bottom:1.25em;margin-top:1.25em;padding-inline-start:1.625em}.prose :where(ol[type=A]):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:upper-alpha}.prose :where(ol[type=a]):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:lower-alpha}.prose :where(ol[type=A s]):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:upper-alpha}.prose :where(ol[type=a s]):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:lower-alpha}.prose :where(ol[type=I]):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:upper-roman}.prose :where(ol[type=i]):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:lower-roman}.prose :where(ol[type=I s]):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:upper-roman}.prose :where(ol[type=i s]):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:lower-roman}.prose :where(ol[type="1"]):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:decimal}.prose :where(ul):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:disc;margin-bottom:1.25em;margin-top:1.25em;padding-inline-start:1.625em}.prose :where(ol>li):not(:where([class~=not-prose],[class~=not-prose] *))::marker{color:var(--tw-prose-counters);font-weight:400}.prose :where(ul>li):not(:where([class~=not-prose],[class~=not-prose] *))::marker{color:var(--tw-prose-bullets)}.prose :where(dt):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-headings);font-weight:600;margin-top:1.25em}.prose :where(hr):not(:where([class~=not-prose],[class~=not-prose] *)){border-color:var(--tw-prose-hr);border-top-width:1px;margin-bottom:3em;margin-top:3em}.prose :where(blockquote):not(:where([class~=not-prose],[class~=not-prose] *)){border-inline-start-color:var(--tw-prose-quote-borders);border-inline-start-width:.25rem;color:var(--tw-prose-quotes);font-style:italic;font-weight:500;margin-bottom:1.6em;margin-top:1.6em;padding-inline-start:1em;quotes:"\201C""\201D""\2018""\2019"}.prose :where(blockquote p:first-of-type):not(:where([class~=not-prose],[class~=not-prose] *)):before{content:open-quote}.prose :where(blockquote p:last-of-type):not(:where([class~=not-prose],[class~=not-prose] *)):after{content:close-quote}.prose :where(h1):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-headings);font-size:2.25em;font-weight:800;line-height:1.1111111;margin-bottom:.8888889em;margin-top:0}.prose :where(h1 strong):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit;font-weight:900}.prose :where(h2):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-headings);font-size:1.5em;font-weight:700;line-height:1.3333333;margin-bottom:1em;margin-top:2em}.prose :where(h2 strong):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit;font-weight:800}.prose :where(h3):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-headings);font-size:1.25em;font-weight:600;line-height:1.6;margin-bottom:.6em;margin-top:1.6em}.prose :where(h3 strong):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit;font-weight:700}.prose :where(h4):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-headings);font-weight:600;line-height:1.5;margin-bottom:.5em;margin-top:1.5em}.prose :where(h4 strong):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit;font-weight:700}.prose :where(img):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:2em;margin-top:2em}.prose :where(picture):not(:where([class~=not-prose],[class~=not-prose] *)){display:block;margin-bottom:2em;margin-top:2em}.prose :where(video):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:2em;margin-top:2em}.prose :where(kbd):not(:where([class~=not-prose],[class~=not-prose] *)){border-radius:.3125rem;box-shadow:0 0 0 1px rgb(var(--tw-prose-kbd-shadows)/10%),0 3px 0 rgb(var(--tw-prose-kbd-shadows)/10%);color:var(--tw-prose-kbd);font-family:inherit;font-size:.875em;font-weight:500;padding-inline-end:.375em;padding-bottom:.1875em;padding-top:.1875em;padding-inline-start:.375em}.prose :where(code):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-code);font-size:.875em;font-weight:600}.prose :where(code):not(:where([class~=not-prose],[class~=not-prose] *)):before{content:"`"}.prose :where(code):not(:where([class~=not-prose],[class~=not-prose] *)):after{content:"`"}.prose :where(a code):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit}.prose :where(h1 code):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit}.prose :where(h2 code):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit;font-size:.875em}.prose :where(h3 code):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit;font-size:.9em}.prose :where(h4 code):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit}.prose :where(blockquote code):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit}.prose :where(thead th code):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit}.prose :where(pre):not(:where([class~=not-prose],[class~=not-prose] *)){background-color:var(--tw-prose-pre-bg);border-radius:.375rem;color:var(--tw-prose-pre-code);font-size:.875em;font-weight:400;line-height:1.7142857;margin-bottom:1.7142857em;margin-top:1.7142857em;overflow-x:auto;padding-inline-end:1.1428571em;padding-bottom:.8571429em;padding-top:.8571429em;padding-inline-start:1.1428571em}.prose :where(pre code):not(:where([class~=not-prose],[class~=not-prose] *)){background-color:transparent;border-radius:0;border-width:0;color:inherit;font-family:inherit;font-size:inherit;font-weight:inherit;line-height:inherit;padding:0}.prose :where(pre code):not(:where([class~=not-prose],[class~=not-prose] *)):before{content:none}.prose :where(pre code):not(:where([class~=not-prose],[class~=not-prose] *)):after{content:none}.prose :where(table):not(:where([class~=not-prose],[class~=not-prose] *)){font-size:.875em;line-height:1.7142857;margin-bottom:2em;margin-top:2em;table-layout:auto;width:100%}.prose :where(thead):not(:where([class~=not-prose],[class~=not-prose] *)){border-bottom-color:var(--tw-prose-th-borders);border-bottom-width:1px}.prose :where(thead th):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-headings);font-weight:600;padding-inline-end:.5714286em;padding-bottom:.5714286em;padding-inline-start:.5714286em;vertical-align:bottom}.prose :where(tbody tr):not(:where([class~=not-prose],[class~=not-prose] *)){border-bottom-color:var(--tw-prose-td-borders);border-bottom-width:1px}.prose :where(tbody tr:last-child):not(:where([class~=not-prose],[class~=not-prose] *)){border-bottom-width:0}.prose :where(tbody td):not(:where([class~=not-prose],[class~=not-prose] *)){vertical-align:baseline}.prose :where(tfoot):not(:where([class~=not-prose],[class~=not-prose] *)){border-top-color:var(--tw-prose-th-borders);border-top-width:1px}.prose :where(tfoot td):not(:where([class~=not-prose],[class~=not-prose] *)){vertical-align:top}.prose :where(th,td):not(:where([class~=not-prose],[class~=not-prose] *)){text-align:start}.prose :where(figure>*):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:0;margin-top:0}.prose :where(figcaption):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-captions);font-size:.875em;line-height:1.4285714;margin-top:.8571429em}.prose{--tw-prose-body:#374151;--tw-prose-headings:#111827;--tw-prose-lead:#4b5563;--tw-prose-links:#111827;--tw-prose-bold:#111827;--tw-prose-counters:#6b7280;--tw-prose-bullets:#d1d5db;--tw-prose-hr:#e5e7eb;--tw-prose-quotes:#111827;--tw-prose-quote-borders:#e5e7eb;--tw-prose-captions:#6b7280;--tw-prose-kbd:#111827;--tw-prose-kbd-shadows:17 24 39;--tw-prose-code:#111827;--tw-prose-pre-code:#e5e7eb;--tw-prose-pre-bg:#1f2937;--tw-prose-th-borders:#d1d5db;--tw-prose-td-borders:#e5e7eb;--tw-prose-invert-body:#d1d5db;--tw-prose-invert-headings:#fff;--tw-prose-invert-lead:#9ca3af;--tw-prose-invert-links:#fff;--tw-prose-invert-bold:#fff;--tw-prose-invert-counters:#9ca3af;--tw-prose-invert-bullets:#4b5563;--tw-prose-invert-hr:#374151;--tw-prose-invert-quotes:#f3f4f6;--tw-prose-invert-quote-borders:#374151;--tw-prose-invert-captions:#9ca3af;--tw-prose-invert-kbd:#fff;--tw-prose-invert-kbd-shadows:255 255 255;--tw-prose-invert-code:#fff;--tw-prose-invert-pre-code:#d1d5db;--tw-prose-invert-pre-bg:rgba(0,0,0,.5);--tw-prose-invert-th-borders:#4b5563;--tw-prose-invert-td-borders:#374151;font-size:1rem;line-height:1.75}.prose :where(picture>img):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:0;margin-top:0}.prose :where(li):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:.5em;margin-top:.5em}.prose :where(ol>li):not(:where([class~=not-prose],[class~=not-prose] *)){padding-inline-start:.375em}.prose :where(ul>li):not(:where([class~=not-prose],[class~=not-prose] *)){padding-inline-start:.375em}.prose :where(.prose>ul>li p):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:.75em;margin-top:.75em}.prose :where(.prose>ul>li>p:first-child):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:1.25em}.prose :where(.prose>ul>li>p:last-child):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:1.25em}.prose :where(.prose>ol>li>p:first-child):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:1.25em}.prose :where(.prose>ol>li>p:last-child):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:1.25em}.prose :where(ul ul,ul ol,ol ul,ol ol):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:.75em;margin-top:.75em}.prose :where(dl):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:1.25em;margin-top:1.25em}.prose :where(dd):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:.5em;padding-inline-start:1.625em}.prose :where(hr+*):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:0}.prose :where(h2+*):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:0}.prose :where(h3+*):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:0}.prose :where(h4+*):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:0}.prose :where(thead th:first-child):not(:where([class~=not-prose],[class~=not-prose] *)){padding-inline-start:0}.prose :where(thead th:last-child):not(:where([class~=not-prose],[class~=not-prose] *)){padding-inline-end:0}.prose :where(tbody td,tfoot td):not(:where([class~=not-prose],[class~=not-prose] *)){padding-inline-end:.5714286em;padding-bottom:.5714286em;padding-top:.5714286em;padding-inline-start:.5714286em}.prose :where(tbody td:first-child,tfoot td:first-child):not(:where([class~=not-prose],[class~=not-prose] *)){padding-inline-start:0}.prose :where(tbody td:last-child,tfoot td:last-child):not(:where([class~=not-prose],[class~=not-prose] *)){padding-inline-end:0}.prose :where(figure):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:2em;margin-top:2em}.prose :where(.prose>:first-child):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:0}.prose :where(.prose>:last-child):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:0}.prose-lg{font-size:1.125rem;line-height:1.7777778}.prose-lg :where(p):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:1.3333333em;margin-top:1.3333333em}.prose-lg :where([class~=lead]):not(:where([class~=not-prose],[class~=not-prose] *)){font-size:1.2222222em;line-height:1.4545455;margin-bottom:1.0909091em;margin-top:1.0909091em}.prose-lg :where(blockquote):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:1.6666667em;margin-top:1.6666667em;padding-inline-start:1em}.prose-lg :where(h1):not(:where([class~=not-prose],[class~=not-prose] *)){font-size:2.6666667em;line-height:1;margin-bottom:.8333333em;margin-top:0}.prose-lg :where(h2):not(:where([class~=not-prose],[class~=not-prose] *)){font-size:1.6666667em;line-height:1.3333333;margin-bottom:1.0666667em;margin-top:1.8666667em}.prose-lg :where(h3):not(:where([class~=not-prose],[class~=not-prose] *)){font-size:1.3333333em;line-height:1.5;margin-bottom:.6666667em;margin-top:1.6666667em}.prose-lg :where(h4):not(:where([class~=not-prose],[class~=not-prose] *)){line-height:1.5555556;margin-bottom:.4444444em;margin-top:1.7777778em}.prose-lg :where(img):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:1.7777778em;margin-top:1.7777778em}.prose-lg :where(picture):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:1.7777778em;margin-top:1.7777778em}.prose-lg :where(picture>img):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:0;margin-top:0}.prose-lg :where(video):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:1.7777778em;margin-top:1.7777778em}.prose-lg :where(kbd):not(:where([class~=not-prose],[class~=not-prose] *)){border-radius:.3125rem;font-size:.8888889em;padding-inline-end:.4444444em;padding-bottom:.2222222em;padding-top:.2222222em;padding-inline-start:.4444444em}.prose-lg :where(code):not(:where([class~=not-prose],[class~=not-prose] *)){font-size:.8888889em}.prose-lg :where(h2 code):not(:where([class~=not-prose],[class~=not-prose] *)){font-size:.8666667em}.prose-lg :where(h3 code):not(:where([class~=not-prose],[class~=not-prose] *)){font-size:.875em}.prose-lg :where(pre):not(:where([class~=not-prose],[class~=not-prose] *)){border-radius:.375rem;font-size:.8888889em;line-height:1.75;margin-bottom:2em;margin-top:2em;padding-inline-end:1.5em;padding-bottom:1em;padding-top:1em;padding-inline-start:1.5em}.prose-lg :where(ol):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:1.3333333em;margin-top:1.3333333em;padding-inline-start:1.5555556em}.prose-lg :where(ul):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:1.3333333em;margin-top:1.3333333em;padding-inline-start:1.5555556em}.prose-lg :where(li):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:.6666667em;margin-top:.6666667em}.prose-lg :where(ol>li):not(:where([class~=not-prose],[class~=not-prose] *)){padding-inline-start:.4444444em}.prose-lg :where(ul>li):not(:where([class~=not-prose],[class~=not-prose] *)){padding-inline-start:.4444444em}.prose-lg :where(.prose-lg>ul>li p):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:.8888889em;margin-top:.8888889em}.prose-lg :where(.prose-lg>ul>li>p:first-child):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:1.3333333em}.prose-lg :where(.prose-lg>ul>li>p:last-child):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:1.3333333em}.prose-lg :where(.prose-lg>ol>li>p:first-child):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:1.3333333em}.prose-lg :where(.prose-lg>ol>li>p:last-child):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:1.3333333em}.prose-lg :where(ul ul,ul ol,ol ul,ol ol):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:.8888889em;margin-top:.8888889em}.prose-lg :where(dl):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:1.3333333em;margin-top:1.3333333em}.prose-lg :where(dt):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:1.3333333em}.prose-lg :where(dd):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:.6666667em;padding-inline-start:1.5555556em}.prose-lg :where(hr):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:3.1111111em;margin-top:3.1111111em}.prose-lg :where(hr+*):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:0}.prose-lg :where(h2+*):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:0}.prose-lg :where(h3+*):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:0}.prose-lg :where(h4+*):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:0}.prose-lg :where(table):not(:where([class~=not-prose],[class~=not-prose] *)){font-size:.8888889em;line-height:1.5}.prose-lg :where(thead th):not(:where([class~=not-prose],[class~=not-prose] *)){padding-inline-end:.75em;padding-bottom:.75em;padding-inline-start:.75em}.prose-lg :where(thead th:first-child):not(:where([class~=not-prose],[class~=not-prose] *)){padding-inline-start:0}.prose-lg :where(thead th:last-child):not(:where([class~=not-prose],[class~=not-prose] *)){padding-inline-end:0}.prose-lg :where(tbody td,tfoot td):not(:where([class~=not-prose],[class~=not-prose] *)){padding-inline-end:.75em;padding-bottom:.75em;padding-top:.75em;padding-inline-start:.75em}.prose-lg :where(tbody td:first-child,tfoot td:first-child):not(:where([class~=not-prose],[class~=not-prose] *)){padding-inline-start:0}.prose-lg :where(tbody td:last-child,tfoot td:last-child):not(:where([class~=not-prose],[class~=not-prose] *)){padding-inline-end:0}.prose-lg :where(figure):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:1.7777778em;margin-top:1.7777778em}.prose-lg :where(figure>*):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:0;margin-top:0}.prose-lg :where(figcaption):not(:where([class~=not-prose],[class~=not-prose] *)){font-size:.8888889em;line-height:1.5;margin-top:1em}.prose-lg :where(.prose-lg>:first-child):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:0}.prose-lg :where(.prose-lg>:last-child):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:0}.fixed{position:fixed}.relative{position:relative}.left-4{left:1rem}.top-0{top:0}.top-32{top:8rem}.z-50{z-index:50}.mx-auto{margin-left:auto;margin-right:auto}.mb-2{margin-bottom:.5rem}.mb-3{margin-bottom:.75rem}.mb-4{margin-bottom:1rem}.mb-8{margin-bottom:2rem}.mt-1{margin-top:.25rem}.mt-8{margin-top:2rem}.block{display:block}.inline-block{display:inline-block}.flex{display:flex}.grid{display:grid}.hidden{display:none}.h-12{height:3rem}.w-12{width:3rem}.w-64{width:16rem}.w-full{width:100%}.max-w-4xl{max-width:56rem}.max-w-6xl{max-width:72rem}.max-w-7xl{max-width:80rem}.max-w-none{max-width:none}.scroll-mt-32{scroll-margin-top:8rem}.list-disc{list-style-type:disc}.list-none{list-style-type:none}.grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.items-center{align-items:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-4{gap:1rem}.gap-6{gap:1.5rem}.space-x-4>:not([hidden])~:not([hidden]){--tw-space-x-reverse:0;margin-left:calc(1rem*(1 - var(--tw-space-x-reverse)));margin-right:calc(1rem*var(--tw-space-x-reverse))}.space-x-7>:not([hidden])~:not([hidden]){--tw-space-x-reverse:0;margin-left:calc(1.75rem*(1 - var(--tw-space-x-reverse)));margin-right:calc(1.75rem*var(--tw-space-x-reverse))}.space-y-4>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-bottom:calc(1rem*var(--tw-space-y-reverse));margin-top:calc(1rem*(1 - var(--tw-space-y-reverse)))}.rounded{border-radius:.25rem}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:.5rem}.border{border-width:1px}.border-t{border-top-width:1px}.border-gray-200{--tw-border-opacity:1;border-color:rgb(229 231 235/var(--tw-border-opacity,1))}.bg-blue-600{--tw-bg-opacity:1;background-color:rgb(37 99 235/var(--tw-bg-opacity,1))}.bg-gray-200{--tw-bg-opacity:1;background-color:rgb(229 231 235/var(--tw-bg-opacity,1))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255/var(--tw-bg-opacity,1))}.object-cover{-o-object-fit:cover;object-fit:cover}.p-4{padding:1rem}.p-6{padding:1.5rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-4{padding-left:1rem;padding-right:1rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.py-2{padding-bottom:.5rem;padding-top:.5rem}.py-4{padding-bottom:1rem;padding-top:1rem}.py-8{padding-top:2rem}.pb-8,.py-8{padding-bottom:2rem}.pl-4{padding-left:1rem}.pt-20{padding-top:5rem}.text-left{text-align:left}.text-center{text-align:center}.text-2xl{font-size:1.5rem;line-height:2rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-lg{font-size:1.125rem}.text-lg,.text-xl{line-height:1.75rem}.text-xl{font-size:1.25rem}.font-bold{font-weight:700}.font-medium{font-weight:500}.font-semibold{font-weight:600}.text-blue-600{--tw-text-opacity:1;color:rgb(37 99 235/var(--tw-text-opacity,1))}.text-gray-600{--tw-text-opacity:1;color:rgb(75 85 99/var(--tw-text-opacity,1))}.text-gray-700{--tw-text-opacity:1;color:rgb(55 65 81/var(--tw-text-opacity,1))}.text-gray-800{--tw-text-opacity:1;color:rgb(31 41 55/var(--tw-text-opacity,1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity,1))}.shadow{--tw-shadow:0 1px 3px 0 rgba(0,0,0,.1),0 1px 2px -1px rgba(0,0,0,.1);--tw-shadow-colored:0 1px 3px 0 var(--tw-shadow-color),0 1px 2px -1px var(--tw-shadow-color)}.shadow,.shadow-lg{box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-lg{--tw-shadow:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -4px rgba(0,0,0,.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color),0 4px 6px -4px var(--tw-shadow-color)}.shadow-md{--tw-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -2px rgba(0,0,0,.1);--tw-shadow-colored:0 4px 6px -1px var(--tw-shadow-color),0 2px 4px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.transition-colors{transition-duration:.15s;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1)}.transition-shadow{transition-duration:.15s;transition-property:box-shadow;transition-timing-function:cubic-bezier(.4,0,.2,1)}.duration-300{transition-duration:.3s}.hover\:bg-blue-700:hover{--tw-bg-opacity:1;background-color:rgb(29 78 216/var(--tw-bg-opacity,1))}.hover\:bg-gray-300:hover{--tw-bg-opacity:1;background-color:rgb(209 213 219/var(--tw-bg-opacity,1))}.hover\:text-blue-800:hover{--tw-text-opacity:1;color:rgb(30 64 175/var(--tw-text-opacity,1))}.hover\:text-gray-900:hover{--tw-text-opacity:1;color:rgb(17 24 39/var(--tw-text-opacity,1))}.hover\:shadow-lg:hover{--tw-shadow:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -4px rgba(0,0,0,.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color),0 4px 6px -4px var(--tw-shadow-color)}.hover\:shadow-lg:hover,.hover\:shadow-md:hover{box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.hover\:shadow-md:hover{--tw-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -2px rgba(0,0,0,.1);--tw-shadow-colored:0 4px 6px -1px var(--tw-shadow-color),0 2px 4px -2px var(--tw-shadow-color)}@media (min-width:768px){.md\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.md\:grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}}@media (min-width:1024px){.lg\:block{display:block}.lg\:grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.lg\:grid-cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f8f9fa;border:1px solid #e2e8f0;border-radius:6px;margin:1em 0;padding:1em}code[class*=language-],pre[class*=language-]{color:#24292e;font-family:ui-monospace,SFMono-Regular,SF Mono,Menlo,Consolas,Liberation Mono,monospace;font-size:14px;line-height:1.5;text-shadow:none}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#6a737d}.token.punctuation{color:#24292e}.token.boolean,.token.constant,.token.number,.token.property,.token.symbol,.token.tag{color:#005cc5}.token.attr-name,.token.builtin,.token.char,.token.selector,.token.string{color:#032f62}.language-css .token.string,.style .token.string,.token.atrule,.token.attr-value,.token.entity,.token.keyword,.token.operator,.token.url{color:#d73a49}.token.function{color:#6f42c1}.token.important,.token.regex,.token.variable{color:#e36209}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]{scroll-margin-top:5rem}:root{--border-radius:4px;--color-text:#333;--color-primary:#7026b9;--color-code-bg:#fff4db;--color-code:#8a6534;--font-sans:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji";--font-mono:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;--font-lg:18px;--font-md:16px;--font-sm:14px;--font-sx:12px;--line-height-loose:1.75;--line-height-normal:1.5;--line-height-dense:1.1;--space-1:4px;--space-2:8px;--space-3:16px;--space-4:24px;--space-5:32px;--space-6:64px;--size-content:54rem;--size-gutter:var(--space-5);--size-gap:var(--space-6)}html{-webkit-text-size-adjust:100%;box-sizing:border-box;font:sans-serif;font-size:var(--font-md);line-height:var(--line-height-normal);overflow-y:scroll}body{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;word-wrap:break-word;color:var(--color-text);font-family:sans-serif;font-family:var(--font-sans);font-weight:400;margin:0}a{background-color:transparent;color:var(--color-primary);font-weight:500;text-decoration:none;text-decoration:underline;text-decoration-thickness:1.5px;text-underline-offset:2px}a:active,a:hover{outline-width:0;text-decoration:none}abbr[title]{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help;text-decoration:none}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{letter-spacing:-.01em;line-height:var(--line-height-dense);margin:0 0 3rem;padding:0}h1>b{color:var(--color-primary)}img{border-style:none;max-width:100%}code,kbd,pre,samp{font-family:var(--font-mono);font-size:1em;line-height:inherit}hr{background:rgba(0,0,0,.2);border:none;box-sizing:content-box;height:1px;margin-bottom:calc(var(--space-4) - 1px);margin-left:0;margin-right:0;margin-top:0;overflow:visible;padding:0}*,:after,:before{box-sizing:inherit}dd,dl,fieldset,figure,hgroup,img,ol,p,ul{margin:0;margin-bottom:var(--space-4);padding:0}ol,ul{list-style-image:none;list-style-position:outside;margin-left:var(--space-4)}pre{word-wrap:normal;background:rgba(0,0,0,.04);border-radius:var(--border-radius);font-size:.875rem;line-height:var(--line-height-normal);margin-bottom:var(--space-4);margin-left:0;margin-right:0;margin-top:0;overflow:auto;padding:var(--space-4)}b,dt,strong,th{font-weight:700}li{margin-bottom:calc(var(--space-4)/2)}ol li,ul li{padding-left:0}li>ol,li>ul{margin-bottom:calc(var(--space-4)/2);margin-left:var(--space-4);margin-top:calc(var(--space-4)/2)}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:calc(var(--space-4)/2)}p{max-width:680px}code,kbd,samp{font-size:.875rem}abbr,acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}code,tt{background-color:var(--color-code-bg);border-radius:var(--border-radius);color:var(--color-code);font-family:var(--font-mono);padding-bottom:.25em;padding-top:.25em;word-break:normal}pre code{background:none}code:after,code:before,tt:after,tt:before{content:"\00a0";letter-spacing:-.2em}pre code:after,pre code:before,pre tt:after,pre tt:before{content:none}</style><style type="text/css">
    .toc-anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .toc-anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .toc-anchor svg,
    h2 .toc-anchor svg,
    h3 .toc-anchor svg,
    h4 .toc-anchor svg,
    h5 .toc-anchor svg,
    h6 .toc-anchor svg {
      visibility: hidden;
    }
    h1:hover .toc-anchor svg,
    h2:hover .toc-anchor svg,
    h3:hover .toc-anchor svg,
    h4:hover .toc-anchor svg,
    h5:hover .toc-anchor svg,
    h6:hover .toc-anchor svg,
    h1 .toc-anchor:focus svg,
    h2 .toc-anchor:focus svg,
    h3 .toc-anchor:focus svg,
    h4 .toc-anchor:focus svg,
    h5 .toc-anchor:focus svg,
    h6 .toc-anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><nav class="bg-white shadow-lg fixed w-full top-0 z-50"><div class="max-w-6xl mx-auto px-4"><div class="flex justify-center"><div class="flex space-x-7"><a class="flex items-center py-4 px-2 text-gray-700 hover:text-gray-900" href="/">首页</a><a class="flex items-center py-4 px-2 text-gray-700 hover:text-gray-900" href="/tags/">标签</a><a class="flex items-center py-4 px-2 text-gray-700 hover:text-gray-900" href="/about/">关于</a><a class="flex items-center py-4 px-2 text-gray-700 hover:text-gray-900" href="/links/">友链</a></div></div></div></nav><div class="text-center" style="margin:0 auto;max-width:var(--size-content);padding:var(--size-gutter)"><main class="pt-20"></main></div><div class="max-w-7xl mx-auto px-4 py-8 relative" style="padding-top:6rem;margin-top:-6rem"><div class="max-w-4xl mx-auto" style="scroll-margin-top:6rem"><h1 class="text-4xl font-bold mb-4">[笔记]mcp for beginners</h1><div class="prose prose-lg max-w-none"><div><h1 id="mcp-for-beginners" style="position:relative;"><a href="#mcp-for-beginners" aria-label="mcp for beginners permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>mcp-for-beginners</h1>
<h1 id="01-mcp-介绍" style="position:relative;"><a href="#01-mcp-%E4%BB%8B%E7%BB%8D" aria-label="01 mcp 介绍 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>01-MCP 介绍</strong></h1>
<h3 id="mcp-标准化的优势" style="position:relative;"><a href="#mcp-%E6%A0%87%E5%87%86%E5%8C%96%E7%9A%84%E4%BC%98%E5%8A%BF" aria-label="mcp 标准化的优势 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>MCP 标准化的优势</strong></h3>
<table>
<thead>
<tr>
<th><strong>优势</strong></th>
<th><strong>描述</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>互操作性</td>
<td>LLMs 可无缝与不同供应商的工具协同工作</td>
</tr>
<tr>
<td>一致性</td>
<td>跨平台和工具的行为统一</td>
</tr>
<tr>
<td>可重用性</td>
<td>一次构建的工具可在项目与系统中复用</td>
</tr>
<tr>
<td>加速开发</td>
<td>通过标准化即插即用接口减少开发时间</td>
</tr>
</tbody>
</table>
<h2 id="mcp-高层架构概述" style="position:relative;"><a href="#mcp-%E9%AB%98%E5%B1%82%E6%9E%B6%E6%9E%84%E6%A6%82%E8%BF%B0" aria-label="mcp 高层架构概述 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>MCP 高层架构概述</strong></h2>
<p>MCP 采用<strong>客户端-服务器模型</strong>：</p>
<ul>
<li><strong>MCP Hosts</strong> 运行 AI 模型</li>
<li><strong>MCP Clients</strong> 发起请求</li>
<li><strong>MCP Servers</strong> 提供上下文、工具和能力</li>
</ul>
<h3 id="关键组件" style="position:relative;"><a href="#%E5%85%B3%E9%94%AE%E7%BB%84%E4%BB%B6" aria-label="关键组件 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>关键组件：</strong></h3>
<ul>
<li><strong>资源（Resources）</strong> – 静态或动态模型数据</li>
<li><strong>提示（Prompts）</strong> – 预定义的工作流，用于引导生成</li>
<li><strong>工具（Tools）</strong> – 可执行函数（如搜索、计算）</li>
<li><strong>采样（Sampling）</strong> – 通过递归交互实现代理行为</li>
</ul>
<h2 id="mcp-服务器如何工作" style="position:relative;"><a href="#mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C" aria-label="mcp 服务器如何工作 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>MCP 服务器如何工作</strong></h2>
<p>MCP 服务器按以下方式运作：</p>
<ul>
<li><strong>请求流程</strong>：
<ol>
<li>MCP 客户端向运行在 MCP Host 中的 AI 模型发送请求。</li>
<li>AI 模型识别何时需要外部工具或数据。</li>
<li>模型使用标准化协议与 MCP 服务器通信。</li>
</ol>
</li>
<li><strong>MCP 服务器功能</strong>：
<ul>
<li>工具注册：维护可用工具及其功能的目录。</li>
<li>身份验证：验证工具访问权限。</li>
<li>请求处理程序：处理来自模型的工具请求。</li>
<li>响应格式化器：将工具输出格式化为模型可理解的结构。</li>
</ul>
</li>
<li><strong>工具执行</strong>：
<ul>
<li>服务器将请求路由到相应的外部工具</li>
<li>工具执行其专业功能（搜索、计算、数据库查询等）</li>
<li>结果以一致的格式返回给模型</li>
</ul>
</li>
<li><strong>响应完成</strong>：
<ul>
<li>AI 模型将工具输出整合到其响应中。</li>
<li>最终响应返回给客户端应用。</li>
</ul>
</li>
</ul>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/d2e6af5a5e3bec6052b55b807430ef89/79166/mcp_image.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 20.245398773006134%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAsUlEQVR42oWO2W7CMBBF8///R0urpoEUqiyI2MaO1/h0Cu8w0tXRLPdqGl5UreB9YHWeaBzJrk/vm1qLIIgx3PmvnB0h3HBOs23+saue6+/IuTvjY3wWaCSgpeRvYmxFX/LRJ8bs6fsdSr1h7cd9NuuB99PARYtnS6JMLPHBLVLkuaYUh1ajmCbhhL0NGD3hpF+WiZR/iOlITj0Xe+KoD4x24KCEbqRVLfM605mOJSz8ARgdNdMtu2yMAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/d2e6af5a5e3bec6052b55b807430ef89/a6d36/mcp_image.png"
        srcset="/static/d2e6af5a5e3bec6052b55b807430ef89/222b7/mcp_image.png 163w,
/static/d2e6af5a5e3bec6052b55b807430ef89/ff46a/mcp_image.png 325w,
/static/d2e6af5a5e3bec6052b55b807430ef89/a6d36/mcp_image.png 650w,
/static/d2e6af5a5e3bec6052b55b807430ef89/e548f/mcp_image.png 975w,
/static/d2e6af5a5e3bec6052b55b807430ef89/3c492/mcp_image.png 1300w,
/static/d2e6af5a5e3bec6052b55b807430ef89/79166/mcp_image.png 2012w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<h2 id="如何构建-mcp-服务器附示例" style="position:relative;"><a href="#%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BA-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%99%84%E7%A4%BA%E4%BE%8B" aria-label="如何构建 mcp 服务器附示例 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>如何构建 MCP 服务器（附示例）</strong></h2>
<p>MCP 服务器允许通过提供数据和功能来扩展 LLM 能力。</p>
<p>准备尝试了吗？以下是不同语言创建简单 MCP 服务器的示例：</p>
<ul>
<li><strong>Python 示例</strong>：<a href="https://github.com/modelcontextprotocol/python-sdk">https://github.com/modelcontextprotocol/python-sdk</a></li>
<li><strong>TypeScript 示例</strong>：<a href="https://github.com/modelcontextprotocol/typescript-sdk">https://github.com/modelcontextprotocol/typescript-sdk</a></li>
<li><strong>Java 示例</strong>：<a href="https://github.com/modelcontextprotocol/java-sdk">https://github.com/modelcontextprotocol/java-sdk</a></li>
<li><strong>C#/.NET 示例</strong>：<a href="https://github.com/modelcontextprotocol/csharp-sdk">https://github.com/modelcontextprotocol/csharp-sdk</a></li>
</ul>
<h2 id="-mcp-实际应用场景" style="position:relative;"><a href="#-mcp-%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF" aria-label=" mcp 实际应用场景 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🌍 MCP 实际应用场景</strong></h2>
<p>MCP 通过扩展 AI 能力实现广泛应用：</p>
<table>
<thead>
<tr>
<th><strong>应用场景</strong></th>
<th><strong>描述</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>企业数据集成</td>
<td>将 LLMs 连接到数据库、CRM 或内部工具</td>
</tr>
<tr>
<td>代理式 AI 系统</td>
<td>通过工具访问和决策工作流实现自主代理</td>
</tr>
<tr>
<td>多模态应用</td>
<td>在单一 AI 应用中结合文本、图像和音频工具</td>
</tr>
<tr>
<td>实时数据集成</td>
<td>将实时数据引入 AI 交互，获得更准确、更新的输出</td>
</tr>
</tbody>
</table>
<h3 id="-mcp--ai-交互的通用标准" style="position:relative;"><a href="#-mcp--ai-%E4%BA%A4%E4%BA%92%E7%9A%84%E9%80%9A%E7%94%A8%E6%A0%87%E5%87%86" aria-label=" mcp  ai 交互的通用标准 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🧠 MCP = AI 交互的通用标准</strong></h3>
<p>Model Context Protocol (MCP) 是 AI 交互的通用标准，就像 USB-C 标准化了设备的物理连接一样。在 AI 领域，MCP 提供了一致的接口，允许模型（客户端）与外部工具和数据提供者（服务器）无缝集成。这消除了为每个 API 或数据源设计不同定制协议的需求。</p>
<p>在 MCP 下，兼容 MCP 的工具（称为 MCP 服务器）遵循统一标准。这些服务器可以列出它们提供的工具或操作，并在 AI 代理请求时执行这些操作。支持 MCP 的 AI 代理平台能够发现服务器上的可用工具，并通过此标准协议调用它们。</p>
<h3 id="-促进知识访问" style="position:relative;"><a href="#-%E4%BF%83%E8%BF%9B%E7%9F%A5%E8%AF%86%E8%AE%BF%E9%97%AE" aria-label=" 促进知识访问 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>💡 促进知识访问</strong></h3>
<p>除了提供工具，MCP 还促进知识访问。它使应用程序能够通过将 LLMs 连接到各种数据源来提供上下文。例如，MCP 服务器可能代表公司的文档库，允许代理按需检索相关信息。另一个服务器可能处理发送电子邮件或更新记录等特定操作。从代理的角度来看，这些只是它可使用的工具——一些工具返回数据（知识上下文），而其他工具执行操作。MCP 高效地管理两者。</p>
<p>连接到 MCP 服务器的代理通过标准格式自动了解服务器的可用能力和可访问数据。这种标准化实现了动态工具可用性。例如，向代理系统添加新的 MCP 服务器会立即使其功能可用，而无需进一步定制代理指令。</p>
<p>这种流线型集成符合 Mermaid 图表中描述的流程，其中服务器提供工具和知识，确保跨系统的无缝协作。</p>
<h3 id="-示例可扩展的代理解决方案" style="position:relative;"><a href="#-%E7%A4%BA%E4%BE%8B%E5%8F%AF%E6%89%A9%E5%B1%95%E7%9A%84%E4%BB%A3%E7%90%86%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88" aria-label=" 示例可扩展的代理解决方案 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>👉 示例：可扩展的代理解决方案</strong></h3>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/4076998494be157ec512bae037e8e9e5/7ef4c/mcp_image_1.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 99.38650306748465%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAACHklEQVR42qVUCW7bMBD0/79XFHBrW64O6lYiS6IuHtMhnRqJD8CpCSwkLsnh7uxwN3gwqqpClmUoigJCCERRhMNhjySJ0bbto2PYPFpY1xXzPGNZFm9ymNC+j7SJ/vX7gNdjmYEwHBBHI9YFrwFaa9GdBmTpG6qyx8BoXwLUWuN4DMhnRl5T8pj8P6CLzg21ukItSIWEUi+nbFgUhTiWSCKJUTpE+33AhZUoihxKKxhjzhg0ayxmrqk7oW4eRwUM/cw0Wxh9nt9euDwPKAeL4NDh17ZGnilGdbsnjmOv1TuA9mKG4bhU50lRKqsX8igNpdL7iFyaTvT+UikvRbsboVKam9UXufzjSYiU0jn6qNzz+wz8BdCYiQdT8lRiHBNMs0Ca/uTtISNK6ROMOqO90yymaeZ+4//HcboDaE9ML4ZIOmy3MRtAzTRzaHVESt9+X6Hval4o/IF50oj4BHe7ipocYcxNhCe+0xA1u0ueCVpBzjJGEeCtqVHkJWQvOBcflVWoywVlIbm+fFBkL7rcWOs0diK5bEm2o+vk58Z0Zx/c180dNdYDfpbWded54qW4yg8efF0rWk2eC/SD47UhjznXGs+xtfpWNtfmNmkdUUIVW1fOFpaQw4Q8/6DwS4R/MjR1w6qH3Ds/0xxYUR3zUIsgaLD7nZO/kX53SUspteS9Z/OI6Jue6zYuNa1diiXnFRXgipaffZTb+b+Aq8dfYEoeJ9eAosgAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/4076998494be157ec512bae037e8e9e5/a6d36/mcp_image_1.png"
        srcset="/static/4076998494be157ec512bae037e8e9e5/222b7/mcp_image_1.png 163w,
/static/4076998494be157ec512bae037e8e9e5/ff46a/mcp_image_1.png 325w,
/static/4076998494be157ec512bae037e8e9e5/a6d36/mcp_image_1.png 650w,
/static/4076998494be157ec512bae037e8e9e5/e548f/mcp_image_1.png 975w,
/static/4076998494be157ec512bae037e8e9e5/3c492/mcp_image_1.png 1300w,
/static/4076998494be157ec512bae037e8e9e5/7ef4c/mcp_image_1.png 1748w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<h3 id="-客户端-服务器-llm-集成的高级-mcp-场景" style="position:relative;"><a href="#-%E5%AE%A2%E6%88%B7%E7%AB%AF-%E6%9C%8D%E5%8A%A1%E5%99%A8-llm-%E9%9B%86%E6%88%90%E7%9A%84%E9%AB%98%E7%BA%A7-mcp-%E5%9C%BA%E6%99%AF" aria-label=" 客户端 服务器 llm 集成的高级 mcp 场景 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🔄 客户端-服务器 LLM 集成的高级 MCP 场景</strong></h3>
<p>在基础 MCP 架构之外，还有高级场景，其中客户端和服务器都包含 LLMs，实现更复杂的交互：</p>
<div class="gatsby-highlight" data-language="mermaid"><pre class="language-mermaid"><code class="language-mermaid"><span class="token arrow operator">---</span>
title<span class="token operator">:</span> 客户端-服务器 LLM 集成的高级 MCP 场景
description<span class="token operator">:</span> 展示用户、客户端应用、客户端 LLM、多个 MCP 服务器和服务器 LLM 之间详细交互流程的序列图，描述了工具发现、用户交互、直接工具调用和特性协商阶段
<span class="token arrow operator">---</span>
<span class="token keyword">sequenceDiagram</span>
    <span class="token keyword">autonumber</span>
    actor User as 👤 User
    <span class="token keyword">participant</span> ClientApp as 🖥️ Client App
    <span class="token keyword">participant</span> ClientLLM as 🧠 Client LLM
    <span class="token keyword">participant</span> Server1 as 🔧 MCP Server 1
    <span class="token keyword">participant</span> Server2 as 📚 MCP Server 2
    <span class="token keyword">participant</span> ServerLLM as 🤖 Server LLM

    <span class="token comment">%% 发现阶段</span>
    <span class="token keyword">rect</span> rgb<span class="token text string">(220, 240, 255)</span>
        <span class="token keyword">Note over</span> ClientApp, Server2<span class="token operator">:</span> 工具发现阶段
        ClientApp<span class="token arrow operator">->></span>+Server1<span class="token operator">:</span> 请求可用工具/资源
        Server1<span class="token arrow operator">-->></span>-ClientApp<span class="token operator">:</span> 返回工具列表 <span class="token text string">(JSON)</span>
        ClientApp<span class="token arrow operator">->></span>+Server2<span class="token operator">:</span> 请求可用工具/资源
        Server2<span class="token arrow operator">-->></span>-ClientApp<span class="token operator">:</span> 返回工具列表 <span class="token text string">(JSON)</span>
        <span class="token keyword">Note right of</span> ClientApp<span class="token operator">:</span> 本地存储组合后的工具目录
    <span class="token keyword">end</span>

    <span class="token comment">%% 用户交互</span>
    <span class="token keyword">rect</span> rgb<span class="token text string">(255, 240, 220)</span>
        <span class="token keyword">Note over</span> User, ClientLLM<span class="token operator">:</span> 用户交互阶段
        User<span class="token arrow operator">->></span>+ClientApp<span class="token operator">:</span> 输入自然语言提示
        ClientApp<span class="token arrow operator">->></span>+ClientLLM<span class="token operator">:</span> 转发提示 + 工具目录
        ClientLLM<span class="token arrow operator">->></span>-ClientLLM<span class="token operator">:</span> 分析提示并选择工具
    <span class="token keyword">end</span>

    <span class="token comment">%% 场景 A: 直接工具调用</span>
    <span class="token keyword">alt</span> 直接工具调用
        <span class="token keyword">rect</span> rgb<span class="token text string">(220, 255, 220)</span>
            <span class="token keyword">Note over</span> ClientApp, Server1<span class="token operator">:</span> 场景 A<span class="token operator">:</span> 直接工具调用
            ClientLLM<span class="token arrow operator">->></span>+ClientApp<span class="token operator">:</span> 请求执行工具
            ClientApp<span class="token arrow operator">->></span>+Server1<span class="token operator">:</span> 执行特定工具
            Server1<span class="token arrow operator">-->></span>-ClientApp<span class="token operator">:</span> 返回结果
            ClientApp<span class="token arrow operator">->></span>+ClientLLM<span class="token operator">:</span> 处理结果
            ClientLLM<span class="token arrow operator">-->></span>-ClientApp<span class="token operator">:</span> 生成响应
            ClientApp<span class="token arrow operator">-->></span>-User<span class="token operator">:</span> 显示最终答案
        <span class="token keyword">end</span>

    <span class="token comment">%% 场景 B: 特性协商（VS Code 风格）</span>
    <span class="token keyword">else</span> 特性协商（VS Code 风格）
        <span class="token keyword">rect</span> rgb<span class="token text string">(255, 220, 220)</span>
            <span class="token keyword">Note over</span> ClientApp, ServerLLM<span class="token operator">:</span> 场景 B<span class="token operator">:</span> 特性协商
            ClientLLM<span class="token arrow operator">->></span>+ClientApp<span class="token operator">:</span> 识别所需能力
            ClientApp<span class="token arrow operator">->></span>+Server2<span class="token operator">:</span> 协商特性/能力
            Server2<span class="token arrow operator">->></span>+ServerLLM<span class="token operator">:</span> 请求额外上下文
            ServerLLM<span class="token arrow operator">-->></span>-Server2<span class="token operator">:</span> 提供上下文
            Server2<span class="token arrow operator">-->></span>-ClientApp<span class="token operator">:</span> 返回可用特性
            ClientApp<span class="token arrow operator">->></span>+Server2<span class="token operator">:</span> 调用协商后的工具
            Server2<span class="token arrow operator">-->></span>-ClientApp<span class="token operator">:</span> 返回结果
            ClientApp<span class="token arrow operator">->></span>+ClientLLM<span class="token operator">:</span> 处理结果
            ClientLLM<span class="token arrow operator">-->></span>-ClientApp<span class="token operator">:</span> 生成响应
            ClientApp<span class="token arrow operator">-->></span>-User<span class="token operator">:</span> 显示最终答案
        <span class="token keyword">end</span>
    <span class="token keyword">end</span></code></pre></div>
<h2 id="-mcp-的实际优势" style="position:relative;"><a href="#-mcp-%E7%9A%84%E5%AE%9E%E9%99%85%E4%BC%98%E5%8A%BF" aria-label=" mcp 的实际优势 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🔐 MCP 的实际优势</strong></h2>
<p>使用 MCP 的实际优势包括：</p>
<ul>
<li><strong>新鲜度</strong>：模型可访问超出其训练数据的最新信息</li>
<li><strong>能力扩展</strong>：模型可利用未训练过的专业工具</li>
<li><strong>减少幻觉</strong>：外部数据源提供事实依据</li>
<li><strong>隐私</strong>：敏感数据可保留在安全环境中，而非嵌入提示中</li>
</ul>
<h2 id="-关键要点" style="position:relative;"><a href="#-%E5%85%B3%E9%94%AE%E8%A6%81%E7%82%B9" aria-label=" 关键要点 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>📌 关键要点</strong></h2>
<p>使用 MCP 的关键要点：</p>
<ul>
<li><strong>MCP</strong> 标准化了 AI 模型与工具和数据的交互方式</li>
<li>促进<strong>可扩展性、一致性和互操作性</strong></li>
<li>MCP 有助于<strong>减少开发时间、提高可靠性并扩展模型能力</strong></li>
<li>客户端-服务器架构<strong>支持灵活、可扩展的 AI 应用</strong></li>
</ul>
<h1 id="02-核心概念详解" style="position:relative;"><a href="#02-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E8%AF%A6%E8%A7%A3" aria-label="02 核心概念详解 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>02-核心概念详解</strong></h1>
<h2 id="-mcp-架构深入解析" style="position:relative;"><a href="#-mcp-%E6%9E%B6%E6%9E%84%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90" aria-label=" mcp 架构深入解析 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🔎 MCP 架构：深入解析</strong></h2>
<p>MCP 生态系统基于客户端-服务器模型构建。这种模块化结构使 AI 应用能够高效地与工具、数据库、API 和上下文资源交互。让我们将这个架构分解为其核心组件。</p>
<h3 id="1-主机" style="position:relative;"><a href="#1-%E4%B8%BB%E6%9C%BA" aria-label="1 主机 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>1. 主机</strong></h3>
<p>在模型上下文协议（MCP）中，主机作为用户与协议交互的主要接口，扮演着关键角色。主机是启动与 MCP 服务器连接以访问数据、工具和提示的应用程序或环境。主机的示例包括集成开发环境（IDE）如 Visual Studio Code、AI 工具如 Claude Desktop，或为特定任务设计的自定义代理。</p>
<p><strong>主机</strong>是执行或与 AI 模型交互的 LLM 应用程序，它们：</p>
<ul>
<li>执行或与 AI 模型交互以生成响应</li>
<li>启动与 MCP 服务器的连接</li>
<li>管理对话流程和用户界面</li>
<li>控制权限和安全约束</li>
<li>处理数据共享和工具执行的用户同意</li>
</ul>
<h3 id="2-客户端" style="position:relative;"><a href="#2-%E5%AE%A2%E6%88%B7%E7%AB%AF" aria-label="2 客户端 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>2. 客户端</strong></h3>
<p>客户端是促进主机与 MCP 服务器之间交互的关键组件。客户端充当中介，使主机能够访问和利用 MCP 服务器提供的功能。它们在确保 MCP 架构内通信流畅和数据高效交换方面起着至关重要的作用。</p>
<p><strong>客户端</strong>是主机应用程序内的连接器，它们：</p>
<ul>
<li>向服务器发送带有提示/指令的请求</li>
<li>与服务器协商能力</li>
<li>管理来自模型的工具执行请求</li>
<li>处理并向用户显示响应</li>
</ul>
<h3 id="3-服务器" style="position:relative;"><a href="#3-%E6%9C%8D%E5%8A%A1%E5%99%A8" aria-label="3 服务器 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>3. 服务器</strong></h3>
<p>服务器负责处理来自 MCP 客户端的请求并提供适当的响应。它们管理各种操作，如数据检索、工具执行和提示生成。服务器确保客户端与主机之间的通信高效可靠，保持交互过程的完整性。</p>
<p><strong>服务器</strong>是提供上下文和能力的服务，它们：</p>
<ul>
<li>注册可用功能（资源、提示、工具）</li>
<li>接收并执行来自客户端的工具调用</li>
<li>提供上下文信息以增强模型响应</li>
<li>将输出返回给客户端</li>
<li>在需要时维护跨交互的状态</li>
</ul>
<p>任何人都可以开发服务器，通过专业功能扩展模型能力。</p>
<h3 id="4-服务器功能" style="position:relative;"><a href="#4-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8A%9F%E8%83%BD" aria-label="4 服务器功能 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>4. 服务器功能</strong></h3>
<p>模型上下文协议（MCP）中的服务器提供基本的构建模块，使客户端、主机和语言模型之间能够进行丰富的交互。这些功能旨在通过提供结构化上下文、工具和提示来增强 MCP 的能力。</p>
<p>MCP 服务器可以提供以下任何功能：</p>
<h3 id="-资源" style="position:relative;"><a href="#-%E8%B5%84%E6%BA%90" aria-label=" 资源 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>📑 资源</strong></h3>
<p>模型上下文协议（MCP）中的资源包括用户或 AI 模型可以利用的各种上下文和数据类型：</p>
<ul>
<li><strong>上下文数据</strong>：用户或 AI 模型可用于决策和任务执行的信息和上下文</li>
<li><strong>知识库和文档仓库</strong>：结构化和非结构化数据的集合，如文章、手册和研究论文，提供有价值的见解和信息</li>
<li><strong>本地文件和数据库</strong>：存储在设备本地或数据库中的数据，可供处理和分析</li>
<li><strong>API 和 Web 服务</strong>：提供额外数据功能的外部接口和服务，支持与各种在线资源和工具的集成</li>
</ul>
<h3 id="-提示" style="position:relative;"><a href="#-%E6%8F%90%E7%A4%BA" aria-label=" 提示 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🤖 提示</strong></h3>
<p>模型上下文协议（MCP）中的提示包括各种预定义的模板和交互模式，旨在简化用户工作流程并增强通信：</p>
<ul>
<li><strong>模板化消息和工作流程</strong>：预结构化的消息和流程，引导用户完成特定任务和交互</li>
<li><strong>预定义交互模式</strong>：标准化的操作和响应序列，促进一致高效的通信</li>
<li><strong>专业对话模板</strong>：为特定类型对话定制的可定制模板，确保相关和上下文适当的交互</li>
</ul>
<p>提示模板示例如下：</p>
<div class="gatsby-highlight" data-language="markdown"><pre class="language-markdown"><code class="language-markdown">根据以下 {{product}} 和 {{keywords}} 生成产品标语</code></pre></div>
<h3 id="️-工具" style="position:relative;"><a href="#%EF%B8%8F-%E5%B7%A5%E5%85%B7" aria-label="️ 工具 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>⛏️ 工具</strong></h3>
<p>模型上下文协议（MCP）中的工具是 AI 模型可以执行以完成特定任务的函数。这些工具旨在通过提供结构化和可靠的操作来增强 AI 模型的能力。关键方面包括：</p>
<ul>
<li><strong>AI 模型执行的函数</strong>：工具是 AI 模型可以调用的可执行函数，用于执行各种任务</li>
<li><strong>唯一名称和描述</strong>：每个工具都有一个独特的名称和详细描述，解释其目的和功能</li>
<li><strong>参数和输出</strong>：工具接受特定参数并返回结构化输出，确保一致和可预测的结果</li>
<li><strong>离散函数</strong>：工具执行离散函数，如网络搜索、计算和数据库查询</li>
</ul>
<p>工具示例如下：</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx">server<span class="token punctuation">.</span><span class="token function">tool</span><span class="token punctuation">(</span>
  <span class="token string">"GetProducts"</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    pageSize<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">optional</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    pageCount<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">optional</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="token comment">// 从 API 返回结果</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<h2 id="客户端功能" style="position:relative;"><a href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%8A%9F%E8%83%BD" aria-label="客户端功能 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>客户端功能</strong></h2>
<p>在模型上下文协议（MCP）中，客户端向服务器提供几个关键功能，增强协议的整体功能和交互。其中一个显著功能是采样。</p>
<h3 id="-采样" style="position:relative;"><a href="#-%E9%87%87%E6%A0%B7" aria-label=" 采样 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>👉 采样</strong></h3>
<ul>
<li><strong>服务器启动的代理行为</strong>：客户端使服务器能够自主启动特定操作或行为，增强系统的动态能力</li>
<li><strong>递归 LLM 交互</strong>：此功能允许与大型语言模型（LLMs）进行递归交互，支持更复杂和迭代的任务处理</li>
<li><strong>请求额外的模型补全</strong>：服务器可以请求模型的额外补全，确保响应全面且上下文相关</li>
</ul>
<h2 id="mcp-中的信息流" style="position:relative;"><a href="#mcp-%E4%B8%AD%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81" aria-label="mcp 中的信息流 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>MCP 中的信息流</strong></h2>
<p>模型上下文协议（MCP）定义了主机、客户端、服务器和模型之间的结构化信息流。理解这种流程有助于阐明用户请求如何处理以及外部工具和数据如何集成到模型响应中。</p>
<ul>
<li>
<p><strong>主机启动连接</strong></p>
<p>主机应用程序（如 IDE 或聊天界面）建立到 MCP 服务器的连接，通常通过 STDIO、WebSocket 或其他支持的传输方式</p>
</li>
<li>
<p><strong>能力协商</strong></p>
<p>客户端（嵌入在主机中）和服务器交换有关其支持的功能、工具、资源和协议版本的信息。这确保双方了解会话中可用的能力</p>
</li>
<li>
<p><strong>用户请求</strong></p>
<p>用户与主机交互（例如输入提示或命令）。主机收集此输入并将其传递给客户端进行处理</p>
</li>
<li>
<p><strong>资源或工具使用</strong></p>
<ul>
<li>客户端可能从服务器请求额外的上下文或资源（如文件、数据库条目或知识库文章）以丰富模型的理解</li>
<li>如果模型确定需要工具（例如获取数据、执行计算或调用 API），客户端将工具调用请求发送到服务器，指定工具名称和参数</li>
</ul>
</li>
<li>
<p><strong>服务器执行</strong></p>
<p>服务器接收资源或工具请求，执行必要的操作（如运行函数、查询数据库或检索文件），并将结果以结构化格式返回给客户端</p>
</li>
<li>
<p><strong>响应生成</strong></p>
<p>客户端将服务器的响应（资源数据、工具输出等）整合到正在进行的模型交互中。模型使用此信息生成全面且上下文相关的响应</p>
</li>
<li>
<p><strong>结果呈现</strong></p>
<p>主机从客户端接收最终输出，并将其呈现给用户，通常包括模型生成的文本和任何工具执行或资源查找的结果</p>
</li>
</ul>
<p>这种流程使 MCP 能够支持高级、交互式和上下文感知的 AI 应用程序，通过无缝连接模型与外部工具和数据源。</p>
<h2 id="协议详情" style="position:relative;"><a href="#%E5%8D%8F%E8%AE%AE%E8%AF%A6%E6%83%85" aria-label="协议详情 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>协议详情</strong></h2>
<p>MCP（模型上下文协议）建立在 <a href="https://www.jsonrpc.org/">JSON-RPC 2.0</a> 之上，为主机、客户端和服务器之间的通信提供了标准化、语言无关的消息格式。这个基础支持跨不同平台和编程语言的可靠、结构化和可扩展的交互。</p>
<h3 id="关键协议特性" style="position:relative;"><a href="#%E5%85%B3%E9%94%AE%E5%8D%8F%E8%AE%AE%E7%89%B9%E6%80%A7" aria-label="关键协议特性 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>关键协议特性</strong></h3>
<p>MCP 使用工具调用、资源访问和提示管理的附加约定扩展了 JSON-RPC 2.0。它支持多种传输层（STDIO、WebSocket、SSE），并确保组件之间的安全、可扩展和语言无关的通信。</p>
<h3 id="-基础协议" style="position:relative;"><a href="#-%E5%9F%BA%E7%A1%80%E5%8D%8F%E8%AE%AE" aria-label=" 基础协议 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🧢 基础协议</strong></h3>
<ul>
<li><strong>JSON-RPC 消息格式</strong>：所有请求和响应使用 JSON-RPC 2.0 规范，确保方法调用、参数、结果和错误处理的结构一致性</li>
<li><strong>有状态连接</strong>：MCP 会话在多个请求之间保持状态，支持持续对话、上下文积累和资源管理</li>
<li><strong>能力协商</strong>：在连接建立期间，客户端和服务器交换有关支持的功能、协议版本、可用工具和资源的信息。这确保双方了解彼此的能力并可以相应调整</li>
</ul>
<h3 id="-附加实用工具" style="position:relative;"><a href="#-%E9%99%84%E5%8A%A0%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7" aria-label=" 附加实用工具 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>➕ 附加实用工具</strong></h3>
<p>以下是 MCP 提供的一些附加实用工具和协议扩展，以增强开发人员体验并支持高级场景：</p>
<ul>
<li><strong>配置选项</strong>：MCP 允许动态配置会话参数，如工具权限、资源访问和模型设置，针对每次交互进行定制</li>
<li><strong>进度跟踪</strong>：长时间运行的操作可以报告进度更新，在复杂任务期间实现响应式用户界面和更好的用户体验</li>
<li><strong>请求取消</strong>：客户端可以取消进行中的请求，允许用户中断不再需要或耗时过长的操作</li>
<li><strong>错误报告</strong>：标准化的错误消息和代码有助于诊断问题、优雅地处理故障并向用户和开发人员提供可操作的反馈</li>
<li><strong>日志记录</strong>：客户端和服务器都可以发出结构化日志用于审计、调试和监控协议交互</li>
</ul>
<p>通过利用这些协议特性，MCP 确保了语言模型与外部工具或数据源之间的稳健、安全和灵活的通信。</p>
<h3 id="-安全考虑" style="position:relative;"><a href="#-%E5%AE%89%E5%85%A8%E8%80%83%E8%99%91" aria-label=" 安全考虑 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🔐 安全考虑</strong></h3>
<p>MCP 实现应遵循几个关键安全原则，以确保安全和可信的交互：</p>
<ul>
<li><strong>用户同意和控制</strong>：在执行任何数据访问或操作之前，用户必须提供明确同意。他们应该清楚地控制共享哪些数据以及授权哪些操作，并通过直观的用户界面支持审查和批准活动</li>
<li><strong>数据隐私</strong>：用户数据只能在明确同意的情况下公开，并且必须通过适当的访问控制进行保护。MCP 实现必须防范未经授权的数据传输，并确保所有交互过程中维护隐私</li>
<li><strong>工具安全</strong>：在调用任何工具之前，需要明确的用户同意。用户应清楚了解每个工具的功能，并且必须强制执行强大的安全边界以防止意外或不安全的工具执行</li>
</ul>
<p>通过遵循这些原则，MCP 确保在所有协议交互中维护用户信任、隐私和安全。</p>
<h2 id="代码示例关键组件" style="position:relative;"><a href="#%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B%E5%85%B3%E9%94%AE%E7%BB%84%E4%BB%B6" aria-label="代码示例关键组件 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>代码示例：关键组件</strong></h2>
<p>以下是几种流行编程语言的代码示例，说明如何实现关键的 MCP 服务器组件和工具。</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment">#!/usr/bin/env python3</span>
<span class="token keyword">import</span> asyncio
<span class="token keyword">from</span> mcp<span class="token punctuation">.</span>server<span class="token punctuation">.</span>fastmcp <span class="token keyword">import</span> FastMCP
<span class="token keyword">from</span> mcp<span class="token punctuation">.</span>server<span class="token punctuation">.</span>transports<span class="token punctuation">.</span>stdio <span class="token keyword">import</span> serve_stdio

<span class="token comment"># 创建 FastMCP 服务器</span>
mcp <span class="token operator">=</span> FastMCP<span class="token punctuation">(</span>
    name<span class="token operator">=</span><span class="token string">"天气 MCP 服务器"</span><span class="token punctuation">,</span>
    version<span class="token operator">=</span><span class="token string">"1.0.0"</span>
<span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@mcp<span class="token punctuation">.</span>tool</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">get_weather</span><span class="token punctuation">(</span>location<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">dict</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""获取当前位置的天气"""</span>
    <span class="token comment"># 这里通常会调用天气 API</span>
    <span class="token comment"># 为演示简化</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token string">"temperature"</span><span class="token punctuation">:</span> <span class="token number">72.5</span><span class="token punctuation">,</span>
        <span class="token string">"conditions"</span><span class="token punctuation">:</span> <span class="token string">"晴天"</span><span class="token punctuation">,</span>
        <span class="token string">"location"</span><span class="token punctuation">:</span> location
    <span class="token punctuation">}</span>

<span class="token comment"># 使用类的替代方法</span>
<span class="token keyword">class</span> <span class="token class-name">WeatherTools</span><span class="token punctuation">:</span>
    <span class="token decorator annotation punctuation">@mcp<span class="token punctuation">.</span>tool</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">forecast</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> location<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> days<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">dict</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""获取指定位置未来天数的天气预报"""</span>
        <span class="token comment"># 这里通常会调用天气 API 的预报端点</span>
        <span class="token comment"># 为演示简化</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token string">"location"</span><span class="token punctuation">:</span> location<span class="token punctuation">,</span>
            <span class="token string">"forecast"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span><span class="token string">"day"</span><span class="token punctuation">:</span> i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"temperature"</span><span class="token punctuation">:</span> <span class="token number">70</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> <span class="token string">"conditions"</span><span class="token punctuation">:</span> <span class="token string">"局部多云"</span><span class="token punctuation">}</span>
                <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>days<span class="token punctuation">)</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>

<span class="token comment"># 实例化类以注册其工具</span>
weather_tools <span class="token operator">=</span> WeatherTools<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 使用 stdio 传输启动服务器</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>serve_stdio<span class="token punctuation">(</span>mcp<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<h2 id="安全与授权" style="position:relative;"><a href="#%E5%AE%89%E5%85%A8%E4%B8%8E%E6%8E%88%E6%9D%83" aria-label="安全与授权 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>安全与授权</strong></h2>
<p>MCP 包含几个内置概念和机制，用于在整个协议中管理安全性和授权：</p>
<ol>
<li>
<p><strong>工具权限控制</strong>：</p>
<p>客户端可以指定模型在会话期间允许使用的工具。这确保只有明确授权的工具可访问，降低了意外或不安全操作的风险。权限可以根据用户偏好、组织策略或交互上下文动态配置</p>
</li>
<li>
<p><strong>身份验证</strong>：</p>
<p>服务器可以在授予工具、资源或敏感操作访问权限之前要求身份验证。这可能涉及 API 密钥、OAuth 令牌或其他身份验证方案。适当的身份验证确保只有受信任的客户端和用户可以调用服务器端功能</p>
</li>
<li>
<p><strong>验证</strong>：</p>
<p>对所有工具调用强制执行参数验证。每个工具定义其参数的预期类型、格式和约束，服务器相应地验证传入请求。这防止格式错误或恶意输入到达工具实现，并有助于维护操作的完整性</p>
</li>
<li>
<p><strong>速率限制</strong>：</p>
<p>为防止滥用并确保服务器资源的公平使用，MCP 服务器可以实现工具调用和资源访问的速率限制。速率限制可以按用户、按会话或全局应用，有助于防范拒绝服务攻击或过度资源消耗</p>
</li>
</ol>
<p>通过结合这些机制，MCP 为将语言模型与外部工具和数据源集成提供了安全基础，同时为用户和开发人员提供了对访问和使用的细粒度控制。</p>
<h2 id="协议消息" style="position:relative;"><a href="#%E5%8D%8F%E8%AE%AE%E6%B6%88%E6%81%AF" aria-label="协议消息 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>协议消息</strong></h2>
<p>MCP 通信使用结构化 JSON 消息，以促进客户端、服务器和模型之间的清晰可靠交互。主要消息类型包括：</p>
<ul>
<li>
<p><strong>客户端请求</strong></p>
<p>从客户端发送到服务器，通常包括：</p>
<ul>
<li>用户的提示或命令</li>
<li>用于上下文的对话历史</li>
<li>工具配置和权限</li>
<li>任何额外的元数据或会话信息</li>
</ul>
</li>
<li>
<p><strong>模型响应</strong></p>
<p>由模型（通过客户端）返回，包含：</p>
<ul>
<li>基于提示和上下文生成的文本或补全</li>
<li>如果模型确定应调用工具，则包含可选的工具调用指令</li>
<li>根据需要引用资源或其他上下文</li>
</ul>
</li>
<li>
<p><strong>工具请求</strong></p>
<p>当需要执行工具时，从客户端发送到服务器。此消息包括：</p>
<ul>
<li>要调用的工具名称</li>
<li>工具所需的参数（根据工具的模式进行验证）</li>
<li>用于跟踪请求的上下文信息或标识符</li>
</ul>
</li>
<li>
<p><strong>工具响应</strong></p>
<p>服务器执行工具后返回。此消息提供：</p>
<ul>
<li>工具执行的结果（结构化数据或内容）</li>
<li>如果工具调用失败，则包含任何错误或状态信息</li>
<li>可选地包含与执行相关的其他元数据或日志</li>
</ul>
</li>
</ul>
<p>这些结构化消息确保 MCP 工作流程中的每个步骤都是明确、可追踪和可扩展的，支持高级场景，如多轮对话、工具链和稳健的错误处理。</p>
<h2 id="关键要点" style="position:relative;"><a href="#%E5%85%B3%E9%94%AE%E8%A6%81%E7%82%B9" aria-label="关键要点 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>关键要点</strong></h2>
<ul>
<li>MCP 使用客户端-服务器架构连接模型与外部功能</li>
<li>生态系统包括客户端、主机、服务器、工具和数据源</li>
<li>通信可以通过 STDIO、SSE 或 WebSockets 进行</li>
<li>工具是暴露给模型的基本功能单元</li>
<li>结构化通信协议确保一致的交互</li>
</ul>
<h1 id="03-mcp-安全性" style="position:relative;"><a href="#03-mcp-%E5%AE%89%E5%85%A8%E6%80%A7" aria-label="03 mcp 安全性 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>03-MCP 安全性</strong></h1>
<h2 id="入门指南" style="position:relative;"><a href="#%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97" aria-label="入门指南 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>入门指南</strong></h2>
<p>本节包含多个课程：</p>
<ul>
<li><strong>1- 的第一个服务器</strong>，在第一课中，将学习如何创建第一个服务器并使用检查器工具进行检查，这是测试和调试服务器的宝贵方式</li>
<li><strong>2- 客户端</strong>，在本课中，将学习如何编写能连接到服务器的客户端</li>
<li><strong>3- 带 LLM 的客户端</strong>，编写客户端的更好方式是添加 LLM，使其能够与服务器”协商”操作</li>
<li><strong>4- 在 Visual Studio Code 中使用 GitHub Copilot 代理模式消费服务器</strong>。这里，我们将探讨如何在 Visual Studio Code 中运行 MCP 服务器</li>
<li><strong>5- 通过 SSE（服务器发送事件）消费</strong>。SSE 是服务器到客户端流的标准，允许服务器通过 HTTP 向客户端推送实时更新</li>
<li><strong>6- 使用 VSCode 的 AI 工具包</strong>来消费和测试的 MCP 客户端和服务器</li>
<li><strong>7 测试</strong>。这里我们将特别关注如何以不同方式测试服务器和客户端</li>
<li><strong>8- 部署</strong>。本章将探讨部署 MCP 解决方案的不同方式</li>
</ul>
<h2 id="01-first-server" style="position:relative;"><a href="#01-first-server" aria-label="01 first server permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>01-first-server</h2>
<p>mcp</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment"># server.py</span>
<span class="token keyword">from</span> mcp<span class="token punctuation">.</span>server<span class="token punctuation">.</span>fastmcp <span class="token keyword">import</span> FastMCP

<span class="token comment"># Create an MCP server</span>
mcp <span class="token operator">=</span> FastMCP<span class="token punctuation">(</span><span class="token string">"Demo"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"123123"</span><span class="token punctuation">)</span>

<span class="token comment"># Add an addition tool</span>
<span class="token decorator annotation punctuation">@mcp<span class="token punctuation">.</span>tool</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">int</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Add two numbers"""</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> b

<span class="token comment"># Add a dynamic greeting resource</span>
<span class="token decorator annotation punctuation">@mcp<span class="token punctuation">.</span>resource</span><span class="token punctuation">(</span><span class="token string">"greeting://{name}"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">get_greeting</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Get a personalized greeting"""</span>
    <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"Hello, </span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">!"</span></span></code></pre></div>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/7f06e53f30757e2e1a4fe9000a6f119d/3c1e5/mcp_image_2.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 74.23312883435584%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB4ElEQVR42o1Uy44TMRDM1yNOG4kTEos48EOIA4cV4sIqmck8PX7b4xRlT5LN5iU6qpmM3V1ddre92lYtNtUOdd3Ch4RgPWQzQo4aSnuoXQ81WUgTIPM33xkx7hEC6ANos0AIj9U4CGh+zSkhW7QOqulI7BgQEcWE4Dx8nBEIzXHP8T1/eAdgjgGrtu1L4J5jez7mORXg4BYPiY7mvIdjgsTx7H9EEROoUCtzGsiW0r44L/8Tg927wDjPxWcR8IaFkAoHLllKBcXNMNaWAMNlxRgXlWfJjgot5y9JT4RZflY5jlPZy8tlvClfVP/4+QtPn57xd7O9SlgIldaYpCQhi2PsFdGlZf+6baGCvZrzVL5qRI/JaTiyZ650pvAW0jHhoYjn8NzvVT+Jks0Ebn46C3hg91ZR2qYZqdAbWH5kt/8hvGeFcJSsslWsrEFiZWNuZjbwPctzuZDeh9uEZuhglIBXij3hYFicuulhfSyn4xK5vaq6gZjkbcJvX75jvf6Mr3x//LDG75c/GKVFO0hoF6FsOGHS9uGWFMKc7XVb4XVToekGtoVD1Q7Y8FIQvAy0n0+YjC8N/ZCw73ibcLmap8Wwx3JzN1xyxdun3nW8QRT7VBcIIdkaFsG7a/AcO63wDxx/kwnZz+Q1AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/7f06e53f30757e2e1a4fe9000a6f119d/a6d36/mcp_image_2.png"
        srcset="/static/7f06e53f30757e2e1a4fe9000a6f119d/222b7/mcp_image_2.png 163w,
/static/7f06e53f30757e2e1a4fe9000a6f119d/ff46a/mcp_image_2.png 325w,
/static/7f06e53f30757e2e1a4fe9000a6f119d/a6d36/mcp_image_2.png 650w,
/static/7f06e53f30757e2e1a4fe9000a6f119d/e548f/mcp_image_2.png 975w,
/static/7f06e53f30757e2e1a4fe9000a6f119d/3c492/mcp_image_2.png 1300w,
/static/7f06e53f30757e2e1a4fe9000a6f119d/3c1e5/mcp_image_2.png 2854w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<h2 id="02-client" style="position:relative;"><a href="#02-client" aria-label="02 client permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>02-client</h2>
<p>client.py</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> mcp <span class="token keyword">import</span> ClientSession<span class="token punctuation">,</span> StdioServerParameters<span class="token punctuation">,</span> types
<span class="token keyword">from</span> mcp<span class="token punctuation">.</span>client<span class="token punctuation">.</span>stdio <span class="token keyword">import</span> stdio_client

<span class="token comment"># Create server parameters for stdio connection</span>
server_params <span class="token operator">=</span> StdioServerParameters<span class="token punctuation">(</span>
    command<span class="token operator">=</span><span class="token string">"mcp"</span><span class="token punctuation">,</span>  <span class="token comment"># Executable</span>
    args<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"run"</span><span class="token punctuation">,</span> <span class="token string">"server.py"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># Optional command line arguments</span>
    env<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>  <span class="token comment"># Optional environment variables</span>
<span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">async</span> <span class="token keyword">with</span> stdio_client<span class="token punctuation">(</span>server_params<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token punctuation">(</span>read<span class="token punctuation">,</span> write<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">async</span> <span class="token keyword">with</span> ClientSession<span class="token punctuation">(</span>
            read<span class="token punctuation">,</span> write
        <span class="token punctuation">)</span> <span class="token keyword">as</span> session<span class="token punctuation">:</span>
            <span class="token comment"># Initialize the connection</span>
            <span class="token keyword">await</span> session<span class="token punctuation">.</span>initialize<span class="token punctuation">(</span><span class="token punctuation">)</span>

            <span class="token comment"># List available resources</span>
            resources <span class="token operator">=</span> <span class="token keyword">await</span> session<span class="token punctuation">.</span>list_resources<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"LISTING RESOURCES"</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> resource <span class="token keyword">in</span> resources<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Resource: "</span><span class="token punctuation">,</span> resource<span class="token punctuation">)</span>

            <span class="token comment"># List available tools</span>
            tools <span class="token operator">=</span> <span class="token keyword">await</span> session<span class="token punctuation">.</span>list_tools<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"LISTING TOOLS"</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> tool <span class="token keyword">in</span> tools<span class="token punctuation">.</span>tools<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Tool: "</span><span class="token punctuation">,</span> tool<span class="token punctuation">.</span>name<span class="token punctuation">)</span>

            <span class="token comment"># Read a resource</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"READING RESOURCE"</span><span class="token punctuation">)</span>
            content<span class="token punctuation">,</span> mime_type <span class="token operator">=</span> <span class="token keyword">await</span> session<span class="token punctuation">.</span>read_resource<span class="token punctuation">(</span><span class="token string">"greeting://hello"</span><span class="token punctuation">)</span>

            <span class="token comment"># Call a tool</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"CALL TOOL"</span><span class="token punctuation">)</span>
            result <span class="token operator">=</span> <span class="token keyword">await</span> session<span class="token punctuation">.</span>call_tool<span class="token punctuation">(</span><span class="token string">"add"</span><span class="token punctuation">,</span> arguments<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"a"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>content<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    <span class="token keyword">import</span> asyncio

    asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<p>python3 client.py</p>
<p>output:</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"> python3 client<span class="token punctuation">.</span>py
<span class="token punctuation">[</span><span class="token number">06</span><span class="token operator">/</span><span class="token number">14</span><span class="token operator">/</span><span class="token number">25</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">47</span><span class="token punctuation">:</span><span class="token number">27</span><span class="token punctuation">]</span> INFO     Processing request of <span class="token builtin">type</span>                  server<span class="token punctuation">.</span>py<span class="token punctuation">:</span><span class="token number">523</span>
                             ListResourcesRequest
LISTING RESOURCES
Resource<span class="token punctuation">:</span>  <span class="token punctuation">(</span><span class="token string">'meta'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
Resource<span class="token punctuation">:</span>  <span class="token punctuation">(</span><span class="token string">'nextCursor'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
Resource<span class="token punctuation">:</span>  <span class="token punctuation">(</span><span class="token string">'resources'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                    INFO     Processing request of <span class="token builtin">type</span> ListToolsRequest server<span class="token punctuation">.</span>py<span class="token punctuation">:</span><span class="token number">523</span>
LISTING TOOLS
Tool<span class="token punctuation">:</span>  add
READING RESOURCE
                    INFO     Processing request of <span class="token builtin">type</span>                  server<span class="token punctuation">.</span>py<span class="token punctuation">:</span><span class="token number">523</span>
                             ReadResourceRequest
CALL TOOL
                    INFO     Processing request of <span class="token builtin">type</span> CallToolRequest  server<span class="token punctuation">.</span>py<span class="token punctuation">:</span><span class="token number">523</span>
<span class="token punctuation">[</span>TextContent<span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'text'</span><span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string">'8'</span><span class="token punctuation">,</span> annotations<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">]</span></code></pre></div>
<h2 id="03-llm-client" style="position:relative;"><a href="#03-llm-client" aria-label="03 llm client permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>03-llm-client</h2>
<p>client.py</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> mcp <span class="token keyword">import</span> ClientSession<span class="token punctuation">,</span> StdioServerParameters<span class="token punctuation">,</span> types
<span class="token keyword">from</span> mcp<span class="token punctuation">.</span>client<span class="token punctuation">.</span>stdio <span class="token keyword">import</span> stdio_client

<span class="token comment"># llm</span>
<span class="token keyword">import</span> os
<span class="token keyword">from</span> azure<span class="token punctuation">.</span>ai<span class="token punctuation">.</span>inference <span class="token keyword">import</span> ChatCompletionsClient
<span class="token keyword">from</span> azure<span class="token punctuation">.</span>ai<span class="token punctuation">.</span>inference<span class="token punctuation">.</span>models <span class="token keyword">import</span> SystemMessage<span class="token punctuation">,</span> UserMessage
<span class="token keyword">from</span> azure<span class="token punctuation">.</span>core<span class="token punctuation">.</span>credentials <span class="token keyword">import</span> AzureKeyCredential
<span class="token keyword">from</span> dotenv <span class="token keyword">import</span> load_dotenv
<span class="token keyword">import</span> json

load_dotenv<span class="token punctuation">(</span><span class="token punctuation">)</span> 

<span class="token comment"># Create server parameters for stdio connection</span>
server_params <span class="token operator">=</span> StdioServerParameters<span class="token punctuation">(</span>
    command<span class="token operator">=</span><span class="token string">"mcp"</span><span class="token punctuation">,</span>  <span class="token comment"># Executable</span>
    args<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"run"</span><span class="token punctuation">,</span> <span class="token string">"server.py"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># Optional command line arguments</span>
    env<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>  <span class="token comment"># Optional environment variables</span>
<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">call_llm</span><span class="token punctuation">(</span>prompt<span class="token punctuation">,</span> functions<span class="token punctuation">)</span><span class="token punctuation">:</span>
    token <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">"GITHUB_TOKEN"</span><span class="token punctuation">]</span>
    endpoint <span class="token operator">=</span> <span class="token string">"https://models.inference.ai.azure.com"</span>

    model_name <span class="token operator">=</span> <span class="token string">"gpt-4o"</span>

    client <span class="token operator">=</span> ChatCompletionsClient<span class="token punctuation">(</span>
        endpoint<span class="token operator">=</span>endpoint<span class="token punctuation">,</span>
        credential<span class="token operator">=</span>AzureKeyCredential<span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"CALLING LLM"</span><span class="token punctuation">)</span>
    response <span class="token operator">=</span> client<span class="token punctuation">.</span>complete<span class="token punctuation">(</span>
        messages<span class="token operator">=</span><span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
            <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"system"</span><span class="token punctuation">,</span>
            <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"You are a helpful assistant."</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
            <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>
            <span class="token string">"content"</span><span class="token punctuation">:</span> prompt<span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        model<span class="token operator">=</span>model_name<span class="token punctuation">,</span>
        tools <span class="token operator">=</span> functions<span class="token punctuation">,</span>
        <span class="token comment"># Optional parameters</span>
        temperature<span class="token operator">=</span><span class="token number">1.</span><span class="token punctuation">,</span>
        max_tokens<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span>
        top_p<span class="token operator">=</span><span class="token number">1.</span>    
    <span class="token punctuation">)</span>

    response_message <span class="token operator">=</span> response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message
    
    functions_to_call <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">if</span> response_message<span class="token punctuation">.</span>tool_calls<span class="token punctuation">:</span>
        <span class="token keyword">for</span> tool_call <span class="token keyword">in</span> response_message<span class="token punctuation">.</span>tool_calls<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"TOOL: "</span><span class="token punctuation">,</span> tool_call<span class="token punctuation">)</span>
            name <span class="token operator">=</span> tool_call<span class="token punctuation">.</span>function<span class="token punctuation">.</span>name
            args <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>tool_call<span class="token punctuation">.</span>function<span class="token punctuation">.</span>arguments<span class="token punctuation">)</span>
            functions_to_call<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">"name"</span><span class="token punctuation">:</span> name<span class="token punctuation">,</span> <span class="token string">"args"</span><span class="token punctuation">:</span> args <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> functions_to_call

<span class="token keyword">def</span> <span class="token function">convert_to_llm_tool</span><span class="token punctuation">(</span>tool<span class="token punctuation">)</span><span class="token punctuation">:</span>
    tool_schema <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"function"</span><span class="token punctuation">,</span>
        <span class="token string">"function"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">"name"</span><span class="token punctuation">:</span> tool<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
            <span class="token string">"description"</span><span class="token punctuation">:</span> tool<span class="token punctuation">.</span>description<span class="token punctuation">,</span>
            <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"function"</span><span class="token punctuation">,</span>
            <span class="token string">"parameters"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
                <span class="token string">"properties"</span><span class="token punctuation">:</span> tool<span class="token punctuation">.</span>inputSchema<span class="token punctuation">[</span><span class="token string">"properties"</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> tool_schema

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">async</span> <span class="token keyword">with</span> stdio_client<span class="token punctuation">(</span>server_params<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token punctuation">(</span>read<span class="token punctuation">,</span> write<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">async</span> <span class="token keyword">with</span> ClientSession<span class="token punctuation">(</span>
            read<span class="token punctuation">,</span> write
        <span class="token punctuation">)</span> <span class="token keyword">as</span> session<span class="token punctuation">:</span>
            <span class="token comment"># Initialize the connection</span>
            <span class="token keyword">await</span> session<span class="token punctuation">.</span>initialize<span class="token punctuation">(</span><span class="token punctuation">)</span>

            <span class="token comment"># List available resources</span>
            resources <span class="token operator">=</span> <span class="token keyword">await</span> session<span class="token punctuation">.</span>list_resources<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"LISTING RESOURCES"</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> resource <span class="token keyword">in</span> resources<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Resource: "</span><span class="token punctuation">,</span> resource<span class="token punctuation">)</span>

            <span class="token comment"># List available tools</span>
            tools <span class="token operator">=</span> <span class="token keyword">await</span> session<span class="token punctuation">.</span>list_tools<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"LISTING TOOLS"</span><span class="token punctuation">)</span>

            functions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

            <span class="token keyword">for</span> tool <span class="token keyword">in</span> tools<span class="token punctuation">.</span>tools<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Tool: "</span><span class="token punctuation">,</span> tool<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Tool"</span><span class="token punctuation">,</span> tool<span class="token punctuation">.</span>inputSchema<span class="token punctuation">[</span><span class="token string">"properties"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                functions<span class="token punctuation">.</span>append<span class="token punctuation">(</span>convert_to_llm_tool<span class="token punctuation">(</span>tool<span class="token punctuation">)</span><span class="token punctuation">)</span>
            
            prompt <span class="token operator">=</span> <span class="token string">"Add 2 to 20"</span>

            <span class="token comment"># ask LLM what tools to all, if any</span>
            functions_to_call <span class="token operator">=</span> call_llm<span class="token punctuation">(</span>prompt<span class="token punctuation">,</span> functions<span class="token punctuation">)</span>

            <span class="token comment"># call suggested functions</span>
            <span class="token keyword">for</span> f <span class="token keyword">in</span> functions_to_call<span class="token punctuation">:</span>
                result <span class="token operator">=</span> <span class="token keyword">await</span> session<span class="token punctuation">.</span>call_tool<span class="token punctuation">(</span>f<span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> arguments<span class="token operator">=</span>f<span class="token punctuation">[</span><span class="token string">"args"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"TOOLS result: "</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>content<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    <span class="token keyword">import</span> asyncio

    asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<p>python client.py</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token punctuation">[</span><span class="token number">06</span><span class="token operator">/</span><span class="token number">14</span><span class="token operator">/</span><span class="token number">25</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">53</span><span class="token punctuation">:</span><span class="token number">22</span><span class="token punctuation">]</span> INFO     Processing request of <span class="token builtin">type</span>                  server<span class="token punctuation">.</span>py<span class="token punctuation">:</span><span class="token number">523</span>
                             ListResourcesRequest
LISTING RESOURCES
Resource<span class="token punctuation">:</span>  <span class="token punctuation">(</span><span class="token string">'meta'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
Resource<span class="token punctuation">:</span>  <span class="token punctuation">(</span><span class="token string">'nextCursor'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
Resource<span class="token punctuation">:</span>  <span class="token punctuation">(</span><span class="token string">'resources'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                    INFO     Processing request of <span class="token builtin">type</span> ListToolsRequest server<span class="token punctuation">.</span>py<span class="token punctuation">:</span><span class="token number">523</span>
LISTING TOOLS
Tool<span class="token punctuation">:</span>  add
Tool <span class="token punctuation">{</span><span class="token string">'a'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'integer'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'integer'</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
CALLING LLM
TOOL<span class="token punctuation">:</span>  <span class="token punctuation">{</span><span class="token string">'function'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'arguments'</span><span class="token punctuation">:</span> <span class="token string">'{"a":2,"b":20}'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'add'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token string">'call_iNpA7aQA96xfqCKNmGWLnZFR'</span><span class="token punctuation">,</span> <span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'function'</span><span class="token punctuation">}</span>
<span class="token punctuation">[</span><span class="token number">06</span><span class="token operator">/</span><span class="token number">14</span><span class="token operator">/</span><span class="token number">25</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">53</span><span class="token punctuation">:</span><span class="token number">25</span><span class="token punctuation">]</span> INFO     Processing request of <span class="token builtin">type</span> CallToolRequest  server<span class="token punctuation">.</span>py<span class="token punctuation">:</span><span class="token number">523</span>
TOOLS result<span class="token punctuation">:</span>  <span class="token punctuation">[</span>TextContent<span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'text'</span><span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string">'22'</span><span class="token punctuation">,</span> annotations<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">]</span></code></pre></div>
<h2 id="04-vscode" style="position:relative;"><a href="#04-vscode" aria-label="04 vscode permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>04-vscode</h2>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/9627f15066b08f757cafb607cc821e4a/e1250/mcp_image_3.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 62.576687116564415%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABZ0lEQVR42q1Sa2vDMAzM//97+1Lars3oM03SPGzHT/kmO6yEMuhgPRCSHPmsi1QMwwg1TUh+Yi+EgNYaUkr0fY9xHBFCwCs4YxG0QeGcA0WNqte49RZCSxC9JngGESGyFSF4Ti2GyWJ3bnG73yHUlE0pBe997vivKKy1iJAwNKGqFT7KDmUlUJ8rqLZBjDG/nsHxw5ZY5IXPkhWUk4g24nIbcbh0mNoW6nSC6TqYO8fXKzQ/YFiBbpp8PqUzjr0xC0KWRGSgveYPAYf9GdfyBFm3uZB4IJRqnJ/jhYXUDFv8UTBLNixZQHqepiIMLrLUmYwrERNZJrTZ5/wXogdhWokYPWxIF2IeQr9aoV+vMbCNZYlh9wnxVeZYlHsM2y2GzQbyeGTJNYjn8EQY4IKbCV2ASf+oaeF4J1MXubNUl1Zj6VOniWw5lLTMESNkGFkmFxD+BSbUCMRbTh7vQEHEexbxNhR4M74BdLH8xhUpO6cAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/9627f15066b08f757cafb607cc821e4a/a6d36/mcp_image_3.png"
        srcset="/static/9627f15066b08f757cafb607cc821e4a/222b7/mcp_image_3.png 163w,
/static/9627f15066b08f757cafb607cc821e4a/ff46a/mcp_image_3.png 325w,
/static/9627f15066b08f757cafb607cc821e4a/a6d36/mcp_image_3.png 650w,
/static/9627f15066b08f757cafb607cc821e4a/e548f/mcp_image_3.png 975w,
/static/9627f15066b08f757cafb607cc821e4a/3c492/mcp_image_3.png 1300w,
/static/9627f15066b08f757cafb607cc821e4a/e1250/mcp_image_3.png 1786w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/604be8c5417f60bc8072ec3d86f3a233/ce0a7/mcp_image_4.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 83.43558282208589%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAACD0lEQVR42q1U2a6jMAzl/79vpNEsXSiFskMIWUk4Y6et5s6ofbm6Fpa3YMfHhsz6CB93+HDnsEd8luSikDk94fu3HL8PLc7HBmNVYZcLYAywroBSgNb/6iw5/tQf8TjPyDYtYNoBxXXA8dxBzAtcU8PUNTwdcF0HQ0XcOCQf27broYoLbNvCDQMs+aNzgBB0Q1HC9iPK/IYqr2Ctwx4jAh2IISBuG4L3SWcZyGbfRvFkP/xx34FFUkJZwYwCbb9gqqmi8wAl5AT7I2FM9t2XEjOz/xnnosTphpsS8MsKRa2s5yNM30NTC+slh75VJC9JNxxnvSigCALdNNQZtU5nDLVuqfWdMQx6gSXc5CywLYTZPN2xI5l4mujFLkk3jYk3tf4dLbf6pGVB5nUPcTrBzBKbXOGETAUc2awzcwde3GMb6Rw3AxWdBIKgjZAyJcMwIou7xfk24lBMOJUTrtWAdlRohhVNL9GSZB5GkmSPk0qy7u66VjRdwjIxYZ2FaCGVx89S4sdV0DopbGNPU7afWu7MBbq+cSgaus2ksVGhnSa2f8TmBXH41YnMB8Jo2yHrBsvhFy1tl6an2yYxT1c/psjTV7cbHGP27oac0LoARQDz9qeX6atQVQlVlmlF1us1JZS0NjLP02rhTQeZjyuMNrSYzz7+50jPRz2+TfbAUNFfxuGrKGP8XsP7yYT4YvoDyOQtFDMGREYAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/604be8c5417f60bc8072ec3d86f3a233/a6d36/mcp_image_4.png"
        srcset="/static/604be8c5417f60bc8072ec3d86f3a233/222b7/mcp_image_4.png 163w,
/static/604be8c5417f60bc8072ec3d86f3a233/ff46a/mcp_image_4.png 325w,
/static/604be8c5417f60bc8072ec3d86f3a233/a6d36/mcp_image_4.png 650w,
/static/604be8c5417f60bc8072ec3d86f3a233/e548f/mcp_image_4.png 975w,
/static/604be8c5417f60bc8072ec3d86f3a233/3c492/mcp_image_4.png 1300w,
/static/604be8c5417f60bc8072ec3d86f3a233/ce0a7/mcp_image_4.png 1590w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/ebe5462dc4abb349d5c6e683a994380a/63ec5/mcp_image_5.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 122.69938650306749%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAYAAAAxFw7TAAAACXBIWXMAABYlAAAWJQFJUiTwAAACXElEQVR42qVVWZLaMBT0XXLFnCpH4ItK5QOKLexh3w0DeAGvGEOP+hGlmMlMJQZXNUJSq/Wkt8gIggC+72O1WmEymWC9XmM+nwsWiwVmsxmWyyWm06mA/fF4jNFohGq1ina7jUajgeFwiNPpBIOkWq2GcrmMXC6HQqGAfD6PUqkki0lky80opEUpSKFOp4N6vY7BYHATjKIISZKIhZvNBqZpyoLtdovz+YzL5SJtmqZ/gXMa7MdxDIOqjuMgDEMcj0fZhQRuws2yQAS5kMfgcZrNJg6HwxtCVoggj0oHsCW4Ae9MW5xJkAt2u53cHT3M1rbth6z7I2hZlhJaK8eYMJUo+xzPChHkD++LA8981+v1FjbaVMv2cDjG2Gw9dXfx44JhGLGL7T7AfOGi3VVOmdu/SQ8I8riX9AzHDfGy87Fcucra8LkjM58Z2Fmt+tRCxmKi0ktaBabav3DPi+JEiSVvvazb7OmmfHA9KeFY/hs6d3Us6UR/n/wa5NC6mFzFCaIEP35ZmLz4aiy5CdJsBnOr1UKv10O/35f0++ieWJWYTWOVmovpCD/HO3z5+h3fimscw+R2ZE2mVbpk8T/H3kNzNVLFNZ0ITsA7TWFQgBVbCz/z0RCDlrDEsybq3bN+6eUq4SaCtOy+6v5vuGgu+9qJEocMasexxSmE67pyBQTndNBrsE8e6ybLHHl8LlgCOWd4vhI8eBJDXKC9TnxUXBl7FGHxZaufDoJzhh9EWFkhut2uPIvFYhGVSkVeQj4HnxXS+xrIlmLkGycOKBzUDhzY7/cCHsfzvMwV+xWTiYy7M/oE0wAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/ebe5462dc4abb349d5c6e683a994380a/a6d36/mcp_image_5.png"
        srcset="/static/ebe5462dc4abb349d5c6e683a994380a/222b7/mcp_image_5.png 163w,
/static/ebe5462dc4abb349d5c6e683a994380a/ff46a/mcp_image_5.png 325w,
/static/ebe5462dc4abb349d5c6e683a994380a/a6d36/mcp_image_5.png 650w,
/static/ebe5462dc4abb349d5c6e683a994380a/63ec5/mcp_image_5.png 812w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<h2 id="05-sse-server" style="position:relative;"><a href="#05-sse-server" aria-label="05 sse server permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>05-sse-server</h2>
<p>uvicorn server:app</p>
<p>server.py</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> starlette<span class="token punctuation">.</span>applications <span class="token keyword">import</span> Starlette
<span class="token keyword">from</span> starlette<span class="token punctuation">.</span>routing <span class="token keyword">import</span> Mount<span class="token punctuation">,</span> Host
<span class="token keyword">from</span> mcp<span class="token punctuation">.</span>server<span class="token punctuation">.</span>fastmcp <span class="token keyword">import</span> FastMCP

mcp <span class="token operator">=</span> FastMCP<span class="token punctuation">(</span><span class="token string">"My App"</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@mcp<span class="token punctuation">.</span>tool</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">int</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Add two numbers"""</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> b

<span class="token comment"># Mount the SSE server to the existing ASGI server</span>
app <span class="token operator">=</span> Starlette<span class="token punctuation">(</span>
    routes<span class="token operator">=</span><span class="token punctuation">[</span>
        Mount<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> app<span class="token operator">=</span>mcp<span class="token punctuation">.</span>sse_app<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">)</span></code></pre></div>
<p>npx @modelcontextprotocol/inspector —cli <a href="http://localhost:8000/sse">http://localhost:8000/sse</a> —method tools/list</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token punctuation">{</span>
  <span class="token string">"tools"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"add"</span>,
      <span class="token string">"description"</span><span class="token builtin class-name">:</span> <span class="token string">"Add two numbers"</span>,
      <span class="token string">"inputSchema"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"object"</span>,
        <span class="token string">"properties"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">"a"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">"title"</span><span class="token builtin class-name">:</span> <span class="token string">"A"</span>,
            <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"integer"</span>
          <span class="token punctuation">}</span>,
          <span class="token string">"b"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">"title"</span><span class="token builtin class-name">:</span> <span class="token string">"B"</span>,
            <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"integer"</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"required"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
          <span class="token string">"a"</span>,
          <span class="token string">"b"</span>
        <span class="token punctuation">]</span>,
        <span class="token string">"title"</span><span class="token builtin class-name">:</span> <span class="token string">"addArguments"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre></div>
<p>npx @modelcontextprotocol/inspector —cli <a href="http://localhost:8000/sse">http://localhost:8000/sse</a> —method tools/call —tool-name add —tool-arg a=1 —tool-arg b=2</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token punctuation">{</span>
  <span class="token string">"content"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"text"</span>,
      <span class="token string">"text"</span><span class="token builtin class-name">:</span> <span class="token string">"3"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>,
  <span class="token string">"isError"</span><span class="token builtin class-name">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span></code></pre></div>
<h2 id="06-http-streaming" style="position:relative;"><a href="#06-http-streaming" aria-label="06 http streaming permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>06-http-streaming</h2>
<table>
<thead>
<tr>
<th>传输机制</th>
<th>实时更新</th>
<th>流式传输</th>
<th>可扩展性</th>
<th>用例</th>
</tr>
</thead>
<tbody>
<tr>
<td>stdio</td>
<td>否</td>
<td>否</td>
<td>低</td>
<td>本地 CLI 工具</td>
</tr>
<tr>
<td>SSE</td>
<td>是</td>
<td>是</td>
<td>中</td>
<td>Web，实时更新</td>
</tr>
<tr>
<td>可流式 HTTP</td>
<td>是</td>
<td>是</td>
<td>高</td>
<td>云，多客户端</td>
</tr>
</tbody>
</table>
<p><strong>流式传输</strong>是网络编程中的一种技术，允许数据以小而可管理的块或事件序列的形式发送和接收，而不是等待整个响应准备就绪。这在以下情况下特别有用：</p>
<ul>
<li>处理大文件或数据集</li>
<li>实时更新（如聊天、进度条）</li>
<li>长时间运行的计算任务（需要让用户了解进度）</li>
</ul>
<p>以下是关于流式传输的高级要点：</p>
<ul>
<li>数据是渐进式传输，而非一次性发送</li>
<li>客户端可以在数据到达时立即处理</li>
<li>减少感知延迟并改善用户体验</li>
</ul>
<p><strong>为什么使用流式传输？</strong></p>
<p>使用流式传输的原因包括：</p>
<ul>
<li>用户可以立即获得反馈，而不仅仅是在结束时</li>
<li>支持实时应用和响应式 UI</li>
<li>更有效地利用网络和计算资源</li>
</ul>
<p><strong>对比：经典流式传输 vs MCP 流式传输</strong></p>
<p>“经典”流式传输与 MCP 流式传输的区别可描述如下：</p>
<table>
<thead>
<tr>
<th>特性</th>
<th>经典 HTTP 流式传输</th>
<th>MCP 流式传输 (通知机制)</th>
</tr>
</thead>
<tbody>
<tr>
<td>主响应</td>
<td>分块传输</td>
<td>结束时返回单个响应</td>
</tr>
<tr>
<td>进度更新</td>
<td>作为数据块发送</td>
<td>作为通知发送</td>
</tr>
<tr>
<td>客户端要求</td>
<td>必须处理流</td>
<td>必须实现消息处理器</td>
</tr>
<tr>
<td>用例</td>
<td>大文件、AI 令牌流</td>
<td>进度、日志、实时反馈</td>
</tr>
</tbody>
</table>
<p><strong>关键差异观察</strong></p>
<p>此外，以下是一些关键差异：</p>
<ul>
<li><strong>通信模式：</strong>
<ul>
<li>经典 HTTP 流式传输：使用简单的分块传输编码发送数据</li>
<li>MCP 流式传输：使用带有 JSON-RPC 协议的结构化通知系统</li>
</ul>
</li>
<li><strong>消息格式：</strong>
<ul>
<li>经典 HTTP：带有换行符的纯文本块</li>
<li>MCP：带有元数据的结构化 LoggingMessageNotification 对象</li>
</ul>
</li>
<li><strong>客户端实现：</strong>
<ul>
<li>经典 HTTP：处理流式响应的简单客户端</li>
<li>MCP：更复杂的客户端，带有处理不同类型消息的消息处理器</li>
</ul>
</li>
<li><strong>进度更新：</strong>
<ul>
<li>经典 HTTP：进度是主响应流的一部分</li>
<li>MCP：进度通过单独的通知消息发送，主响应在结束时返回</li>
</ul>
</li>
</ul>
<p>server.py</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment"># server.py</span>
<span class="token keyword">from</span> fastapi <span class="token keyword">import</span> FastAPI
<span class="token keyword">from</span> fastapi<span class="token punctuation">.</span>responses <span class="token keyword">import</span> StreamingResponse<span class="token punctuation">,</span> HTMLResponse
<span class="token keyword">from</span> mcp<span class="token punctuation">.</span>server<span class="token punctuation">.</span>fastmcp <span class="token keyword">import</span> FastMCP<span class="token punctuation">,</span> Context
<span class="token keyword">from</span> mcp<span class="token punctuation">.</span>types <span class="token keyword">import</span> <span class="token punctuation">(</span>
    TextContent
<span class="token punctuation">)</span>
<span class="token keyword">import</span> asyncio
<span class="token keyword">import</span> uvicorn
<span class="token keyword">import</span> os

<span class="token comment"># Create an MCP server</span>
mcp <span class="token operator">=</span> FastMCP<span class="token punctuation">(</span><span class="token string">"Streamable DEMO"</span><span class="token punctuation">)</span>

app <span class="token operator">=</span> FastAPI<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> response_class<span class="token operator">=</span>HTMLResponse<span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">root</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    html_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"welcome.html"</span><span class="token punctuation">)</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>html_path<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        html_content <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> HTMLResponse<span class="token punctuation">(</span>content<span class="token operator">=</span>html_content<span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">event_stream</span><span class="token punctuation">(</span>message<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> <span class="token string-interpolation"><span class="token string">f"Processing file </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">/3..."</span></span>
        <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">yield</span> <span class="token string-interpolation"><span class="token string">f"Here's the file content: </span><span class="token interpolation"><span class="token punctuation">{</span>message<span class="token punctuation">}</span></span><span class="token string">"</span></span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/stream"</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">stream</span><span class="token punctuation">(</span>message<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> StreamingResponse<span class="token punctuation">(</span>event_stream<span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">,</span> media_type<span class="token operator">=</span><span class="token string">"text/plain"</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@mcp<span class="token punctuation">.</span>tool</span><span class="token punctuation">(</span>description<span class="token operator">=</span><span class="token string">"A tool that simulates file processing and sends progress notifications"</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">process_files</span><span class="token punctuation">(</span>message<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> ctx<span class="token punctuation">:</span> Context<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> TextContent<span class="token punctuation">:</span>
    files <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-interpolation"><span class="token string">f"file_</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">.txt"</span></span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> idx<span class="token punctuation">,</span> <span class="token builtin">file</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>files<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Processing </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">file</span><span class="token punctuation">}</span></span><span class="token string"> (</span><span class="token interpolation"><span class="token punctuation">{</span>idx<span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">)..."</span></span><span class="token punctuation">)</span>
        <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  
    <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"All files processed!"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> TextContent<span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"text"</span><span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"Processed files: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token string">', '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> | Message: </span><span class="token interpolation"><span class="token punctuation">{</span>message<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    <span class="token keyword">import</span> sys
    <span class="token keyword">if</span> <span class="token string">"mcp"</span> <span class="token keyword">in</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">:</span>
        <span class="token comment"># Configure MCP server with streamable-http transport</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Starting MCP server with streamable-http transport..."</span><span class="token punctuation">)</span>
        <span class="token comment"># MCP server will create its own FastAPI app with the /mcp endpoint</span>
        mcp<span class="token punctuation">.</span>run<span class="token punctuation">(</span>transport<span class="token operator">=</span><span class="token string">"streamable-http"</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token comment"># Start FastAPI app for classic HTTP streaming</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Starting FastAPI server for classic HTTP streaming..."</span><span class="token punctuation">)</span>
        uvicorn<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">"server:app"</span><span class="token punctuation">,</span> host<span class="token operator">=</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">8000</span><span class="token punctuation">,</span> <span class="token builtin">reload</span><span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></code></pre></div>
<p>client.py</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment"># client.py</span>
<span class="token keyword">from</span> mcp<span class="token punctuation">.</span>client<span class="token punctuation">.</span>streamable_http <span class="token keyword">import</span> streamablehttp_client
<span class="token keyword">from</span> mcp <span class="token keyword">import</span> ClientSession
<span class="token keyword">import</span> asyncio
<span class="token keyword">import</span> mcp<span class="token punctuation">.</span>types <span class="token keyword">as</span> types
<span class="token keyword">from</span> mcp<span class="token punctuation">.</span>shared<span class="token punctuation">.</span>session <span class="token keyword">import</span> RequestResponder
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> logging

<span class="token comment"># Configure logging</span>
logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span>
    level<span class="token operator">=</span>logging<span class="token punctuation">.</span>INFO<span class="token punctuation">,</span>
    <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span><span class="token punctuation">,</span>
    datefmt<span class="token operator">=</span><span class="token string">'%Y-%m-%d %H:%M:%S'</span>
<span class="token punctuation">)</span>
logger <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span><span class="token string">'mcp_client'</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">LoggingCollector</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>log_messages<span class="token punctuation">:</span> <span class="token builtin">list</span><span class="token punctuation">[</span>types<span class="token punctuation">.</span>LoggingMessageNotificationParams<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> params<span class="token punctuation">:</span> types<span class="token punctuation">.</span>LoggingMessageNotificationParams<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>log_messages<span class="token punctuation">.</span>append<span class="token punctuation">(</span>params<span class="token punctuation">)</span>
        logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"MCP Log: %s - %s"</span><span class="token punctuation">,</span> params<span class="token punctuation">.</span>level<span class="token punctuation">,</span> params<span class="token punctuation">.</span>data<span class="token punctuation">)</span>

logging_collector <span class="token operator">=</span> LoggingCollector<span class="token punctuation">(</span><span class="token punctuation">)</span>
port <span class="token operator">=</span> <span class="token number">8000</span>

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">message_handler</span><span class="token punctuation">(</span>
    message<span class="token punctuation">:</span> RequestResponder<span class="token punctuation">[</span>types<span class="token punctuation">.</span>ServerRequest<span class="token punctuation">,</span> types<span class="token punctuation">.</span>ClientResult<span class="token punctuation">]</span>
    <span class="token operator">|</span> types<span class="token punctuation">.</span>ServerNotification
    <span class="token operator">|</span> Exception<span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Received message: %s"</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> Exception<span class="token punctuation">)</span><span class="token punctuation">:</span>
        logger<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">"Exception received!"</span><span class="token punctuation">)</span>
        <span class="token keyword">raise</span> message
    <span class="token keyword">elif</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> types<span class="token punctuation">.</span>ServerNotification<span class="token punctuation">)</span><span class="token punctuation">:</span>
        logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"NOTIFICATION: %s"</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span>
    <span class="token keyword">elif</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> RequestResponder<span class="token punctuation">)</span><span class="token punctuation">:</span>
        logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"REQUEST_RESPONDER: %s"</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"SERVER_MESSAGE: %s"</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Starting client..."</span><span class="token punctuation">)</span>
    <span class="token keyword">async</span> <span class="token keyword">with</span> streamablehttp_client<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"http://localhost:</span><span class="token interpolation"><span class="token punctuation">{</span>port<span class="token punctuation">}</span></span><span class="token string">/mcp"</span></span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token punctuation">(</span>
        read_stream<span class="token punctuation">,</span>
        write_stream<span class="token punctuation">,</span>
        session_callback<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">async</span> <span class="token keyword">with</span> ClientSession<span class="token punctuation">(</span>
            read_stream<span class="token punctuation">,</span>
            write_stream<span class="token punctuation">,</span>
            logging_callback<span class="token operator">=</span>logging_collector<span class="token punctuation">,</span>
            message_handler<span class="token operator">=</span>message_handler<span class="token punctuation">,</span>
        <span class="token punctuation">)</span> <span class="token keyword">as</span> session<span class="token punctuation">:</span>
            id_before <span class="token operator">=</span> session_callback<span class="token punctuation">(</span><span class="token punctuation">)</span>
            logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Session ID before init: %s"</span><span class="token punctuation">,</span> id_before<span class="token punctuation">)</span>
            <span class="token keyword">await</span> session<span class="token punctuation">.</span>initialize<span class="token punctuation">(</span><span class="token punctuation">)</span>
            id_after <span class="token operator">=</span> session_callback<span class="token punctuation">(</span><span class="token punctuation">)</span>
            logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Session ID after init: %s"</span><span class="token punctuation">,</span> id_after<span class="token punctuation">)</span>
            logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Session initialized, ready to call tools."</span><span class="token punctuation">)</span>
            tool_result <span class="token operator">=</span> <span class="token keyword">await</span> session<span class="token punctuation">.</span>call_tool<span class="token punctuation">(</span><span class="token string">"process_files"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string">"hello from client"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
            logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Tool result: %s"</span><span class="token punctuation">,</span> tool_result<span class="token punctuation">)</span>
            <span class="token keyword">if</span> logging_collector<span class="token punctuation">.</span>log_messages<span class="token punctuation">:</span>
                logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Collected log messages:"</span><span class="token punctuation">)</span>
                <span class="token keyword">for</span> log <span class="token keyword">in</span> logging_collector<span class="token punctuation">.</span>log_messages<span class="token punctuation">:</span>
                    logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Log: %s"</span><span class="token punctuation">,</span> log<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">stream_progress</span><span class="token punctuation">(</span>message<span class="token operator">=</span><span class="token string">"hello"</span><span class="token punctuation">,</span> url<span class="token operator">=</span><span class="token string">"http://localhost:8000/stream"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    params <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"message"</span><span class="token punctuation">:</span> message<span class="token punctuation">}</span>
    logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Connecting to %s with message: %s"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> message<span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token operator">=</span>params<span class="token punctuation">,</span> stream<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">as</span> r<span class="token punctuation">:</span>
            r<span class="token punctuation">.</span>raise_for_status<span class="token punctuation">(</span><span class="token punctuation">)</span>
            logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"--- Streaming Progress ---"</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> line <span class="token keyword">in</span> r<span class="token punctuation">.</span>iter_lines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> line<span class="token punctuation">:</span>
                    <span class="token comment"># Still print the streamed content to stdout for visibility</span>
                    decoded_line <span class="token operator">=</span> line<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span>decoded_line<span class="token punctuation">)</span>
                    logger<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string">"Stream content: %s"</span><span class="token punctuation">,</span> decoded_line<span class="token punctuation">)</span>
            logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"--- Stream Ended ---"</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> requests<span class="token punctuation">.</span>RequestException <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        logger<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">"Error during streaming: %s"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    <span class="token keyword">import</span> sys
    
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">1</span> <span class="token keyword">and</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"mcp"</span><span class="token punctuation">:</span>
        <span class="token comment"># MCP client mode</span>
        logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Running MCP client..."</span><span class="token punctuation">)</span>
        asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token comment"># Classic HTTP streaming client mode</span>
        logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Running classic HTTP streaming client..."</span><span class="token punctuation">)</span>
        stream_progress<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
    <span class="token comment"># Don't run both by default, let the user choose the mode</span></code></pre></div>
<h2 id="07-ai-toolkit" style="position:relative;"><a href="#07-ai-toolkit" aria-label="07 ai toolkit permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>07-<strong>AI Toolkit</strong></h2>
<p>server.py</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">import</span> math

<span class="token keyword">from</span> mcp<span class="token punctuation">.</span>server<span class="token punctuation">.</span>fastmcp <span class="token keyword">import</span> FastMCP

server <span class="token operator">=</span> FastMCP<span class="token punctuation">(</span><span class="token string">"calculator"</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@server<span class="token punctuation">.</span>tool</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">float</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""将两个数字相加并返回结果"""</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> b

<span class="token decorator annotation punctuation">@server<span class="token punctuation">.</span>tool</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">subtract</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">float</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""从 a 中减去 b 并返回结果"""</span>
    <span class="token keyword">return</span> a <span class="token operator">-</span> b

<span class="token decorator annotation punctuation">@server<span class="token punctuation">.</span>tool</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">multiply</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">float</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""将两个数字相乘并返回结果"""</span>
    <span class="token keyword">return</span> a <span class="token operator">*</span> b

<span class="token decorator annotation punctuation">@server<span class="token punctuation">.</span>tool</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">divide</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">float</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""将 a 除以 b 并返回结果"""</span>
    <span class="token keyword">if</span> b <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"不能除以零"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> a <span class="token operator">/</span> b

<span class="token decorator annotation punctuation">@server<span class="token punctuation">.</span>tool</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">square_root</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">float</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""计算数字的平方根"""</span>
    <span class="token keyword">if</span> x <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"不能计算负数的平方根"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> math<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>x<span class="token punctuation">)</span></code></pre></div>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/744ad9d62b62f5e2836fd351cbc0912a/963fa/mcp_image_6.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 58.89570552147239%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABM0lEQVR42n2Ti4qEMAxF/f+fFIYRQatVq/VttqdsZHbVKVysMbm5eZg45wQMwyDbtslxHCd4X5ZF1nUV2zrpBy+j9398/iOBrGvbM5AnRGAcx5iMu6mtVHUtfd/H5HfAP6mqSkxAWZbyer0kTVPJ81zakAQnEnC4Y/NBIYHTNF2Ab9I0jQAMqOFurT3J5nmOpXRdJ0VRxO+QPhJmWSYmqKtDOdpPlBAICe/7vkcbIMHXkiHM3u9oIPPnE6hCstM/gkjwOBQCljAMBqLDUKgNR0pCMcqxPZ1I6P0Qsh7y7eAHIWWj8JFwmSfJjAsqrh9RRZkopQ302RgTyR8J234U42ZZbxRSqu4mYPqQ6kqR8ELoQ5OtbWT+3be7RlMiBJ8roz/ChRBnbT73O6hSXR0dyt2UfwCCR6m7tya/DQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/744ad9d62b62f5e2836fd351cbc0912a/a6d36/mcp_image_6.png"
        srcset="/static/744ad9d62b62f5e2836fd351cbc0912a/222b7/mcp_image_6.png 163w,
/static/744ad9d62b62f5e2836fd351cbc0912a/ff46a/mcp_image_6.png 325w,
/static/744ad9d62b62f5e2836fd351cbc0912a/a6d36/mcp_image_6.png 650w,
/static/744ad9d62b62f5e2836fd351cbc0912a/e548f/mcp_image_6.png 975w,
/static/744ad9d62b62f5e2836fd351cbc0912a/3c492/mcp_image_6.png 1300w,
/static/744ad9d62b62f5e2836fd351cbc0912a/963fa/mcp_image_6.png 2666w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<h2 id="08-testing" style="position:relative;"><a href="#08-testing" aria-label="08 testing permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>08-testing</h2>
<p><strong>手动测试</strong></p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># 示例：测试服务器元数据</span>
<span class="token function">curl</span> http://localhost:3000/v1/metadata

<span class="token comment"># 示例：执行工具</span>
<span class="token function">curl</span> <span class="token parameter variable">-X</span> POST http://localhost:3000/v1/tools/execute <span class="token punctuation">\</span>
  <span class="token parameter variable">-H</span> <span class="token string">"Content-Type: application/json"</span> <span class="token punctuation">\</span>
  <span class="token parameter variable">-d</span> <span class="token string">'{"name": "calculator", "parameters": {"expression": "2+2"}}'</span></code></pre></div>
<p><strong>pytest</strong></p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">import</span> pytest

<span class="token keyword">from</span> mcp<span class="token punctuation">.</span>server<span class="token punctuation">.</span>fastmcp <span class="token keyword">import</span> FastMCP
<span class="token keyword">from</span> mcp<span class="token punctuation">.</span>shared<span class="token punctuation">.</span>memory <span class="token keyword">import</span> <span class="token punctuation">(</span>
    create_connected_server_and_client_session <span class="token keyword">as</span> create_session<span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token comment"># Mark the whole module for async tests</span>
pytestmark <span class="token operator">=</span> pytest<span class="token punctuation">.</span>mark<span class="token punctuation">.</span>anyio

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">test_list_tools_cursor_parameter</span><span class="token punctuation">(</span>stream_spy<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Test that the cursor parameter is accepted for list_tools
    and that it is correctly passed to the server.

    See: https://modelcontextprotocol.io/specification/2025-03-26/server/utilities/pagination#request-format
    """</span>
    server <span class="token operator">=</span> FastMCP<span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span>

    <span class="token comment"># Create a couple of test tools</span>
    <span class="token decorator annotation punctuation">@server<span class="token punctuation">.</span>tool</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"test_tool_1"</span><span class="token punctuation">)</span>
    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">test_tool_1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""First test tool"""</span>
        <span class="token keyword">return</span> <span class="token string">"Result 1"</span>

    <span class="token decorator annotation punctuation">@server<span class="token punctuation">.</span>tool</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"test_tool_2"</span><span class="token punctuation">)</span>
    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">test_tool_2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Second test tool"""</span>
        <span class="token keyword">return</span> <span class="token string">"Result 2"</span>

    <span class="token keyword">async</span> <span class="token keyword">with</span> create_session<span class="token punctuation">(</span>server<span class="token punctuation">.</span>_mcp_server<span class="token punctuation">)</span> <span class="token keyword">as</span> client_session<span class="token punctuation">:</span>
        spies <span class="token operator">=</span> stream_spy<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># Test without cursor parameter (omitted)</span>
        _ <span class="token operator">=</span> <span class="token keyword">await</span> client_session<span class="token punctuation">.</span>list_tools<span class="token punctuation">(</span><span class="token punctuation">)</span>
        list_tools_requests <span class="token operator">=</span> spies<span class="token punctuation">.</span>get_client_requests<span class="token punctuation">(</span>method<span class="token operator">=</span><span class="token string">"tools/list"</span><span class="token punctuation">)</span>
        <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>list_tools_requests<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span>
        <span class="token keyword">assert</span> list_tools_requests<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>params <span class="token keyword">is</span> <span class="token boolean">None</span>

        spies<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># Test with cursor=None</span>
        _ <span class="token operator">=</span> <span class="token keyword">await</span> client_session<span class="token punctuation">.</span>list_tools<span class="token punctuation">(</span>cursor<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
        list_tools_requests <span class="token operator">=</span> spies<span class="token punctuation">.</span>get_client_requests<span class="token punctuation">(</span>method<span class="token operator">=</span><span class="token string">"tools/list"</span><span class="token punctuation">)</span>
        <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>list_tools_requests<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span>
        <span class="token keyword">assert</span> list_tools_requests<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>params <span class="token keyword">is</span> <span class="token boolean">None</span>

        spies<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># Test with cursor as string</span>
        _ <span class="token operator">=</span> <span class="token keyword">await</span> client_session<span class="token punctuation">.</span>list_tools<span class="token punctuation">(</span>cursor<span class="token operator">=</span><span class="token string">"some_cursor_value"</span><span class="token punctuation">)</span>
        list_tools_requests <span class="token operator">=</span> spies<span class="token punctuation">.</span>get_client_requests<span class="token punctuation">(</span>method<span class="token operator">=</span><span class="token string">"tools/list"</span><span class="token punctuation">)</span>
        <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>list_tools_requests<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span>
        <span class="token keyword">assert</span> list_tools_requests<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>params <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span>
        <span class="token keyword">assert</span> list_tools_requests<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token string">"cursor"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"some_cursor_value"</span>

        spies<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># Test with empty string cursor</span>
        _ <span class="token operator">=</span> <span class="token keyword">await</span> client_session<span class="token punctuation">.</span>list_tools<span class="token punctuation">(</span>cursor<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>
        list_tools_requests <span class="token operator">=</span> spies<span class="token punctuation">.</span>get_client_requests<span class="token punctuation">(</span>method<span class="token operator">=</span><span class="token string">"tools/list"</span><span class="token punctuation">)</span>
        <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>list_tools_requests<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span>
        <span class="token keyword">assert</span> list_tools_requests<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>params <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span>
        <span class="token keyword">assert</span> list_tools_requests<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token string">"cursor"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">""</span>

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">test_list_resources_cursor_parameter</span><span class="token punctuation">(</span>stream_spy<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Test that the cursor parameter is accepted for list_resources
    and that it is correctly passed to the server.

    See: https://modelcontextprotocol.io/specification/2025-03-26/server/utilities/pagination#request-format
    """</span>
    server <span class="token operator">=</span> FastMCP<span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span>

    <span class="token comment"># Create a test resource</span>
    <span class="token decorator annotation punctuation">@server<span class="token punctuation">.</span>resource</span><span class="token punctuation">(</span><span class="token string">"resource://test/data"</span><span class="token punctuation">)</span>
    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">test_resource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Test resource"""</span>
        <span class="token keyword">return</span> <span class="token string">"Test data"</span>

    <span class="token keyword">async</span> <span class="token keyword">with</span> create_session<span class="token punctuation">(</span>server<span class="token punctuation">.</span>_mcp_server<span class="token punctuation">)</span> <span class="token keyword">as</span> client_session<span class="token punctuation">:</span>
        spies <span class="token operator">=</span> stream_spy<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># Test without cursor parameter (omitted)</span>
        _ <span class="token operator">=</span> <span class="token keyword">await</span> client_session<span class="token punctuation">.</span>list_resources<span class="token punctuation">(</span><span class="token punctuation">)</span>
        list_resources_requests <span class="token operator">=</span> spies<span class="token punctuation">.</span>get_client_requests<span class="token punctuation">(</span>method<span class="token operator">=</span><span class="token string">"resources/list"</span><span class="token punctuation">)</span>
        <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>list_resources_requests<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span>
        <span class="token keyword">assert</span> list_resources_requests<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>params <span class="token keyword">is</span> <span class="token boolean">None</span>

        spies<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># Test with cursor=None</span>
        _ <span class="token operator">=</span> <span class="token keyword">await</span> client_session<span class="token punctuation">.</span>list_resources<span class="token punctuation">(</span>cursor<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
        list_resources_requests <span class="token operator">=</span> spies<span class="token punctuation">.</span>get_client_requests<span class="token punctuation">(</span>method<span class="token operator">=</span><span class="token string">"resources/list"</span><span class="token punctuation">)</span>
        <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>list_resources_requests<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span>
        <span class="token keyword">assert</span> list_resources_requests<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>params <span class="token keyword">is</span> <span class="token boolean">None</span>

        spies<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># Test with cursor as string</span>
        _ <span class="token operator">=</span> <span class="token keyword">await</span> client_session<span class="token punctuation">.</span>list_resources<span class="token punctuation">(</span>cursor<span class="token operator">=</span><span class="token string">"some_cursor"</span><span class="token punctuation">)</span>
        list_resources_requests <span class="token operator">=</span> spies<span class="token punctuation">.</span>get_client_requests<span class="token punctuation">(</span>method<span class="token operator">=</span><span class="token string">"resources/list"</span><span class="token punctuation">)</span>
        <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>list_resources_requests<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span>
        <span class="token keyword">assert</span> list_resources_requests<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>params <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span>
        <span class="token keyword">assert</span> list_resources_requests<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token string">"cursor"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"some_cursor"</span>

        spies<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># Test with empty string cursor</span>
        _ <span class="token operator">=</span> <span class="token keyword">await</span> client_session<span class="token punctuation">.</span>list_resources<span class="token punctuation">(</span>cursor<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>
        list_resources_requests <span class="token operator">=</span> spies<span class="token punctuation">.</span>get_client_requests<span class="token punctuation">(</span>method<span class="token operator">=</span><span class="token string">"resources/list"</span><span class="token punctuation">)</span>
        <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>list_resources_requests<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span>
        <span class="token keyword">assert</span> list_resources_requests<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>params <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span>
        <span class="token keyword">assert</span> list_resources_requests<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token string">"cursor"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">""</span>

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">test_list_prompts_cursor_parameter</span><span class="token punctuation">(</span>stream_spy<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Test that the cursor parameter is accepted for list_prompts
    and that it is correctly passed to the server.
    See: https://modelcontextprotocol.io/specification/2025-03-26/server/utilities/pagination#request-format
    """</span>
    server <span class="token operator">=</span> FastMCP<span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span>

    <span class="token comment"># Create a test prompt</span>
    <span class="token decorator annotation punctuation">@server<span class="token punctuation">.</span>prompt</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">test_prompt</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Test prompt"""</span>
        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"Hello, </span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">!"</span></span>

    <span class="token keyword">async</span> <span class="token keyword">with</span> create_session<span class="token punctuation">(</span>server<span class="token punctuation">.</span>_mcp_server<span class="token punctuation">)</span> <span class="token keyword">as</span> client_session<span class="token punctuation">:</span>
        spies <span class="token operator">=</span> stream_spy<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># Test without cursor parameter (omitted)</span>
        _ <span class="token operator">=</span> <span class="token keyword">await</span> client_session<span class="token punctuation">.</span>list_prompts<span class="token punctuation">(</span><span class="token punctuation">)</span>
        list_prompts_requests <span class="token operator">=</span> spies<span class="token punctuation">.</span>get_client_requests<span class="token punctuation">(</span>method<span class="token operator">=</span><span class="token string">"prompts/list"</span><span class="token punctuation">)</span>
        <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>list_prompts_requests<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span>
        <span class="token keyword">assert</span> list_prompts_requests<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>params <span class="token keyword">is</span> <span class="token boolean">None</span>

        spies<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># Test with cursor=None</span>
        _ <span class="token operator">=</span> <span class="token keyword">await</span> client_session<span class="token punctuation">.</span>list_prompts<span class="token punctuation">(</span>cursor<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
        list_prompts_requests <span class="token operator">=</span> spies<span class="token punctuation">.</span>get_client_requests<span class="token punctuation">(</span>method<span class="token operator">=</span><span class="token string">"prompts/list"</span><span class="token punctuation">)</span>
        <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>list_prompts_requests<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span>
        <span class="token keyword">assert</span> list_prompts_requests<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>params <span class="token keyword">is</span> <span class="token boolean">None</span>

        spies<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># Test with cursor as string</span>
        _ <span class="token operator">=</span> <span class="token keyword">await</span> client_session<span class="token punctuation">.</span>list_prompts<span class="token punctuation">(</span>cursor<span class="token operator">=</span><span class="token string">"some_cursor"</span><span class="token punctuation">)</span>
        list_prompts_requests <span class="token operator">=</span> spies<span class="token punctuation">.</span>get_client_requests<span class="token punctuation">(</span>method<span class="token operator">=</span><span class="token string">"prompts/list"</span><span class="token punctuation">)</span>
        <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>list_prompts_requests<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span>
        <span class="token keyword">assert</span> list_prompts_requests<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>params <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span>
        <span class="token keyword">assert</span> list_prompts_requests<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token string">"cursor"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"some_cursor"</span>

        spies<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># Test with empty string cursor</span>
        _ <span class="token operator">=</span> <span class="token keyword">await</span> client_session<span class="token punctuation">.</span>list_prompts<span class="token punctuation">(</span>cursor<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>
        list_prompts_requests <span class="token operator">=</span> spies<span class="token punctuation">.</span>get_client_requests<span class="token punctuation">(</span>method<span class="token operator">=</span><span class="token string">"prompts/list"</span><span class="token punctuation">)</span>
        <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>list_prompts_requests<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span>
        <span class="token keyword">assert</span> list_prompts_requests<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>params <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span>
        <span class="token keyword">assert</span> list_prompts_requests<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token string">"cursor"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">""</span>

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">test_list_resource_templates_cursor_parameter</span><span class="token punctuation">(</span>stream_spy<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Test that the cursor parameter is accepted for list_resource_templates
    and that it is correctly passed to the server.

    See: https://modelcontextprotocol.io/specification/2025-03-26/server/utilities/pagination#request-format
    """</span>
    server <span class="token operator">=</span> FastMCP<span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span>

    <span class="token comment"># Create a test resource template</span>
    <span class="token decorator annotation punctuation">@server<span class="token punctuation">.</span>resource</span><span class="token punctuation">(</span><span class="token string">"resource://test/{name}"</span><span class="token punctuation">)</span>
    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">test_template</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Test resource template"""</span>
        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"Data for </span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">"</span></span>

    <span class="token keyword">async</span> <span class="token keyword">with</span> create_session<span class="token punctuation">(</span>server<span class="token punctuation">.</span>_mcp_server<span class="token punctuation">)</span> <span class="token keyword">as</span> client_session<span class="token punctuation">:</span>
        spies <span class="token operator">=</span> stream_spy<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># Test without cursor parameter (omitted)</span>
        _ <span class="token operator">=</span> <span class="token keyword">await</span> client_session<span class="token punctuation">.</span>list_resource_templates<span class="token punctuation">(</span><span class="token punctuation">)</span>
        list_templates_requests <span class="token operator">=</span> spies<span class="token punctuation">.</span>get_client_requests<span class="token punctuation">(</span>method<span class="token operator">=</span><span class="token string">"resources/templates/list"</span><span class="token punctuation">)</span>
        <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>list_templates_requests<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span>
        <span class="token keyword">assert</span> list_templates_requests<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>params <span class="token keyword">is</span> <span class="token boolean">None</span>

        spies<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># Test with cursor=None</span>
        _ <span class="token operator">=</span> <span class="token keyword">await</span> client_session<span class="token punctuation">.</span>list_resource_templates<span class="token punctuation">(</span>cursor<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
        list_templates_requests <span class="token operator">=</span> spies<span class="token punctuation">.</span>get_client_requests<span class="token punctuation">(</span>method<span class="token operator">=</span><span class="token string">"resources/templates/list"</span><span class="token punctuation">)</span>
        <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>list_templates_requests<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span>
        <span class="token keyword">assert</span> list_templates_requests<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>params <span class="token keyword">is</span> <span class="token boolean">None</span>

        spies<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># Test with cursor as string</span>
        _ <span class="token operator">=</span> <span class="token keyword">await</span> client_session<span class="token punctuation">.</span>list_resource_templates<span class="token punctuation">(</span>cursor<span class="token operator">=</span><span class="token string">"some_cursor"</span><span class="token punctuation">)</span>
        list_templates_requests <span class="token operator">=</span> spies<span class="token punctuation">.</span>get_client_requests<span class="token punctuation">(</span>method<span class="token operator">=</span><span class="token string">"resources/templates/list"</span><span class="token punctuation">)</span>
        <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>list_templates_requests<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span>
        <span class="token keyword">assert</span> list_templates_requests<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>params <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span>
        <span class="token keyword">assert</span> list_templates_requests<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token string">"cursor"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"some_cursor"</span>

        spies<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># Test with empty string cursor</span>
        _ <span class="token operator">=</span> <span class="token keyword">await</span> client_session<span class="token punctuation">.</span>list_resource_templates<span class="token punctuation">(</span>cursor<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>
        list_templates_requests <span class="token operator">=</span> spies<span class="token punctuation">.</span>get_client_requests<span class="token punctuation">(</span>method<span class="token operator">=</span><span class="token string">"resources/templates/list"</span><span class="token punctuation">)</span>
        <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>list_templates_requests<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span>
        <span class="token keyword">assert</span> list_templates_requests<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>params <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span>
        <span class="token keyword">assert</span> list_templates_requests<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token string">"cursor"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">""</span></code></pre></div>
<h2 id="09-deployment" style="position:relative;"><a href="#09-deployment" aria-label="09 deployment permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>09-deployment</h2>
<p><strong>本地开发与部署</strong></p>
<p>如果的服务器旨在用户机器上运行使用，请遵循以下步骤：</p>
<ol>
<li><strong>下载服务器</strong>：如果没有编写服务器，请先将其下载到的机器上</li>
<li><strong>启动服务器进程</strong>：运行的 MCP 服务器应用</li>
</ol>
<p>对于 SSE 服务器（stdio 类型服务器不需要此步骤）</p>
<ol>
<li><strong>配置网络</strong>：确保服务器在预期端口上可访问</li>
<li><strong>连接客户端</strong>：使用本地连接 URL，如 <code class="language-text">http://localhost:3000</code></li>
</ol>
<p><strong>云部署</strong></p>
<p>MCP 服务器可以部署到各种云平台：</p>
<ul>
<li><strong>无服务器函数</strong>：将轻量级 MCP 服务器部署为无服务器函数</li>
<li><strong>容器服务</strong>：使用 Azure Container Apps、AWS ECS 或 Google Cloud Run 等服务</li>
<li><strong>Kubernetes</strong>：在 Kubernetes 集群中部署和管理 MCP 服务器以实现高可用性</li>
</ul>
<p><strong>示例：Azure Container Apps</strong></p>
<p>Azure Container Apps 支持部署 MCP 服务器。目前仍在开发中，当前支持 SSE 服务器。</p>
<p>以下是部署步骤：</p>
<ol>
<li>克隆仓库：</li>
</ol>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/anthonychu/azure-container-apps-mcp-sample.git</code></pre></div>
<ol>
<li>本地运行测试：</li>
</ol>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">uv venv
uv <span class="token function">sync</span>

<span class="token comment"># Linux/macOSexport API_KEYS=&lt;API密钥></span>
<span class="token comment"># Windowsset API_KEYS=&lt;API密钥></span>

uv run fastapi dev main.py
</code></pre></div>
<ol>
<li>本地测试时，在 <em>.vscode</em> 目录创建 <em>mcp.json</em> 文件并添加以下内容：</li>
</ol>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"inputs"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"promptString"</span><span class="token punctuation">,</span>
      <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"weather-api-key"</span><span class="token punctuation">,</span>
      <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"天气 API 密钥"</span><span class="token punctuation">,</span>
      <span class="token property">"password"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"servers"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"weather-sse"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"sse"</span><span class="token punctuation">,</span>
      <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"http://localhost:8000/sse"</span><span class="token punctuation">,</span>
      <span class="token property">"headers"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"x-api-key"</span><span class="token operator">:</span> <span class="token string">"${input:weather-api-key}"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>启动 SSE 服务器后，点击 JSON 文件中的播放图标，现在应该看到 GitHub Copilot 检测到服务器工具（查看工具图标）。</p>
<ol>
<li>部署运行以下命令：</li>
</ol>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">az containerapp up <span class="token parameter variable">-g</span> <span class="token operator">&lt;</span>资源组名称<span class="token operator">></span> <span class="token parameter variable">-n</span> weather-mcp <span class="token parameter variable">--environment</span> mcp <span class="token parameter variable">-l</span> westus --env-vars <span class="token assign-left variable">API_KEYS</span><span class="token operator">=</span><span class="token operator">&lt;</span>API密钥<span class="token operator">></span> <span class="token parameter variable">--source</span> <span class="token builtin class-name">.</span></code></pre></div>
<h1 id="04-实战应用" style="position:relative;"><a href="#04-%E5%AE%9E%E6%88%98%E5%BA%94%E7%94%A8" aria-label="04 实战应用 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>04-实战应用</strong></h1>
<h3 id="核心服务器功能" style="position:relative;"><a href="#%E6%A0%B8%E5%BF%83%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8A%9F%E8%83%BD" aria-label="核心服务器功能 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>核心服务器功能</strong></h3>
<p>MCP服务器可以实现以下任意组合的功能：</p>
<h3 id="资源" style="position:relative;"><a href="#%E8%B5%84%E6%BA%90" aria-label="资源 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>资源</strong></h3>
<p>资源为用户或AI模型提供上下文和数据：</p>
<ul>
<li>文档库</li>
<li>知识库</li>
<li>结构化数据源</li>
<li>文件系统</li>
</ul>
<h3 id="提示" style="position:relative;"><a href="#%E6%8F%90%E7%A4%BA" aria-label="提示 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>提示</strong></h3>
<p>提示是为用户预定义的模板消息和工作流程：</p>
<ul>
<li>预定义的对话模板</li>
<li>引导式交互模式</li>
<li>专业化的对话结构</li>
</ul>
<h3 id="工具" style="position:relative;"><a href="#%E5%B7%A5%E5%85%B7" aria-label="工具 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>工具</strong></h3>
<p>工具是AI模型执行的函数：</p>
<ul>
<li>数据处理实用程序</li>
<li>外部API集成</li>
<li>计算能力</li>
<li>搜索功能</li>
</ul>
<h3 id="示例实现python" style="position:relative;"><a href="#%E7%A4%BA%E4%BE%8B%E5%AE%9E%E7%8E%B0python" aria-label="示例实现python permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>示例实现：Python</strong></h3>
<p>Python SDK提供了一种符合Python风格的MCP实现方式，并集成了优秀的机器学习框架。</p>
<h3 id="关键功能" style="position:relative;"><a href="#%E5%85%B3%E9%94%AE%E5%8A%9F%E8%83%BD" aria-label="关键功能 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>关键功能</strong></h3>
<ul>
<li>支持asyncio的异步/等待</li>
<li>与Flask和FastAPI集成</li>
<li>简单的工具注册</li>
<li>与流行ML库的本机集成</li>
</ul>
<p>有关完整的Python实现示例，请参见示例目录中的<a href="https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/04-PracticalImplementation/samples/python/mcp_sample.py">mcp_sample.py</a>。</p>
<h3 id="api管理" style="position:relative;"><a href="#api%E7%AE%A1%E7%90%86" aria-label="api管理 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>API管理</strong></h3>
<p>Azure API管理是保护MCP服务器的理想解决方案。其思想是在的MCP服务器前放置一个Azure API管理实例，让它处理可能需要的功能，例如：</p>
<ul>
<li>速率限制</li>
<li>令牌管理</li>
<li>监控</li>
<li>负载均衡</li>
<li>安全性</li>
</ul>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/23120ddc4dd3609333985feeff37ae93/b12f7/mcp_image_7.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 33.12883435582822%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABLUlEQVR42nVRwU6DQBDlJ7RRWBZ2N0BLF1AjjWikiUSwB6OeNDFejDfFf2jiyYNf4Lc+B2gtknp42Z15M28mbwzbtrEG5/xfNLySAuEkRBRHkPRf9/Q1jC5JWJGMMXDHgUNoXu4KylPsunDMPWTLbwSPS7DRTscPBpMg/xXrtpDwlAS39uFHMYLTORRnLSeFQPrwAnlyDc6srmco2A8s00L9XqMsC5i+xrS4QXx5C/+8Alc+dDhGdniMRI+haOg2m4y+R4I2qBYLzNIEuxf34K9f0PUnRs8fsKIZmPAQRDn0NKIetvGX21sECY1vjBHZ+DhJEM6vEFd30HkJ4XlwwiNkT2/Ik6L19c/RNoKro/Sv1YgzEzb5qGhrT7oISFB5PuL0DEl8QDVOWzf08AdElMuONcc1bgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/23120ddc4dd3609333985feeff37ae93/a6d36/mcp_image_7.png"
        srcset="/static/23120ddc4dd3609333985feeff37ae93/222b7/mcp_image_7.png 163w,
/static/23120ddc4dd3609333985feeff37ae93/ff46a/mcp_image_7.png 325w,
/static/23120ddc4dd3609333985feeff37ae93/a6d36/mcp_image_7.png 650w,
/static/23120ddc4dd3609333985feeff37ae93/e548f/mcp_image_7.png 975w,
/static/23120ddc4dd3609333985feeff37ae93/b12f7/mcp_image_7.png 1020w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/f7bef3e092834acb08de8df08885fa37/9b29b/mcp_image_8.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 73.00613496932516%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAABoElEQVR42nVT2W7cMAzc//+tvPQlT0FaNOimRZu141v3TbljK3a8qEsIhEDPUNSMdZnnmYistSmlGKNzDvucM+rIxhjvPTbAlAoAqACDfJnXwLdCLvzSoiC01tM0IYdDAIZGn+R9AyZjrK5rcLwPeYsdUAY5IaMUE4WQGBM4FnPknOZD5ENcDqWQyVLSWg2cNePwLkTPx5fgmv+SKSpKwtqR9c98eJLsatUvb34HWy3THQY+IQffO3Pj4ysbXwVvjQmQyXnIlgT72VaPfPyaSRfiRp7vxl4FmFclFtWRsZfT97Z6GJovVvcQGBKk5GMQlAyAhYx+eRPsTti1aQ6RlNJCcCmV4I1kP4Jv8tr9RO3tD8GK3rbODjAPtkkpY8RctJ/xqTZR8OYPlpiuQ/dN8E4hRJWivBeMTqxaG8AqYXSnRAfHBK8lvwZ7O1p94vN+Z7hq1G25pDRq+SUdUSyXT+lj5c3Df++cguvKir73tlOy5tObYG9aVlrWzjTBtcH1QF72V1V0Wh6MrnIaZhqRtbyB4xd0l1Gh0Zl3bxuL7O1fB5ZsRj0+3vkAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/f7bef3e092834acb08de8df08885fa37/a6d36/mcp_image_8.png"
        srcset="/static/f7bef3e092834acb08de8df08885fa37/222b7/mcp_image_8.png 163w,
/static/f7bef3e092834acb08de8df08885fa37/ff46a/mcp_image_8.png 325w,
/static/f7bef3e092834acb08de8df08885fa37/a6d36/mcp_image_8.png 650w,
/static/f7bef3e092834acb08de8df08885fa37/e548f/mcp_image_8.png 975w,
/static/f7bef3e092834acb08de8df08885fa37/3c492/mcp_image_8.png 1300w,
/static/f7bef3e092834acb08de8df08885fa37/9b29b/mcp_image_8.png 3840w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<h3 id="将远程mcp服务器部署到azure" style="position:relative;"><a href="#%E5%B0%86%E8%BF%9C%E7%A8%8Bmcp%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2%E5%88%B0azure" aria-label="将远程mcp服务器部署到azure permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>将远程MCP服务器部署到Azure</strong></h3>
<ol>
<li>
<p>克隆代码库</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/Azure-Samples/remote-mcp-apim-functions-python.git
<span class="token builtin class-name">cd</span> remote-mcp-apim-functions-python</code></pre></div>
</li>
<li>
<p>注册<code class="language-text">Microsoft.App</code>资源提供程序。</p>
<ul>
<li>如果使用Azure CLI，运行<code class="language-text">az provider register --namespace Microsoft.App --wait</code>。</li>
<li>如果使用Azure PowerShell，运行<code class="language-text">Register-AzResourceProvider -ProviderNamespace Microsoft.App</code>。然后在一段时间后运行<code class="language-text">(Get-AzResourceProvider -ProviderNamespace Microsoft.App).RegistrationState</code>以检查注册是否完成。</li>
</ul>
</li>
<li>
<p>运行此<a href="https://aka.ms/azd">azd</a>命令，以预配API管理服务、函数应用（包含代码）和所有其他所需的Azure资源</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">azd up</code></pre></div>
<p>此命令应部署Azure上的所有云资源。</p>
</li>
</ol>
<h3 id="使用mcp检查器测试的服务器" style="position:relative;"><a href="#%E4%BD%BF%E7%94%A8mcp%E6%A3%80%E6%9F%A5%E5%99%A8%E6%B5%8B%E8%AF%95%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8" aria-label="使用mcp检查器测试的服务器 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>使用MCP检查器测试的服务器</strong></h3>
<ol>
<li>
<p>在<strong>新终端窗口</strong>中，安装并运行MCP检查器</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">npx @modelcontextprotocol/inspector</code></pre></div>
<p>应该会看到一个类似于以下内容的界面：</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/754d3975194283bc0eb6ad08cfdc9783/870dd/mcp_image_9.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 59.50920245398773%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAwElEQVR42p1RywrCMBDMP3vRQxHRgwfRg0c/TlHxVJu0jSSbbBOnFrHgg8YhZMOys7szERVQa6UUIhE1KRBSqvxaSFk652OMIYQ4GAJErW8dDc3SyKqsLLnwIHdIIEOw9z70kECWqoRszxyfwz/WdaL6QEag2BhT1YBuU1+GoLu1RNa1NzljLQwWtdZwe384ns4X6GduEtbebHej8Xy6WE+yZTZb5Xkx/MMERrVrGFjuvOc0w96N+Z8Mz/j34df7DpiJv/ZmMLisAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/754d3975194283bc0eb6ad08cfdc9783/a6d36/mcp_image_9.png"
        srcset="/static/754d3975194283bc0eb6ad08cfdc9783/222b7/mcp_image_9.png 163w,
/static/754d3975194283bc0eb6ad08cfdc9783/ff46a/mcp_image_9.png 325w,
/static/754d3975194283bc0eb6ad08cfdc9783/a6d36/mcp_image_9.png 650w,
/static/754d3975194283bc0eb6ad08cfdc9783/e548f/mcp_image_9.png 975w,
/static/754d3975194283bc0eb6ad08cfdc9783/3c492/mcp_image_9.png 1300w,
/static/754d3975194283bc0eb6ad08cfdc9783/870dd/mcp_image_9.png 2323w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
</li>
<li>
<p>CTRL点击以从应用显示的URL加载MCP检查器Web应用（例如<a href="http://127.0.0.1:6274/#resources%EF%BC%89%E3%80%82">http://127.0.0.1:6274/#resources）。</a></p>
</li>
<li>
<p>将传输类型设置为<code class="language-text">SSE</code>。</p>
</li>
<li>
<p>将URL设置为<code class="language-text">azd up</code>后显示的运行中的API管理SSE端点并<strong>连接</strong>：</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">https://&lt;apim-servicename-from-azd-output>.azure-api.net/mcp/sse</code></pre></div>
</li>
<li>
<p><strong>列出工具</strong>。点击一个工具并<strong>运行工具</strong>。</p>
</li>
</ol>
<p>server.py</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment">#!/usr/bin/env python3</span>
<span class="token triple-quoted-string string">"""
Model Context Protocol (MCP) Python Sample Implementation.

This module demonstrates how to implement a basic MCP server that can handle
completion requests. It provides a mock implementation that simulates
interaction with various AI models.

For more information about MCP: https://modelcontextprotocol.io/
"""</span>

<span class="token keyword">import</span> json
<span class="token keyword">import</span> logging

<span class="token comment"># Import FastMCP - the high-level MCP server API</span>
<span class="token keyword">from</span> mcp<span class="token punctuation">.</span>server<span class="token punctuation">.</span>fastmcp <span class="token keyword">import</span> FastMCP

<span class="token comment"># Configure module logger</span>
logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span>level<span class="token operator">=</span>logging<span class="token punctuation">.</span>INFO<span class="token punctuation">)</span>
logger <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

<span class="token comment"># Define available models</span>
AVAILABLE_MODELS <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"gpt-4"</span><span class="token punctuation">,</span> <span class="token string">"llama-3-70b"</span><span class="token punctuation">,</span> <span class="token string">"claude-3-sonnet"</span><span class="token punctuation">]</span>

<span class="token comment"># Create an MCP server</span>
mcp <span class="token operator">=</span> FastMCP<span class="token punctuation">(</span><span class="token string">"Python MCP Demo Server"</span><span class="token punctuation">)</span>

<span class="token comment"># Define a tool for generating completions</span>
<span class="token decorator annotation punctuation">@mcp<span class="token punctuation">.</span>tool</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">completion</span><span class="token punctuation">(</span>model<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> prompt<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> temperature<span class="token punctuation">:</span> <span class="token builtin">float</span> <span class="token operator">=</span> <span class="token number">0.7</span><span class="token punctuation">,</span> max_tokens<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Generate completions using AI models
    
    Args:
        model: The AI model to use for completion
        prompt: The prompt text to complete
        temperature: Sampling temperature (0.0 to 1.0)
        max_tokens: Maximum number of tokens to generate
    """</span>
    <span class="token comment"># Validate model</span>
    <span class="token keyword">if</span> model <span class="token keyword">not</span> <span class="token keyword">in</span> AVAILABLE_MODELS<span class="token punctuation">:</span>
        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Model </span><span class="token interpolation"><span class="token punctuation">{</span>model<span class="token punctuation">}</span></span><span class="token string"> not supported"</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># In a real implementation, this would call an AI model</span>
    <span class="token comment"># Here we provide a more comprehensive mock response based on the prompt</span>
    logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Processing completion request for model: </span><span class="token interpolation"><span class="token punctuation">{</span>model<span class="token punctuation">}</span></span><span class="token string"> with temperature: </span><span class="token interpolation"><span class="token punctuation">{</span>temperature<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># Return different responses based on common prompts</span>
    <span class="token keyword">if</span> <span class="token string">"meaning of life"</span> <span class="token keyword">in</span> prompt<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        completion_text <span class="token operator">=</span> <span class="token string">"The meaning of life is a philosophical question that has been debated throughout human history. According to Douglas Adams in 'The Hitchhiker's Guide to the Galaxy', the answer is simply '42'. However, many philosophers suggest that the meaning of life is something each person must discover for themselves through their own experiences, values, and beliefs."</span>
    <span class="token keyword">elif</span> <span class="token string">"hello"</span> <span class="token keyword">in</span> prompt<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token string">"hi"</span> <span class="token keyword">in</span> prompt<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        completion_text <span class="token operator">=</span> <span class="token string">"Hello! I'm a simulated AI response from the MCP server example. How can I help you today?"</span>
    <span class="token keyword">elif</span> <span class="token string">"who are you"</span> <span class="token keyword">in</span> prompt<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        completion_text <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"I'm a mock </span><span class="token interpolation"><span class="token punctuation">{</span>model<span class="token punctuation">}</span></span><span class="token string"> model response from the Model Context Protocol (MCP) Python sample implementation. I'm not actually using </span><span class="token interpolation"><span class="token punctuation">{</span>model<span class="token punctuation">}</span></span><span class="token string">, just simulating how it would respond in a real MCP server."</span></span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        completion_text <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"This is a simulated response to your prompt about '</span><span class="token interpolation"><span class="token punctuation">{</span>prompt<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">30]</span><span class="token punctuation">}</span></span><span class="token string">...' from model </span><span class="token interpolation"><span class="token punctuation">{</span>model<span class="token punctuation">}</span></span><span class="token string">. In a real implementation, you would get an actual AI-generated completion here."</span></span>
    
    <span class="token comment"># Return the response</span>
    <span class="token keyword">return</span> completion_text

<span class="token comment"># Define a calculator tool to add two numbers</span>
<span class="token decorator annotation punctuation">@mcp<span class="token punctuation">.</span>tool</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">int</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Add two numbers together
    
    Args:
        a: First number
        b: Second number
    
    Returns:
        The sum of the two numbers
    """</span>
    logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Adding </span><span class="token interpolation"><span class="token punctuation">{</span>a<span class="token punctuation">}</span></span><span class="token string"> and </span><span class="token interpolation"><span class="token punctuation">{</span>b<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> b

<span class="token comment"># Define a models resource to expose available AI models</span>
<span class="token decorator annotation punctuation">@mcp<span class="token punctuation">.</span>resource</span><span class="token punctuation">(</span><span class="token string">"models://"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">get_models</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Get information about available AI models"""</span>
    logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Retrieving available models"</span><span class="token punctuation">)</span>
    models_data <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token string">"gpt-4"</span><span class="token punctuation">,</span> 
            <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"GPT-4"</span><span class="token punctuation">,</span>
            <span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"OpenAI's GPT-4 large language model"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token string">"llama-3-70b"</span><span class="token punctuation">,</span>
            <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"LLaMA 3 (70B)"</span><span class="token punctuation">,</span>
            <span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"Meta's LLaMA 3 with 70 billion parameters"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token string">"claude-3-sonnet"</span><span class="token punctuation">,</span>
            <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Claude 3 Sonnet"</span><span class="token punctuation">,</span>
            <span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"Anthropic's Claude 3 Sonnet model"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
    
    <span class="token keyword">return</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"models"</span><span class="token punctuation">:</span> models_data<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># Define a greeting resource that dynamically constructs a personalized greeting</span>
<span class="token decorator annotation punctuation">@mcp<span class="token punctuation">.</span>resource</span><span class="token punctuation">(</span><span class="token string">"greeting://{name}"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">get_greeting</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Return a greeting for the given name
    
    Args:
        name: The name to greet
        
    Returns:
        A personalized greeting message
    """</span>
    <span class="token keyword">import</span> urllib<span class="token punctuation">.</span>parse
    <span class="token comment"># Decode URL-encoded name</span>
    decoded_name <span class="token operator">=</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>unquote<span class="token punctuation">(</span>name<span class="token punctuation">)</span>
    logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Generating greeting for </span><span class="token interpolation"><span class="token punctuation">{</span>decoded_name<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"Hello, </span><span class="token interpolation"><span class="token punctuation">{</span>decoded_name<span class="token punctuation">}</span></span><span class="token string">!"</span></span>

<span class="token comment"># Define a prompt for code review</span>
<span class="token decorator annotation punctuation">@mcp<span class="token punctuation">.</span>prompt</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">review_code</span><span class="token punctuation">(</span>code<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Provide a template for reviewing code
    
    Args:
        code: The code to review
        
    Returns:
        A prompt that asks the LLM to review the code
    """</span>
    logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Creating code review prompt for </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> bytes of code"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"Please review this code and provide feedback on best practices, potential bugs, and improvements:```</span><span class="token interpolation"><span class="token punctuation">{</span>code<span class="token punctuation">}</span></span><span class="token string">```"</span></span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"MCP Server initialized"</span></span><span class="token punctuation">)</span>
    logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Supported models: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token string">', '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>AVAILABLE_MODELS<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># Run the server with stdio transport</span>
    <span class="token comment"># This can be tested with one of these methods:</span>
    <span class="token comment"># 1. Direct execution: python server.py</span>
    <span class="token comment"># 2. MCP inspector: mcp dev server.py</span>
    <span class="token comment"># 3. Install in Claude Desktop: mcp install server.py</span>
    mcp<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div>
<p>client.py</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment">#!/usr/bin/env python3</span>
<span class="token triple-quoted-string string">"""
Clean MCP Client Example.

This is a clean implementation of an MCP client that demonstrates
all capabilities of the MCP protocol with proper error handling.
"""</span>

<span class="token keyword">import</span> asyncio
<span class="token keyword">import</span> logging
<span class="token keyword">import</span> json
<span class="token keyword">import</span> urllib<span class="token punctuation">.</span>parse
<span class="token keyword">import</span> sys
<span class="token keyword">from</span> mcp <span class="token keyword">import</span> ClientSession<span class="token punctuation">,</span> StdioServerParameters
<span class="token keyword">from</span> mcp<span class="token punctuation">.</span>client<span class="token punctuation">.</span>stdio <span class="token keyword">import</span> stdio_client
<span class="token keyword">from</span> mcp<span class="token punctuation">.</span>types <span class="token keyword">import</span> TextContent<span class="token punctuation">,</span> TextResourceContents

<span class="token comment"># Configure logging</span>
logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span>level<span class="token operator">=</span>logging<span class="token punctuation">.</span>INFO<span class="token punctuation">)</span>
logger <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Main client function that demonstrates MCP client features"""</span>
    logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Starting clean MCP client"</span><span class="token punctuation">)</span>
    
    server_params <span class="token operator">=</span> StdioServerParameters<span class="token punctuation">(</span>
        command<span class="token operator">=</span><span class="token string">"python"</span><span class="token punctuation">,</span>
        args<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"server.py"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Connecting to server..."</span><span class="token punctuation">)</span>
        <span class="token keyword">async</span> <span class="token keyword">with</span> stdio_client<span class="token punctuation">(</span>server_params<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token punctuation">(</span>reader<span class="token punctuation">,</span> writer<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">async</span> <span class="token keyword">with</span> ClientSession<span class="token punctuation">(</span>reader<span class="token punctuation">,</span> writer<span class="token punctuation">)</span> <span class="token keyword">as</span> session<span class="token punctuation">:</span>
                logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Initializing session"</span><span class="token punctuation">)</span>
                <span class="token keyword">await</span> session<span class="token punctuation">.</span>initialize<span class="token punctuation">(</span><span class="token punctuation">)</span>
                
                <span class="token comment"># 1. Call the add tool</span>
                logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Testing calculator tool"</span><span class="token punctuation">)</span>
                add_result <span class="token operator">=</span> <span class="token keyword">await</span> session<span class="token punctuation">.</span>call_tool<span class="token punctuation">(</span><span class="token string">"add"</span><span class="token punctuation">,</span> arguments<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"a"</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> add_result <span class="token keyword">and</span> add_result<span class="token punctuation">.</span>content<span class="token punctuation">:</span>
                    text_content <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span><span class="token punctuation">(</span>content <span class="token keyword">for</span> content <span class="token keyword">in</span> add_result<span class="token punctuation">.</span>content 
                                        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> TextContent<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
                    <span class="token keyword">if</span> text_content<span class="token punctuation">:</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"1. Calculator result (5 + 7) = </span><span class="token interpolation"><span class="token punctuation">{</span>text_content<span class="token punctuation">.</span>text<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                
                <span class="token comment"># 2. Call the completion tool</span>
                logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Testing completion tool"</span><span class="token punctuation">)</span>
                completion_result <span class="token operator">=</span> <span class="token keyword">await</span> session<span class="token punctuation">.</span>call_tool<span class="token punctuation">(</span>
                    <span class="token string">"completion"</span><span class="token punctuation">,</span> 
                    arguments<span class="token operator">=</span><span class="token punctuation">{</span>
                        <span class="token string">"model"</span><span class="token punctuation">:</span> <span class="token string">"gpt-4"</span><span class="token punctuation">,</span>
                        <span class="token string">"prompt"</span><span class="token punctuation">:</span> <span class="token string">"What is the meaning of life?"</span><span class="token punctuation">,</span>
                        <span class="token string">"temperature"</span><span class="token punctuation">:</span> <span class="token number">0.7</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">)</span>
                <span class="token keyword">if</span> completion_result <span class="token keyword">and</span> completion_result<span class="token punctuation">.</span>content<span class="token punctuation">:</span>
                    text_content <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span><span class="token punctuation">(</span>content <span class="token keyword">for</span> content <span class="token keyword">in</span> completion_result<span class="token punctuation">.</span>content 
                                        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> TextContent<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
                    <span class="token keyword">if</span> text_content<span class="token punctuation">:</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"2. Completion: </span><span class="token interpolation"><span class="token punctuation">{</span>text_content<span class="token punctuation">.</span>text<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                
                <span class="token comment"># 3. Get models resource</span>
                logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Testing models resource"</span><span class="token punctuation">)</span>
                models_response <span class="token operator">=</span> <span class="token keyword">await</span> session<span class="token punctuation">.</span>read_resource<span class="token punctuation">(</span><span class="token string">"models://"</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> models_response <span class="token keyword">and</span> models_response<span class="token punctuation">.</span>contents<span class="token punctuation">:</span>
                    text_resource <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span><span class="token punctuation">(</span>content <span class="token keyword">for</span> content <span class="token keyword">in</span> models_response<span class="token punctuation">.</span>contents 
                                        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> TextResourceContents<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
                    <span class="token keyword">if</span> text_resource<span class="token punctuation">:</span>
                        models <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>text_resource<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"3. Available models:"</span><span class="token punctuation">)</span>
                        <span class="token keyword">for</span> model <span class="token keyword">in</span> models<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"models"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"   - </span><span class="token interpolation"><span class="token punctuation">{</span>model<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string"> (</span><span class="token interpolation"><span class="token punctuation">{</span>model<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">): </span><span class="token interpolation"><span class="token punctuation">{</span>model<span class="token punctuation">[</span><span class="token string">'description'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                
                <span class="token comment"># 4. Get greeting resource</span>
                logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Testing greeting resource"</span><span class="token punctuation">)</span>
                name <span class="token operator">=</span> <span class="token string">"MCP Explorer"</span>
                encoded_name <span class="token operator">=</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>quote<span class="token punctuation">(</span>name<span class="token punctuation">)</span>
                greeting_response <span class="token operator">=</span> <span class="token keyword">await</span> session<span class="token punctuation">.</span>read_resource<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"greeting://</span><span class="token interpolation"><span class="token punctuation">{</span>encoded_name<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> greeting_response <span class="token keyword">and</span> greeting_response<span class="token punctuation">.</span>contents<span class="token punctuation">:</span>
                    text_resource <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span><span class="token punctuation">(</span>content <span class="token keyword">for</span> content <span class="token keyword">in</span> greeting_response<span class="token punctuation">.</span>contents 
                                        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> TextResourceContents<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
                    <span class="token keyword">if</span> text_resource<span class="token punctuation">:</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"4. Greeting: </span><span class="token interpolation"><span class="token punctuation">{</span>text_resource<span class="token punctuation">.</span>text<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                
                <span class="token comment"># 5. Use code review prompt</span>
                logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Testing code review prompt"</span><span class="token punctuation">)</span>
                sample_code <span class="token operator">=</span> <span class="token string">"def hello_world():    print('Hello, world!')"</span>
                prompt_response <span class="token operator">=</span> <span class="token keyword">await</span> session<span class="token punctuation">.</span>get_prompt<span class="token punctuation">(</span><span class="token string">"review_code"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">"code"</span><span class="token punctuation">:</span> sample_code<span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> prompt_response <span class="token keyword">and</span> prompt_response<span class="token punctuation">.</span>messages<span class="token punctuation">:</span>
                    message <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span><span class="token punctuation">(</span>msg <span class="token keyword">for</span> msg <span class="token keyword">in</span> prompt_response<span class="token punctuation">.</span>messages <span class="token keyword">if</span> msg<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
                    <span class="token keyword">if</span> message <span class="token keyword">and</span> message<span class="token punctuation">.</span>content<span class="token punctuation">:</span>
                        text_content <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span><span class="token punctuation">(</span>content <span class="token keyword">for</span> content <span class="token keyword">in</span> <span class="token punctuation">[</span>message<span class="token punctuation">.</span>content<span class="token punctuation">]</span> 
                                            <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> TextContent<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
                        <span class="token keyword">if</span> text_content<span class="token punctuation">:</span>
                            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"5. Code review prompt:"</span><span class="token punctuation">)</span>
                            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"   </span><span class="token interpolation"><span class="token punctuation">{</span>text_content<span class="token punctuation">.</span>text<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>
        logger<span class="token punctuation">.</span>exception<span class="token punctuation">(</span><span class="token string">"An error occurred"</span><span class="token punctuation">)</span>
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div>
<h1 id="05-mcp-高级话题" style="position:relative;"><a href="#05-mcp-%E9%AB%98%E7%BA%A7%E8%AF%9D%E9%A2%98" aria-label="05 mcp 高级话题 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>05-MCP 高级话题</strong></h1>
<p>本章涵盖模型上下文协议（MCP）实现中的一系列高级主题，包括多模态集成、可扩展性、安全最佳实践和企业集成。这些主题对于构建健壮且生产就绪的MCP应用至关重要，能够满足现代AI系统的需求。</p>
<table>
<thead>
<tr>
<th>链接</th>
<th>标题</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-integration/README.md">5.1 与Azure集成</a></td>
<td>与Azure集成</td>
<td>学习如何在Azure上集成的MCP服务器</td>
</tr>
<tr>
<td><a href="https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-multi-modality/README.md">5.2 多模态示例</a></td>
<td>MCP多模态示例</td>
<td>音频、图像和多模态响应的示例</td>
</tr>
<tr>
<td><a href="https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-oauth2-demo/">5.3 MCP OAuth2示例</a></td>
<td>MCP OAuth2演示</td>
<td>最小的Spring Boot应用，展示OAuth2与MCP结合，包括授权和资源服务器。演示安全令牌发放、受保护的端点、Azure Container Apps部署和API管理集成。</td>
</tr>
<tr>
<td><a href="https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-root-contexts/README.md">5.4 根上下文</a></td>
<td>根上下文</td>
<td>了解根上下文及其实现方式</td>
</tr>
<tr>
<td><a href="https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-routing/README.md">5.5 路由</a></td>
<td>路由</td>
<td>学习不同类型的路由</td>
</tr>
<tr>
<td><a href="https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-sampling/README.md">5.6 采样</a></td>
<td>采样</td>
<td>学习如何使用采样</td>
</tr>
<tr>
<td><a href="https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-scaling/README.md">5.7 扩展</a></td>
<td>扩展</td>
<td>学习扩展相关知识</td>
</tr>
<tr>
<td><a href="https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-security/README.md">5.8 安全</a></td>
<td>安全</td>
<td>保护的MCP服务器</td>
</tr>
<tr>
<td><a href="https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/web-search-mcp/README.md">5.9 网络搜索示例</a></td>
<td>网络搜索MCP</td>
<td>集成了SerpAPI的Python MCP服务器和客户端，用于实时网络搜索、新闻搜索、产品搜索和问答。展示了多工具协调、外部API集成和健壮的错误处理。</td>
</tr>
<tr>
<td><a href="https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-realtimestreaming/README.md">5.10 实时流</a></td>
<td>实时流传输</td>
<td>在当今数据驱动的世界中，实时数据流传输变得至关重要，企业和应用需要即时访问信息以做出及时决策。</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>链接</th>
<th>标题</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-integration/README.md">5.1 与 Azure 集成</a></td>
<td>与 Azure 集成</td>
<td>了解如何在 Azure 上集成的 MCP 服务器</td>
</tr>
<tr>
<td><a href="https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-multi-modality/README.md">5.2 多模态示例</a></td>
<td>MCP 多模态示例</td>
<td>音频、图像和多模态响应的示例</td>
</tr>
<tr>
<td><a href="https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-oauth2-demo/">5.3 MCP OAuth2 示例</a></td>
<td>MCP OAuth2 演示</td>
<td>一个最小的 Spring Boot 应用程序，展示了与 MCP 的 OAuth2，既作为授权服务器又作为资源服务器。演示了安全令牌颁发、受保护的端点、Azure 容器应用部署和 API 管理集成。</td>
</tr>
<tr>
<td><a href="https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-root-contexts/README.md">5.4 根上下文</a></td>
<td>根上下文</td>
<td>了解有关根上下文以及如何实现它们的更多信息</td>
</tr>
<tr>
<td><a href="https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-routing/README.md">5.5 路由</a></td>
<td>路由</td>
<td>了解不同类型的路由</td>
</tr>
<tr>
<td><a href="https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-sampling/README.md">5.6 采样</a></td>
<td>采样</td>
<td>了解如何使用采样</td>
</tr>
<tr>
<td><a href="https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-scaling/README.md">5.7 扩展</a></td>
<td>扩展</td>
<td>了解有关扩展的信息</td>
</tr>
<tr>
<td><a href="https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-security/README.md">5.8 安全</a></td>
<td>安全</td>
<td>保护的 MCP 服务器</td>
</tr>
<tr>
<td><a href="https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/web-search-mcp/README.md">5.9 Web 搜索示例</a></td>
<td>Web 搜索 MCP</td>
<td>与 SerpAPI 集成的 Python MCP 服务器和客户端，用于实时 Web、新闻、产品搜索和问答。演示了多工具编排、外部 API 集成和强大的错误处理。</td>
</tr>
<tr>
<td><a href="https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-realtimestreaming/README.md">5.10 实时流</a></td>
<td>流</td>
<td>实时数据流在当今数据驱动的世界中已变得至关重要，企业和应用程序需要立即访问信息以做出及时决策。</td>
</tr>
<tr>
<td><a href="https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-realtimesearch/README.md">5.11 实时 Web 搜索</a></td>
<td>Web 搜索</td>
<td>实时 Web 搜索 MCP 如何通过提供跨 AI 模型、搜索引擎和应用程序的上下文管理的标准化方法来改变实时 Web 搜索。</td>
</tr>
<tr>
<td><a href="https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-security-entra/README.md">5.12 模型上下文协议服务器的 Entra ID 身份验证</a></td>
<td>Entra ID 身份验证</td>
<td>Microsoft Entra ID 提供了强大的基于云的身份和访问管理解决方案，有助于确保只有授权的用户和应用程序才能与的 MCP 服务器交互。</td>
</tr>
<tr>
<td><a href="https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/05-AdvancedTopics/mcp-foundry-agent-integration/README.md">5.13 Azure AI Foundry 代理集成</a></td>
<td>Azure AI Foundry 集成</td>
<td>了解如何将模型上下文协议服务器与 Azure AI Foundry 代理集成，从而通过标准化的外部数据源连接实现强大的工具编排和企业 AI 功能。</td>
</tr>
</tbody>
</table>
<h2 id="mcp-与-azure-集成" style="position:relative;"><a href="#mcp-%E4%B8%8E-azure-%E9%9B%86%E6%88%90" aria-label="mcp 与 azure 集成 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>MCP 与 Azure 集成</strong></h2>
<p><strong>与Azure OpenAI 集成 TODO change to python</strong></p>
<p><strong>Microsoft AI Foundry 集成 TODO change to python</strong></p>
<p><strong>将 MCP 与 Azure ML 集成</strong></p>
<ul>
<li>
<p>Python</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"> Python Azure AI 集成
<span class="token keyword">from</span> mcp_client <span class="token keyword">import</span> McpClient
<span class="token keyword">from</span> azure<span class="token punctuation">.</span>ai<span class="token punctuation">.</span>ml <span class="token keyword">import</span> MLClient
<span class="token keyword">from</span> azure<span class="token punctuation">.</span>identity <span class="token keyword">import</span> DefaultAzureCredential
<span class="token keyword">from</span> azure<span class="token punctuation">.</span>ai<span class="token punctuation">.</span>ml<span class="token punctuation">.</span>entities <span class="token keyword">import</span> Environment<span class="token punctuation">,</span> AmlCompute
<span class="token keyword">import</span> os
<span class="token keyword">import</span> asyncio

<span class="token keyword">class</span> <span class="token class-name">EnterpriseAiIntegration</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> mcp_server_url<span class="token punctuation">,</span> subscription_id<span class="token punctuation">,</span> resource_group<span class="token punctuation">,</span> workspace_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 设置 MCP 客户端</span>
        self<span class="token punctuation">.</span>mcp_client <span class="token operator">=</span> McpClient<span class="token punctuation">(</span>server_url<span class="token operator">=</span>mcp_server_url<span class="token punctuation">)</span>

        <span class="token comment"># 设置 Azure ML 客户端</span>
        self<span class="token punctuation">.</span>credential <span class="token operator">=</span> DefaultAzureCredential<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>ml_client <span class="token operator">=</span> MLClient<span class="token punctuation">(</span>
            self<span class="token punctuation">.</span>credential<span class="token punctuation">,</span>
            subscription_id<span class="token punctuation">,</span>
            resource_group<span class="token punctuation">,</span>
            workspace_name
        <span class="token punctuation">)</span>

    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">execute_ml_pipeline</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> pipeline_name<span class="token punctuation">,</span> input_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""在 Azure ML 中执行 ML 流水线"""</span>
        <span class="token comment"># 首先使用 MCP 工具处理输入数据</span>
        processed_data <span class="token operator">=</span> <span class="token keyword">await</span> self<span class="token punctuation">.</span>mcp_client<span class="token punctuation">.</span>execute_tool<span class="token punctuation">(</span>
            <span class="token string">"dataPreprocessor"</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">"data"</span><span class="token punctuation">:</span> input_data<span class="token punctuation">,</span>
                <span class="token string">"operations"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"normalize"</span><span class="token punctuation">,</span> <span class="token string">"clean"</span><span class="token punctuation">,</span> <span class="token string">"transform"</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>

        <span class="token comment"># 将流水线提交到 Azure ML</span>
        pipeline_job <span class="token operator">=</span> self<span class="token punctuation">.</span>ml_client<span class="token punctuation">.</span>jobs<span class="token punctuation">.</span>create_or_update<span class="token punctuation">(</span>
            entity<span class="token operator">=</span><span class="token punctuation">{</span>
                <span class="token string">"name"</span><span class="token punctuation">:</span> pipeline_name<span class="token punctuation">,</span>
                <span class="token string">"display_name"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"MCP触发的 </span><span class="token interpolation"><span class="token punctuation">{</span>pipeline_name<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span>
                <span class="token string">"experiment_name"</span><span class="token punctuation">:</span> <span class="token string">"mcp-integration"</span><span class="token punctuation">,</span>
                <span class="token string">"inputs"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                    <span class="token string">"processed_data"</span><span class="token punctuation">:</span> processed_data<span class="token punctuation">.</span>result
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>

        <span class="token comment"># 返回作业信息</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token string">"job_id"</span><span class="token punctuation">:</span> pipeline_job<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span>
            <span class="token string">"status"</span><span class="token punctuation">:</span> pipeline_job<span class="token punctuation">.</span>status<span class="token punctuation">,</span>
            <span class="token string">"creation_time"</span><span class="token punctuation">:</span> pipeline_job<span class="token punctuation">.</span>creation_context<span class="token punctuation">.</span>created_at
        <span class="token punctuation">}</span>

    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">register_ml_model_as_tool</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> model_name<span class="token punctuation">,</span> model_version<span class="token operator">=</span><span class="token string">"latest"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""将 Azure ML 模型注册为 MCP 工具"""</span>
        <span class="token comment"># 获取模型详情</span>
        <span class="token keyword">if</span> model_version <span class="token operator">==</span> <span class="token string">"latest"</span><span class="token punctuation">:</span>
            model <span class="token operator">=</span> self<span class="token punctuation">.</span>ml_client<span class="token punctuation">.</span>models<span class="token punctuation">.</span>get<span class="token punctuation">(</span>name<span class="token operator">=</span>model_name<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"latest"</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            model <span class="token operator">=</span> self<span class="token punctuation">.</span>ml_client<span class="token punctuation">.</span>models<span class="token punctuation">.</span>get<span class="token punctuation">(</span>name<span class="token operator">=</span>model_name<span class="token punctuation">,</span> version<span class="token operator">=</span>model_version<span class="token punctuation">)</span>

        <span class="token comment"># 创建部署环境</span>
        env <span class="token operator">=</span> Environment<span class="token punctuation">(</span>
            name<span class="token operator">=</span><span class="token string">"mcp-model-env"</span><span class="token punctuation">,</span>
            conda_file<span class="token operator">=</span><span class="token string">"./environments/inference-env.yml"</span>
        <span class="token punctuation">)</span>

        <span class="token comment"># 设置计算资源</span>
        compute <span class="token operator">=</span> self<span class="token punctuation">.</span>ml_client<span class="token punctuation">.</span>compute<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"mcp-inference"</span><span class="token punctuation">)</span>

        <span class="token comment"># 将模型部署为在线端点</span>
        deployment <span class="token operator">=</span> self<span class="token punctuation">.</span>ml_client<span class="token punctuation">.</span>online_deployments<span class="token punctuation">.</span>create_or_update<span class="token punctuation">(</span>
            endpoint_name<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"mcp-</span><span class="token interpolation"><span class="token punctuation">{</span>model_name<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span>
            deployment<span class="token operator">=</span><span class="token punctuation">{</span>
                <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"mcp-</span><span class="token interpolation"><span class="token punctuation">{</span>model_name<span class="token punctuation">}</span></span><span class="token string">-deployment"</span></span><span class="token punctuation">,</span>
                <span class="token string">"model"</span><span class="token punctuation">:</span> model<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span>
                <span class="token string">"environment"</span><span class="token punctuation">:</span> env<span class="token punctuation">,</span>
                <span class="token string">"compute"</span><span class="token punctuation">:</span> compute<span class="token punctuation">,</span>
                <span class="token string">"scale_settings"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                    <span class="token string">"scale_type"</span><span class="token punctuation">:</span> <span class="token string">"auto"</span><span class="token punctuation">,</span>
                    <span class="token string">"min_instances"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                    <span class="token string">"max_instances"</span><span class="token punctuation">:</span> <span class="token number">3</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>

        <span class="token comment"># 基于模型模式创建 MCP 工具模式</span>
        tool_schema <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
            <span class="token string">"properties"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">"required"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>

        <span class="token comment"># 基于模型模式添加输入属性</span>
        <span class="token keyword">for</span> input_name<span class="token punctuation">,</span> input_spec <span class="token keyword">in</span> model<span class="token punctuation">.</span>signature<span class="token punctuation">.</span>inputs<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            tool_schema<span class="token punctuation">[</span><span class="token string">"properties"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>input_name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">"type"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>_map_ml_type_to_json_type<span class="token punctuation">(</span>input_spec<span class="token punctuation">.</span><span class="token builtin">type</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            tool_schema<span class="token punctuation">[</span><span class="token string">"required"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>input_name<span class="token punctuation">)</span>

        <span class="token comment"># 注册为 MCP 工具</span>
        <span class="token comment"># 在实际实现中，需要创建一个调用端点的工具</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token string">"model_name"</span><span class="token punctuation">:</span> model_name<span class="token punctuation">,</span>
            <span class="token string">"model_version"</span><span class="token punctuation">:</span> model<span class="token punctuation">.</span>version<span class="token punctuation">,</span>
            <span class="token string">"endpoint"</span><span class="token punctuation">:</span> deployment<span class="token punctuation">.</span>endpoint_uri<span class="token punctuation">,</span>
            <span class="token string">"tool_schema"</span><span class="token punctuation">:</span> tool_schema
        <span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">_map_ml_type_to_json_type</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> ml_type<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""将 ML 数据类型映射到 JSON 模式类型"""</span>
        mapping <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">"float"</span><span class="token punctuation">:</span> <span class="token string">"number"</span><span class="token punctuation">,</span>
            <span class="token string">"int"</span><span class="token punctuation">:</span> <span class="token string">"integer"</span><span class="token punctuation">,</span>
            <span class="token string">"bool"</span><span class="token punctuation">:</span> <span class="token string">"boolean"</span><span class="token punctuation">,</span>
            <span class="token string">"str"</span><span class="token punctuation">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
            <span class="token string">"object"</span><span class="token punctuation">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
            <span class="token string">"array"</span><span class="token punctuation">:</span> <span class="token string">"array"</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> mapping<span class="token punctuation">.</span>get<span class="token punctuation">(</span>ml_type<span class="token punctuation">,</span> <span class="token string">"string"</span><span class="token punctuation">)</span></code></pre></div>
</li>
</ul>
<h2 id="多模态" style="position:relative;"><a href="#%E5%A4%9A%E6%A8%A1%E6%80%81" aria-label="多模态 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>多模态</strong></h2>
<p><strong>多模态示例：图像分析 TODO change to python</strong></p>
<p><strong>多模态示例：音频处理 TODO change to python</strong></p>
<p><strong>多模态示例：多模态响应生成</strong></p>
<ul>
<li>
<p>Python</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"></code></pre></div>
</li>
</ul>
<h2 id="mcp-oauth2-演示" style="position:relative;"><a href="#mcp-oauth2-%E6%BC%94%E7%A4%BA" aria-label="mcp oauth2 演示 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>MCP OAuth2 演示</strong></h2>
<h2 id="根上下文" style="position:relative;"><a href="#%E6%A0%B9%E4%B8%8A%E4%B8%8B%E6%96%87" aria-label="根上下文 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>根上下文</strong></h2>
<p>根上下文是模型上下文协议（MCP）中的基础概念，提供了一个持久层，用于跨多个请求和会话维护对话历史和共享状态。</p>
<p>根上下文作为容器，保存一系列相关交互的历史和状态。它们支持：</p>
<ul>
<li><strong>对话持久性</strong>：维护连贯的多轮对话</li>
<li><strong>记忆管理</strong>：跨交互存储和检索信息</li>
<li><strong>状态管理</strong>：跟踪复杂工作流的进度</li>
<li><strong>上下文共享</strong>：允许多个客户端访问相同的对话状态</li>
</ul>
<p>在 MCP 中，根上下文具有以下关键特征：</p>
<ul>
<li>每个根上下文都有唯一标识符</li>
<li>可包含对话历史、用户偏好和其他元数据</li>
<li>可根据需要创建、访问和归档</li>
<li>支持细粒度的访问控制和权限管理</li>
</ul>
<p><strong>根上下文生命周期</strong></p>
<p><strong>使用根上下文</strong></p>
<p>以下是创建和管理根上下文的示例。</p>
<p><strong>示例：财务分析的根上下文实现</strong></p>
<p>此示例中，我们将为财务分析会话创建根上下文，展示如何跨多个交互维护状态。</p>
<p><strong>示例：根上下文管理</strong></p>
<p>有效管理根上下文对于维护对话历史和状态至关重要。以下是实现根上下文管理的示例。</p>
<p><strong>多轮协助的根上下文</strong></p>
<p>在此示例中，我们将为多轮协助会话创建根上下文，展示如何跨多个交互维护状态。</p>
<ul>
<li>
<p>Python</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment"># Python 示例：多轮协助的根上下文</span>
<span class="token keyword">import</span> asyncio
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
<span class="token keyword">from</span> mcp_client <span class="token keyword">import</span> McpClient<span class="token punctuation">,</span> RootContextManager

<span class="token keyword">class</span> <span class="token class-name">AssistantSession</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> server_url<span class="token punctuation">,</span> api_key<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>client <span class="token operator">=</span> McpClient<span class="token punctuation">(</span>server_url<span class="token operator">=</span>server_url<span class="token punctuation">,</span> api_key<span class="token operator">=</span>api_key<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>context_manager <span class="token operator">=</span> RootContextManager<span class="token punctuation">(</span>self<span class="token punctuation">.</span>client<span class="token punctuation">)</span>

    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">create_session</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> user_info<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""为协助会话创建新根上下文"""</span>
        metadata <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">"session_type"</span><span class="token punctuation">:</span> <span class="token string">"assistant"</span><span class="token punctuation">,</span>
            <span class="token string">"created_at"</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>

        <span class="token comment"># 添加用户信息（如果提供）</span>
        <span class="token keyword">if</span> user_info<span class="token punctuation">:</span>
            metadata<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-interpolation"><span class="token string">f"user_</span><span class="token interpolation"><span class="token punctuation">{</span>k<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">:</span> v <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> user_info<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token comment"># 创建根上下文</span>
        context <span class="token operator">=</span> <span class="token keyword">await</span> self<span class="token punctuation">.</span>context_manager<span class="token punctuation">.</span>create_root_context<span class="token punctuation">(</span>name<span class="token punctuation">,</span> metadata<span class="token punctuation">)</span>
        <span class="token keyword">return</span> context<span class="token punctuation">.</span><span class="token builtin">id</span>

    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">send_message</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context_id<span class="token punctuation">,</span> message<span class="token punctuation">,</span> tools<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""在根上下文中发送消息"""</span>
        <span class="token comment"># 创建带上下文ID的选项</span>
        options <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">"root_context_id"</span><span class="token punctuation">:</span> context_id
        <span class="token punctuation">}</span>

        <span class="token comment"># 添加工具（如果指定）</span>
        <span class="token keyword">if</span> tools<span class="token punctuation">:</span>
            options<span class="token punctuation">[</span><span class="token string">"allowed_tools"</span><span class="token punctuation">]</span> <span class="token operator">=</span> tools

        <span class="token comment"># 在上下文中发送提示</span>
        response <span class="token operator">=</span> <span class="token keyword">await</span> self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>send_prompt<span class="token punctuation">(</span>message<span class="token punctuation">,</span> options<span class="token punctuation">)</span>

        <span class="token comment"># 用对话进度更新上下文元数据</span>
        <span class="token keyword">await</span> self<span class="token punctuation">.</span>context_manager<span class="token punctuation">.</span>update_context_metadata<span class="token punctuation">(</span>
            context_id<span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string-interpolation"><span class="token string">f"message_</span><span class="token interpolation"><span class="token punctuation">{</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>timestamp<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">:</span> message<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">50</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">"..."</span><span class="token punctuation">,</span>
                <span class="token string">"last_interaction"</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>

        <span class="token keyword">return</span> response

    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">get_conversation_history</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""从上下文中检索对话历史"""</span>
        context_info <span class="token operator">=</span> <span class="token keyword">await</span> self<span class="token punctuation">.</span>context_manager<span class="token punctuation">.</span>get_context_info<span class="token punctuation">(</span>context_id<span class="token punctuation">)</span>
        messages <span class="token operator">=</span> <span class="token keyword">await</span> self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>get_context_messages<span class="token punctuation">(</span>context_id<span class="token punctuation">)</span>

        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token string">"context_info"</span><span class="token punctuation">:</span> context_info<span class="token punctuation">,</span>
            <span class="token string">"messages"</span><span class="token punctuation">:</span> messages
        <span class="token punctuation">}</span>

    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">end_session</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""通过归档上下文结束协助会话"""</span>
        <span class="token comment"># 首先生成摘要</span>
        summary_response <span class="token operator">=</span> <span class="token keyword">await</span> self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>send_prompt<span class="token punctuation">(</span>
            <span class="token string">"请总结我们的对话以及任何关键点或决策。"</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span><span class="token string">"root_context_id"</span><span class="token punctuation">:</span> context_id<span class="token punctuation">}</span>
        <span class="token punctuation">)</span>

        <span class="token comment"># 在元数据中存储摘要</span>
        <span class="token keyword">await</span> self<span class="token punctuation">.</span>context_manager<span class="token punctuation">.</span>update_context_metadata<span class="token punctuation">(</span>
            context_id<span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">"summary"</span><span class="token punctuation">:</span> summary_response<span class="token punctuation">.</span>generated_text<span class="token punctuation">,</span>
                <span class="token string">"ended_at"</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">"status"</span><span class="token punctuation">:</span> <span class="token string">"completed"</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>

        <span class="token comment"># 归档上下文</span>
        <span class="token keyword">await</span> self<span class="token punctuation">.</span>context_manager<span class="token punctuation">.</span>archive_context<span class="token punctuation">(</span>context_id<span class="token punctuation">)</span>

        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token string">"status"</span><span class="token punctuation">:</span> <span class="token string">"completed"</span><span class="token punctuation">,</span>
            <span class="token string">"summary"</span><span class="token punctuation">:</span> summary_response<span class="token punctuation">.</span>generated_text
        <span class="token punctuation">}</span>

<span class="token comment"># 示例用法</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">demo_assistant_session</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    assistant <span class="token operator">=</span> AssistantSession<span class="token punctuation">(</span><span class="token string">"https://mcp-server-example.com"</span><span class="token punctuation">)</span>

    <span class="token comment"># 1. 创建会话</span>
    context_id <span class="token operator">=</span> <span class="token keyword">await</span> assistant<span class="token punctuation">.</span>create_session<span class="token punctuation">(</span>
        <span class="token string">"技术支持会话"</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Alex"</span><span class="token punctuation">,</span> <span class="token string">"technical_level"</span><span class="token punctuation">:</span> <span class="token string">"高级"</span><span class="token punctuation">,</span> <span class="token string">"product"</span><span class="token punctuation">:</span> <span class="token string">"云服务"</span><span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"已创建会话，上下文 ID: </span><span class="token interpolation"><span class="token punctuation">{</span>context_id<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

    <span class="token comment"># 2. 首次交互</span>
    response1 <span class="token operator">=</span> <span class="token keyword">await</span> assistant<span class="token punctuation">.</span>send_message<span class="token punctuation">(</span>
        context_id<span class="token punctuation">,</span>
        <span class="token string">"我在你们的云平台中遇到自动扩展功能的问题。"</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token string">"documentation_search"</span><span class="token punctuation">,</span> <span class="token string">"diagnostic_tool"</span><span class="token punctuation">]</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"响应 1: </span><span class="token interpolation"><span class="token punctuation">{</span>response1<span class="token punctuation">.</span>generated_text<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

    <span class="token comment"># 同一上下文的第二次交互</span>
    response2 <span class="token operator">=</span> <span class="token keyword">await</span> assistant<span class="token punctuation">.</span>send_message<span class="token punctuation">(</span>
        context_id<span class="token punctuation">,</span>
        <span class="token string">"是的，我已经检查了你提到的配置设置，但仍然无法工作。"</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"响应 2: </span><span class="token interpolation"><span class="token punctuation">{</span>response2<span class="token punctuation">.</span>generated_text<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

    <span class="token comment"># 3. 获取历史记录</span>
    history <span class="token operator">=</span> <span class="token keyword">await</span> assistant<span class="token punctuation">.</span>get_conversation_history<span class="token punctuation">(</span>context_id<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"会话有 </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>history<span class="token punctuation">[</span><span class="token string">'messages'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> 条消息"</span></span><span class="token punctuation">)</span>

    <span class="token comment"># 4. 结束会话</span>
    end_result <span class="token operator">=</span> <span class="token keyword">await</span> assistant<span class="token punctuation">.</span>end_session<span class="token punctuation">(</span>context_id<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"会话结束，摘要: </span><span class="token interpolation"><span class="token punctuation">{</span>end_result<span class="token punctuation">[</span><span class="token string">'summary'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>demo_assistant_session<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
</code></pre></div>
</li>
</ul>
<p><strong>根上下文最佳实践</strong></p>
<p>以下是有效管理根上下文的最佳实践：</p>
<ul>
<li><strong>创建聚焦的上下文</strong>：为不同目的或领域创建独立的根上下文以保持清晰度</li>
<li><strong>设置过期策略</strong>：实施策略归档或删除旧上下文以管理存储并符合数据保留政策</li>
<li><strong>存储相关元数据</strong>：使用上下文元数据存储对话中的重要信息以备后用</li>
<li><strong>一致使用上下文 ID</strong>：上下文创建后，所有相关请求始终使用其 ID 以保持连续性</li>
<li><strong>生成摘要</strong>：当上下文过大时，考虑生成摘要以捕获关键信息</li>
<li><strong>实施访问控制</strong>：在多用户系统中实施适当的访问控制以确保对话上下文的隐私和安全</li>
<li><strong>处理上下文限制</strong>：注意上下文大小限制，并为处理超长对话实施策略</li>
<li><strong>完成后归档</strong>：对话完成后归档上下文以释放资源同时保留历史记录</li>
</ul>
<h2 id="路由" style="position:relative;"><a href="#%E8%B7%AF%E7%94%B1" aria-label="路由 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>路由</strong></h2>
<ul>
<li><strong>水平扩展</strong>：在负载均衡器后部署多个 MCP 服务器实例，均匀分配传入请求</li>
<li><strong>垂直扩展</strong>：通过增加资源（CPU、内存）和优化配置，优化单个 MCP 服务器实例以处理更多请求</li>
<li><strong>资源优化</strong>：使用高效算法、缓存和异步处理来减少资源消耗并提高响应时间</li>
<li><strong>分布式架构</strong>：实现多个 MCP 节点协同工作的分布式系统，共享负载并提供冗余</li>
</ul>
<p><strong>基于内容的路由</strong></p>
<p>基于内容的路由根据请求内容将请求定向到专用服务。例如，与代码生成相关的请求可以路由到专门的代码模型，而创意写作请求则可以发送到创意写作模型。</p>
<p>以下是不同编程语言的实现示例：</p>
<ul>
<li>
<p>.NET</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"></code></pre></div>
<ul>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
</ul>
</li>
</ul>
<h3 id="智能负载均衡" style="position:relative;"><a href="#%E6%99%BA%E8%83%BD%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1" aria-label="智能负载均衡 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>智能负载均衡</strong></h3>
<p>负载均衡优化资源利用并确保 MCP 服务的高可用性。实现负载均衡有不同方式，如轮询、加权响应时间或内容感知策略。</p>
<p>以下是使用以下策略的示例实现：</p>
<ul>
<li>
<p><strong>轮询（Round Robin）</strong>：在可用服务器间均匀分配请求</p>
</li>
<li>
<p><strong>加权响应时间（Weighted Response Time）</strong>：基于服务器平均响应时间路由请求</p>
</li>
<li>
<p><strong>内容感知（Content-Aware）</strong>：基于请求内容路由到专用服务器</p>
</li>
<li>
<p>Java</p>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"></code></pre></div>
<ul>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
</ul>
</li>
</ul>
<h3 id="动态工具路由" style="position:relative;"><a href="#%E5%8A%A8%E6%80%81%E5%B7%A5%E5%85%B7%E8%B7%AF%E7%94%B1" aria-label="动态工具路由 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>动态工具路由</strong></h3>
<p>工具路由确保工具调用根据上下文被定向到最合适的服务。例如，天气工具调用可能需要基于用户位置路由到区域端点，或计算器工具可能需要使用特定版本的 API。</p>
<p>以下是基于请求分析、区域端点和版本支持的动态工具路由示例实现：</p>
<ul>
<li>
<p>Python</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"></code></pre></div>
<ul>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
</ul>
</li>
</ul>
<h2 id="采样" style="position:relative;"><a href="#%E9%87%87%E6%A0%B7" aria-label="采样 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>采样</strong></h2>
<h3 id="采样参数概览" style="position:relative;"><a href="#%E9%87%87%E6%A0%B7%E5%8F%82%E6%95%B0%E6%A6%82%E8%A7%88" aria-label="采样参数概览 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>采样参数概览</strong></h3>
<p>MCP 定义了以下可以在客户端请求中配置的采样参数：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
<th>典型范围</th>
</tr>
</thead>
<tbody>
<tr>
<td><code class="language-text">temperature</code></td>
<td>控制标记选择的随机性</td>
<td>0.0 - 2.0</td>
</tr>
<tr>
<td><code class="language-text">top_p</code></td>
<td>核采样 - 限制标记为累积概率最高的选项</td>
<td>0.0 - 1.0</td>
</tr>
<tr>
<td><code class="language-text">top_k</code></td>
<td>限制标记选择为前 K 个选项</td>
<td>1 - 100</td>
</tr>
<tr>
<td><code class="language-text">presence_penalty</code></td>
<td>基于标记在文本中的出现频率进行惩罚</td>
<td>-2.0 - 2.0</td>
</tr>
<tr>
<td><code class="language-text">frequency_penalty</code></td>
<td>基于标记在文本中的出现次数进行惩罚</td>
<td>-2.0 - 2.0</td>
</tr>
<tr>
<td><code class="language-text">seed</code></td>
<td>用于可重现结果的特定随机种子</td>
<td>整数值</td>
</tr>
<tr>
<td><code class="language-text">max_tokens</code></td>
<td>要生成的最大标记数</td>
<td>整数值</td>
</tr>
<tr>
<td><code class="language-text">stop_sequences</code></td>
<td>遇到时停止生成的自定义序列</td>
<td>字符串数组</td>
</tr>
</tbody>
</table>
<h3 id="温度和-top-ktop-p-采样" style="position:relative;"><a href="#%E6%B8%A9%E5%BA%A6%E5%92%8C-top-ktop-p-%E9%87%87%E6%A0%B7" aria-label="温度和 top ktop p 采样 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>温度和 Top-K/Top-P 采样</strong></h3>
<p>采样参数允许微调语言模型的行为，以在确定性和创造性输出之间达到所需的平衡。</p>
<p>以下是不同编程语言中如何配置这些参数的示例：</p>
<ul>
<li>
<p>.NET</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"></code></pre></div>
<ul>
<li></li>
<li></li>
<li></li>
<li>
<ul>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
</ul>
</li>
</ul>
</li>
<li>
<p>JavaScript</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"></code></pre></div>
<ul>
<li></li>
<li></li>
<li></li>
<li></li>
</ul>
</li>
</ul>
<h3 id="确定性采样" style="position:relative;"><a href="#%E7%A1%AE%E5%AE%9A%E6%80%A7%E9%87%87%E6%A0%B7" aria-label="确定性采样 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>确定性采样</strong></h3>
<p>对于需要一致输出的应用程序，确定性采样可确保结果可重现。这是通过使用固定的随机种子并将温度设置为零来实现的。</p>
<p>以下是不同编程语言中实现确定性采样的示例：</p>
<ul>
<li>
<p>Java</p>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"></code></pre></div>
<ul>
<li></li>
<li></li>
<li></li>
<li></li>
</ul>
</li>
<li>
<p>JavaScript</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"></code></pre></div>
<ul>
<li></li>
<li></li>
<li></li>
</ul>
</li>
</ul>
<h3 id="动态采样配置" style="position:relative;"><a href="#%E5%8A%A8%E6%80%81%E9%87%87%E6%A0%B7%E9%85%8D%E7%BD%AE" aria-label="动态采样配置 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>动态采样配置</strong></h3>
<p>在实际应用中，通常需要根据上下文动态调整采样参数。以下示例展示了如何根据用户输入类型自动选择采样策略：</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment"># Python 示例：动态采样配置def get_sampling_strategy(input_type):</span>
    <span class="token triple-quoted-string string">"""
    根据输入类型返回合适的采样参数
    """</span>
    <span class="token keyword">if</span> input_type <span class="token operator">==</span> <span class="token string">"creative"</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token string">"temperature"</span><span class="token punctuation">:</span> <span class="token number">0.9</span><span class="token punctuation">,</span>
            <span class="token string">"top_p"</span><span class="token punctuation">:</span> <span class="token number">0.95</span><span class="token punctuation">,</span>
            <span class="token string">"frequency_penalty"</span><span class="token punctuation">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
            <span class="token string">"presence_penalty"</span><span class="token punctuation">:</span> <span class="token number">0.3</span>
        <span class="token punctuation">}</span>
    <span class="token keyword">elif</span> input_type <span class="token operator">==</span> <span class="token string">"technical"</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token string">"temperature"</span><span class="token punctuation">:</span> <span class="token number">0.3</span><span class="token punctuation">,</span>
            <span class="token string">"top_p"</span><span class="token punctuation">:</span> <span class="token number">0.8</span><span class="token punctuation">,</span>
            <span class="token string">"frequency_penalty"</span><span class="token punctuation">:</span> <span class="token number">0.2</span><span class="token punctuation">,</span>
            <span class="token string">"presence_penalty"</span><span class="token punctuation">:</span> <span class="token number">0.1</span>
        <span class="token punctuation">}</span>
    <span class="token keyword">elif</span> input_type <span class="token operator">==</span> <span class="token string">"factual"</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token string">"temperature"</span><span class="token punctuation">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span>
            <span class="token string">"top_p"</span><span class="token punctuation">:</span> <span class="token number">0.7</span><span class="token punctuation">,</span>
            <span class="token string">"frequency_penalty"</span><span class="token punctuation">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span>
            <span class="token string">"presence_penalty"</span><span class="token punctuation">:</span> <span class="token number">0.05</span><span class="token punctuation">,</span>
            <span class="token string">"seed"</span><span class="token punctuation">:</span> <span class="token number">42</span><span class="token comment"># 固定种子用于确定性输出</span>
        <span class="token punctuation">}</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span><span class="token comment"># 默认策略return {</span>
            <span class="token string">"temperature"</span><span class="token punctuation">:</span> <span class="token number">0.7</span><span class="token punctuation">,</span>
            <span class="token string">"top_p"</span><span class="token punctuation">:</span> <span class="token number">0.9</span><span class="token punctuation">,</span>
            <span class="token string">"frequency_penalty"</span><span class="token punctuation">:</span> <span class="token number">0.3</span><span class="token punctuation">,</span>
            <span class="token string">"presence_penalty"</span><span class="token punctuation">:</span> <span class="token number">0.2</span>
        <span class="token punctuation">}</span>

<span class="token comment"># 使用示例</span>
creative_params <span class="token operator">=</span> get_sampling_strategy<span class="token punctuation">(</span><span class="token string">"creative"</span><span class="token punctuation">)</span>
technical_params <span class="token operator">=</span> get_sampling_strategy<span class="token punctuation">(</span><span class="token string">"technical"</span><span class="token punctuation">)</span>
</code></pre></div>
<h3 id="停止序列和标记限制" style="position:relative;"><a href="#%E5%81%9C%E6%AD%A2%E5%BA%8F%E5%88%97%E5%92%8C%E6%A0%87%E8%AE%B0%E9%99%90%E5%88%B6" aria-label="停止序列和标记限制 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>停止序列和标记限制</strong></h3>
<p>停止序列和标记限制对于控制输出长度和格式至关重要：</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// JavaScript 示例：使用停止序列和标记限制const response = await client.sendPrompt("生成Python函数计算斐波那契数列", {</span>
  <span class="token literal-property property">max_tokens</span><span class="token operator">:</span> <span class="token number">150</span><span class="token punctuation">,</span><span class="token comment">// 限制输出长度stop_sequences: ["", "def test_"],// 遇到空行或测试函数定义时停止temperature: 0.4,</span>
  <span class="token literal-property property">top_p</span><span class="token operator">:</span> <span class="token number">0.9</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h3 id="采样策略应用" style="position:relative;"><a href="#%E9%87%87%E6%A0%B7%E7%AD%96%E7%95%A5%E5%BA%94%E7%94%A8" aria-label="采样策略应用 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>采样策略应用</strong></h3>
<p>在不同场景下的推荐采样配置：</p>
<table>
<thead>
<tr>
<th>应用场景</th>
<th>推荐配置</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>创意写作</td>
<td><code class="language-text">温度=0.8-1.2</code>, <code class="language-text">top_p=0.9-1.0</code></td>
<td>鼓励多样性和创造性</td>
</tr>
<tr>
<td>技术文档生成</td>
<td><code class="language-text">温度=0.3-0.6</code>, <code class="language-text">top_p=0.8-0.95</code></td>
<td>平衡准确性和流畅性</td>
</tr>
<tr>
<td>事实性问答</td>
<td><code class="language-text">温度=0.1-0.3</code>, <code class="language-text">top_p=0.7-0.85</code>, <code class="language-text">seed=固定</code></td>
<td>最大化准确性和一致性</td>
</tr>
<tr>
<td>代码生成</td>
<td><code class="language-text">温度=0.5-0.7</code>, <code class="language-text">top_p=0.85-0.95</code></td>
<td>结构准确性兼顾适度创造性</td>
</tr>
<tr>
<td>对话系统</td>
<td><code class="language-text">温度=0.7-0.9</code>, <code class="language-text">presence_penalty=0.5</code></td>
<td>自然流畅同时避免重复</td>
</tr>
</tbody>
</table>
<h2 id="扩展" style="position:relative;"><a href="#%E6%89%A9%E5%B1%95" aria-label="扩展 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>扩展</strong></h2>
<h3 id="可扩展性策略" style="position:relative;"><a href="#%E5%8F%AF%E6%89%A9%E5%B1%95%E6%80%A7%E7%AD%96%E7%95%A5" aria-label="可扩展性策略 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>可扩展性策略</strong></h3>
<p>有几种策略可以有效扩展 MCP 服务器：</p>
<ul>
<li><strong>水平扩展</strong>：在负载均衡器后部署多个 MCP 服务器实例，均匀分配传入请求</li>
<li><strong>垂直扩展</strong>：通过增加资源（CPU、内存）和优化配置，优化单个 MCP 服务器实例以处理更多请求</li>
<li><strong>资源优化</strong>：使用高效算法、缓存和异步处理来减少资源消耗并提高响应时间</li>
<li><strong>分布式架构</strong>：实现多个 MCP 节点协同工作的分布式系统，共享负载并提供冗余</li>
</ul>
<h3 id="水平扩展" style="position:relative;"><a href="#%E6%B0%B4%E5%B9%B3%E6%89%A9%E5%B1%95" aria-label="水平扩展 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>水平扩展</strong></h3>
<p>水平扩展涉及部署多个 MCP 服务器实例，并使用负载均衡器分配传入请求。这种方法可以同时处理更多请求并提供容错能力。</p>
<p>以下是配置水平扩展的示例：</p>
<ul>
<li>
<p>.NET</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"></code></pre></div>
<ul>
<li></li>
<li></li>
<li></li>
</ul>
</li>
</ul>
<h3 id="垂直扩展和资源优化" style="position:relative;"><a href="#%E5%9E%82%E7%9B%B4%E6%89%A9%E5%B1%95%E5%92%8C%E8%B5%84%E6%BA%90%E4%BC%98%E5%8C%96" aria-label="垂直扩展和资源优化 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>垂直扩展和资源优化</strong></h3>
<p>垂直扩展侧重于优化单个 MCP 服务器实例以高效处理更多请求。这可以通过优化配置、使用高效算法和有效管理资源来实现。例如，可以调整线程池、请求超时和内存限制以提高性能。</p>
<p>以下是优化 MCP 服务器以实现垂直扩展的示例：</p>
<ul>
<li>
<p>Java</p>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"></code></pre></div>
<ul>
<li></li>
<li></li>
<li></li>
</ul>
</li>
</ul>
<h3 id="分布式架构" style="position:relative;"><a href="#%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84" aria-label="分布式架构 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>分布式架构</strong></h3>
<p>分布式架构涉及多个 MCP 节点协同工作来处理请求、共享资源并提供冗余。这种方法通过允许节点通过分布式系统进行通信和协调，增强了可扩展性和容错能力。</p>
<p>以下是使用 Redis 实现分布式 MCP 服务器架构的示例：</p>
<ul>
<li>
<p>Python</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"></code></pre></div>
</li>
</ul>
<h2 id="安全" style="position:relative;"><a href="#%E5%AE%89%E5%85%A8" aria-label="安全 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>安全</strong></h2>
<h3 id="认证与授权" style="position:relative;"><a href="#%E8%AE%A4%E8%AF%81%E4%B8%8E%E6%8E%88%E6%9D%83" aria-label="认证与授权 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>认证与授权</strong></h3>
<p>认证和授权是保护 MCP 服务器的关键。认证回答”你是谁？“的问题，而授权回答”你能做什么？“。</p>
<p>让我们看看如何在 .NET 和 Java 中为 MCP 服务器实现安全的认证和授权。</p>
<h3 id="net-identity-集成" style="position:relative;"><a href="#net-identity-%E9%9B%86%E6%88%90" aria-label="net identity 集成 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>.NET Identity 集成</strong></h3>
<p>ASP .NET Core Identity 提供了一个强大的框架来管理用户认证和授权。我们可以将其与 MCP 服务器集成，以保护对工具和资源的访问。</p>
<p>集成 ASP.NET Core Identity 与 MCP 服务器时，需要理解一些核心概念：</p>
<ul>
<li><strong>身份配置</strong>：设置包含用户角色和声明的 ASP.NET Core Identity。声明是有关用户的信息片段，例如他们的角色或权限（如”Admin”或”User”）</li>
<li><strong>JWT 认证</strong>：使用 JSON Web Tokens (JWT) 进行安全的 API 访问。JWT 是在各方之间安全传输信息作为 JSON 对象的标准，可以验证和信任，因为它是数字签名的</li>
<li><strong>授权策略</strong>：定义策略以基于用户角色控制对特定工具的访问。MCP 使用授权策略根据用户的角色和声明确定哪些用户可以访问哪些工具</li>
</ul>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecureMcpStartup</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
<span class="token comment">// 添加 ASP.NET Core Identity</span>
        services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddIdentity</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ApplicationUser<span class="token punctuation">,</span> IdentityRole<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddEntityFrameworkStores</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ApplicationDbContext<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">AddDefaultTokenProviders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 配置 JWT 认证</span>
        services<span class="token punctuation">.</span><span class="token function">AddAuthentication</span><span class="token punctuation">(</span>options <span class="token operator">=></span>
        <span class="token punctuation">{</span>
            options<span class="token punctuation">.</span>DefaultAuthenticateScheme <span class="token operator">=</span> JwtBearerDefaults<span class="token punctuation">.</span>AuthenticationScheme<span class="token punctuation">;</span>
            options<span class="token punctuation">.</span>DefaultChallengeScheme <span class="token operator">=</span> JwtBearerDefaults<span class="token punctuation">.</span>AuthenticationScheme<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">AddJwtBearer</span><span class="token punctuation">(</span>options <span class="token operator">=></span>
        <span class="token punctuation">{</span>
            options<span class="token punctuation">.</span>TokenValidationParameters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TokenValidationParameters</span>
            <span class="token punctuation">{</span>
                ValidateIssuer <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                ValidateAudience <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                ValidateLifetime <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                ValidateIssuerSigningKey <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                ValidIssuer <span class="token operator">=</span> Configuration<span class="token punctuation">[</span><span class="token string">"Jwt:Issuer"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                ValidAudience <span class="token operator">=</span> Configuration<span class="token punctuation">[</span><span class="token string">"Jwt:Audience"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                IssuerSigningKey <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SymmetricSecurityKey</span><span class="token punctuation">(</span>
                    Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span>Configuration<span class="token punctuation">[</span><span class="token string">"Jwt:Key"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 添加授权策略</span>
        services<span class="token punctuation">.</span><span class="token function">AddAuthorization</span><span class="token punctuation">(</span>options <span class="token operator">=></span>
        <span class="token punctuation">{</span>
            options<span class="token punctuation">.</span><span class="token function">AddPolicy</span><span class="token punctuation">(</span><span class="token string">"CanUseAdminTools"</span><span class="token punctuation">,</span> policy <span class="token operator">=></span>
                policy<span class="token punctuation">.</span><span class="token function">RequireRole</span><span class="token punctuation">(</span><span class="token string">"Admin"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            options<span class="token punctuation">.</span><span class="token function">AddPolicy</span><span class="token punctuation">(</span><span class="token string">"CanUseBasicTools"</span><span class="token punctuation">,</span> policy <span class="token operator">=></span>
                policy<span class="token punctuation">.</span><span class="token function">RequireAuthenticatedUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 配置带安全的 MCP 服务器</span>
        services<span class="token punctuation">.</span><span class="token function">AddMcpServer</span><span class="token punctuation">(</span>options <span class="token operator">=></span>
        <span class="token punctuation">{</span>
            options<span class="token punctuation">.</span>ServerName <span class="token operator">=</span> <span class="token string">"Secure MCP Server"</span><span class="token punctuation">;</span>
            options<span class="token punctuation">.</span>ServerVersion <span class="token operator">=</span> <span class="token string">"1.0.0"</span><span class="token punctuation">;</span>
            options<span class="token punctuation">.</span>RequireAuthentication <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 注册带授权要求的工具</span>
        services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddMcpTool</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>BasicTool<span class="token punctuation">></span></span></span><span class="token punctuation">(</span>options <span class="token operator">=></span>
            options<span class="token punctuation">.</span><span class="token function">RequirePolicy</span><span class="token punctuation">(</span><span class="token string">"CanUseBasicTools"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddMcpTool</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>AdminTool<span class="token punctuation">></span></span></span><span class="token punctuation">(</span>options <span class="token operator">=></span>
            options<span class="token punctuation">.</span><span class="token function">RequirePolicy</span><span class="token punctuation">(</span><span class="token string">"CanUseAdminTools"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">IApplicationBuilder</span> app<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
<span class="token comment">// 使用认证和授权</span>
        app<span class="token punctuation">.</span><span class="token function">UseAuthentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        app<span class="token punctuation">.</span><span class="token function">UseAuthorization</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 使用 MCP 服务器中间件</span>
        app<span class="token punctuation">.</span><span class="token function">UseMcpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>在前面的代码中：</p>
<ul>
<li>配置了用于用户管理的 ASP.NET Core Identity</li>
<li>设置了用于安全 API 访问的 JWT 认证。我们指定了令牌验证参数，包括颁发者、受众和签名密钥</li>
<li>定义了基于用户角色控制工具访问权限的授权策略。例如，“CanUseAdminTools”策略要求用户具有”Admin”角色，而”CanUseBasic”策略要求用户已认证</li>
<li>注册了具有特定授权要求的 MCP 工具，确保只有具有适当角色的用户才能访问它们</li>
</ul>
<h3 id="java-spring-security-集成" style="position:relative;"><a href="#java-spring-security-%E9%9B%86%E6%88%90" aria-label="java spring security 集成 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>Java Spring Security 集成</strong></h3>
<p>对于 Java，我们将使用 Spring Security 为 MCP 服务器实现安全的认证和授权。Spring Security 提供了一个全面的安全框架，与 Spring 应用无缝集成。</p>
<p>核心概念包括：</p>
<ul>
<li><strong>Spring Security 配置</strong>：设置用于认证和授权的安全配置</li>
<li><strong>OAuth2 资源服务器</strong>：使用 OAuth2 安全访问 MCP 工具。OAuth2 是一个授权框架，允许第三方服务交换访问令牌以安全访问 API</li>
<li><strong>安全拦截器</strong>：实现安全拦截器以在工具执行时强制执行访问控制</li>
<li><strong>基于角色的访问控制</strong>：使用角色控制对特定工具和资源的访问</li>
<li><strong>安全注解</strong>：使用注解保护方法和端点</li>
</ul>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableWebSecurity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecurityConfig</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        http
            <span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">"/mcp/discovery"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 允许工具发现</span>
                <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">"/mcp/tools/**"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasAnyRole</span><span class="token punctuation">(</span><span class="token string">"USER"</span><span class="token punctuation">,</span> <span class="token string">"ADMIN"</span><span class="token punctuation">)</span><span class="token comment">// 要求工具认证</span>
                <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">"/mcp/admin/**"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasRole</span><span class="token punctuation">(</span><span class="token string">"ADMIN"</span><span class="token punctuation">)</span><span class="token comment">// 仅管理员端点</span>
                <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">oauth2ResourceServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">jwt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">McpSecurityInterceptor</span> <span class="token function">mcpSecurityInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">McpSecurityInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 用于工具授权的 MCP 安全拦截器public class McpSecurityInterceptor implements ToolExecutionInterceptor {</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">JwtDecoder</span> jwtDecoder<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">beforeToolExecution</span><span class="token punctuation">(</span><span class="token class-name">ToolRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">Authentication</span> authentication<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> toolName <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getToolName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 检查用户是否有使用此工具的权限if (toolName.startsWith("admin") &amp;&amp; !authentication.getAuthorities().contains("ROLE_ADMIN")) {</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AccessDeniedException</span><span class="token punctuation">(</span><span class="token string">"无权使用此工具"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

<span class="token comment">// 基于工具或参数的额外安全检查if ("sensitiveDataAccess".equals(toolName)) {</span>
            <span class="token function">validateDataAccessPermissions</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> authentication<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">validateDataAccessPermissions</span><span class="token punctuation">(</span><span class="token class-name">ToolRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">Authentication</span> auth<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">// 检查细粒度数据访问权限的实现</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>在前面的代码中，我们：</p>
<ul>
<li>配置了 Spring Security 来保护 MCP 端点，允许公共访问工具发现，同时要求工具执行进行认证</li>
<li>使用 OAuth2 作为资源服务器处理对 MCP 工具的安全访问</li>
<li>实现了安全拦截器以在工具执行时强制执行访问控制，检查用户角色和权限后允许访问特定工具</li>
<li>定义了基于角色的访问控制，根据用户角色限制对管理工具和敏感数据访问的访问</li>
</ul>
<h3 id="数据保护与隐私" style="position:relative;"><a href="#%E6%95%B0%E6%8D%AE%E4%BF%9D%E6%8A%A4%E4%B8%8E%E9%9A%90%E7%A7%81" aria-label="数据保护与隐私 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>数据保护与隐私</strong></h3>
<p>数据保护对于确保敏感信息安全处理至关重要。这包括保护个人身份信息 (PII)、财务数据和其他敏感信息免受未经授权的访问和泄露。</p>
<h3 id="python-数据保护示例" style="position:relative;"><a href="#python-%E6%95%B0%E6%8D%AE%E4%BF%9D%E6%8A%A4%E7%A4%BA%E4%BE%8B" aria-label="python 数据保护示例 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>Python 数据保护示例</strong></h3>
<p>让我们看一个使用加密和 PII 检测在 Python 中实现数据保护的示例。</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> mcp_server <span class="token keyword">import</span> McpServer
<span class="token keyword">from</span> mcp_tools <span class="token keyword">import</span> Tool<span class="token punctuation">,</span> ToolRequest<span class="token punctuation">,</span> ToolResponse
<span class="token keyword">from</span> cryptography<span class="token punctuation">.</span>fernet <span class="token keyword">import</span> Fernet
<span class="token keyword">import</span> os
<span class="token keyword">import</span> json
<span class="token keyword">from</span> functools <span class="token keyword">import</span> wraps

<span class="token comment"># PII 检测器 - 识别和保护敏感信息</span>
<span class="token keyword">class</span> <span class="token class-name">PiiDetector</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 加载不同类型 PII 的模式</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"pii_patterns.json"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>patterns <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">scan_text</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""扫描文本中的 PII 并返回检测到的 PII 类型"""</span>
        detected_pii <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token comment"># 使用正则或 ML 模型检测 PII 的实现</span>
        <span class="token keyword">return</span> detected_pii

    <span class="token keyword">def</span> <span class="token function">scan_parameters</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> parameters<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""扫描请求参数中的 PII"""</span>
        detected_pii <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> parameters<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                pii_in_value <span class="token operator">=</span> self<span class="token punctuation">.</span>scan_text<span class="token punctuation">(</span>value<span class="token punctuation">)</span>
                <span class="token keyword">if</span> pii_in_value<span class="token punctuation">:</span>
                    detected_pii<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> pii_in_value<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> detected_pii

<span class="token comment"># 保护敏感数据的加密服务</span>
<span class="token keyword">class</span> <span class="token class-name">EncryptionService</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key_path<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> key_path <span class="token keyword">and</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>key_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>key_path<span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> key_file<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>key <span class="token operator">=</span> key_file<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>key <span class="token operator">=</span> Fernet<span class="token punctuation">.</span>generate_key<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> key_path<span class="token punctuation">:</span>
                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>key_path<span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> key_file<span class="token punctuation">:</span>
                    key_file<span class="token punctuation">.</span>write<span class="token punctuation">(</span>self<span class="token punctuation">.</span>key<span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>cipher <span class="token operator">=</span> Fernet<span class="token punctuation">(</span>self<span class="token punctuation">.</span>key<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">encrypt</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""加密数据"""</span>
        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>cipher<span class="token punctuation">.</span>encrypt<span class="token punctuation">(</span>data<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>cipher<span class="token punctuation">.</span>encrypt<span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> encrypted_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""解密数据"""</span>
        <span class="token keyword">if</span> encrypted_data <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">None</span>

        decrypted <span class="token operator">=</span> self<span class="token punctuation">.</span>cipher<span class="token punctuation">.</span>decrypt<span class="token punctuation">(</span>encrypted_data<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>decrypted<span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> decrypted<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 工具的安全装饰器</span>
<span class="token keyword">def</span> <span class="token function">secure_tool</span><span class="token punctuation">(</span>requires_encryption<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> log_access<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">decorator</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span><span class="token punctuation">:</span>
        original_execute <span class="token operator">=</span> cls<span class="token punctuation">.</span>execute_async <span class="token keyword">if</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token string">'execute_async'</span><span class="token punctuation">)</span> <span class="token keyword">else</span> cls<span class="token punctuation">.</span>execute

        <span class="token decorator annotation punctuation">@wraps</span><span class="token punctuation">(</span>original_execute<span class="token punctuation">)</span>
        <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">secure_execute</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># 检查请求中的 PII</span>
            pii_detector <span class="token operator">=</span> PiiDetector<span class="token punctuation">(</span><span class="token punctuation">)</span>
            pii_found <span class="token operator">=</span> pii_detector<span class="token punctuation">.</span>scan_parameters<span class="token punctuation">(</span>request<span class="token punctuation">.</span>parameters<span class="token punctuation">)</span>

            <span class="token comment"># 如果需要则记录访问</span>
            <span class="token keyword">if</span> log_access<span class="token punctuation">:</span>
                tool_name <span class="token operator">=</span> self<span class="token punctuation">.</span>get_name<span class="token punctuation">(</span><span class="token punctuation">)</span>
                user_id <span class="token operator">=</span> request<span class="token punctuation">.</span>context<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"user_id"</span><span class="token punctuation">,</span> <span class="token string">"anonymous"</span><span class="token punctuation">)</span>
                log_entry <span class="token operator">=</span> <span class="token punctuation">{</span>
                    <span class="token string">"timestamp"</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token string">"tool"</span><span class="token punctuation">:</span> tool_name<span class="token punctuation">,</span>
                    <span class="token string">"user"</span><span class="token punctuation">:</span> user_id<span class="token punctuation">,</span>
                    <span class="token string">"contains_pii"</span><span class="token punctuation">:</span> <span class="token builtin">bool</span><span class="token punctuation">(</span>pii_found<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token string">"parameters"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>k<span class="token punctuation">:</span> <span class="token string">"***"</span> <span class="token keyword">for</span> k <span class="token keyword">in</span> request<span class="token punctuation">.</span>parameters<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>  <span class="token comment"># 不记录实际值</span>
                <span class="token punctuation">}</span>
                logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"工具访问: </span><span class="token interpolation"><span class="token punctuation">{</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>log_entry<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

            <span class="token comment"># 处理检测到的 PII</span>
            <span class="token keyword">if</span> pii_found<span class="token punctuation">:</span>
                <span class="token comment"># 加密敏感数据或拒绝请求</span>
                <span class="token keyword">if</span> requires_encryption<span class="token punctuation">:</span>
                    encryption_service <span class="token operator">=</span> EncryptionService<span class="token punctuation">(</span><span class="token string">"keys/tool_key.key"</span><span class="token punctuation">)</span>
                    <span class="token keyword">for</span> param_name<span class="token punctuation">,</span> pii_types <span class="token keyword">in</span> pii_found<span class="token punctuation">:</span>
                        <span class="token comment"># 加密敏感参数</span>
                        request<span class="token punctuation">.</span>parameters<span class="token punctuation">[</span>param_name<span class="token punctuation">]</span> <span class="token operator">=</span> encryption_service<span class="token punctuation">.</span>encrypt<span class="token punctuation">(</span>
                            request<span class="token punctuation">.</span>parameters<span class="token punctuation">[</span>param_name<span class="token punctuation">]</span>
                        <span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    <span class="token comment"># 如果没有加密且检测到 PII，可以拒绝请求</span>
                    <span class="token keyword">raise</span> ToolExecutionException<span class="token punctuation">(</span>
                        <span class="token string">"请求包含无法安全处理的敏感数据"</span>
                    <span class="token punctuation">)</span>

            <span class="token comment"># 执行原始方法</span>
            <span class="token keyword">return</span> <span class="token keyword">await</span> original_execute<span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span>

        <span class="token comment"># 替换 execute 方法</span>
        <span class="token keyword">if</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token string">'execute_async'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            cls<span class="token punctuation">.</span>execute_async <span class="token operator">=</span> secure_execute
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            cls<span class="token punctuation">.</span>execute <span class="token operator">=</span> secure_execute
        <span class="token keyword">return</span> cls

    <span class="token keyword">return</span> decorator

<span class="token comment"># 使用装饰器的安全工具示例</span>
<span class="token decorator annotation punctuation">@secure_tool</span><span class="token punctuation">(</span>requires_encryption<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> log_access<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">SecureCustomerDataTool</span><span class="token punctuation">(</span>Tool<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">get_name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"customerData"</span>

    <span class="token keyword">def</span> <span class="token function">get_description</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"安全访问客户数据"</span>

    <span class="token keyword">def</span> <span class="token function">get_schema</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 模式定义</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">execute_async</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 实现将安全地访问客户数据</span>
        <span class="token comment"># 由于我们使用了装饰器，PII 已被检测并加密</span>
        <span class="token keyword">return</span> ToolResponse<span class="token punctuation">(</span>result<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"status"</span><span class="token punctuation">:</span> <span class="token string">"success"</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>在前面的代码中，我们：</p>
<ul>
<li>实现了 <code class="language-text">PiiDetector</code> 类来扫描文本和参数中的个人身份信息 (PII)</li>
<li>创建了 <code class="language-text">EncryptionService</code> 类，使用 <code class="language-text">cryptography</code> 库处理敏感数据的加密和解密</li>
<li>定义了 <code class="language-text">secure_tool</code> 装饰器，包装工具执行以检查 PII、记录访问并在需要时加密敏感数据</li>
<li>将 <code class="language-text">secure_tool</code> 装饰器应用于示例工具 (<code class="language-text">SecureCustomerDataTool</code>)，确保其安全处理敏感数据</li>
</ul>
<h2 id="实时-web-搜索" style="position:relative;"><a href="#%E5%AE%9E%E6%97%B6-web-%E6%90%9C%E7%B4%A2" aria-label="实时 web 搜索 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实时 Web 搜索</h2>
<ul>
<li>
<p>server.py</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment">#!/usr/bin/env python3</span>
<span class="token triple-quoted-string string">"""
Web Search MCP Server

This advanced MCP server demonstrates integration with SerpAPI to provide
real-time web data to LLMs through four specialized tools:
- general_search: For broad web search results
- news_search: For recent news articles
- product_search: For e-commerce product information
- qna: For direct question-answer snippets

The server is built using FastMCP and showcases advanced concepts
like external API integration, structured data parsing, and
multi-tool orchestration.
"""</span>

<span class="token keyword">import</span> os
<span class="token keyword">import</span> json
<span class="token keyword">import</span> httpx
<span class="token keyword">import</span> logging
<span class="token keyword">from</span> typing <span class="token keyword">import</span> Dict<span class="token punctuation">,</span> Any
<span class="token keyword">from</span> dotenv <span class="token keyword">import</span> load_dotenv
<span class="token keyword">from</span> mcp<span class="token punctuation">.</span>server<span class="token punctuation">.</span>fastmcp <span class="token keyword">import</span> FastMCP<span class="token punctuation">,</span> Context

<span class="token comment"># Configure logging</span>
logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span>
    level<span class="token operator">=</span>logging<span class="token punctuation">.</span>INFO<span class="token punctuation">,</span>
    <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">"%(asctime)s - %(name)s - %(levelname)s - %(message)s"</span>
<span class="token punctuation">)</span>
logger <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

<span class="token comment"># Load environment variables</span>
load_dotenv<span class="token punctuation">(</span><span class="token punctuation">)</span>
SERPAPI_KEY <span class="token operator">=</span> os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">"SERPAPI_KEY"</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token keyword">not</span> SERPAPI_KEY<span class="token punctuation">:</span>
    logger<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">"SERPAPI_KEY environment variable not found. Please set it in .env file."</span><span class="token punctuation">)</span>
    <span class="token keyword">raise</span> EnvironmentError<span class="token punctuation">(</span><span class="token string">"SERPAPI_KEY environment variable is required"</span><span class="token punctuation">)</span>

<span class="token comment"># API configuration</span>
SERPAPI_BASE_URL <span class="token operator">=</span> <span class="token string">"https://serpapi.com/search"</span>
DEFAULT_TIMEOUT <span class="token operator">=</span> <span class="token number">10.0</span>  <span class="token comment"># seconds</span>
DEFAULT_RESULTS_LIMIT <span class="token operator">=</span> <span class="token number">5</span>

<span class="token comment"># Initialize FastMCP server</span>
mcp <span class="token operator">=</span> FastMCP<span class="token punctuation">(</span><span class="token string">"WebSearchServer"</span><span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">make_serpapi_request</span><span class="token punctuation">(</span>ctx<span class="token punctuation">:</span> Context<span class="token punctuation">,</span> params<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Dict<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    Make a request to SerpAPI with the given parameters.
    
    Args:
        ctx: MCP context object for logging
        params: Dictionary of parameters to send to SerpAPI
        
    Returns:
        Dict containing the API response
        
    Raises:
        Exception: If the API request fails
    """</span>
    <span class="token comment"># Ensure API key is included</span>
    request_params <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">**</span>params<span class="token punctuation">,</span> <span class="token string">"api_key"</span><span class="token punctuation">:</span> SERPAPI_KEY<span class="token punctuation">}</span>
    
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">async</span> <span class="token keyword">with</span> httpx<span class="token punctuation">.</span>AsyncClient<span class="token punctuation">(</span>timeout<span class="token operator">=</span>DEFAULT_TIMEOUT<span class="token punctuation">)</span> <span class="token keyword">as</span> client<span class="token punctuation">:</span>
            <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Making SerpAPI request with engine: </span><span class="token interpolation"><span class="token punctuation">{</span>params<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'engine'</span><span class="token punctuation">,</span> <span class="token string">'google'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            response <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span>get<span class="token punctuation">(</span>SERPAPI_BASE_URL<span class="token punctuation">,</span> params<span class="token operator">=</span>request_params<span class="token punctuation">)</span>
            response<span class="token punctuation">.</span>raise_for_status<span class="token punctuation">(</span><span class="token punctuation">)</span>
            data <span class="token operator">=</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"SerpAPI request successful"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> data
    <span class="token keyword">except</span> httpx<span class="token punctuation">.</span>TimeoutException<span class="token punctuation">:</span>
        <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">"SerpAPI request timed out"</span><span class="token punctuation">)</span>
        <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"Search request timed out. Please try again."</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> httpx<span class="token punctuation">.</span>RequestError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"SerpAPI request error: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Failed to fetch data from search API: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> httpx<span class="token punctuation">.</span>HTTPStatusError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"SerpAPI HTTP error: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">.</span>response<span class="token punctuation">.</span>status_code<span class="token punctuation">}</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">.</span>response<span class="token punctuation">.</span>text<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Search API returned error status: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">.</span>response<span class="token punctuation">.</span>status_code<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> json<span class="token punctuation">.</span>JSONDecodeError<span class="token punctuation">:</span>
        <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">"Failed to parse SerpAPI response as JSON"</span><span class="token punctuation">)</span>
        <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"Failed to parse search results"</span><span class="token punctuation">)</span>

<span class="token comment"># Tool for general web search</span>
<span class="token decorator annotation punctuation">@mcp<span class="token punctuation">.</span>tool</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">general_search</span><span class="token punctuation">(</span>query<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> num_results<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> DEFAULT_RESULTS_LIMIT<span class="token punctuation">,</span> ctx<span class="token punctuation">:</span> Context <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    Perform a general web search and return formatted results.
    
    Args:
        query: The search query
        num_results: Number of results to return (default: 5)
        ctx: MCP context object
        
    Returns:
        Formatted search results as a string
    """</span>
    <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Performing general search for: </span><span class="token interpolation"><span class="token punctuation">{</span>query<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token comment"># Prepare parameters for SerpAPI</span>
        params <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">"q"</span><span class="token punctuation">:</span> query<span class="token punctuation">,</span>
            <span class="token string">"num"</span><span class="token punctuation">:</span> num_results<span class="token punctuation">,</span>
            <span class="token string">"engine"</span><span class="token punctuation">:</span> <span class="token string">"google"</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment"># Make the API request</span>
        response_data <span class="token operator">=</span> <span class="token keyword">await</span> make_serpapi_request<span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> params<span class="token punctuation">)</span>
        
        <span class="token comment"># Extract organic results</span>
        organic_results <span class="token operator">=</span> response_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"organic_results"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> organic_results<span class="token punctuation">:</span>
            <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"No general search results found"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token string">"No search results found."</span>
        
        <span class="token comment"># Format results for return</span>
        formatted_results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i<span class="token punctuation">,</span> result <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>organic_results<span class="token punctuation">[</span><span class="token punctuation">:</span>num_results<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            formatted_results<span class="token punctuation">.</span>append<span class="token punctuation">(</span>
                <span class="token string-interpolation"><span class="token string">f"## </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">. </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'No title'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
                <span class="token string-interpolation"><span class="token string">f"**Link**: </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'link'</span><span class="token punctuation">,</span> <span class="token string">'No link'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
                <span class="token string-interpolation"><span class="token string">f"**Snippet**: </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'snippet'</span><span class="token punctuation">,</span> <span class="token string">'No description'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
            <span class="token punctuation">)</span>
        
        <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Returning </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>formatted_results<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> general search results"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>formatted_results<span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"General search failed: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"Error: Unable to fetch results. </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>

<span class="token comment"># Tool for news search</span>
<span class="token decorator annotation punctuation">@mcp<span class="token punctuation">.</span>tool</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">news_search</span><span class="token punctuation">(</span>query<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> num_results<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> DEFAULT_RESULTS_LIMIT<span class="token punctuation">,</span> ctx<span class="token punctuation">:</span> Context <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    Search for recent news articles related to a query.
    
    Args:
        query: The search query
        num_results: Number of news articles to return (default: 5)
        ctx: MCP context object
        
    Returns:
        Formatted news search results as a string
    """</span>
    <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Performing news search for: </span><span class="token interpolation"><span class="token punctuation">{</span>query<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token comment"># Prepare parameters for SerpAPI</span>
        params <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">"q"</span><span class="token punctuation">:</span> query<span class="token punctuation">,</span>
            <span class="token string">"num"</span><span class="token punctuation">:</span> num_results<span class="token punctuation">,</span>
            <span class="token string">"engine"</span><span class="token punctuation">:</span> <span class="token string">"google_news"</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment"># Make the API request</span>
        response_data <span class="token operator">=</span> <span class="token keyword">await</span> make_serpapi_request<span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> params<span class="token punctuation">)</span>
        
        <span class="token comment"># Extract news results</span>
        news_results <span class="token operator">=</span> response_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"news_results"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> news_results<span class="token punctuation">:</span>
            <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"No news articles found"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token string">"No news articles found."</span>
        
        <span class="token comment"># Format results for return</span>
        formatted_results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i<span class="token punctuation">,</span> result <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>news_results<span class="token punctuation">[</span><span class="token punctuation">:</span>num_results<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            formatted_results<span class="token punctuation">.</span>append<span class="token punctuation">(</span>
                <span class="token string-interpolation"><span class="token string">f"## </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">. </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'No title'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
                <span class="token string-interpolation"><span class="token string">f"**Source**: </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'source'</span><span class="token punctuation">,</span> <span class="token string">'Unknown source'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> | "</span></span>
                <span class="token string-interpolation"><span class="token string">f"**Date**: </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'date'</span><span class="token punctuation">,</span> <span class="token string">'Unknown date'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
                <span class="token string-interpolation"><span class="token string">f"**Link**: </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'link'</span><span class="token punctuation">,</span> <span class="token string">'No link'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
                <span class="token string-interpolation"><span class="token string">f"**Snippet**: </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'snippet'</span><span class="token punctuation">,</span> <span class="token string">'No description'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
            <span class="token punctuation">)</span>
        
        <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Returning </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>formatted_results<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> news results"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>formatted_results<span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"News search failed: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"Error: Unable to fetch news. </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>

<span class="token comment"># Tool for product search</span>
<span class="token decorator annotation punctuation">@mcp<span class="token punctuation">.</span>tool</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">product_search</span><span class="token punctuation">(</span>query<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> num_results<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> DEFAULT_RESULTS_LIMIT<span class="token punctuation">,</span> ctx<span class="token punctuation">:</span> Context <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    Search for products matching a query.
    
    Args:
        query: The product search query
        num_results: Number of product results to return (default: 5)
        ctx: MCP context object
        
    Returns:
        Formatted product search results as a string
    """</span>
    <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Performing product search for: </span><span class="token interpolation"><span class="token punctuation">{</span>query<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token comment"># Prepare parameters for SerpAPI</span>
        params <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">"q"</span><span class="token punctuation">:</span> query<span class="token punctuation">,</span>
            <span class="token string">"engine"</span><span class="token punctuation">:</span> <span class="token string">"google_shopping"</span><span class="token punctuation">,</span>
            <span class="token string">"shopping_intent"</span><span class="token punctuation">:</span> <span class="token string">"high"</span><span class="token punctuation">,</span>
            <span class="token string">"num"</span><span class="token punctuation">:</span> num_results
        <span class="token punctuation">}</span>
        
        <span class="token comment"># Make the API request</span>
        response_data <span class="token operator">=</span> <span class="token keyword">await</span> make_serpapi_request<span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> params<span class="token punctuation">)</span>
        
        <span class="token comment"># Extract shopping results</span>
        shopping_results <span class="token operator">=</span> response_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"shopping_results"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> shopping_results<span class="token punctuation">:</span>
            <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"No product results found"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token string">"No product results found."</span>
        
        <span class="token comment"># Format results for return</span>
        formatted_results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i<span class="token punctuation">,</span> result <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>shopping_results<span class="token punctuation">[</span><span class="token punctuation">:</span>num_results<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            formatted_results<span class="token punctuation">.</span>append<span class="token punctuation">(</span>
                <span class="token string-interpolation"><span class="token string">f"## </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">. </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'No title'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
                <span class="token string-interpolation"><span class="token string">f"**Price**: </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'price'</span><span class="token punctuation">,</span> <span class="token string">'Unknown price'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
                <span class="token string-interpolation"><span class="token string">f"**Rating**: </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'rating'</span><span class="token punctuation">,</span> <span class="token string">'No rating'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> "</span></span>
                <span class="token string-interpolation"><span class="token string">f"(</span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'reviews'</span><span class="token punctuation">,</span> <span class="token string">'No'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> reviews)"</span></span>
                <span class="token string-interpolation"><span class="token string">f"**Source**: </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'source'</span><span class="token punctuation">,</span> <span class="token string">'Unknown source'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
                <span class="token string-interpolation"><span class="token string">f"**Link**: </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'link'</span><span class="token punctuation">,</span> <span class="token string">'No link'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
            <span class="token punctuation">)</span>
        
        <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Returning </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>formatted_results<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> product results"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>formatted_results<span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Product search failed: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"Error: Unable to fetch products. </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>

<span class="token comment"># Tool for Q&amp;A search</span>
<span class="token decorator annotation punctuation">@mcp<span class="token punctuation">.</span>tool</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">qna</span><span class="token punctuation">(</span>question<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> ctx<span class="token punctuation">:</span> Context <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    Get direct answers to questions from search engines.
    
    Args:
        question: The question to find an answer for
        ctx: MCP context object
        
    Returns:
        Answer snippet as a string
    """</span>
    <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Searching for answer to: </span><span class="token interpolation"><span class="token punctuation">{</span>question<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token comment"># Prepare parameters for SerpAPI</span>
        params <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">"q"</span><span class="token punctuation">:</span> question<span class="token punctuation">,</span>
            <span class="token string">"engine"</span><span class="token punctuation">:</span> <span class="token string">"google"</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment"># Make the API request</span>
        response_data <span class="token operator">=</span> <span class="token keyword">await</span> make_serpapi_request<span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> params<span class="token punctuation">)</span>
        
        <span class="token comment"># Try to extract answer box first (direct answer)</span>
        answer_box <span class="token operator">=</span> response_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"answer_box"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> answer_box<span class="token punctuation">:</span>
            <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Found answer in answer box"</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token string">"answer"</span> <span class="token keyword">in</span> answer_box<span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"**Answer**: </span><span class="token interpolation"><span class="token punctuation">{</span>answer_box<span class="token punctuation">[</span><span class="token string">'answer'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
            <span class="token keyword">elif</span> <span class="token string">"snippet"</span> <span class="token keyword">in</span> answer_box<span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"**Answer**: </span><span class="token interpolation"><span class="token punctuation">{</span>answer_box<span class="token punctuation">[</span><span class="token string">'snippet'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
            <span class="token keyword">elif</span> <span class="token string">"snippet_highlighted_words"</span> <span class="token keyword">in</span> answer_box<span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"**Answer**: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>answer_box<span class="token punctuation">[</span><span class="token string">'snippet_highlighted_words'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
        
        <span class="token comment"># Try knowledge graph if no answer box</span>
        knowledge_graph <span class="token operator">=</span> response_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"knowledge_graph"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> knowledge_graph <span class="token keyword">and</span> <span class="token string">"description"</span> <span class="token keyword">in</span> knowledge_graph<span class="token punctuation">:</span>
            <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Found answer in knowledge graph"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"**Answer**: </span><span class="token interpolation"><span class="token punctuation">{</span>knowledge_graph<span class="token punctuation">[</span><span class="token string">'description'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
        
        <span class="token comment"># Try featured snippet</span>
        <span class="token keyword">if</span> <span class="token string">"featured_snippet"</span> <span class="token keyword">in</span> response_data<span class="token punctuation">:</span>
            <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Found answer in featured snippet"</span><span class="token punctuation">)</span>
            snippet <span class="token operator">=</span> response_data<span class="token punctuation">[</span><span class="token string">"featured_snippet"</span><span class="token punctuation">]</span>
            <span class="token keyword">if</span> <span class="token string">"snippet"</span> <span class="token keyword">in</span> snippet<span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"**Answer**: </span><span class="token interpolation"><span class="token punctuation">{</span>snippet<span class="token punctuation">[</span><span class="token string">'snippet'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
        
        <span class="token comment"># Try related questions</span>
        related_questions <span class="token operator">=</span> response_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"related_questions"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> related_questions<span class="token punctuation">:</span>
            <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Found answer in related questions"</span><span class="token punctuation">)</span>
            formatted <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> i<span class="token punctuation">,</span> question <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>related_questions<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                formatted<span class="token punctuation">.</span>append<span class="token punctuation">(</span>
                    <span class="token string-interpolation"><span class="token string">f"**Question**: </span><span class="token interpolation"><span class="token punctuation">{</span>question<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'question'</span><span class="token punctuation">,</span> <span class="token string">'Unknown question'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
                    <span class="token string-interpolation"><span class="token string">f"**Answer**: </span><span class="token interpolation"><span class="token punctuation">{</span>question<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'snippet'</span><span class="token punctuation">,</span> <span class="token string">'No answer available'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
                    <span class="token string-interpolation"><span class="token string">f"**Source**: {question.get('source', {}).get('link', 'No source')}"</span></span>
                <span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>formatted<span class="token punctuation">)</span>
        
        <span class="token comment"># Fallback to first organic result snippet</span>
        organic_results <span class="token operator">=</span> response_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"organic_results"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> organic_results <span class="token keyword">and</span> <span class="token string">"snippet"</span> <span class="token keyword">in</span> organic_results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"No direct answer found, using first organic result"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"**Possible answer**: </span><span class="token interpolation"><span class="token punctuation">{</span>organic_results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'snippet'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
        
        <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"No answer found"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token string">"No direct answer found for your question."</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Q&amp;A search failed: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"Error: Unable to find an answer. </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
        
<span class="token decorator annotation punctuation">@mcp<span class="token punctuation">.</span>resource</span><span class="token punctuation">(</span><span class="token string">"readme://"</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">get_readme</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Get README information for the Web Search MCP Server"""</span>
    <span class="token keyword">return</span> <span class="token triple-quoted-string string">"""
    # Web Search MCP Server
    
    This MCP server provides tools for integrating web search capabilities into LLMs using SerpAPI.
    
    ## Available Tools:
    
    1. `general_search(query, num_results=5)` - Perform a general web search
    2. `news_search(query, num_results=5)` - Search for recent news articles
    3. `product_search(query, num_results=5)` - Search for products
    4. `qna(question)` - Get direct answers to questions
    
    ## Usage:
    
    Call these tools from an MCP client to retrieve real-time web data.
    """</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    mcp<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div>
</li>
<li>
<p>client.py</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment">#!/usr/bin/env python3</span>
<span class="token triple-quoted-string string">"""
Web Search MCP Client

This client demonstrates how to interact with the Web Search MCP Server
by calling its various tools for retrieving real-time web data.

The client connects to the MCP server via stdio communication and
shows how to call each of the four specialized search tools:
- general_search: For broad web search results
- news_search: For recent news articles
- product_search: For e-commerce product information
- qna: For direct question-answer snippets

Quick Start:

1. Get a free API key from SerpAPI (https://serpapi.com/), then create a `.env` file in this folder with:
   SERPAPI_KEY=your_serpapi_key_here
2. Install dependencies:
   pip install -r ../../requirements.txt
3. Start the server:
   python server.py
4. In a new terminal, run the client:
   python client.py
   # Or for interactive mode:
   python client.py --interactive
"""</span>

<span class="token keyword">import</span> asyncio
<span class="token keyword">import</span> argparse
<span class="token keyword">import</span> logging
<span class="token keyword">import</span> sys
<span class="token keyword">from</span> typing <span class="token keyword">import</span> Dict<span class="token punctuation">,</span> Any
<span class="token keyword">from</span> mcp <span class="token keyword">import</span> ClientSession<span class="token punctuation">,</span> StdioServerParameters
<span class="token keyword">from</span> mcp<span class="token punctuation">.</span>client<span class="token punctuation">.</span>stdio <span class="token keyword">import</span> stdio_client
<span class="token keyword">from</span> mcp<span class="token punctuation">.</span>types <span class="token keyword">import</span> TextContent<span class="token punctuation">,</span> TextResourceContents
<span class="token keyword">from</span> dotenv <span class="token keyword">import</span> load_dotenv

<span class="token comment"># Configure logging</span>
logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span>
    level<span class="token operator">=</span>logging<span class="token punctuation">.</span>INFO<span class="token punctuation">,</span>
    <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">"%(asctime)s - %(name)s - %(levelname)s - %(message)s"</span>
<span class="token punctuation">)</span>
logger <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">call_tool</span><span class="token punctuation">(</span>session<span class="token punctuation">:</span> ClientSession<span class="token punctuation">,</span> tool_name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> params<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    Call a tool on the MCP server and print the results.
    
    Args:
        session: MCP client session
        tool_name: Name of the tool to call
        params: Parameters to pass to the tool
    """</span>
    logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Calling </span><span class="token interpolation"><span class="token punctuation">{</span>tool_name<span class="token punctuation">}</span></span><span class="token string"> with params: </span><span class="token interpolation"><span class="token punctuation">{</span>params<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        result <span class="token operator">=</span> <span class="token keyword">await</span> session<span class="token punctuation">.</span>call_tool<span class="token punctuation">(</span>tool_name<span class="token punctuation">,</span> arguments<span class="token operator">=</span>params<span class="token punctuation">)</span>
        
        <span class="token keyword">if</span> result <span class="token keyword">and</span> result<span class="token punctuation">.</span>content<span class="token punctuation">:</span>
            text_content <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span><span class="token punctuation">(</span>content <span class="token keyword">for</span> content <span class="token keyword">in</span> result<span class="token punctuation">.</span>content 
                              <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> TextContent<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> text_content<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token string">'='</span><span class="token operator">*</span><span class="token number">50</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>tool_name<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> RESULTS:"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token string">'='</span><span class="token operator">*</span><span class="token number">50</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>text_content<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token string">'='</span><span class="token operator">*</span><span class="token number">50</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                
                logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Successfully called </span><span class="token interpolation"><span class="token punctuation">{</span>tool_name<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                logger<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"No text content returned from </span><span class="token interpolation"><span class="token punctuation">{</span>tool_name<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"No text content returned from </span><span class="token interpolation"><span class="token punctuation">{</span>tool_name<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            logger<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"No content returned from </span><span class="token interpolation"><span class="token punctuation">{</span>tool_name<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"No content returned from </span><span class="token interpolation"><span class="token punctuation">{</span>tool_name<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        logger<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error calling </span><span class="token interpolation"><span class="token punctuation">{</span>tool_name<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error calling </span><span class="token interpolation"><span class="token punctuation">{</span>tool_name<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">run_interactive_demo</span><span class="token punctuation">(</span>session<span class="token punctuation">:</span> ClientSession<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    Run an interactive demo that lets the user try different search tools.
    
    Args:
        session: MCP client session
    """</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"=== Web Search MCP Interactive Demo ==="</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token comment"># Get list of available tools</span>
        logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Getting list of tools"</span><span class="token punctuation">)</span>
        tools_response <span class="token operator">=</span> <span class="token keyword">await</span> session<span class="token punctuation">.</span>list_tools<span class="token punctuation">(</span><span class="token punctuation">)</span>
        tool_names <span class="token operator">=</span> <span class="token punctuation">[</span>tool<span class="token punctuation">.</span>name <span class="token keyword">for</span> tool <span class="token keyword">in</span> tools_response<span class="token punctuation">.</span>tools<span class="token punctuation">]</span>
        
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Connected to server"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Available tools: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token string">', '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>tool_names<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Options:"</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"1. General Web Search"</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"2. News Search"</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"3. Product Search"</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"4. Question &amp; Answer"</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"5. Exit"</span><span class="token punctuation">)</span>
            
            choice <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"Enter your choice (1-5): "</span><span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> choice <span class="token operator">==</span> <span class="token string">"5"</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Exiting demo. Goodbye!"</span><span class="token punctuation">)</span>
                <span class="token keyword">break</span>
                
            query <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"Enter your search query: "</span><span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> <span class="token keyword">not</span> query<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Query cannot be empty. Please try again."</span><span class="token punctuation">)</span>
                <span class="token keyword">continue</span>
                
            <span class="token keyword">if</span> choice <span class="token operator">==</span> <span class="token string">"1"</span><span class="token punctuation">:</span>
                <span class="token keyword">await</span> call_tool<span class="token punctuation">(</span>session<span class="token punctuation">,</span> <span class="token string">"general_search"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">"query"</span><span class="token punctuation">:</span> query<span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">elif</span> choice <span class="token operator">==</span> <span class="token string">"2"</span><span class="token punctuation">:</span>
                <span class="token keyword">await</span> call_tool<span class="token punctuation">(</span>session<span class="token punctuation">,</span> <span class="token string">"news_search"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">"query"</span><span class="token punctuation">:</span> query<span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">elif</span> choice <span class="token operator">==</span> <span class="token string">"3"</span><span class="token punctuation">:</span>                <span class="token keyword">await</span> call_tool<span class="token punctuation">(</span>session<span class="token punctuation">,</span> <span class="token string">"product_search"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">"query"</span><span class="token punctuation">:</span> query<span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">elif</span> choice <span class="token operator">==</span> <span class="token string">"4"</span><span class="token punctuation">:</span>
                <span class="token keyword">await</span> call_tool<span class="token punctuation">(</span>session<span class="token punctuation">,</span> <span class="token string">"qna"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">"question"</span><span class="token punctuation">:</span> query<span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Invalid choice. Please enter a number between 1 and 5."</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        logger<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error in interactive demo: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">run_all_tools_demo</span><span class="token punctuation">(</span>session<span class="token punctuation">:</span> ClientSession<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Run a demonstration of all available tools with preset queries."""</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"=== Running All Tools Demo ==="</span><span class="token punctuation">)</span>
    
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token comment"># Get the README resource</span>
        logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Getting README resource"</span><span class="token punctuation">)</span>
        readme_response <span class="token operator">=</span> <span class="token keyword">await</span> session<span class="token punctuation">.</span>read_resource<span class="token punctuation">(</span><span class="token string">"readme://"</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> readme_response <span class="token keyword">and</span> readme_response<span class="token punctuation">.</span>contents<span class="token punctuation">:</span>
            text_resource <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span><span class="token punctuation">(</span>content <span class="token keyword">for</span> content <span class="token keyword">in</span> readme_response<span class="token punctuation">.</span>contents 
                                <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> TextResourceContents<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> text_resource<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token string">'='</span><span class="token operator">*</span><span class="token number">50</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"README RESOURCE:"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token string">'='</span><span class="token operator">*</span><span class="token number">50</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>text_resource<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token string">'='</span><span class="token operator">*</span><span class="token number">50</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        
        <span class="token comment"># Test the general_search tool</span>
        <span class="token keyword">await</span> call_tool<span class="token punctuation">(</span>session<span class="token punctuation">,</span> <span class="token string">"general_search"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"latest AI trends 2025"</span><span class="token punctuation">,</span> <span class="token string">"num_results"</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Test the news_search tool</span>
        <span class="token keyword">await</span> call_tool<span class="token punctuation">(</span>session<span class="token punctuation">,</span> <span class="token string">"news_search"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"AI policy updates"</span><span class="token punctuation">,</span> <span class="token string">"num_results"</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Test the product_search tool</span>
        <span class="token keyword">await</span> call_tool<span class="token punctuation">(</span>session<span class="token punctuation">,</span> <span class="token string">"product_search"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"best AI gadgets 2025"</span><span class="token punctuation">,</span> <span class="token string">"num_results"</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Test the qna tool</span>
        <span class="token keyword">await</span> call_tool<span class="token punctuation">(</span>session<span class="token punctuation">,</span> <span class="token string">"qna"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">"question"</span><span class="token punctuation">:</span> <span class="token string">"what is artificial intelligence"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        logger<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error running tools demo: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Main entry point for the client."""</span>
    <span class="token comment"># Load environment variables if dotenv module is available</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        load_dotenv<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
    
    parser <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span>description<span class="token operator">=</span><span class="token string">"Web Search MCP Client"</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span>
        <span class="token string">"--interactive"</span><span class="token punctuation">,</span> 
        action<span class="token operator">=</span><span class="token string">"store_true"</span><span class="token punctuation">,</span>
        <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"Run in interactive mode"</span>
    <span class="token punctuation">)</span>
    
    args <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Starting Web Search MCP client"</span><span class="token punctuation">)</span>
    
    server_params <span class="token operator">=</span> StdioServerParameters<span class="token punctuation">(</span>
        command<span class="token operator">=</span><span class="token string">"python"</span><span class="token punctuation">,</span>
        args<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"server.py"</span><span class="token punctuation">]</span>
    <span class="token punctuation">)</span>
    
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Connecting to server..."</span><span class="token punctuation">)</span>
        <span class="token keyword">async</span> <span class="token keyword">with</span> stdio_client<span class="token punctuation">(</span>server_params<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token punctuation">(</span>reader<span class="token punctuation">,</span> writer<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">async</span> <span class="token keyword">with</span> ClientSession<span class="token punctuation">(</span>reader<span class="token punctuation">,</span> writer<span class="token punctuation">)</span> <span class="token keyword">as</span> session<span class="token punctuation">:</span>
                logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Initializing session"</span><span class="token punctuation">)</span>
                <span class="token keyword">await</span> session<span class="token punctuation">.</span>initialize<span class="token punctuation">(</span><span class="token punctuation">)</span>
                
                <span class="token keyword">if</span> args<span class="token punctuation">.</span>interactive<span class="token punctuation">:</span>
                    <span class="token keyword">await</span> run_interactive_demo<span class="token punctuation">(</span>session<span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    <span class="token keyword">await</span> run_all_tools_demo<span class="token punctuation">(</span>session<span class="token punctuation">)</span>
    
    <span class="token keyword">except</span> KeyboardInterrupt<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Client terminated by user."</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        logger<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error during client execution: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">import</span> traceback
        logger<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Traceback: </span><span class="token interpolation"><span class="token punctuation">{</span>traceback<span class="token punctuation">.</span>format_exc<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
</li>
</ul>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">mcp run server</code></pre></div>
<h2 id="模型上下文协议服务器的-entra-id-身份验证" style="position:relative;"><a href="#%E6%A8%A1%E5%9E%8B%E4%B8%8A%E4%B8%8B%E6%96%87%E5%8D%8F%E8%AE%AE%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84-entra-id-%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81" aria-label="模型上下文协议服务器的 entra id 身份验证 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模型上下文协议服务器的 Entra ID 身份验证</h2>
<h3 id="microsoft-entra-id-简介" style="position:relative;"><a href="#microsoft-entra-id-%E7%AE%80%E4%BB%8B" aria-label="microsoft entra id 简介 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>Microsoft Entra ID 简介</strong></h3>
<p><a href="https://adoption.microsoft.com/microsoft-security/entra/"><strong>Microsoft Entra ID</strong></a> 是一种基于云的身份和访问管理服务。可以把它看作是应用程序的通用安全卫士。它处理验证用户身份（身份验证）和确定他们被允许做什么（授权）的复杂过程。</p>
<p>通过使用 Entra ID，可以：</p>
<ul>
<li>为用户启用安全登录。</li>
<li>保护 API 和服务。</li>
<li>从一个中心位置管理访问策略。</li>
</ul>
<p>对于 MCP 服务器，Entra ID 提供了一个强大且广受信赖的解决方案来管理谁可以访问服务器的功能。</p>
<h3 id="身份验证流程" style="position:relative;"><a href="#%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81%E6%B5%81%E7%A8%8B" aria-label="身份验证流程 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>身份验证流程</strong></h3>
<p>以下是该过程在实践中的工作方式：</p>
<div class="gatsby-highlight" data-language="mermaid"><pre class="language-mermaid"><code class="language-mermaid"><span class="token keyword">sequenceDiagram</span>
    actor User as 👤 用户
    <span class="token keyword">participant</span> Client as 🖥️ MCP 客户端
    <span class="token keyword">participant</span> Entra as 🔐 Microsoft Entra ID
    <span class="token keyword">participant</span> Server as 🔧 MCP 服务器

    Client<span class="token arrow operator">->></span>+User<span class="token operator">:</span> 请登录以继续。
    User<span class="token arrow operator">->></span>+Entra<span class="token operator">:</span> 输入凭据（用户名/密码）。
    Entra<span class="token arrow operator">-->></span>Client<span class="token operator">:</span> 这是的访问令牌。
    User<span class="token arrow operator">-->></span>-Client<span class="token operator">:</span> （返回到应用程序）

    Client<span class="token arrow operator">->></span>+Server<span class="token operator">:</span> 我需要使用一个工具。这是我的访问令牌。
    Server<span class="token arrow operator">->></span>+Entra<span class="token operator">:</span> 这个访问令牌有效吗？
    Entra<span class="token arrow operator">-->></span>-Server<span class="token operator">:</span> 是的，有效。
    Server<span class="token arrow operator">-->></span>-Client<span class="token operator">:</span> 令牌有效。这是工具的结果。
</code></pre></div>
<h3 id="介绍-microsoft-身份验证库-msal" style="position:relative;"><a href="#%E4%BB%8B%E7%BB%8D-microsoft-%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81%E5%BA%93-msal" aria-label="介绍 microsoft 身份验证库 msal permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>介绍 Microsoft 身份验证库 (MSAL)</strong></h3>
<p>MSAL 是由 Microsoft 开发的一个库，它使开发人员更容易处理身份验证。不必编写所有复杂的代码来处理安全令牌、管理登录和刷新会话，MSAL 会为处理这些繁重的工作。</p>
<p>强烈建议使用像 MSAL 这样的库，因为：</p>
<ul>
<li><strong>它很安全：</strong> 它实现了行业标准协议和安全最佳实践，降低了代码中出现漏洞的风险。</li>
<li><strong>它简化了开发：</strong> 它抽象了 OAuth 2.0 和 OpenID Connect 协议的复杂性，让只需几行代码即可为的应用程序添加强大的身份验证功能。</li>
<li><strong>它得到维护：</strong> Microsoft 会积极维护和更新 MSAL，以应对新的安全威胁和平台变化。</li>
</ul>
<p>MSAL 支持多种语言和应用程序框架，包括 .NET、JavaScript/TypeScript、Python、Java、Go 以及 iOS 和 Android 等移动平台。这意味着可以在整个技术栈中使用相同的一致身份验证模式。</p>
<h2 id="使用-entra-id-保护的-mcp-服务器分步指南" style="position:relative;"><a href="#%E4%BD%BF%E7%94%A8-entra-id-%E4%BF%9D%E6%8A%A4%E7%9A%84-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%88%86%E6%AD%A5%E6%8C%87%E5%8D%97" aria-label="使用 entra id 保护的 mcp 服务器分步指南 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>使用 Entra ID 保护的 MCP 服务器：分步指南</strong></h2>
<h3 id="场景-1保护本地-mcp-服务器使用公共客户端" style="position:relative;"><a href="#%E5%9C%BA%E6%99%AF-1%E4%BF%9D%E6%8A%A4%E6%9C%AC%E5%9C%B0-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BD%BF%E7%94%A8%E5%85%AC%E5%85%B1%E5%AE%A2%E6%88%B7%E7%AB%AF" aria-label="场景 1保护本地 mcp 服务器使用公共客户端 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>场景 1：保护本地 MCP 服务器（使用公共客户端）</strong></h3>
<p>在此场景中，我们将研究一个在本地运行、通过 <code class="language-text">stdio</code> 通信并使用 Entra ID 在允许访问其工具之前对用户进行身份验证的 MCP 服务器。该服务器将有一个工具，用于从 Microsoft Graph API 获取用户的个人资料信息。</p>
<h3 id="1-在-entra-id-中设置应用程序" style="position:relative;"><a href="#1-%E5%9C%A8-entra-id-%E4%B8%AD%E8%AE%BE%E7%BD%AE%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F" aria-label="1 在 entra id 中设置应用程序 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>1. 在 Entra ID 中设置应用程序</strong></h3>
<p>在编写任何代码之前，需要在 Microsoft Entra ID 中注册的应用程序。这会告知 Entra ID 的应用程序，并授予其使用身份验证服务的权限。</p>
<ol>
<li>导航到 <a href="https://entra.microsoft.com/"><strong>Microsoft Entra 门户</strong></a>。</li>
<li>转到<strong>应用注册</strong>并单击<strong>新建注册</strong>。</li>
<li>为的应用程序命名（例如，“我的本地 MCP 服务器”）。</li>
<li>对于<strong>支持的帐户类型</strong>，选择<strong>仅限此组织目录中的帐户</strong>。</li>
<li>对于此示例，可以将<strong>重定向 URI</strong> 留空。</li>
<li>单击<strong>注册</strong>。</li>
</ol>
<p>注册后，记下<strong>应用程序（客户端）ID</strong> 和<strong>目录（租户）ID</strong>。将在代码中需要它们。</p>
<h3 id="2-代码分解" style="position:relative;"><a href="#2-%E4%BB%A3%E7%A0%81%E5%88%86%E8%A7%A3" aria-label="2 代码分解 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>2. 代码：分解</strong></h3>
<p>让我们看一下处理身份验证的代码的关键部分。此示例的完整代码可在 <a href="https://github.com/Azure-Samples/mcp-auth-servers">mcp-auth-servers GitHub 存储库</a> 的 <a href="https://github.com/Azure-Samples/mcp-auth-servers/tree/main/src/entra-id-local-wam">Entra ID - Local - WAM</a> 文件夹中找到。</p>
<p><strong><code class="language-text">AuthenticationService.cs</code></strong></p>
<p>此类负责处理与 Entra ID 的交互。</p>
<ul>
<li><strong><code class="language-text">CreateAsync</code></strong>：此方法从 MSAL（Microsoft 身份验证库）初始化 <code class="language-text">PublicClientApplication</code>。它使用的应用程序的 <code class="language-text">clientId</code> 和 <code class="language-text">tenantId</code> 进行配置。</li>
<li><strong><code class="language-text">WithBroker</code></strong>：这启用了代理（如 Windows Web 帐户管理器）的使用，从而提供了更安全、更无缝的单点登录体验。</li>
<li><strong><code class="language-text">AcquireTokenAsync</code></strong>：这是核心方法。它首先尝试以静默方式获取令牌（这意味着如果用户已经有有效的会话，则无需再次登录）。如果无法获取静默令牌，它将提示用户以交互方式登录。</li>
</ul>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token comment">// 为清晰起见进行了简化public static async Task&lt;AuthenticationService> CreateAsync(ILogger&lt;AuthenticationService> logger)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> msalClient <span class="token operator">=</span> PublicClientApplicationBuilder
        <span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>_clientId<span class="token punctuation">)</span><span class="token comment">// 的应用程序（客户端）ID</span>
        <span class="token punctuation">.</span><span class="token function">WithAuthority</span><span class="token punctuation">(</span>AadAuthorityAudience<span class="token punctuation">.</span>AzureAdMyOrg<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">WithTenantId</span><span class="token punctuation">(</span>_tenantId<span class="token punctuation">)</span><span class="token comment">// 的目录（租户）ID</span>
        <span class="token punctuation">.</span><span class="token function">WithBroker</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">BrokerOptions</span><span class="token punctuation">(</span>BrokerOptions<span class="token punctuation">.</span>OperatingSystems<span class="token punctuation">.</span>Windows<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ... 缓存注册 ...return new AuthenticationService(logger, msalClient);</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">></span></span> <span class="token function">AcquireTokenAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">try</span>
    <span class="token punctuation">{</span>
<span class="token comment">// 首先尝试静默身份验证var accounts = await _msalClient.GetAccountsAsync();</span>
        <span class="token class-name"><span class="token keyword">var</span></span> account <span class="token operator">=</span> accounts<span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">AuthenticationResult<span class="token punctuation">?</span></span> result <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>account <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            result <span class="token operator">=</span> <span class="token keyword">await</span> _msalClient<span class="token punctuation">.</span><span class="token function">AcquireTokenSilent</span><span class="token punctuation">(</span>_scopes<span class="token punctuation">,</span> account<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ExecuteAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
<span class="token comment">// 如果没有帐户，或者静默失败，则进行交互式操作</span>
            result <span class="token operator">=</span> <span class="token keyword">await</span> _msalClient<span class="token punctuation">.</span><span class="token function">AcquireTokenInteractive</span><span class="token punctuation">(</span>_scopes<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ExecuteAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> result<span class="token punctuation">.</span>AccessToken<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _logger<span class="token punctuation">.</span><span class="token function">LogError</span><span class="token punctuation">(</span>ex<span class="token punctuation">,</span> <span class="token string">"获取令牌时发生错误。"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">throw</span><span class="token punctuation">;</span><span class="token comment">// 可选择重新抛出异常以进行更高级别的处理</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p><strong><code class="language-text">Program.cs</code></strong></p>
<p>这是设置 MCP 服务器并集成身份验证服务的地方。</p>
<ul>
<li><strong><code class="language-text">AddSingleton&lt;AuthenticationService></code></strong>：这将 <code class="language-text">AuthenticationService</code> 注册到依赖注入容器中，以便应用程序的其他部分（如我们的工具）可以使用它。</li>
<li><strong><code class="language-text">GetUserDetailsFromGraph</code> 工具</strong>：此工具需要 <code class="language-text">AuthenticationService</code> 的实例。在执行任何操作之前，它会调用 <code class="language-text">authService.AcquireTokenAsync()</code> 来获取有效的访问令牌。如果身份验证成功，它将使用该令牌调用 Microsoft Graph API 并获取用户的详细信息。</li>
</ul>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token comment">// 为清晰起见进行了简化</span>
<span class="token punctuation">[</span><span class="token function">McpServerTool</span><span class="token punctuation">(</span>Name <span class="token operator">=</span> <span class="token string">"GetUserDetailsFromGraph"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">></span></span> <span class="token function">GetUserDetailsFromGraph</span><span class="token punctuation">(</span>
    <span class="token class-name">AuthenticationService</span> authService<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">try</span>
    <span class="token punctuation">{</span>
<span class="token comment">// 这将触发身份验证流程var accessToken = await authService.AcquireTokenAsync();</span>

<span class="token comment">// 使用令牌创建 GraphServiceClientvar graphClient = new GraphServiceClient(</span>
            <span class="token keyword">new</span> <span class="token constructor-invocation class-name">BaseBearerTokenAuthenticationProvider</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">TokenProvider</span><span class="token punctuation">(</span>authService<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name"><span class="token keyword">var</span></span> user <span class="token operator">=</span> <span class="token keyword">await</span> graphClient<span class="token punctuation">.</span>Me<span class="token punctuation">.</span><span class="token function">GetAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> System<span class="token punctuation">.</span>Text<span class="token punctuation">.</span>Json<span class="token punctuation">.</span>JsonSerializer<span class="token punctuation">.</span><span class="token function">Serialize</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token interpolation-string"><span class="token string">$"错误：</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">ex<span class="token punctuation">.</span>Message</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h3 id="3-它们如何协同工作" style="position:relative;"><a href="#3-%E5%AE%83%E4%BB%AC%E5%A6%82%E4%BD%95%E5%8D%8F%E5%90%8C%E5%B7%A5%E4%BD%9C" aria-label="3 它们如何协同工作 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>3. 它们如何协同工作</strong></h3>
<ol>
<li>当 MCP 客户端尝试使用 <code class="language-text">GetUserDetailsFromGraph</code> 工具时，该工具首先调用 <code class="language-text">AcquireTokenAsync</code>。</li>
<li><code class="language-text">AcquireTokenAsync</code> 触发 MSAL 库检查有效令牌。</li>
<li>如果未找到令牌，MSAL 将通过代理提示用户使用其 Entra ID 帐户登录。</li>
<li>用户登录后，Entra ID 会颁发一个访问令牌。</li>
<li>该工具接收令牌并使用它对 Microsoft Graph API 进行安全调用。</li>
<li>用户的详细信息将返回给 MCP 客户端。</li>
</ol>
<p>此过程可确保只有经过身份验证的用户才能使用该工具，从而有效地保护的本地 MCP 服务器。</p>
<h3 id="场景-2保护远程-mcp-服务器使用机密客户端" style="position:relative;"><a href="#%E5%9C%BA%E6%99%AF-2%E4%BF%9D%E6%8A%A4%E8%BF%9C%E7%A8%8B-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BD%BF%E7%94%A8%E6%9C%BA%E5%AF%86%E5%AE%A2%E6%88%B7%E7%AB%AF" aria-label="场景 2保护远程 mcp 服务器使用机密客户端 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>场景 2：保护远程 MCP 服务器（使用机密客户端）</strong></h3>
<p>当的 MCP 服务器在远程计算机（如云服务器）上运行并通过 HTTP Streaming 等协议进行通信时，安全要求会有所不同。在这种情况下，应该使用<strong>机密客户端</strong>和<strong>授权码流</strong>。这是一种更安全的方法，因为应用程序的机密永远不会暴露给浏览器。</p>
<p>此示例使用基于 TypeScript 的 MCP 服务器，该服务器使用 Express.js 处理 HTTP 请求。</p>
<h3 id="1-在-entra-id-中设置应用程序-1" style="position:relative;"><a href="#1-%E5%9C%A8-entra-id-%E4%B8%AD%E8%AE%BE%E7%BD%AE%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F-1" aria-label="1 在 entra id 中设置应用程序 1 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>1. 在 Entra ID 中设置应用程序</strong></h3>
<p>在 Entra ID 中的设置与公共客户端类似，但有一个关键区别：需要创建一个<strong>客户端密码</strong>。</p>
<ol>
<li>导航到 <a href="https://entra.microsoft.com/"><strong>Microsoft Entra 门户</strong></a>。</li>
<li>在的应用注册中，转到<strong>证书和密码</strong>选项卡。</li>
<li>单击<strong>新建客户端密码</strong>，为其指定描述，然后单击<strong>添加</strong>。</li>
<li><strong>重要提示：</strong> 立即复制密码值。将无法再次看到它。</li>
<li>还需要配置一个<strong>重定向 URI</strong>。转到<strong>身份验证</strong>选项卡，单击<strong>添加平台</strong>，选择 <strong>Web</strong>，然后输入的应用程序的重定向 URI（例如，<code class="language-text">http://localhost:3001/auth/callback</code>）。</li>
</ol>
<blockquote>
<p>⚠️ 重要安全说明： 对于生产应用程序，Microsoft 强烈建议使用无密码身份验证方法，例如托管标识或工作负载标识联合，而不是客户端密码。客户端密码会带来安全风险，因为它们可能会被暴露或泄露。托管标识通过消除在代码或配置中存储凭据的需要，提供了一种更安全的方法。</p>
<p>有关托管标识以及如何实现它们的更多信息，请参阅 <a href="https://learn.microsoft.com/entra/identity/managed-identities-azure-resources/overview">Azure 资源的托管标识概述</a>。</p>
</blockquote>
<h3 id="2-代码分解-1" style="position:relative;"><a href="#2-%E4%BB%A3%E7%A0%81%E5%88%86%E8%A7%A3-1" aria-label="2 代码分解 1 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>2. 代码：分解</strong></h3>
<p>此示例使用基于会话的方法。当用户进行身份验证时，服务器会将访问令牌和刷新令牌存储在会话中，并向用户提供一个会话令牌。然后，此会话令牌将用于后续请求。此示例的完整代码可在 <a href="https://github.com/Azure-Samples/mcp-auth-servers">mcp-auth-servers GitHub 存储库</a> 的 <a href="https://github.com/Azure-Samples/mcp-auth-servers/tree/main/src/entra-id-cca-session">Entra ID - Confidential client</a> 文件夹中找到。</p>
<p><strong><code class="language-text">Server.ts</code></strong></p>
<p>此文件设置 Express 服务器和 MCP 传输层。</p>
<ul>
<li><strong><code class="language-text">requireBearerAuth</code></strong>：这是一个中间件，用于保护 <code class="language-text">/sse</code> 和 <code class="language-text">/message</code> 端点。它会检查请求的 <code class="language-text">Authorization</code> 标头中是否存在有效的持有者令牌。</li>
<li><strong><code class="language-text">EntraIdServerAuthProvider</code></strong>：这是一个自定义类，实现了 <code class="language-text">McpServerAuthorizationProvider</code> 接口。它负责处理 OAuth 2.0 流程。</li>
<li><strong><code class="language-text">/auth/callback</code></strong>：此端点处理用户进行身份验证后从 Entra ID 的重定向。它将授权码交换为访问令牌和刷新令牌。</li>
</ul>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// 为清晰起见进行了简化const app = express();</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> server <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> provider <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EntraIdServerAuthProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 保护 SSE 端点</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/sse"</span><span class="token punctuation">,</span> <span class="token function">requireBearerAuth</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  provider<span class="token punctuation">,</span>
  requiredScopes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"User.Read"</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="token comment">// ... 连接到传输 ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 保护消息端点</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/message"</span><span class="token punctuation">,</span> <span class="token function">requireBearerAuth</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  provider<span class="token punctuation">,</span>
  requiredScopes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"User.Read"</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="token comment">// ... 处理消息 ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 处理 OAuth 2.0 回调</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/auth/callback"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  provider<span class="token punctuation">.</span><span class="token function">handleCallback</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>code<span class="token punctuation">,</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>state<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>result <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="token comment">// ... 处理成功或失败 ...</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p><strong><code class="language-text">Tools.ts</code></strong></p>
<p>此文件定义了 MCP 服务器提供的工具。<code class="language-text">getUserDetails</code> 工具与前一个示例中的工具类似，但它从会话中获取访问令牌。</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// 为清晰起见进行了简化</span>
server<span class="token punctuation">.</span><span class="token function">setRequestHandler</span><span class="token punctuation">(</span>CallToolRequestSchema<span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>request<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>params<span class="token punctuation">;</span>
  <span class="token keyword">const</span> context <span class="token operator">=</span> request<span class="token punctuation">.</span>params<span class="token operator">?.</span>context <span class="token keyword">as</span> <span class="token punctuation">{</span> token<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> sessionToken <span class="token operator">=</span> context<span class="token operator">?.</span>token<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">===</span> ToolName<span class="token punctuation">.</span><span class="token constant">GET_USER_DETAILS</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>sessionToken<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AuthenticationError</span><span class="token punctuation">(</span><span class="token string">"身份验证令牌丢失或无效。请确保在请求上下文中提供了令牌。"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token comment">// 从会话存储中获取 Entra ID 令牌const tokenData = tokenStore.getToken(sessionToken);</span>
    <span class="token keyword">const</span> entraIdToken <span class="token operator">=</span> tokenData<span class="token punctuation">.</span>accessToken<span class="token punctuation">;</span>

    <span class="token keyword">const</span> graphClient <span class="token operator">=</span> Client<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token function-variable function">authProvider</span><span class="token operator">:</span> <span class="token punctuation">(</span>done<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> entraIdToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> graphClient<span class="token punctuation">.</span><span class="token function">api</span><span class="token punctuation">(</span><span class="token string">'/me'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ... 返回用户详细信息 ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p><strong><code class="language-text">auth/EntraIdServerAuthProvider.ts</code></strong></p>
<p>此类处理以下逻辑：</p>
<ul>
<li>将用户重定向到 Entra ID 登录页面。</li>
<li>将授权码交换为访问令牌。</li>
<li>将令牌存储在 <code class="language-text">tokenStore</code> 中。</li>
<li>在访问令牌过期时刷新它。</li>
</ul>
<h3 id="3-它们如何协同工作-1" style="position:relative;"><a href="#3-%E5%AE%83%E4%BB%AC%E5%A6%82%E4%BD%95%E5%8D%8F%E5%90%8C%E5%B7%A5%E4%BD%9C-1" aria-label="3 它们如何协同工作 1 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>3. 它们如何协同工作</strong></h3>
<ol>
<li>当用户首次尝试连接到 MCP 服务器时，<code class="language-text">requireBearerAuth</code> 中间件将看到他们没有有效的会话，并将他们重定向到 Entra ID 登录页面。</li>
<li>用户使用其 Entra ID 帐户登录。</li>
<li>Entra ID 将用户重定向回带有授权码的 <code class="language-text">/auth/callback</code> 端点。</li>
<li>服务器将代码交换为访问令牌和刷新令牌，存储它们，并创建一个发送给客户端的会话令牌。</li>
<li>客户端现在可以在所有未来对 MCP 服务器的请求的 <code class="language-text">Authorization</code> 标头中使用此会话令牌。</li>
<li>当调用 <code class="language-text">getUserDetails</code> 工具时，它使用会话令牌查找 Entra ID 访问令牌，然后使用该令牌调用 Microsoft Graph API。</li>
</ol>
<p>此流程比公共客户端流程更复杂，但是面向互联网的端点所必需的。由于远程 MCP 服务器可通过公共互联网访问，因此它们需要更强的安全措施来防止未经授权的访问和潜在的攻击。</p>
<h3 id="安全最佳实践" style="position:relative;"><a href="#%E5%AE%89%E5%85%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5" aria-label="安全最佳实践 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>安全最佳实践</strong></h3>
<ul>
<li><strong>始终使用 HTTPS</strong>：加密客户端和服务器之间的通信，以防止令牌被拦截。</li>
<li><strong>实施基于角色的访问控制 (RBAC)</strong>：不要只检查用户<em>是否</em>经过身份验证；还要检查他们有权<em>做什么</em>。可以在 Entra ID 中定义角色，并在的 MCP 服务器中检查它们。</li>
<li><strong>监控和审计</strong>：记录所有身份验证事件，以便可以检测并响应可疑活动。</li>
<li><strong>处理速率限制和节流</strong>：Microsoft Graph 和其他 API 会实施速率限制以防止滥用。在的 MCP 服务器中实施指数退避和重试逻辑，以优雅地处理 HTTP 429（请求过多）响应。考虑缓存频繁访问的数据以减少 API 调用。</li>
<li><strong>安全令牌存储</strong>：安全地存储访问令牌和刷新令牌。对于本地应用程序，请使用系统的安全存储机制。对于服务器应用程序，请考虑使用加密存储或 Azure Key Vault 等安全密钥管理服务。</li>
<li><strong>令牌过期处理</strong>：访问令牌的生命周期有限。使用刷新令牌实施自动令牌刷新，以维持无缝的用户体验，而无需重新进行身份验证。</li>
<li><strong>考虑使用 Azure API 管理</strong>：虽然直接在的 MCP 服务器中实施安全性可以为提供精细的控制，但像 Azure API 管理这样的 API 网关可以自动处理许多这些安全问题，包括身份验证、授权、速率限制和监控。它们提供了一个位于的客户端和 MCP 服务器之间的集中式安全层。有关将 API 网关与 MCP 结合使用的更多详细信息，请参阅我们的 <a href="https://techcommunity.microsoft.com/blog/integrationsonazureblog/azure-api-management-your-auth-gateway-for-mcp-servers/4402690">Azure API 管理：的 MCP 服务器的身份验证网关</a>。</li>
</ul>
<h2 id="azure-ai-foundry-代理集成" style="position:relative;"><a href="#azure-ai-foundry-%E4%BB%A3%E7%90%86%E9%9B%86%E6%88%90" aria-label="azure ai foundry 代理集成 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Azure AI Foundry 代理集成</h2>
<h3 id="什么是模型上下文协议-mcp" style="position:relative;"><a href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%A8%A1%E5%9E%8B%E4%B8%8A%E4%B8%8B%E6%96%87%E5%8D%8F%E8%AE%AE-mcp" aria-label="什么是模型上下文协议 mcp permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>什么是模型上下文协议 (MCP)？</strong></h3>
<p>模型上下文协议是 AI 应用程序连接到外部数据源和工具的标准化方式。主要优势包括：</p>
<ul>
<li><strong>标准化集成</strong>：跨不同工具和服务的一致接口</li>
<li><strong>安全性</strong>：安全身份验证和授权机制</li>
<li><strong>灵活性</strong>：支持各种数据源、API 和自定义工具</li>
<li><strong>可扩展性</strong>：易于添加新功能和集成</li>
</ul>
<h3 id="使用-azure-ai-foundry-设置-mcp" style="position:relative;"><a href="#%E4%BD%BF%E7%94%A8-azure-ai-foundry-%E8%AE%BE%E7%BD%AE-mcp" aria-label="使用 azure ai foundry 设置 mcp permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>使用 Azure AI Foundry 设置 MCP</strong></h3>
<h3 id="1-环境配置" style="position:relative;"><a href="#1-%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE" aria-label="1 环境配置 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>1. 环境配置</strong></h3>
<p>首先，设置的环境变量和依赖项：</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span> time
<span class="token keyword">import</span> json
<span class="token keyword">from</span> azure<span class="token punctuation">.</span>ai<span class="token punctuation">.</span>agents<span class="token punctuation">.</span>models <span class="token keyword">import</span> MessageTextContent<span class="token punctuation">,</span> ListSortOrder
<span class="token keyword">from</span> azure<span class="token punctuation">.</span>ai<span class="token punctuation">.</span>projects <span class="token keyword">import</span> AIProjectClient
<span class="token keyword">from</span> azure<span class="token punctuation">.</span>identity <span class="token keyword">import</span> DefaultAzureCredential

<span class="token comment">### 1. 初始化 AI 项目客户端</span>

```python
project_client <span class="token operator">=</span> AIProjectClient<span class="token punctuation">(</span>
    endpoint<span class="token operator">=</span><span class="token string">"https://your-project-endpoint.services.ai.azure.com/api/projects/your-project"</span><span class="token punctuation">,</span>
    credential<span class="token operator">=</span>DefaultAzureCredential<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
</code></pre></div>
<h3 id="2-创建具有-mcp-工具的代理" style="position:relative;"><a href="#2-%E5%88%9B%E5%BB%BA%E5%85%B7%E6%9C%89-mcp-%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BB%A3%E7%90%86" aria-label="2 创建具有 mcp 工具的代理 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>2. 创建具有 MCP 工具的代理</strong></h3>
<p>配置具有 MCP 服务器集成的代理：</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">with</span> project_client<span class="token punctuation">:</span>
    agent <span class="token operator">=</span> project_client<span class="token punctuation">.</span>agents<span class="token punctuation">.</span>create_agent<span class="token punctuation">(</span>
        model<span class="token operator">=</span><span class="token string">"gpt-4.1-nano"</span><span class="token punctuation">,</span>
        name<span class="token operator">=</span><span class="token string">"mcp_agent"</span><span class="token punctuation">,</span>
        instructions<span class="token operator">=</span><span class="token string">"是一个乐于助人的助手。使用提供的工具来回答问题。请务必引用的来源。"</span><span class="token punctuation">,</span>
        tools<span class="token operator">=</span><span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"mcp"</span><span class="token punctuation">,</span>
                <span class="token string">"server_label"</span><span class="token punctuation">:</span> <span class="token string">"microsoft_docs"</span><span class="token punctuation">,</span>
                <span class="token string">"server_url"</span><span class="token punctuation">:</span> <span class="token string">"https://learn.microsoft.com/api/mcp"</span><span class="token punctuation">,</span>
                <span class="token string">"require_approval"</span><span class="token punctuation">:</span> <span class="token string">"never"</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        tool_resources<span class="token operator">=</span><span class="token boolean">None</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"已创建代理，代理 ID：</span><span class="token interpolation"><span class="token punctuation">{</span>agent<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
</code></pre></div>
<h3 id="mcp-工具配置选项" style="position:relative;"><a href="#mcp-%E5%B7%A5%E5%85%B7%E9%85%8D%E7%BD%AE%E9%80%89%E9%A1%B9" aria-label="mcp 工具配置选项 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>MCP 工具配置选项</strong></h3>
<p>在为的代理配置 MCP 工具时，可以指定几个重要参数：</p>
<h3 id="配置" style="position:relative;"><a href="#%E9%85%8D%E7%BD%AE" aria-label="配置 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>配置</strong></h3>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">mcp_tool <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"mcp"</span><span class="token punctuation">,</span>
    <span class="token string">"server_label"</span><span class="token punctuation">:</span> <span class="token string">"unique_server_name"</span><span class="token punctuation">,</span><span class="token comment"># MCP 服务器的标识符"server_url": "https://api.example.com/mcp",# MCP 服务器端点"require_approval": "never"# 批准策略：目前仅支持 "never"</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h3 id="完整示例使用-microsoft-learn-mcp-服务器" style="position:relative;"><a href="#%E5%AE%8C%E6%95%B4%E7%A4%BA%E4%BE%8B%E4%BD%BF%E7%94%A8-microsoft-learn-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8" aria-label="完整示例使用 microsoft learn mcp 服务器 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>完整示例：使用 Microsoft Learn MCP 服务器</strong></h3>
<p>这是一个完整的示例，演示了如何创建具有 MCP 集成的代理并处理对话：</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">import</span> time
<span class="token keyword">import</span> json
<span class="token keyword">import</span> os
<span class="token keyword">from</span> azure<span class="token punctuation">.</span>ai<span class="token punctuation">.</span>agents<span class="token punctuation">.</span>models <span class="token keyword">import</span> MessageTextContent<span class="token punctuation">,</span> ListSortOrder
<span class="token keyword">from</span> azure<span class="token punctuation">.</span>ai<span class="token punctuation">.</span>projects <span class="token keyword">import</span> AIProjectClient
<span class="token keyword">from</span> azure<span class="token punctuation">.</span>identity <span class="token keyword">import</span> DefaultAzureCredential

<span class="token keyword">def</span> <span class="token function">create_mcp_agent_example</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    project_client <span class="token operator">=</span> AIProjectClient<span class="token punctuation">(</span>
        endpoint<span class="token operator">=</span><span class="token string">"https://your-endpoint.services.ai.azure.com/api/projects/your-project"</span><span class="token punctuation">,</span>
        credential<span class="token operator">=</span>DefaultAzureCredential<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>

    <span class="token keyword">with</span> project_client<span class="token punctuation">:</span>
<span class="token comment"># 创建具有 MCP 工具的代理</span>
        agent <span class="token operator">=</span> project_client<span class="token punctuation">.</span>agents<span class="token punctuation">.</span>create_agent<span class="token punctuation">(</span>
            model<span class="token operator">=</span><span class="token string">"gpt-4.1-nano"</span><span class="token punctuation">,</span>
            name<span class="token operator">=</span><span class="token string">"documentation_assistant"</span><span class="token punctuation">,</span>
            instructions<span class="token operator">=</span><span class="token string">"是一个专门研究 Microsoft 文档的乐于助人的助手。使用 Microsoft Learn MCP 服务器搜索准确、最新的信息。始终引用的来源。"</span><span class="token punctuation">,</span>
            tools<span class="token operator">=</span><span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"mcp"</span><span class="token punctuation">,</span>
                    <span class="token string">"server_label"</span><span class="token punctuation">:</span> <span class="token string">"mslearn"</span><span class="token punctuation">,</span>
                    <span class="token string">"server_url"</span><span class="token punctuation">:</span> <span class="token string">"https://learn.microsoft.com/api/mcp"</span><span class="token punctuation">,</span>
                    <span class="token string">"require_approval"</span><span class="token punctuation">:</span> <span class="token string">"never"</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            tool_resources<span class="token operator">=</span><span class="token boolean">None</span>
        <span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"已创建代理，代理 ID：</span><span class="token interpolation"><span class="token punctuation">{</span>agent<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 创建对话线程</span>
        thread <span class="token operator">=</span> project_client<span class="token punctuation">.</span>agents<span class="token punctuation">.</span>threads<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"已创建线程，线程 ID：</span><span class="token interpolation"><span class="token punctuation">{</span>thread<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 发送消息</span>
        message <span class="token operator">=</span> project_client<span class="token punctuation">.</span>agents<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
            thread_id<span class="token operator">=</span>thread<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span>
            role<span class="token operator">=</span><span class="token string">"user"</span><span class="token punctuation">,</span>
            content<span class="token operator">=</span><span class="token string">"什么是 .NET MAUI？它与 Xamarin.Forms 相比如何？"</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"已创建消息，消息 ID：</span><span class="token interpolation"><span class="token punctuation">{</span>message<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 运行代理</span>
        run <span class="token operator">=</span> project_client<span class="token punctuation">.</span>agents<span class="token punctuation">.</span>runs<span class="token punctuation">.</span>create<span class="token punctuation">(</span>thread_id<span class="token operator">=</span>thread<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span> agent_id<span class="token operator">=</span>agent<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span>

<span class="token comment"># 轮询完成情况while run.status in ["queued", "in_progress", "requires_action"]:</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            run <span class="token operator">=</span> project_client<span class="token punctuation">.</span>agents<span class="token punctuation">.</span>runs<span class="token punctuation">.</span>get<span class="token punctuation">(</span>thread_id<span class="token operator">=</span>thread<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span> run_id<span class="token operator">=</span>run<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"运行状态：</span><span class="token interpolation"><span class="token punctuation">{</span>run<span class="token punctuation">.</span>status<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 检查运行步骤和工具调用</span>
        run_steps <span class="token operator">=</span> project_client<span class="token punctuation">.</span>agents<span class="token punctuation">.</span>run_steps<span class="token punctuation">.</span><span class="token builtin">list</span><span class="token punctuation">(</span>thread_id<span class="token operator">=</span>thread<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span> run_id<span class="token operator">=</span>run<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> step <span class="token keyword">in</span> run_steps<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"运行步骤：</span><span class="token interpolation"><span class="token punctuation">{</span>step<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">}</span></span><span class="token string">，状态：</span><span class="token interpolation"><span class="token punctuation">{</span>step<span class="token punctuation">.</span>status<span class="token punctuation">}</span></span><span class="token string">，类型：</span><span class="token interpolation"><span class="token punctuation">{</span>step<span class="token punctuation">.</span><span class="token builtin">type</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> step<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> <span class="token string">"tool_calls"</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"工具调用详细信息："</span><span class="token punctuation">)</span>
                <span class="token keyword">for</span> tool_call <span class="token keyword">in</span> step<span class="token punctuation">.</span>step_details<span class="token punctuation">.</span>tool_calls<span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>tool_call<span class="token punctuation">.</span>as_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 显示对话</span>
        messages <span class="token operator">=</span> project_client<span class="token punctuation">.</span>agents<span class="token punctuation">.</span>messages<span class="token punctuation">.</span><span class="token builtin">list</span><span class="token punctuation">(</span>thread_id<span class="token operator">=</span>thread<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span> order<span class="token operator">=</span>ListSortOrder<span class="token punctuation">.</span>ASCENDING<span class="token punctuation">)</span>
        <span class="token keyword">for</span> data_point <span class="token keyword">in</span> messages<span class="token punctuation">:</span>
            last_message_content <span class="token operator">=</span> data_point<span class="token punctuation">.</span>content<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
            <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>last_message_content<span class="token punctuation">,</span> MessageTextContent<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>data_point<span class="token punctuation">.</span>role<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>last_message_content<span class="token punctuation">.</span>text<span class="token punctuation">.</span>value<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> agent<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span> thread<span class="token punctuation">.</span><span class="token builtin">id</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    create_mcp_agent_example<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div>
<h3 id="解决常见问题" style="position:relative;"><a href="#%E8%A7%A3%E5%86%B3%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98" aria-label="解决常见问题 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>解决常见问题</strong></h3>
<h3 id="1-连接问题" style="position:relative;"><a href="#1-%E8%BF%9E%E6%8E%A5%E9%97%AE%E9%A2%98" aria-label="1 连接问题 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>1. 连接问题</strong></h3>
<ul>
<li>验证 MCP 服务器 URL 是否可访问</li>
<li>检查身份验证凭据</li>
<li>确保网络连接</li>
</ul>
<h3 id="2-工具调用失败" style="position:relative;"><a href="#2-%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8%E5%A4%B1%E8%B4%A5" aria-label="2 工具调用失败 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>2. 工具调用失败</strong></h3>
<ul>
<li>查看工具参数和格式</li>
<li>检查服务器特定要求</li>
<li>实现正确的错误处理</li>
</ul>
<h3 id="3-性能问题" style="position:relative;"><a href="#3-%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98" aria-label="3 性能问题 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>3. 性能问题</strong></h3>
<ul>
<li>优化工具调用频率</li>
<li>在适当的地方实现缓存</li>
<li>监控服务器响应时间</li>
</ul>
<h1 id="06-社区贡献" style="position:relative;"><a href="#06-%E7%A4%BE%E5%8C%BA%E8%B4%A1%E7%8C%AE" aria-label="06 社区贡献 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>06-社区贡献</strong></h1>
<h2 id="mcp-社区生态系统" style="position:relative;"><a href="#mcp-%E7%A4%BE%E5%8C%BA%E7%94%9F%E6%80%81%E7%B3%BB%E7%BB%9F" aria-label="mcp 社区生态系统 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>MCP 社区生态系统</strong></h2>
<p>MCP 生态系统由共同推进协议发展的各种组件和参与者组成。</p>
<h3 id="关键社区组件" style="position:relative;"><a href="#%E5%85%B3%E9%94%AE%E7%A4%BE%E5%8C%BA%E7%BB%84%E4%BB%B6" aria-label="关键社区组件 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>关键社区组件</strong></h3>
<ol>
<li><strong>核心协议维护者</strong>：维护核心 MCP 规范和参考实现的 Microsoft 和其他组织</li>
<li><strong>工具开发者</strong>：创建 MCP 工具的个人和团队</li>
<li><strong>集成提供商</strong>：将 MCP 集成到其产品和服务中的公司</li>
<li><strong>最终用户</strong>：在应用程序中使用 MCP 的开发者和组织</li>
<li><strong>贡献者</strong>：贡献代码、文档或其他资源的社区成员</li>
</ol>
<h3 id="社区资源" style="position:relative;"><a href="#%E7%A4%BE%E5%8C%BA%E8%B5%84%E6%BA%90" aria-label="社区资源 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>社区资源</strong></h3>
<h3 id="官方渠道" style="position:relative;"><a href="#%E5%AE%98%E6%96%B9%E6%B8%A0%E9%81%93" aria-label="官方渠道 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>官方渠道</strong></h3>
<ul>
<li><a href="https://github.com/modelcontextprotocol">MCP GitHub 仓库</a></li>
<li><a href="https://modelcontextprotocol.io/">MCP 文档</a></li>
<li><a href="https://spec.modelcontextprotocol.io/">MCP 规范</a></li>
<li><a href="https://github.com/orgs/modelcontextprotocol/discussions">GitHub 讨论区</a></li>
</ul>
<h3 id="社区驱动资源" style="position:relative;"><a href="#%E7%A4%BE%E5%8C%BA%E9%A9%B1%E5%8A%A8%E8%B5%84%E6%BA%90" aria-label="社区驱动资源 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>社区驱动资源</strong></h3>
<ul>
<li>特定语言 SDK 实现</li>
<li>服务器实现和工具库</li>
<li>博客文章和教程</li>
<li>社区论坛和社交媒体讨论</li>
</ul>
<h2 id="为-mcp-做贡献" style="position:relative;"><a href="#%E4%B8%BA-mcp-%E5%81%9A%E8%B4%A1%E7%8C%AE" aria-label="为 mcp 做贡献 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>为 MCP 做贡献</strong></h2>
<h3 id="贡献类型" style="position:relative;"><a href="#%E8%B4%A1%E7%8C%AE%E7%B1%BB%E5%9E%8B" aria-label="贡献类型 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>贡献类型</strong></h3>
<p>MCP 生态系统欢迎各种类型的贡献：</p>
<ol>
<li><strong>代码贡献</strong>：
<ul>
<li>核心协议增强</li>
<li>错误修复</li>
<li>工具实现</li>
<li>不同语言的客户端/服务器库</li>
</ul>
</li>
<li><strong>文档</strong>：
<ul>
<li>改进现有文档</li>
<li>创建教程和指南</li>
<li>翻译文档</li>
<li>创建示例和示例应用程序</li>
</ul>
</li>
<li><strong>社区支持</strong>：
<ul>
<li>在论坛上回答问题</li>
<li>测试和报告问题</li>
<li>组织社区活动</li>
<li>指导新贡献者</li>
</ul>
</li>
</ol>
<h3 id="贡献流程核心协议" style="position:relative;"><a href="#%E8%B4%A1%E7%8C%AE%E6%B5%81%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8D%8F%E8%AE%AE" aria-label="贡献流程核心协议 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>贡献流程：核心协议</strong></h3>
<p>要为核心 MCP 协议或官方实现做贡献：</p>
<h3 id="python-示例为标准库贡献新工具" style="position:relative;"><a href="#python-%E7%A4%BA%E4%BE%8B%E4%B8%BA%E6%A0%87%E5%87%86%E5%BA%93%E8%B4%A1%E7%8C%AE%E6%96%B0%E5%B7%A5%E5%85%B7" aria-label="python 示例为标准库贡献新工具 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>Python 示例：为标准库贡献新工具</strong></h3>
<ul>
<li>
<p>python</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment"># 示例贡献：用于 MCP 标准库的 CSV 数据处理工具</span>
<span class="token keyword">from</span> mcp_tools <span class="token keyword">import</span> Tool<span class="token punctuation">,</span> ToolRequest<span class="token punctuation">,</span> ToolResponse<span class="token punctuation">,</span> ToolExecutionException
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> io
<span class="token keyword">import</span> json
<span class="token keyword">from</span> typing <span class="token keyword">import</span> Dict<span class="token punctuation">,</span> Any<span class="token punctuation">,</span> List<span class="token punctuation">,</span> Optional

<span class="token keyword">class</span> <span class="token class-name">CsvProcessingTool</span><span class="token punctuation">(</span>Tool<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    用于处理和解析 CSV 数据的工具。

    此工具允许模型从 CSV 文件中提取信息，
    运行基本分析，并在不同格式之间转换数据。
    """</span>

    <span class="token keyword">def</span> <span class="token function">get_name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"csvProcessor"</span>

    <span class="token keyword">def</span> <span class="token function">get_description</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"处理和解析 CSV 数据"</span>

    <span class="token keyword">def</span> <span class="token function">get_schema</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
            <span class="token string">"properties"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                <span class="token string">"csvData"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                    <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
                    <span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"作为字符串的 CSV 数据"</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string">"csvUrl"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                    <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
                    <span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"CSV 文件的 URL（csvData 的替代方案）"</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string">"operation"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                    <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
                    <span class="token string">"enum"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"summary"</span><span class="token punctuation">,</span> <span class="token string">"filter"</span><span class="token punctuation">,</span> <span class="token string">"transform"</span><span class="token punctuation">,</span> <span class="token string">"convert"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"对 CSV 数据执行的操作"</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string">"filterColumn"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                    <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
                    <span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"要过滤的列（用于过滤操作）"</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string">"filterValue"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                    <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
                    <span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"要过滤的值（用于过滤操作）"</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string">"outputFormat"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                    <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
                    <span class="token string">"enum"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"json"</span><span class="token punctuation">,</span> <span class="token string">"csv"</span><span class="token punctuation">,</span> <span class="token string">"markdown"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token string">"default"</span><span class="token punctuation">:</span> <span class="token string">"json"</span><span class="token punctuation">,</span>
                    <span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"处理后数据的输出格式"</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">"oneOf"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span><span class="token string">"required"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"csvData"</span><span class="token punctuation">,</span> <span class="token string">"operation"</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span><span class="token string">"required"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"csvUrl"</span><span class="token punctuation">,</span> <span class="token string">"operation"</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>

    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">execute_async</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">:</span> ToolRequest<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> ToolResponse<span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
<span class="token comment"># 提取参数</span>
            operation <span class="token operator">=</span> request<span class="token punctuation">.</span>parameters<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"operation"</span><span class="token punctuation">)</span>
            output_format <span class="token operator">=</span> request<span class="token punctuation">.</span>parameters<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"outputFormat"</span><span class="token punctuation">,</span> <span class="token string">"json"</span><span class="token punctuation">)</span>

<span class="token comment"># 从直接数据或 URL 获取 CSV 数据</span>
            df <span class="token operator">=</span> <span class="token keyword">await</span> self<span class="token punctuation">.</span>_get_dataframe<span class="token punctuation">(</span>request<span class="token punctuation">)</span>

<span class="token comment"># 根据请求的操作进行处理</span>
            result <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

            <span class="token keyword">if</span> operation <span class="token operator">==</span> <span class="token string">"summary"</span><span class="token punctuation">:</span>
                result <span class="token operator">=</span> self<span class="token punctuation">.</span>_generate_summary<span class="token punctuation">(</span>df<span class="token punctuation">)</span>
            <span class="token keyword">elif</span> operation <span class="token operator">==</span> <span class="token string">"filter"</span><span class="token punctuation">:</span>
                column <span class="token operator">=</span> request<span class="token punctuation">.</span>parameters<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"filterColumn"</span><span class="token punctuation">)</span>
                value <span class="token operator">=</span> request<span class="token punctuation">.</span>parameters<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"filterValue"</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> column<span class="token punctuation">:</span>
                    <span class="token keyword">raise</span> ToolExecutionException<span class="token punctuation">(</span><span class="token string">"过滤操作需要 filterColumn"</span><span class="token punctuation">)</span>
                result <span class="token operator">=</span> self<span class="token punctuation">.</span>_filter_data<span class="token punctuation">(</span>df<span class="token punctuation">,</span> column<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
            <span class="token keyword">elif</span> operation <span class="token operator">==</span> <span class="token string">"transform"</span><span class="token punctuation">:</span>
                result <span class="token operator">=</span> self<span class="token punctuation">.</span>_transform_data<span class="token punctuation">(</span>df<span class="token punctuation">,</span> request<span class="token punctuation">.</span>parameters<span class="token punctuation">)</span>
            <span class="token keyword">elif</span> operation <span class="token operator">==</span> <span class="token string">"convert"</span><span class="token punctuation">:</span>
                result <span class="token operator">=</span> self<span class="token punctuation">.</span>_convert_format<span class="token punctuation">(</span>df<span class="token punctuation">,</span> output_format<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">raise</span> ToolExecutionException<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"未知操作: </span><span class="token interpolation"><span class="token punctuation">{</span>operation<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

            <span class="token keyword">return</span> ToolResponse<span class="token punctuation">(</span>result<span class="token operator">=</span>result<span class="token punctuation">)</span>

        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ToolExecutionException<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"CSV 处理失败: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">_get_dataframe</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">:</span> ToolRequest<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""从 CSV 数据或 URL 获取 pandas DataFrame"""</span>
        <span class="token keyword">if</span> <span class="token string">"csvData"</span> <span class="token keyword">in</span> request<span class="token punctuation">.</span>parameters<span class="token punctuation">:</span>
            csv_data <span class="token operator">=</span> request<span class="token punctuation">.</span>parameters<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"csvData"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>io<span class="token punctuation">.</span>StringIO<span class="token punctuation">(</span>csv_data<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> <span class="token string">"csvUrl"</span> <span class="token keyword">in</span> request<span class="token punctuation">.</span>parameters<span class="token punctuation">:</span>
            csv_url <span class="token operator">=</span> request<span class="token punctuation">.</span>parameters<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"csvUrl"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>csv_url<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ToolExecutionException<span class="token punctuation">(</span><span class="token string">"必须提供 csvData 或 csvUrl"</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">_generate_summary</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> df<span class="token punctuation">:</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Dict<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""生成 CSV 数据的摘要"""</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token string">"columns"</span><span class="token punctuation">:</span> df<span class="token punctuation">.</span>columns<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"rowCount"</span><span class="token punctuation">:</span> <span class="token builtin">len</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"columnCount"</span><span class="token punctuation">:</span> <span class="token builtin">len</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>columns<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"numericColumns"</span><span class="token punctuation">:</span> df<span class="token punctuation">.</span>select_dtypes<span class="token punctuation">(</span>include<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'number'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>columns<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"categoricalColumns"</span><span class="token punctuation">:</span> df<span class="token punctuation">.</span>select_dtypes<span class="token punctuation">(</span>include<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'object'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>columns<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"sampleRows"</span><span class="token punctuation">:</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to_json<span class="token punctuation">(</span>orient<span class="token operator">=</span><span class="token string">"records"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"statistics"</span><span class="token punctuation">:</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>df<span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to_json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">_filter_data</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> df<span class="token punctuation">:</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">,</span> column<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Dict<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""按列值过滤 DataFrame"""</span>
        <span class="token keyword">if</span> column <span class="token keyword">not</span> <span class="token keyword">in</span> df<span class="token punctuation">.</span>columns<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ToolExecutionException<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"未找到列 '</span><span class="token interpolation"><span class="token punctuation">{</span>column<span class="token punctuation">}</span></span><span class="token string">'"</span></span><span class="token punctuation">)</span>

        filtered_df <span class="token operator">=</span> df<span class="token punctuation">[</span>df<span class="token punctuation">[</span>column<span class="token punctuation">]</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>contains<span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">]</span>

        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token string">"originalRowCount"</span><span class="token punctuation">:</span> <span class="token builtin">len</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"filteredRowCount"</span><span class="token punctuation">:</span> <span class="token builtin">len</span><span class="token punctuation">(</span>filtered_df<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"data"</span><span class="token punctuation">:</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>filtered_df<span class="token punctuation">.</span>to_json<span class="token punctuation">(</span>orient<span class="token operator">=</span><span class="token string">"records"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">_transform_data</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> df<span class="token punctuation">:</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">,</span> params<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Dict<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""根据参数转换数据"""</span>
<span class="token comment"># 实现将包括各种转换return {</span>
            <span class="token string">"status"</span><span class="token punctuation">:</span> <span class="token string">"success"</span><span class="token punctuation">,</span>
            <span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string">"已应用转换"</span>
        <span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">_convert_format</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> df<span class="token punctuation">:</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Dict<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""将 DataFrame 转换为不同格式"""</span>
        <span class="token keyword">if</span> <span class="token builtin">format</span> <span class="token operator">==</span> <span class="token string">"json"</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                <span class="token string">"data"</span><span class="token punctuation">:</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>df<span class="token punctuation">.</span>to_json<span class="token punctuation">(</span>orient<span class="token operator">=</span><span class="token string">"records"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">"format"</span><span class="token punctuation">:</span> <span class="token string">"json"</span>
            <span class="token punctuation">}</span>
        <span class="token keyword">elif</span> <span class="token builtin">format</span> <span class="token operator">==</span> <span class="token string">"csv"</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                <span class="token string">"data"</span><span class="token punctuation">:</span> df<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">"format"</span><span class="token punctuation">:</span> <span class="token string">"csv"</span>
            <span class="token punctuation">}</span>
        <span class="token keyword">elif</span> <span class="token builtin">format</span> <span class="token operator">==</span> <span class="token string">"markdown"</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                <span class="token string">"data"</span><span class="token punctuation">:</span> df<span class="token punctuation">.</span>to_markdown<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">"format"</span><span class="token punctuation">:</span> <span class="token string">"markdown"</span>
            <span class="token punctuation">}</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ToolExecutionException<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"不支持的输出格式: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">format</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
</code></pre></div>
</li>
</ul>
<h3 id="贡献指南" style="position:relative;"><a href="#%E8%B4%A1%E7%8C%AE%E6%8C%87%E5%8D%97" aria-label="贡献指南 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>贡献指南</strong></h3>
<p>要成功为 MCP 项目做出贡献：</p>
<ol>
<li><strong>从小处着手</strong>：从文档、错误修复或小改进开始</li>
<li><strong>遵循风格指南</strong>：遵守项目的编码风格和约定</li>
<li><strong>编写测试</strong>：为代码贡献包含单元测试</li>
<li><strong>记录工作</strong>：为新功能或更改添加清晰的文档</li>
<li><strong>提交有针对性的 PR</strong>：保持拉取请求专注于单个问题或功能</li>
<li><strong>参与反馈</strong>：积极响应贡献反馈</li>
</ol>
<h3 id="示例贡献工作流" style="position:relative;"><a href="#%E7%A4%BA%E4%BE%8B%E8%B4%A1%E7%8C%AE%E5%B7%A5%E4%BD%9C%E6%B5%81" aria-label="示例贡献工作流 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>示例贡献工作流</strong></h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># 克隆仓库</span>
<span class="token function">git</span> clone https://github.com/microsoft/mcp-for-beginners.git
<span class="token builtin class-name">cd</span> mcp-for-beginners

<span class="token comment"># 为贡献创建新分支</span>
<span class="token function">git</span> checkout <span class="token parameter variable">-b</span> feature/my-contribution

<span class="token comment"># 进行更改# ...# 运行测试确保更改不会破坏现有功能</span>
dotnet <span class="token builtin class-name">test</span><span class="token comment"># .NET 项目</span>
mvn <span class="token builtin class-name">test</span><span class="token comment"># Java 项目</span>
pytest<span class="token comment"># Python 项目# 提交更改并附带描述性信息</span>
<span class="token function">git</span> commit <span class="token parameter variable">-am</span> <span class="token string">"在协议中添加对二进制数据流的支持"</span>

<span class="token comment"># 将分支推送到的 fork</span>
<span class="token function">git</span> push origin feature/my-contribution

<span class="token comment"># 从的分支到主仓库创建拉取请求# 然后根据需要参与反馈并迭代 PR</span></code></pre></div>
<h2 id="创建和分享自定义-mcp-工具" style="position:relative;"><a href="#%E5%88%9B%E5%BB%BA%E5%92%8C%E5%88%86%E4%BA%AB%E8%87%AA%E5%AE%9A%E4%B9%89-mcp-%E5%B7%A5%E5%85%B7" aria-label="创建和分享自定义 mcp 工具 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>创建和分享自定义 MCP 工具</strong></h2>
<p>为 MCP 生态系统做出贡献最有价值的方式之一是创建和分享自定义工具。</p>
<h3 id="开发可分享的工具" style="position:relative;"><a href="#%E5%BC%80%E5%8F%91%E5%8F%AF%E5%88%86%E4%BA%AB%E7%9A%84%E5%B7%A5%E5%85%B7" aria-label="开发可分享的工具 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>开发可分享的工具</strong></h3>
<h3 id="python-示例发布-pypi-包" style="position:relative;"><a href="#python-%E7%A4%BA%E4%BE%8B%E5%8F%91%E5%B8%83-pypi-%E5%8C%85" aria-label="python 示例发布 pypi 包 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>Python 示例：发布 PyPI 包</strong></h3>
<ul>
<li>
<p>python</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment"># PyPI 包的目录结构：# mcp_nlp_tools/# ├── LICENSE# ├── README.md# ├── setup.py# ├── mcp_nlp_tools/# │   ├── __init__.py# │   ├── sentiment_tool.py# │   └── translation_tool.py# 示例 setup.py"""</span>
<span class="token keyword">from</span> setuptools <span class="token keyword">import</span> setup<span class="token punctuation">,</span> find_packages

setup<span class="token punctuation">(</span>
    name<span class="token operator">=</span><span class="token string">"mcp_nlp_tools"</span><span class="token punctuation">,</span>
    version<span class="token operator">=</span><span class="token string">"0.1.0"</span><span class="token punctuation">,</span>
    packages<span class="token operator">=</span>find_packages<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    install_requires<span class="token operator">=</span><span class="token punctuation">[</span>
        <span class="token string">"mcp_server>=1.0.0"</span><span class="token punctuation">,</span>
        <span class="token string">"transformers>=4.0.0"</span><span class="token punctuation">,</span>
        <span class="token string">"torch>=1.8.0"</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    author<span class="token operator">=</span><span class="token string">"Your Name"</span><span class="token punctuation">,</span>
    author_email<span class="token operator">=</span><span class="token string">"your.email@example.com"</span><span class="token punctuation">,</span>
    description<span class="token operator">=</span><span class="token string">"用于自然语言处理任务的 MCP 工具"</span><span class="token punctuation">,</span>
    long_description<span class="token operator">=</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"README.md"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    long_description_content_type<span class="token operator">=</span><span class="token string">"text/markdown"</span><span class="token punctuation">,</span>
    url<span class="token operator">=</span><span class="token string">"极ttps://github.com/username/mcp_nlp_tools"</span><span class="token punctuation">,</span>
    classifiers<span class="token operator">=</span><span class="token punctuation">[</span>
        <span class="token string">"Programming Language :: Python :: 3"</span><span class="token punctuation">,</span>
        <span class="token string">"License :: OSI Approved :: MIT License"</span><span class="token punctuation">,</span>
        <span class="token string">"Operating System :: OS Independent"</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    python_requires<span class="token operator">=</span><span class="token string">">=3.8"</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""

# 示例 NLP 工具实现 (sentiment_tool.py)from mcp_tools import Tool, ToolRequest, ToolResponse, ToolExecutionException
from transformers import pipeline
import torch

class SentimentAnalysisTool(Tool):
    """</span>用于文本情感分析的 MCP 工具<span class="token string">""</span>"

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> model_name<span class="token operator">=</span><span class="token string">"distilbert-base-uncased-finetuned-sst-2-english"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token comment"># 加载情感分析模型</span>
        self<span class="token punctuation">.</span>sentiment_analyzer <span class="token operator">=</span> pipeline<span class="token punctuation">(</span><span class="token string">"sentiment-analysis"</span><span class="token punctuation">,</span> model<span class="token operator">=</span>model_name<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">get_name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"sentimentAnalysis"</span>

    <span class="token keyword">def</span> <span class="token function">get_description</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"分析文本情感，将其分类为积极或消极"</span>

    <span class="token keyword">def</span> <span class="token function">get_schema</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
            <span class="token string">"properties"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                <span class="token string">"text"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                    <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
                    <span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"要分析情感的文本"</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string">"includeScore"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                    <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"boolean"</span><span class="token punctuation">,</span>
                    <span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"是否包含置信度分数"</span><span class="token punctuation">,</span>
                    <span class="token string">"default"</span><span class="token punctuation">:</span> <span class="token boolean">True</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">"required"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"text"</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>

    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">execute_async</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">:</span> ToolRequest<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> ToolResponse<span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
<span class="token comment"># 提取参数</span>
            text <span class="token operator">=</span> request<span class="token punctuation">.</span>parameters<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"text"</span><span class="token punctuation">)</span>
            include_score <span class="token operator">=</span> request<span class="token punctuation">.</span>parameters<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"includeScore"</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment"># 分析情感</span>
            sentiment_result <span class="token operator">=</span> self<span class="token punctuation">.</span>sentiment_analyzer<span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

<span class="token comment"># 格式化结果</span>
            result <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">"sentiment"</span><span class="token punctuation">:</span> sentiment_result<span class="token punctuation">[</span><span class="token string">"label"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string">"text"</span><span class="token punctuation">:</span> text
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> include_score<span class="token punctuation">:</span>
                result<span class="token punctuation">[</span><span class="token string">"score"</span><span class="token punctuation">]</span> <span class="token operator">=</span> sentiment_result<span class="token punctuation">[</span><span class="token string">"score"</span><span class="token punctuation">]</span>

<span class="token comment"># 返回结果return ToolResponse(result=result)</span>

        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ToolExecutionException<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"情感分析失败: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 发布：# python setup.py sdist bdist_wheel# python -m twine upload dist/*</span></code></pre></div>
</li>
</ul>
<h3 id="分享最佳实践" style="position:relative;"><a href="#%E5%88%86%E4%BA%AB%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5" aria-label="分享最佳实践 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>分享最佳实践</strong></h3>
<p>与社区分享 MCP 工具时：</p>
<ol>
<li><strong>完整文档</strong>：
<ul>
<li>记录目的、使用方法和示例</li>
<li>解释参数和返回值</li>
<li>记录所有外部依赖项</li>
</ul>
</li>
<li><strong>错误处理</strong>：
<ul>
<li>实现健壮的错误处理</li>
<li>提供有用的错误信息</li>
<li>优雅地处理边缘情况</li>
</ul>
</li>
<li><strong>性能考虑</strong>：
<ul>
<li>优化速度和资源使用</li>
<li>适当时实施缓存</li>
<li>考虑可扩展性</li>
</ul>
</li>
<li><strong>安全性</strong>：
<ul>
<li>使用安全的 API 密钥和身份验证</li>
<li>验证和清理输入</li>
<li>为外部 API 调用实施速率限制</li>
</ul>
</li>
<li><strong>测试</strong>：
<ul>
<li>包含全面的测试覆盖</li>
<li>使用不同类型输入和边缘情况进行测试</li>
<li>记录测试过程</li>
</ul>
</li>
</ol>
<h2 id="社区协作与最佳实践" style="position:relative;"><a href="#%E7%A4%BE%E5%8C%BA%E5%8D%8F%E4%BD%9C%E4%B8%8E%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5" aria-label="社区协作与最佳实践 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>社区协作与最佳实践</strong></h2>
<p>有效的协作是蓬勃发展的 MCP 生态系统的关键。</p>
<h3 id="沟通渠道" style="position:relative;"><a href="#%E6%B2%9F%E9%80%9A%E6%B8%A0%E9%81%93" aria-label="沟通渠道 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>沟通渠道</strong></h3>
<ul>
<li>GitHub Issues 和 Discussions</li>
<li>Microsoft Tech Community</li>
<li>Discord 和 Slack 频道</li>
<li>Stack Overflow (标签: <code class="language-text">model-context-protocol</code> 或 <code class="language-text">mcp</code>)</li>
</ul>
<h3 id="代码审查" style="position:relative;"><a href="#%E4%BB%A3%E7%A0%81%E5%AE%A1%E6%9F%A5" aria-label="代码审查 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>代码审查</strong></h3>
<p>审查 MCP 贡献时：</p>
<ol>
<li><strong>清晰度</strong>：代码是否清晰且文档齐全？</li>
<li><strong>正确性</strong>：是否按预期工作？</li>
<li><strong>一致性</strong>：是否遵循项目约定？</li>
<li><strong>完整性</strong>：是否包含测试和文档？</li>
<li><strong>安全性</strong>：是否存在安全问题？</li>
</ol>
<h3 id="版本兼容性" style="position:relative;"><a href="#%E7%89%88%E6%9C%AC%E5%85%BC%E5%AE%B9%E6%80%A7" aria-label="版本兼容性 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>版本兼容性</strong></h3>
<p>为 MCP 开发时：</p>
<ol>
<li><strong>协议版本控制</strong>：遵守工具支持的 MCP 协议版本</li>
<li><strong>客户端兼容性</strong>：考虑向后兼容性</li>
<li><strong>服务器兼容性</strong>：遵循服务器实现指南</li>
<li><strong>破坏性变更</strong>：明确记录任何破坏性变更</li>
</ol>
<h2 id="示例社区项目mcp-工具注册表" style="position:relative;"><a href="#%E7%A4%BA%E4%BE%8B%E7%A4%BE%E5%8C%BA%E9%A1%B9%E7%9B%AEmcp-%E5%B7%A5%E5%85%B7%E6%B3%A8%E5%86%8C%E8%A1%A8" aria-label="示例社区项目mcp 工具注册表 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>示例社区项目：MCP 工具注册表</strong></h2>
<p>一个重要的社区贡献可能是开发 MCP 工具的公共注册表。</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment"># 社区工具注册表 API 的示例模式</span>
<span class="token keyword">from</span> fastapi <span class="token keyword">import</span> FastAPI<span class="token punctuation">,</span> HTTPException<span class="token punctuation">,</span> Depends
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> Field<span class="token punctuation">,</span> HttpUrl
<span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token punctuation">,</span> Optional
<span class="token keyword">import</span> datetime
<span class="token keyword">import</span> uuid

<span class="token comment"># 工具注册表的模型</span>
<span class="token keyword">class</span> <span class="token class-name">ToolSchema</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""工具的 JSON 模式"""</span>
    <span class="token builtin">type</span><span class="token punctuation">:</span> <span class="token builtin">str</span>
    properties<span class="token punctuation">:</span> <span class="token builtin">dict</span>
    required<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">class</span> <span class="token class-name">ToolRegistration</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""注册工具的信息"""</span>
    name<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> Field<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> description<span class="token operator">=</span><span class="token string">"工具的唯一名称"</span><span class="token punctuation">)</span>
    description<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> Field<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> description<span class="token operator">=</span><span class="token string">"工具功能的描述"</span><span class="token punctuation">)</span>
    version<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> Field<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> description<span class="token operator">=</span><span class="token string">"工具的语义版本"</span><span class="token punctuation">)</span>
    schema<span class="token punctuation">:</span> ToolSchema <span class="token operator">=</span> Field<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> description<span class="token operator">=</span><span class="token string">"工具参数的 JSON 模式"</span><span class="token punctuation">)</span>
    author<span class="token punctuation">:</span>极 <span class="token builtin">str</span> <span class="token operator">=</span> Field<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> description<span class="token operator">=</span><span class="token string">"工具作者"</span><span class="token punctuation">)</span>
    repository<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>HttpUrl<span class="token punctuation">]</span> <span class="token operator">=</span> Field<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> description<span class="token operator">=</span><span class="token string">"仓库 URL"</span><span class="token punctuation">)</span>
    documentation<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>HttpUrl<span class="token punctuation">]</span> <span class="token operator">=</span> Field<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> description<span class="token operator">=</span><span class="token string">"文档 URL"</span><span class="token punctuation">)</span>
    package<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>HttpUrl<span class="token punctuation">]</span> <span class="token operator">=</span> Field<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> description<span class="token operator">=</span><span class="token string">"包 URL"</span><span class="token punctuation">)</span>
    tags<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span> <span class="token operator">=</span> Field<span class="token punctuation">(</span>default_factory<span class="token operator">=</span><span class="token builtin">list</span><span class="token punctuation">,</span> description<span class="token operator">=</span><span class="token string">"用于分类的标签"</span><span class="token punctuation">)</span>
    examples<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">dict</span><span class="token punctuation">]</span> <span class="token operator">=</span> Field<span class="token punctuation">(</span>default_factory<span class="token operator">=</span><span class="token builtin">list</span><span class="token punctuation">,</span> description<span class="token operator">=</span><span class="token string">"使用示例"</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Tool</span><span class="token punctuation">(</span>ToolRegistration<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""带注册元数据的工具"""</span>
    <span class="token builtin">id</span><span class="token punctuation">:</span> uuid<span class="token punctuation">.</span>UUID <span class="token operator">=</span> Field<span class="token punctuation">(</span>default_factory<span class="token operator">=</span>uuid<span class="token punctuation">.</span>uuid4<span class="token punctuation">)</span>
    created_at<span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>datetime <span class="token operator">=</span> Field<span class="token punctuation">(</span>default_factory<span class="token operator">=</span>datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">)</span>
    updated_at<span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>datetime <span class="token operator">=</span> Field<span class="token punctuation">(</span>default_factory<span class="token operator">=</span>datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">)</span>
    downloads<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> Field<span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    rating<span class="token punctuation">:</span> <span class="token builtin">float</span> <span class="token operator">=</span> Field<span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">)</span>
    ratings_count<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> Field<span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment"># 注册表的 FastAPI 应用</span>
app <span class="token operator">=</span> FastAPI<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">"MCP 工具注册表"</span><span class="token punctuation">)</span>

<span class="token comment"># 此示例的内存数据库</span>
tools_db <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>post</span><span class="token punctuation">(</span><span class="token string">"/tools"</span><span class="token punctuation">,</span> response_model<span class="token operator">=</span>Tool<span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">register_tool</span><span class="token punctuation">(</span>tool<span class="token punctuation">:</span> ToolRegistration<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""在注册表中注册新工具"""</span>
    <span class="token keyword">if</span> tool<span class="token punctuation">.</span>name <span class="token keyword">in</span> tools_db<span class="token punctuation">:</span>
        <span class="token keyword">raise</span> HTTPException<span class="token punctuation">(</span>status_code<span class="token operator">=</span><span class="token number">400</span><span class="token punctuation">,</span> detail<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"工具 '</span><span class="token interpolation"><span class="token punctuation">{</span>tool<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">' 已存在"</span></span><span class="token punctuation">)</span>

    new_tool <span class="token operator">=</span> Tool<span class="token punctuation">(</span><span class="token operator">**</span>tool<span class="token punctuation">.</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    tools_db<span class="token punctuation">[</span>tool<span class="token punctuation">.</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> new_tool
    <span class="token keyword">return</span> new_tool

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/tools"</span><span class="token punctuation">,</span> response_model<span class="token operator">=</span>List<span class="token punctuation">[</span>Tool<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">list_tools</span><span class="token punctuation">(</span>tag<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""列出所有注册工具，可按标签过滤"""</span>
    <span class="token keyword">if</span> tag<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>tool <span class="token keyword">for</span> tool <span class="token keyword">in</span> tools_db<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> tag <span class="token keyword">in</span> tool<span class="token punctuation">.</span>tags<span class="token punctuation">]</span>
    <span class="token keyword">return</span> <span class="token builtin">list</span><span class="token punctuation">(</span>tools_db<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/tools/{tool_name}"</span><span class="token punctuation">,</span> response_model<span class="token operator">=</span>Tool<span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">get_tool</span><span class="token punctuation">(</span>tool_name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""获取特定工具的信息"""</span>
    <span class="token keyword">if</span> tool_name <span class="token keyword">not</span> <span class="token keyword">in</span> tools_db<span class="token punctuation">:</span>
        <span class="token keyword">raise</span> HTTPException<span class="token punctuation">(</span>status_code<span class="token operator">=</span><span class="token number">404</span><span class="token punctuation">,</span> detail<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"工具 '</span><span class="token interpolation"><span class="token punctuation">{</span>tool_name<span class="token punctuation">}</span></span><span class="token string">' 未找到"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> tools_db<span class="token punctuation">[</span>tool_name<span class="token punctuation">]</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>delete</span><span class="token punctuation">(</span><span class="token string">"/tools/{tool_name}"</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">delete_tool</span><span class="token punctuation">(</span>tool_name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""从注册表中删除工具"""</span>
    <span class="token keyword">if</span> tool_name <span class="token keyword">not</span> <span class="token keyword">in</span> tools_db<span class="token punctuation">:</span>
        <span class="token keyword">raise</span> HTTPException<span class="token punctuation">(</span>status_code<span class="token operator">=</span><span class="token number">404</span><span class="token punctuation">,</span> detail<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"工具 '</span><span class="token interpolation"><span class="token punctuation">{</span>tool_name<span class="token punctuation">}</span></span><span class="token string">' 未找到"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">del</span> tools_db<span class="token punctuation">[</span>tool_name<span class="token punctuation">]</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"工具 '</span><span class="token interpolation"><span class="token punctuation">{</span>tool_name<span class="token punctuation">}</span></span><span class="token string">' 已删除"</span></span><span class="token punctuation">}</span>
</code></pre></div>
<h2 id="关键要点-1" style="position:relative;"><a href="#%E5%85%B3%E9%94%AE%E8%A6%81%E7%82%B9-1" aria-label="关键要点 1 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>关键要点</strong></h2>
<ul>
<li>MCP 社区多元化，欢迎各种类型的贡献</li>
<li>为 MCP 做贡献的范围可以从核心协议增强到自定义工具</li>
<li>遵循贡献指南可提高 PR 被接受的机会</li>
<li>创建和分享 MCP 工具是增强生态系统的宝贵方式</li>
<li>社区协作对于 MCP 的发展和改进至关重要</li>
</ul>
<h1 id="07-早期采用经验分享" style="position:relative;"><a href="#07-%E6%97%A9%E6%9C%9F%E9%87%87%E7%94%A8%E7%BB%8F%E9%AA%8C%E5%88%86%E4%BA%AB" aria-label="07 早期采用经验分享 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>07-早期采用经验分享</strong></h1>
<h2 id="真实的-mcp-实施" style="position:relative;"><a href="#%E7%9C%9F%E5%AE%9E%E7%9A%84-mcp-%E5%AE%9E%E6%96%BD" aria-label="真实的 mcp 实施 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>真实的 MCP 实施</strong></h2>
<h3 id="案例研究-1企业客户支持自动化" style="position:relative;"><a href="#%E6%A1%88%E4%BE%8B%E7%A0%94%E7%A9%B6-1%E4%BC%81%E4%B8%9A%E5%AE%A2%E6%88%B7%E6%94%AF%E6%8C%81%E8%87%AA%E5%8A%A8%E5%8C%96" aria-label="案例研究 1企业客户支持自动化 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>案例研究 1：企业客户支持自动化</strong></h3>
<p>一家跨国公司实施了基于 MCP 的解决方案，以标准化其客户支持系统中的 AI 交互。这使他们能够：</p>
<ul>
<li>为多个 LLM 提供商创建统一的界面</li>
<li>在各部门之间保持一致的提示管理</li>
<li>实施强大的安全和合规性控制</li>
<li>根据特定需求轻松在不同的 AI 模型之间切换</li>
</ul>
<p><strong>技术实现：</strong></p>
<ul>
<li>
<p>python</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment"># 用于客户支持的 Python MCP 服务器实现</span>
<span class="token keyword">import</span> logging
<span class="token keyword">import</span> asyncio
<span class="token keyword">from</span> modelcontextprotocol <span class="token keyword">import</span> create_server<span class="token punctuation">,</span> ServerConfig
<span class="token keyword">from</span> modelcontextprotocol<span class="token punctuation">.</span>server <span class="token keyword">import</span> MCPServer
<span class="token keyword">from</span> modelcontextprotocol<span class="token punctuation">.</span>transports <span class="token keyword">import</span> create_http_transport
<span class="token keyword">from</span> modelcontextprotocol<span class="token punctuation">.</span>resources <span class="token keyword">import</span> ResourceDefinition
<span class="token keyword">from</span> modelcontextprotocol<span class="token punctuation">.</span>prompts <span class="token keyword">import</span> PromptDefinition
<span class="token keyword">from</span> modelcontextprotocol<span class="token punctuation">.</span>tool <span class="token keyword">import</span> ToolDefinition

<span class="token comment"># 配置日志记录</span>
logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span>level<span class="token operator">=</span>logging<span class="token punctuation">.</span>INFO<span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 创建服务器配置</span>
    config <span class="token operator">=</span> ServerConfig<span class="token punctuation">(</span>
        name<span class="token operator">=</span><span class="token string">"Enterprise Customer Support Server"</span><span class="token punctuation">,</span>
        version<span class="token operator">=</span><span class="token string">"1.0.0"</span><span class="token punctuation">,</span>
        description<span class="token operator">=</span><span class="token string">"MCP server for handling customer support inquiries"</span>
    <span class="token punctuation">)</span>

    <span class="token comment"># 初始化 MCP 服务器</span>
    server <span class="token operator">=</span> create_server<span class="token punctuation">(</span>config<span class="token punctuation">)</span>

<span class="token comment"># 注册知识库资源</span>
    server<span class="token punctuation">.</span>resources<span class="token punctuation">.</span>register<span class="token punctuation">(</span>
        ResourceDefinition<span class="token punctuation">(</span>
            name<span class="token operator">=</span><span class="token string">"customer_kb"</span><span class="token punctuation">,</span>
            description<span class="token operator">=</span><span class="token string">"Customer knowledge base documentation"</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">lambda</span> params<span class="token punctuation">:</span> get_customer_documentation<span class="token punctuation">(</span>params<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>

<span class="token comment"># 注册提示模板</span>
    server<span class="token punctuation">.</span>prompts<span class="token punctuation">.</span>register<span class="token punctuation">(</span>
        PromptDefinition<span class="token punctuation">(</span>
            name<span class="token operator">=</span><span class="token string">"support_template"</span><span class="token punctuation">,</span>
            description<span class="token operator">=</span><span class="token string">"Templates for customer support responses"</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">lambda</span> params<span class="token punctuation">:</span> get_support_templates<span class="token punctuation">(</span>params<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>

		<span class="token comment"># 注册支持工具</span>
    server<span class="token punctuation">.</span>tools<span class="token punctuation">.</span>register<span class="token punctuation">(</span>
        ToolDefinition<span class="token punctuation">(</span>
            name<span class="token operator">=</span><span class="token string">"ticketing"</span><span class="token punctuation">,</span>
            description<span class="token operator">=</span><span class="token string">"Create and update support tickets"</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        handle_ticketing_operations
    <span class="token punctuation">)</span>

		<span class="token comment"># 使用 HTTP 传输启动服务器</span>
    transport <span class="token operator">=</span> create_http_transport<span class="token punctuation">(</span>port<span class="token operator">=</span><span class="token number">8080</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> server<span class="token punctuation">.</span>run<span class="token punctuation">(</span>transport<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div>
</li>
</ul>
<p><strong>结果：</strong> 模型成本降低 30%，响应一致性提高 45%，全球运营的合规性得到增强。</p>
<h3 id="案例研究-2医疗保健诊断助手" style="position:relative;"><a href="#%E6%A1%88%E4%BE%8B%E7%A0%94%E7%A9%B6-2%E5%8C%BB%E7%96%97%E4%BF%9D%E5%81%A5%E8%AF%8A%E6%96%AD%E5%8A%A9%E6%89%8B" aria-label="案例研究 2医疗保健诊断助手 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>案例研究 2：医疗保健诊断助手</strong></h3>
<p>一家医疗保健提供商开发了 MCP 基础设施，以集成多个专门的医疗 AI 模型，同时确保敏感的患者数据得到保护：</p>
<ul>
<li>在通用和专科医疗模型之间无缝切换</li>
<li>严格的隐私控制和审计跟踪</li>
<li>与现有的电子健康记录 (EHR) 系统集成</li>
<li>针对医学术语的一致提示工程</li>
</ul>
<p><strong>技术实现：</strong></p>
<ul>
<li>
<p>c#</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token comment">// C# MCP 主机应用程序在医疗保健应用程序中的实现</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>DependencyInjection</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">ModelContextProtocol<span class="token punctuation">.</span>SDK<span class="token punctuation">.</span>Client</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">ModelContextProtocol<span class="token punctuation">.</span>SDK<span class="token punctuation">.</span>Security</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">ModelContextProtocol<span class="token punctuation">.</span>SDK<span class="token punctuation">.</span>Resources</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DiagnosticAssistant</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">MCPHostClient</span> _mcpClient<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">PatientContext</span> _patientContext<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">DiagnosticAssistant</span><span class="token punctuation">(</span><span class="token class-name">PatientContext</span> patientContext<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _patientContext <span class="token operator">=</span> patientContext<span class="token punctuation">;</span>

<span class="token comment">// 使用特定于医疗保健的设置配置 MCP 客户端var clientOptions = new ClientOptions</span>
        <span class="token punctuation">{</span>
            Name <span class="token operator">=</span> <span class="token string">"Healthcare Diagnostic Assistant"</span><span class="token punctuation">,</span>
            Version <span class="token operator">=</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>
            Security <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SecurityOptions</span>
            <span class="token punctuation">{</span>
                Encryption <span class="token operator">=</span> EncryptionLevel<span class="token punctuation">.</span>Medical<span class="token punctuation">,</span>
                AuditEnabled <span class="token operator">=</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        _mcpClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MCPHostClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">WithOptions</span><span class="token punctuation">(</span>clientOptions<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">WithTransport</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">HttpTransport</span><span class="token punctuation">(</span><span class="token string">"https://healthcare-mcp.example.org"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">WithAuthentication</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">HIPAACompliantAuthProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>DiagnosticSuggestion<span class="token punctuation">></span></span> <span class="token function">GetDiagnosticAssistance</span><span class="token punctuation">(</span>
        <span class="token class-name"><span class="token keyword">string</span></span> symptoms<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> patientHistory<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
				<span class="token comment">// 使用适当的资源和工具访问权限创建请求var resourceRequest = new ResourceRequest</span>
        <span class="token punctuation">{</span>
            Name <span class="token operator">=</span> <span class="token string">"patient_records"</span><span class="token punctuation">,</span>
            Parameters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">object</span><span class="token punctuation">></span></span>
            <span class="token punctuation">{</span>
                <span class="token punctuation">[</span><span class="token string">"patientId"</span><span class="token punctuation">]</span> <span class="token operator">=</span> _patientContext<span class="token punctuation">.</span>PatientId<span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token string">"requestingProvider"</span><span class="token punctuation">]</span> <span class="token operator">=</span> _patientContext<span class="token punctuation">.</span>ProviderId
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

						<span class="token comment">// 使用适当的提示请求诊断帮助var response = await _mcpClient.SendPromptRequestAsync(</span>
            promptName<span class="token punctuation">:</span> <span class="token string">"diagnostic_assistance"</span><span class="token punctuation">,</span>
            <span class="token named-parameter punctuation">parameters</span><span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">object</span><span class="token punctuation">></span></span>
            <span class="token punctuation">{</span>
                <span class="token punctuation">[</span><span class="token string">"symptoms"</span><span class="token punctuation">]</span> <span class="token operator">=</span> symptoms<span class="token punctuation">,</span>
                patientHistory <span class="token operator">=</span> patientHistory<span class="token punctuation">,</span>
                relevantGuidelines <span class="token operator">=</span> _patientContext<span class="token punctuation">.</span><span class="token function">GetRelevantGuidelines</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> DiagnosticSuggestion<span class="token punctuation">.</span><span class="token function">FromMCPResponse</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
</li>
</ul>
<p><strong>结果：</strong> 改进了对医生的诊断建议，同时保持了完全的 HIPAA 合规性，并显着减少了系统之间的上下文切换。</p>
<h3 id="案例研究-3金融服务风险分析" style="position:relative;"><a href="#%E6%A1%88%E4%BE%8B%E7%A0%94%E7%A9%B6-3%E9%87%91%E8%9E%8D%E6%9C%8D%E5%8A%A1%E9%A3%8E%E9%99%A9%E5%88%86%E6%9E%90" aria-label="案例研究 3金融服务风险分析 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>案例研究 3：金融服务风险分析</strong></h3>
<p>一家金融机构实施了 MCP，以标准化其不同部门的风险分析流程：</p>
<ul>
<li>为信用风险、欺诈检测和投资风险模型创建了统一的界面</li>
<li>实施了严格的访问控制和模型版本控制</li>
<li>确保了所有 AI 建议的可审计性</li>
<li>在不同系统之间保持一致的数据格式</li>
</ul>
<p><strong>技术实现：</strong></p>
<ul>
<li>
<p>java</p>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token comment">// 用于金融风险评估的 Java MCP 服务器import org.mcp.server.*;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>mcp<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FinancialRiskMCPServer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">// 创建具有金融合规功能的 MCP 服务器MCPServer server = new MCPServerBuilder()</span>
            <span class="token punctuation">.</span><span class="token function">withModelProviders</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token class-name">ModelProvider</span><span class="token punctuation">(</span><span class="token string">"risk-assessment-primary"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">AzureOpenAIProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">ModelProvider</span><span class="token punctuation">(</span><span class="token string">"risk-assessment-audit"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LocalLlamaProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">withPromptTemplateDirectory</span><span class="token punctuation">(</span><span class="token string">"./compliance/templates"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">withAccessControls</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SOCCompliantAccessControl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">withDataEncryption</span><span class="token punctuation">(</span><span class="token class-name">EncryptionStandard</span><span class="token punctuation">.</span><span class="token constant">FINANCIAL_GRADE</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">withVersionControl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">withAuditLogging</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DatabaseAuditLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        server<span class="token punctuation">.</span><span class="token function">addRequestValidator</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FinancialDataValidator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        server<span class="token punctuation">.</span><span class="token function">addResponseFilter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PII_RedactionFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        server<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token number">9000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Financial Risk MCP Server running on port 9000"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
</li>
</ul>
<p><strong>结果：</strong> 增强了法规遵从性，模型部署周期加快了 40%，并提高了各部门风险评估的一致性。</p>
<h3 id="案例研究-4用于浏览器自动化的-microsoft-playwright-mcp-服务器" style="position:relative;"><a href="#%E6%A1%88%E4%BE%8B%E7%A0%94%E7%A9%B6-4%E7%94%A8%E4%BA%8E%E6%B5%8F%E8%A7%88%E5%99%A8%E8%87%AA%E5%8A%A8%E5%8C%96%E7%9A%84-microsoft-playwright-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8" aria-label="案例研究 4用于浏览器自动化的 microsoft playwright mcp 服务器 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>案例研究 4：用于浏览器自动化的 Microsoft Playwright MCP 服务器</strong></h3>
<p>微软开发了 <a href="https://github.com/microsoft/playwright-mcp">Playwright MCP 服务器</a>，以通过模型上下文协议实现安全、标准化的浏览器自动化。该解决方案允许 AI 代理和 LLM 以受控、可审计和可扩展的方式与 Web 浏览器交互，从而支持自动化 Web 测试、数据提取和端到端工作流等用例。</p>
<ul>
<li>将浏览器自动化功能（导航、表单填写、屏幕截图捕获等）公开为 MCP 工具</li>
<li>实施严格的访问控制和沙盒机制，以防止未经授权的操作</li>
<li>为所有浏览器交互提供详细的审计日志</li>
<li>支持与 Azure OpenAI 和其他 LLM 提供商集成，以实现代理驱动的自动化</li>
</ul>
<p><strong>技术实现：</strong></p>
<ul>
<li>
<p>node</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// TypeScript：在 MCP 服务器中注册 Playwright 浏览器自动化工具import { createServer, ToolDefinition } from 'modelcontextprotocol';</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> launch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'playwright'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'Playwright MCP Server'</span><span class="token punctuation">,</span>
  version<span class="token operator">:</span> <span class="token string">'1.0.0'</span><span class="token punctuation">,</span>
  description<span class="token operator">:</span> <span class="token string">'MCP server for browser automation using Playwright'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 注册一个用于导航到 URL 并捕获屏幕截图的工具</span>
server<span class="token punctuation">.</span>tools<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>
  <span class="token keyword">new</span> <span class="token class-name">ToolDefinition</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'navigate_and_screenshot'</span><span class="token punctuation">,</span>
    description<span class="token operator">:</span> <span class="token string">'Navigate to a URL and capture a screenshot'</span><span class="token punctuation">,</span>
    parameters<span class="token operator">:</span> <span class="token punctuation">{</span>
      url<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span> description<span class="token operator">:</span> <span class="token string">'The URL to visit'</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> url <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> screenshot <span class="token operator">=</span> <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">screenshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> screenshot <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 启动 MCP 服务器</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
</li>
</ul>
<p><strong>结果：</strong></p>
<ul>
<li>为 AI 代理和 LLM 启用了安全、程序化的浏览器自动化</li>
<li>减少了手动测试工作量，提高了 Web 应用程序的测试覆盖率</li>
<li>为企业环境中基于浏览器的工具集成提供了可重用、可扩展的框架</li>
</ul>
<p><strong>参考资料：</strong></p>
<ul>
<li><a href="https://github.com/microsoft/playwright-mcp">Playwright MCP 服务器 GitHub 存储库</a></li>
<li><a href="https://azure.microsoft.com/en-us/products/ai-services/">Microsoft AI 和自动化解决方案</a></li>
</ul>
<h3 id="案例研究-5azure-mcp--企业级模型上下文协议即服务" style="position:relative;"><a href="#%E6%A1%88%E4%BE%8B%E7%A0%94%E7%A9%B6-5azure-mcp--%E4%BC%81%E4%B8%9A%E7%BA%A7%E6%A8%A1%E5%9E%8B%E4%B8%8A%E4%B8%8B%E6%96%87%E5%8D%8F%E8%AE%AE%E5%8D%B3%E6%9C%8D%E5%8A%A1" aria-label="案例研究 5azure mcp  企业级模型上下文协议即服务 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>案例研究 5：Azure MCP – 企业级模型上下文协议即服务</strong></h3>
<p>Azure MCP (<a href="https://aka.ms/azmcp">https://aka.ms/azmcp</a>) 是微软托管的企业级模型上下文协议实现，旨在作为云服务提供可扩展、安全和合规的 MCP 服务器功能。Azure MCP 使组织能够快速部署、管理 MCP 服务器并将其与 Azure AI、数据和安全服务集成，从而减少运营开销并加速 AI 的采用。</p>
<ul>
<li>完全托管的 MCP 服务器托管，具有内置的扩展、监控和安全性</li>
<li>与 Azure OpenAI、Azure AI 搜索和其他 Azure 服务的本机集成</li>
<li>通过 Microsoft Entra ID 进行企业身份验证和授权</li>
<li>支持自定义工具、提示模板和资源连接器</li>
<li>符合企业安全和法规要求</li>
</ul>
<p><strong>技术实现：</strong></p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token comment"># 示例：Azure MCP 服务器部署配置 (YAML)</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> mcp.microsoft.com/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> McpServer
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> enterprise<span class="token punctuation">-</span>mcp<span class="token punctuation">-</span>server
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">modelProviders</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> azure<span class="token punctuation">-</span>openai
      <span class="token key atrule">type</span><span class="token punctuation">:</span> AzureOpenAI
      <span class="token key atrule">endpoint</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//&lt;your<span class="token punctuation">-</span>openai<span class="token punctuation">-</span>resource<span class="token punctuation">></span>.openai.azure.com/
      <span class="token key atrule">apiKeySecret</span><span class="token punctuation">:</span> &lt;your<span class="token punctuation">-</span>azure<span class="token punctuation">-</span>keyvault<span class="token punctuation">-</span>secret<span class="token punctuation">></span>
  <span class="token key atrule">tools</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> document_search
      <span class="token key atrule">type</span><span class="token punctuation">:</span> AzureAISearch
      <span class="token key atrule">endpoint</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//&lt;your<span class="token punctuation">-</span>search<span class="token punctuation">-</span>resource<span class="token punctuation">></span>.search.windows.net/
      <span class="token key atrule">apiKeySecret</span><span class="token punctuation">:</span> &lt;your<span class="token punctuation">-</span>azure<span class="token punctuation">-</span>keyvault<span class="token punctuation">-</span>secret<span class="token punctuation">></span>
  <span class="token key atrule">authentication</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> EntraID
    <span class="token key atrule">tenantId</span><span class="token punctuation">:</span> &lt;your<span class="token punctuation">-</span>tenant<span class="token punctuation">-</span>id<span class="token punctuation">></span>
  <span class="token key atrule">monitoring</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">logAnalyticsWorkspace</span><span class="token punctuation">:</span> &lt;your<span class="token punctuation">-</span>log<span class="token punctuation">-</span>analytics<span class="token punctuation">-</span>id<span class="token punctuation">></span>
</code></pre></div>
<p><strong>结果：</strong></p>
<ul>
<li>通过提供即用型、合规的 MCP 服务器平台，缩短了企业 AI 项目的价值实现时间</li>
<li>简化了 LLM、工具和企业数据源的集成</li>
<li>增强了 MCP 工作负载的安全性、可观察性和运营效率</li>
</ul>
<p><strong>参考资料：</strong></p>
<ul>
<li><a href="https://aka.ms/azmcp">Azure MCP 文档</a></li>
<li><a href="https://azure.microsoft.com/en-us/products/ai-services/">Azure AI 服务</a></li>
</ul>
<h3 id="案例研究-6nlweb" style="position:relative;"><a href="#%E6%A1%88%E4%BE%8B%E7%A0%94%E7%A9%B6-6nlweb" aria-label="案例研究 6nlweb permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>案例研究 6：NLWeb</strong></h3>
<p>MCP（模型上下文协议）是一种新兴协议，用于聊天机器人和 AI 助手与工具进行交互。每个 NLWeb 实例也是一个 MCP 服务器，它支持一个核心方法 ask，用于以自然语言向网站提问。返回的响应利用 schema.org，这是一个广泛用于描述 Web 数据的词汇表。不严格地说，MCP 之于 NLWeb 就像 Http 之于 HTML。NLWeb 结合了协议、Schema.org 格式和示例代码，以帮助网站快速创建这些端点，通过对话界面使人类受益，并通过自然的代理到代理交互使机器受益。</p>
<p>NLWeb 有两个不同的组件。</p>
<ul>
<li>一种协议，最初非常简单，用于以自然语言与网站交互，以及一种利用 json 和 schema.org 获取返回答案的格式。有关 REST API 的更多详细信息，请参阅文档。</li>
<li>(1) 的一个简单实现，它利用现有标记，适用于可以抽象为项目列表（产品、食谱、景点、评论等）的网站。结合一组用户界面小部件，网站可以轻松地为其内容提供对话界面。有关其工作原理的更多详细信息，请参阅有关聊天查询生命周期的文档。</li>
</ul>
<p><strong>参考资料：</strong></p>
<ul>
<li><a href="https://aka.ms/azmcp">Azure MCP 文档</a></li>
<li><a href="https://github.com/microsoft/NlWeb">NLWeb</a></li>
</ul>
<h3 id="案例研究-7用于-foundry-的-mcp--集成-azure-ai-代理" style="position:relative;"><a href="#%E6%A1%88%E4%BE%8B%E7%A0%94%E7%A9%B6-7%E7%94%A8%E4%BA%8E-foundry-%E7%9A%84-mcp--%E9%9B%86%E6%88%90-azure-ai-%E4%BB%A3%E7%90%86" aria-label="案例研究 7用于 foundry 的 mcp  集成 azure ai 代理 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>案例研究 7：用于 Foundry 的 MCP – 集成 Azure AI 代理</strong></h3>
<p>Azure AI Foundry MCP 服务器演示了如何使用 MCP 在企业环境中编排和管理 AI 代理和工作流。通过将 MCP 与 Azure AI Foundry 集成，组织可以标准化代理交互，利用 Foundry 的工作流管理，并确保安全、可扩展的部署。这种方法可以实现快速原型设计、强大的监控以及与 Azure AI 服务的无缝集成，从而支持知识管理和代理评估等高级方案。开发人员可以从用于构建、部署和监控代理管道的统一界面中受益，而 IT 团队则可以获得更高的安全性、合规性和运营效率。该解决方案非常适合寻求加速 AI 采用并保持对复杂代理驱动流程控制的企业。</p>
<p><strong>参考资料：</strong></p>
<ul>
<li><a href="https://github.com/azure-ai-foundry/mcp-foundry">MCP Foundry GitHub 存储库</a></li>
<li><a href="https://devblogs.microsoft.com/foundry/integrating-azure-ai-agents-mcp/">将 Azure AI 代理与 MCP 集成 (Microsoft Foundry 博客)</a></li>
</ul>
<h3 id="案例研究-8foundry-mcp-playground--实验和原型设计" style="position:relative;"><a href="#%E6%A1%88%E4%BE%8B%E7%A0%94%E7%A9%B6-8foundry-mcp-playground--%E5%AE%9E%E9%AA%8C%E5%92%8C%E5%8E%9F%E5%9E%8B%E8%AE%BE%E8%AE%A1" aria-label="案例研究 8foundry mcp playground  实验和原型设计 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>案例研究 8：Foundry MCP Playground – 实验和原型设计</strong></h3>
<p>Foundry MCP Playground 提供了一个即用型环境，用于试验 MCP 服务器和 Azure AI Foundry 集成。开发人员可以使用 Azure AI Foundry 目录和实验室中的资源快速对 AI 模型和代理工作流进行原型设计、测试和评估。该 playground 简化了设置，提供了示例项目，并支持协作开发，从而可以轻松地以最少的开销探索最佳实践和新方案。对于希望验证想法、分享实验和加速学习而无需复杂基础设施的团队来说，它尤其有用。通过降低进入门槛，该 playground 有助于在 MCP 和 Azure AI Foundry 生态系统中促进创新和社区贡献。</p>
<p><strong>参考资料：</strong></p>
<ul>
<li><a href="https://github.com/azure-ai-foundry/foundry-mcp-playground">Foundry MCP Playground GitHub 存储库</a></li>
</ul>
<h3 id="案例研究-9-microsoft-docs-mcp-服务器---学习和技能提升" style="position:relative;"><a href="#%E6%A1%88%E4%BE%8B%E7%A0%94%E7%A9%B6-9-microsoft-docs-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8---%E5%AD%A6%E4%B9%A0%E5%92%8C%E6%8A%80%E8%83%BD%E6%8F%90%E5%8D%87" aria-label="案例研究 9 microsoft docs mcp 服务器   学习和技能提升 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>案例研究 9. Microsoft Docs MCP 服务器 - 学习和技能提升</strong></h3>
<p>Microsoft Docs MCP 服务器实现了模型上下文协议 (MCP) 服务器，该服务器为 AI 助手提供对 Microsoft 官方文档的实时访问。对 Microsoft 官方技术文档执行语义搜索。</p>
<p><strong>参考资料：</strong></p>
<ul>
<li><a href="https://github.com/MicrosoftDocs/mcp">Microsoft Learn Docs MCP 服务器</a></li>
</ul>
<h2 id="动手项目-todo" style="position:relative;"><a href="#%E5%8A%A8%E6%89%8B%E9%A1%B9%E7%9B%AE-todo" aria-label="动手项目 todo permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>动手项目 TODO</strong></h2>
<h3 id="项目-1构建一个多提供商-mcp-服务器" style="position:relative;"><a href="#%E9%A1%B9%E7%9B%AE-1%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%A4%9A%E6%8F%90%E4%BE%9B%E5%95%86-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8" aria-label="项目 1构建一个多提供商 mcp 服务器 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>项目 1：构建一个多提供商 MCP 服务器</strong></h3>
<p><strong>目标：</strong> 创建一个 MCP 服务器，该服务器可以根据特定标准将请求路由到多个 AI 模型提供商。</p>
<p><strong>要求：</strong></p>
<ul>
<li>支持至少三个不同的模型提供商（例如，OpenAI、Anthropic、本地模型）</li>
<li>根据请求元数据实施路由机制</li>
<li>创建用于管理提供商凭据的配置系统</li>
<li>添加缓存以优化性能和成本</li>
<li>构建一个用于监控使用情况的简单仪表板</li>
</ul>
<p><strong>实施步骤：</strong></p>
<ol>
<li>设置基本的 MCP 服务器基础设施</li>
<li>为每个 AI 模型服务实施提供商适配器</li>
<li>根据请求属性创建路由逻辑</li>
<li>为频繁请求添加缓存机制</li>
<li>开发监控仪表板</li>
<li>使用各种请求模式进行测试</li>
</ol>
<p><strong>技术：</strong> 根据的偏好选择 Python（.NET/Java/Python），使用 Redis 进行缓存，并使用一个简单的 Web 框架来构建仪表板。</p>
<h3 id="项目-2企业提示管理系统" style="position:relative;"><a href="#%E9%A1%B9%E7%9B%AE-2%E4%BC%81%E4%B8%9A%E6%8F%90%E7%A4%BA%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F" aria-label="项目 2企业提示管理系统 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>项目 2：企业提示管理系统</strong></h3>
<p><strong>目标：</strong> 开发一个基于 MCP 的系统，用于在整个组织内管理、版本控制和部署提示模板。</p>
<p><strong>要求：</strong></p>
<ul>
<li>创建一个用于提示模板的集中式存储库</li>
<li>实施版本控制和审批工作流</li>
<li>使用示例输入构建模板测试功能</li>
<li>开发基于角色的访问控制</li>
<li>创建用于模板检索和部署的 API</li>
</ul>
<p><strong>实施步骤：</strong></p>
<ol>
<li>设计用于模板存储的数据库模式</li>
<li>创建用于模板 CRUD 操作的核心 API</li>
<li>实施版本控制系统</li>
<li>构建审批工作流</li>
<li>开发测试框架</li>
<li>创建一个用于管理的简单 Web 界面</li>
<li>与 MCP 服务器集成</li>
</ol>
<p><strong>技术：</strong> 选择的后端框架、SQL 或 NoSQL 数据库，以及用于管理界面的前端框架。</p>
<h3 id="项目-3基于-mcp-的内容生成平台" style="position:relative;"><a href="#%E9%A1%B9%E7%9B%AE-3%E5%9F%BA%E4%BA%8E-mcp-%E7%9A%84%E5%86%85%E5%AE%B9%E7%94%9F%E6%88%90%E5%B9%B3%E5%8F%B0" aria-label="项目 3基于 mcp 的内容生成平台 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>项目 3：基于 MCP 的内容生成平台</strong></h3>
<p><strong>目标：</strong> 构建一个内容生成平台，该平台利用 MCP 在不同内容类型之间提供一致的结果。</p>
<p><strong>要求：</strong></p>
<ul>
<li>支持多种内容格式（博客文章、社交媒体、营销文案）</li>
<li>实施具有自定义选项的基于模板的生成</li>
<li>创建内容审查和反馈系统</li>
<li>跟踪内容性能指标</li>
<li>支持内容版本控制和迭代</li>
</ul>
<p><strong>实施步骤：</strong></p>
<ol>
<li>设置 MCP 客户端基础设施</li>
<li>为不同的内容类型创建模板</li>
<li>构建内容生成管道</li>
<li>实施审查系统</li>
<li>开发指标跟踪系统</li>
<li>创建用于模板管理和内容生成的用户界面</li>
</ol>
<p><strong>技术：</strong> 首选的编程语言、Web 框架和数据库系统。</p>
<h2 id="mcp-技术的未来方向" style="position:relative;"><a href="#mcp-%E6%8A%80%E6%9C%AF%E7%9A%84%E6%9C%AA%E6%9D%A5%E6%96%B9%E5%90%91" aria-label="mcp 技术的未来方向 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>MCP 技术的未来方向</strong></h2>
<h3 id="新兴趋势" style="position:relative;"><a href="#%E6%96%B0%E5%85%B4%E8%B6%8B%E5%8A%BF" aria-label="新兴趋势 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>新兴趋势</strong></h3>
<ol>
<li><strong>多模式 MCP</strong>
<ul>
<li>将 MCP 扩展到标准化与图像、音频和视频模型的交互</li>
<li>开发跨模式推理能力</li>
<li>针对不同模式的标准化提示格式</li>
</ul>
</li>
<li><strong>联合 MCP 基础设施</strong>
<ul>
<li>可以在组织之间共享资源的分布式 MCP 网络</li>
<li>用于安全模型共享的标准化协议</li>
<li>保护隐私的计算技术</li>
</ul>
</li>
<li><strong>MCP 市场</strong>
<ul>
<li>用于共享和货币化 MCP 模板和插件的生态系统</li>
<li>质量保证和认证流程</li>
<li>与模型市场集成</li>
</ul>
</li>
<li><strong>用于边缘计算的 MCP</strong>
<ul>
<li>针对资源受限的边缘设备调整 MCP 标准</li>
<li>针对低带宽环境优化的协议</li>
<li>针对物联网生态系统的专门 MCP 实现</li>
</ul>
</li>
<li><strong>监管框架</strong>
<ul>
<li>开发用于法规遵从性的 MCP 扩展</li>
<li>标准化的审计跟踪和可解释性接口</li>
<li>与新兴的 AI 治理框架集成</li>
</ul>
</li>
</ol>
<h3 id="来自微软的-mcp-解决方案" style="position:relative;"><a href="#%E6%9D%A5%E8%87%AA%E5%BE%AE%E8%BD%AF%E7%9A%84-mcp-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88" aria-label="来自微软的 mcp 解决方案 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>来自微软的 MCP 解决方案</strong></h3>
<p>微软和 Azure 开发了几个开源存储库，以帮助开发人员在各种场景中实施 MCP：</p>
<h3 id="微软组织" style="position:relative;"><a href="#%E5%BE%AE%E8%BD%AF%E7%BB%84%E7%BB%87" aria-label="微软组织 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>微软组织</strong></h3>
<ol>
<li><a href="https://github.com/microsoft/playwright-mcp">playwright-mcp</a> - 用于浏览器自动化和测试的 Playwright MCP 服务器</li>
<li><a href="https://github.com/microsoft/files-mcp-server">files-mcp-server</a> - 用于本地测试和社区贡献的 OneDrive MCP 服务器实现</li>
<li><a href="https://github.com/microsoft/NlWeb">NLWeb</a> - NLWeb 是一组开放协议和相关的开源工具。其主要重点是为 AI Web 建立一个基础层</li>
</ol>
<h3 id="azure-samples-组织" style="position:relative;"><a href="#azure-samples-%E7%BB%84%E7%BB%87" aria-label="azure samples 组织 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>Azure-Samples 组织</strong></h3>
<ol>
<li><a href="https://github.com/Azure-Samples/mcp">mcp</a> - 指向使用多种语言在 Azure 上构建和集成 MCP 服务器的示例、工具和资源的链接</li>
<li><a href="https://github.com/Azure-Samples/mcp-auth-servers">mcp-auth-servers</a> - 演示使用当前模型上下文协议规范进行身份验证的参考 MCP 服务器</li>
<li><a href="https://github.com/Azure-Samples/remote-mcp-functions">remote-mcp-functions</a> - Azure Functions 中远程 MCP 服务器实现的登陆页面，其中包含指向特定语言存储库的链接</li>
<li><a href="https://github.com/Azure-Samples/remote-mcp-functions-python">remote-mcp-functions-python</a> - 使用 Python 在 Azure Functions 中构建和部署自定义远程 MCP 服务器的快速入门模板</li>
<li><a href="https://github.com/Azure-Samples/remote-mcp-functions-dotnet">remote-mcp-functions-dotnet</a> - 使用 .NET/C# 在 Azure Functions 中构建和部署自定义远程 MCP 服务器的快速入门模板</li>
<li><a href="https://github.com/Azure-Samples/remote-mcp-functions-typescript">remote-mcp-functions-typescript</a> - 使用 TypeScript 在 Azure Functions 中构建和部署自定义远程 MCP 服务器的快速入门模板</li>
<li><a href="https://github.com/Azure-Samples/remote-mcp-apim-functions-python">remote-mcp-apim-functions-python</a> - 使用 Python 将 Azure API 管理作为 AI 网关连接到远程 MCP 服务器</li>
<li><a href="https://github.com/Azure-Samples/AI-Gateway">AI-Gateway</a> - APIM ❤️ AI 实验，包括 MCP 功能，与 Azure OpenAI 和 AI Foundry 集成</li>
</ol>
<p>这些存储库提供了用于在不同编程语言和 Azure 服务中使用模型上下文协议的各种实现、模板和资源。它们涵盖了从基本服务器实现到身份验证、云部署和企业集成场景的各种用例。</p>
<h3 id="mcp-资源目录" style="position:relative;"><a href="#mcp-%E8%B5%84%E6%BA%90%E7%9B%AE%E5%BD%95" aria-label="mcp 资源目录 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>MCP 资源目录</strong></h3>
<p>官方 Microsoft MCP 存储库中的 <a href="https://github.com/microsoft/mcp/tree/main/Resources">MCP 资源目录</a> 提供了一组精选的示例资源、提示模板和工具定义，可与模型上下文协议服务器一起使用。该目录旨在通过为以下方面提供可重用的构建块和最佳实践示例来帮助开发人员快速开始使用 MCP：</p>
<ul>
<li><strong>提示模板：</strong> 适用于常见 AI 任务和场景的即用型提示模板，可以针对自己的 MCP 服务器实现进行调整。</li>
<li><strong>工具定义：</strong> 示例工具模式和元数据，用于在不同 MCP 服务器之间标准化工具集成和调用。</li>
<li><strong>资源示例：</strong> 用于在 MCP 框架内连接到数据源、API 和外部服务的示例资源定义。</li>
<li><strong>参考实现：</strong> 演示如何在实际 MCP 项目中组织和安排资源、提示和工具的实用示例。</li>
</ul>
<p>这些资源可以加速开发，促进标准化，并有助于确保在构建和部署基于 MCP 的解决方案时遵循最佳实践。</p>
<h3 id="mcp-资源目录-1" style="position:relative;"><a href="#mcp-%E8%B5%84%E6%BA%90%E7%9B%AE%E5%BD%95-1" aria-label="mcp 资源目录 1 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>MCP 资源目录</strong></h3>
<ul>
<li><a href="https://github.com/microsoft/mcp/tree/main/Resources">MCP 资源（示例提示、工具和资源定义）</a></li>
</ul>
<h3 id="研究机会" style="position:relative;"><a href="#%E7%A0%94%E7%A9%B6%E6%9C%BA%E4%BC%9A" aria-label="研究机会 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>研究机会</strong></h3>
<ul>
<li>MCP 框架内的高效提示优化技术</li>
<li>多租户 MCP 部署的安全模型</li>
<li>不同 MCP 实现的性能基准测试</li>
<li>MCP 服务器的形式验证方法</li>
</ul>
<h2 id="其他资源" style="position:relative;"><a href="#%E5%85%B6%E4%BB%96%E8%B5%84%E6%BA%90" aria-label="其他资源 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>其他资源</strong></h2>
<ul>
<li><a href="https://github.com/azure-ai-foundry/mcp-foundry">MCP Foundry GitHub 存储库</a></li>
<li><a href="https://github.com/azure-ai-foundry/foundry-mcp-playground">Foundry MCP Playground</a></li>
<li><a href="https://devblogs.microsoft.com/foundry/integrating-azure-ai-agents-mcp/">将 Azure AI 代理与 MCP 集成 (Microsoft Foundry 博客)</a></li>
<li><a href="https://github.com/microsoft/mcp">MCP GitHub 存储库 (Microsoft)</a></li>
<li><a href="https://github.com/microsoft/mcp/tree/main/Resources">MCP 资源目录（示例提示、工具和资源定义）</a></li>
<li><a href="https://modelcontextprotocol.io/introduction">MCP 社区和文档</a></li>
<li><a href="https://aka.ms/azmcp">Azure MCP 文档</a></li>
<li><a href="https://github.com/microsoft/playwright-mcp">Playwright MCP 服务器 GitHub 存储库</a></li>
<li><a href="https://github.com/microsoft/files-mcp-server">文件 MCP 服务器 (OneDrive)</a></li>
<li><a href="https://github.com/Azure-Samples/mcp">Azure-Samples MCP</a></li>
<li><a href="https://github.com/Azure-Samples/mcp-auth-servers">MCP Auth 服务器 (Azure-Samples)</a></li>
<li><a href="https://github.com/Azure-Samples/remote-mcp-functions">远程 MCP 函数 (Azure-Samples)</a></li>
<li><a href="https://github.com/Azure-Samples/remote-mcp-functions-python">远程 MCP 函数 Python (Azure-Samples)</a></li>
<li><a href="https://github.com/Azure-Samples/remote-mcp-functions-dotnet">远程 MCP 函数 .NET (Azure-Samples)</a></li>
<li><a href="https://github.com/Azure-Samples/remote-mcp-functions-typescript">远程 MCP 函数 TypeScript (Azure-Samples)</a></li>
<li><a href="https://github.com/Azure-Samples/remote-mcp-apim-functions-python">远程 MCP APIM 函数 Python (Azure-Samples)</a></li>
<li><a href="https://github.com/Azure-Samples/AI-Gateway">AI-Gateway (Azure-Samples)</a></li>
<li><a href="https://azure.microsoft.com/en-us/products/ai-services/">Microsoft AI 和自动化解决方案</a></li>
</ul>
<h1 id="08-mcp-最佳实践" style="position:relative;"><a href="#08-mcp-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5" aria-label="08 mcp 最佳实践 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>08-MCP 最佳实践</strong></h1>
<h2 id="mcp-工具开发最佳实践" style="position:relative;"><a href="#mcp-%E5%B7%A5%E5%85%B7%E5%BC%80%E5%8F%91%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5" aria-label="mcp 工具开发最佳实践 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>MCP 工具开发最佳实践</strong></h2>
<h3 id="架构原则" style="position:relative;"><a href="#%E6%9E%B6%E6%9E%84%E5%8E%9F%E5%88%99" aria-label="架构原则 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>架构原则</strong></h3>
<h3 id="1-单一职责原则" style="position:relative;"><a href="#1-%E5%8D%95%E4%B8%80%E8%81%8C%E8%B4%A3%E5%8E%9F%E5%88%99" aria-label="1 单一职责原则 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>1. 单一职责原则</strong></h3>
<p>每个 MCP 功能都应有明确、集中的用途。与其创建试图处理多个问题的单体工具，不如开发专门用于特定任务的专用工具。</p>
<p><strong>好的例子：</strong></p>
<ul>
<li>
<p>C#</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token comment">// 一个专注于做好一件事的工具public class WeatherForecastTool : ITool</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IWeatherService</span> _weatherService<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">WeatherForecastTool</span><span class="token punctuation">(</span><span class="token class-name">IWeatherService</span> weatherService<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _weatherService <span class="token operator">=</span> weatherService<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token operator">=></span> <span class="token string">"weatherForecast"</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Description <span class="token operator">=></span> <span class="token string">"获取特定位置的天气预报"</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">ToolDefinition</span> <span class="token function">GetDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ToolDefinition</span>
        <span class="token punctuation">{</span>
            Name <span class="token operator">=</span> Name<span class="token punctuation">,</span>
            Description <span class="token operator">=</span> Description<span class="token punctuation">,</span>
            Parameters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> ParameterDefinition<span class="token punctuation">></span></span>
            <span class="token punctuation">{</span>
                <span class="token punctuation">[</span><span class="token string">"location"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ParameterDefinition</span>
                <span class="token punctuation">{</span>
                    Type <span class="token operator">=</span> ParameterType<span class="token punctuation">.</span>String<span class="token punctuation">,</span>
                    Description <span class="token operator">=</span> <span class="token string">"城市或位置名称"</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token string">"days"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ParameterDefinition</span>
                <span class="token punctuation">{</span>
                    Type <span class="token operator">=</span> ParameterType<span class="token punctuation">.</span>Integer<span class="token punctuation">,</span>
                    Description <span class="token operator">=</span> <span class="token string">"预报天数"</span><span class="token punctuation">,</span>
                    Default <span class="token operator">=</span> <span class="token number">3</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            Required <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token string">"location"</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
      <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>ToolResponse<span class="token punctuation">></span></span> <span class="token function">ExecuteAsync</span><span class="token punctuation">(</span><span class="token class-name">IDictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">object</span><span class="token punctuation">></span></span> parameters<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> location <span class="token operator">=</span> parameters<span class="token punctuation">[</span><span class="token string">"location"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> days <span class="token operator">=</span> parameters<span class="token punctuation">.</span><span class="token function">ContainsKey</span><span class="token punctuation">(</span><span class="token string">"days"</span><span class="token punctuation">)</span>
            <span class="token punctuation">?</span> Convert<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span>parameters<span class="token punctuation">[</span><span class="token string">"days"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">;</span>

        <span class="token class-name"><span class="token keyword">var</span></span> forecast <span class="token operator">=</span> <span class="token keyword">await</span> _weatherService<span class="token punctuation">.</span><span class="token function">GetForecastAsync</span><span class="token punctuation">(</span>location<span class="token punctuation">,</span> days<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ToolResponse</span>
        <span class="token punctuation">{</span>
            Content <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>ContentItem<span class="token punctuation">></span></span>
            <span class="token punctuation">{</span>
                <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TextContent</span><span class="token punctuation">(</span>JsonSerializer<span class="token punctuation">.</span><span class="token function">Serialize</span><span class="token punctuation">(</span>forecast<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
</li>
</ul>
<p><strong>不好的例子：</strong></p>
<ul>
<li>
<p>C#</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token comment">// 一个试图做太多事情的工具public class WeatherToolSuite : ITool</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token operator">=></span> <span class="token string">"weather"</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Description <span class="token operator">=></span> <span class="token string">"与天气相关的功能"</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">ToolDefinition</span> <span class="token function">GetDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ToolDefinition</span>
        <span class="token punctuation">{</span>
            Name <span class="token operator">=</span> Name<span class="token punctuation">,</span>
            Description <span class="token operator">=</span> Description<span class="token punctuation">,</span>
            Parameters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> ParameterDefinition<span class="token punctuation">></span></span>
            <span class="token punctuation">{</span>
                <span class="token punctuation">[</span><span class="token string">"action"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ParameterDefinition</span>
                <span class="token punctuation">{</span>
                    Type <span class="token operator">=</span> ParameterType<span class="token punctuation">.</span>String<span class="token punctuation">,</span>
                    Description <span class="token operator">=</span> <span class="token string">"要执行的天气操作"</span><span class="token punctuation">,</span>
                    Enum <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token string">"forecast"</span><span class="token punctuation">,</span> <span class="token string">"history"</span><span class="token punctuation">,</span> <span class="token string">"alerts"</span><span class="token punctuation">,</span> <span class="token string">"radar"</span> <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token string">"location"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ParameterDefinition</span>
                <span class="token punctuation">{</span>
                    Type <span class="token operator">=</span> ParameterType<span class="token punctuation">.</span>String<span class="token punctuation">,</span>
                    Description <span class="token operator">=</span> <span class="token string">"城市或位置名称"</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// 更多用于不同操作的属性...</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            required <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token string">"action"</span><span class="token punctuation">,</span> <span class="token string">"location"</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>ToolResponse<span class="token punctuation">></span></span> <span class="token function">ExecuteAsync</span><span class="token punctuation">(</span><span class="token class-name">ToolRequest</span> request<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
<span class="token comment">// 处理不同操作的复杂条件逻辑var action = request.Parameters.GetProperty("action").GetString();</span>
        <span class="token class-name"><span class="token keyword">var</span></span> location <span class="token operator">=</span> request<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">GetProperty</span><span class="token punctuation">(</span><span class="token string">"location"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token string">"forecast"</span><span class="token punctuation">:</span>
<span class="token comment">// 预报逻辑break;</span>
            <span class="token keyword">case</span> <span class="token string">"history"</span><span class="token punctuation">:</span>
<span class="token comment">// 历史数据逻辑break;</span>
<span class="token comment">// 更多情况...default:</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ToolExecutionException</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"未知操作: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">action</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

<span class="token comment">// 结果处理// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
</li>
</ul>
<h3 id="2-依赖注入和可测试性" style="position:relative;"><a href="#2-%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E5%92%8C%E5%8F%AF%E6%B5%8B%E8%AF%95%E6%80%A7" aria-label="2 依赖注入和可测试性 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>2. 依赖注入和可测试性</strong></h3>
<p>设计工具以通过构造函数注入接收其依赖项，使其可测试和可配置：</p>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token comment">// 带有依赖注入的 Java 示例public class CurrencyConversionTool implements Tool {</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ExchangeRateService</span> exchangeService<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">CacheService</span> cacheService<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> logger<span class="token punctuation">;</span>

<span class="token comment">// 通过构造函数注入依赖项public CurrencyConversionTool(</span>
            <span class="token class-name">ExchangeRateService</span> exchangeService<span class="token punctuation">,</span>
            <span class="token class-name">CacheService</span> cacheService<span class="token punctuation">,</span>
            <span class="token class-name">Logger</span> logger<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>exchangeService <span class="token operator">=</span> exchangeService<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>cacheService <span class="token operator">=</span> cacheService<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>logger <span class="token operator">=</span> logger<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token comment">// 工具实现// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<h3 id="3-可组合工具" style="position:relative;"><a href="#3-%E5%8F%AF%E7%BB%84%E5%90%88%E5%B7%A5%E5%85%B7" aria-label="3 可组合工具 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>3. 可组合工具</strong></h3>
<p>设计可以组合在一起以创建更复杂工作流的工具：</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment"># 显示可组合工具的 Python 示例class DataFetchTool(Tool):</span>
    <span class="token keyword">def</span> <span class="token function">get_name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"dataFetch"</span>

<span class="token comment"># 实现...class DataAnalysisTool(Tool):</span>
    <span class="token keyword">def</span> <span class="token function">get_name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"dataAnalysis"</span>

<span class="token comment"># 此工具可以使用来自 dataFetch 工具的结果async def execute_async(self, request):</span>
<span class="token comment"># 实现...pass</span>

<span class="token keyword">class</span> <span class="token class-name">DataVisualizationTool</span><span class="token punctuation">(</span>Tool<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">get_name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"dataVisualize"</span>

<span class="token comment"># 此工具可以使用来自 dataAnalysis 工具的结果async def execute_async(self, request):</span>
<span class="token comment"># 实现...pass</span>

<span class="token comment"># 这些工具可以独立使用，也可以作为工作流的一部分使用</span></code></pre></div>
<h3 id="模式设计最佳实践" style="position:relative;"><a href="#%E6%A8%A1%E5%BC%8F%E8%AE%BE%E8%AE%A1%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5" aria-label="模式设计最佳实践 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>模式设计最佳实践</strong></h3>
<p>模式是模型和工具之间的契约。精心设计的模式可以提高工具的可用性。</p>
<h3 id="1-清晰的参数描述" style="position:relative;"><a href="#1-%E6%B8%85%E6%99%B0%E7%9A%84%E5%8F%82%E6%95%B0%E6%8F%8F%E8%BF%B0" aria-label="1 清晰的参数描述 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>1. 清晰的参数描述</strong></h3>
<p>始终为每个参数包含描述性信息：</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">GetSchema</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token punctuation">{</span>
        type <span class="token operator">=</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
        properties <span class="token operator">=</span> <span class="token punctuation">{</span>
            query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">{</span>
                type <span class="token operator">=</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
                description <span class="token operator">=</span> <span class="token string">"搜索查询文本。使用精确的关键字以获得更好的结果。"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            filters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">{</span>
                type <span class="token operator">=</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
                description <span class="token operator">=</span> <span class="token string">"用于缩小搜索结果的可选筛选器"</span><span class="token punctuation">,</span>
                properties <span class="token operator">=</span> <span class="token punctuation">{</span>
                    dateRange <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">{</span>
                        type <span class="token operator">=</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
                        description <span class="token operator">=</span> <span class="token string">"日期范围，格式为 YYYY-MM-DD:YYYY-MM-DD"</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    category <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">{</span>
                        type <span class="token operator">=</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
                        description <span class="token operator">=</span> <span class="token string">"用于筛选的类别名称"</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            limit <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">{</span>
                type <span class="token operator">=</span> <span class="token string">"integer"</span><span class="token punctuation">,</span>
                description <span class="token operator">=</span> <span class="token string">"要返回的最大结果数 (1-50)"</span><span class="token punctuation">,</span>
                <span class="token keyword">default</span> <span class="token operator">=</span> <span class="token number">10</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        required <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token string">"query"</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h3 id="2-验证约束" style="position:relative;"><a href="#2-%E9%AA%8C%E8%AF%81%E7%BA%A6%E6%9D%9F" aria-label="2 验证约束 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>2. 验证约束</strong></h3>
<p>包含验证约束以防止无效输入：</p>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> <span class="token function">getSchema</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> schema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    schema<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"type"</span><span class="token punctuation">,</span> <span class="token string">"object"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 带有格式验证的电子邮件属性</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> email <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    email<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"type"</span><span class="token punctuation">,</span> <span class="token string">"string"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    email<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"format"</span><span class="token punctuation">,</span> <span class="token string">"email"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    email<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"description"</span><span class="token punctuation">,</span> <span class="token string">"用户电子邮件地址"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 带有数字约束的年龄属性</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> age <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    age<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"type"</span><span class="token punctuation">,</span> <span class="token string">"integer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    age<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"minimum"</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    age<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"maximum"</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    age<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"description"</span><span class="token punctuation">,</span> <span class="token string">"用户年龄（岁）"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 枚举属性</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> subscription <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    subscription<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"type"</span><span class="token punctuation">,</span> <span class="token string">"string"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    subscription<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"enum"</span><span class="token punctuation">,</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"free"</span><span class="token punctuation">,</span> <span class="token string">"basic"</span><span class="token punctuation">,</span> <span class="token string">"premium"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    subscription<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"default"</span><span class="token punctuation">,</span> <span class="token string">"free"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    subscription<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"description"</span><span class="token punctuation">,</span> <span class="token string">"订阅层级"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"email"</span><span class="token punctuation">,</span> email<span class="token punctuation">)</span><span class="token punctuation">;</span>
    properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
    properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"subscription"</span><span class="token punctuation">,</span> subscription<span class="token punctuation">)</span><span class="token punctuation">;</span>

    schema<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"properties"</span><span class="token punctuation">,</span> properties<span class="token punctuation">)</span><span class="token punctuation">;</span>
    schema<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"required"</span><span class="token punctuation">,</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"email"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> schema<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h3 id="3-一致的返回结构" style="position:relative;"><a href="#3-%E4%B8%80%E8%87%B4%E7%9A%84%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%84" aria-label="3 一致的返回结构 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>3. 一致的返回结构</strong></h3>
<p>在响应结构中保持一致性，以便模型更容易解释结果：</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">execute_async</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
<span class="token comment"># 处理请求</span>
        results <span class="token operator">=</span> <span class="token keyword">await</span> self<span class="token punctuation">.</span>_search_database<span class="token punctuation">(</span>request<span class="token punctuation">.</span>parameters<span class="token punctuation">[</span><span class="token string">"query"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 始终返回一致的结构return ToolResponse(</span>
            result<span class="token operator">=</span><span class="token punctuation">{</span>
                <span class="token string">"matches"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>self<span class="token punctuation">.</span>_format_item<span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token keyword">for</span> item <span class="token keyword">in</span> results<span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string">"totalCount"</span><span class="token punctuation">:</span> <span class="token builtin">len</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">"queryTime"</span><span class="token punctuation">:</span> calculation_time_ms<span class="token punctuation">,</span>
                <span class="token string">"status"</span><span class="token punctuation">:</span> <span class="token string">"success"</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">return</span> ToolResponse<span class="token punctuation">(</span>
            result<span class="token operator">=</span><span class="token punctuation">{</span>
                <span class="token string">"matches"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string">"totalCount"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token string">"queryTime"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token string">"status"</span><span class="token punctuation">:</span> <span class="token string">"error"</span><span class="token punctuation">,</span>
                <span class="token string">"error"</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">_format_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""确保每个项目都有一个一致的结构"""</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token string">"id"</span><span class="token punctuation">:</span> item<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span>
        <span class="token string">"title"</span><span class="token punctuation">:</span> item<span class="token punctuation">.</span>title<span class="token punctuation">,</span>
        <span class="token string">"summary"</span><span class="token punctuation">:</span> item<span class="token punctuation">.</span>summary<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">"..."</span> <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>summary<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">100</span> <span class="token keyword">else</span> item<span class="token punctuation">.</span>summary<span class="token punctuation">,</span>
        <span class="token string">"url"</span><span class="token punctuation">:</span> item<span class="token punctuation">.</span>url<span class="token punctuation">,</span>
        <span class="token string">"relevance"</span><span class="token punctuation">:</span> item<span class="token punctuation">.</span>score
    <span class="token punctuation">}</span>
</code></pre></div>
<h3 id="错误处理" style="position:relative;"><a href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86" aria-label="错误处理 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>错误处理</strong></h3>
<p>强大的错误处理对于 MCP 工具保持可靠性至关重要。</p>
<h3 id="1-优雅的错误处理" style="position:relative;"><a href="#1-%E4%BC%98%E9%9B%85%E7%9A%84%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86" aria-label="1 优雅的错误处理 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>1. 优雅的错误处理</strong></h3>
<p>在适当的级别处理错误并提供信息性消息：</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>ToolResponse<span class="token punctuation">></span></span> <span class="token function">ExecuteAsync</span><span class="token punctuation">(</span><span class="token class-name">ToolRequest</span> request<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">try</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">string</span></span> fileId <span class="token operator">=</span> request<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">GetProperty</span><span class="token punctuation">(</span><span class="token string">"fileId"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> fileData <span class="token operator">=</span> <span class="token keyword">await</span> _fileService<span class="token punctuation">.</span><span class="token function">GetFileAsync</span><span class="token punctuation">(</span>fileId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ToolResponse</span> <span class="token punctuation">{</span>
                Result <span class="token operator">=</span> JsonSerializer<span class="token punctuation">.</span><span class="token function">SerializeToElement</span><span class="token punctuation">(</span>fileData<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">FileNotFoundException</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ToolExecutionException</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"未找到文件: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">fileId</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">UnauthorizedAccessException</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ToolExecutionException</span><span class="token punctuation">(</span><span class="token string">"无权访问此文件"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token keyword">when</span> <span class="token punctuation">(</span>ex <span class="token keyword">is</span> <span class="token class-name">IOException</span> <span class="token operator">||</span> ex <span class="token keyword">is</span> <span class="token class-name">TimeoutException</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            _logger<span class="token punctuation">.</span><span class="token function">LogError</span><span class="token punctuation">(</span>ex<span class="token punctuation">,</span> <span class="token string">"访问文件 {FileId} 时出错"</span><span class="token punctuation">,</span> fileId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ToolExecutionException</span><span class="token punctuation">(</span><span class="token string">"访问文件时出错：服务暂时不可用"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">JsonException</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ToolExecutionException</span><span class="token punctuation">(</span><span class="token string">"无效的文件 ID 格式"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _logger<span class="token punctuation">.</span><span class="token function">LogError</span><span class="token punctuation">(</span>ex<span class="token punctuation">,</span> <span class="token string">"FileAccessTool 中发生意外错误"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ToolExecutionException</span><span class="token punctuation">(</span><span class="token string">"发生意外错误"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h3 id="2-结构化错误响应" style="position:relative;"><a href="#2-%E7%BB%93%E6%9E%84%E5%8C%96%E9%94%99%E8%AF%AF%E5%93%8D%E5%BA%94" aria-label="2 结构化错误响应 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>2. 结构化错误响应</strong></h3>
<p>尽可能返回结构化的错误信息：</p>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">ToolResponse</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">ToolRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
<span class="token comment">// 实现</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> errorResult <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        errorResult<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>ex <span class="token keyword">instanceof</span> <span class="token class-name">ValidationException</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">ValidationException</span> validationEx <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ValidationException</span><span class="token punctuation">)</span> ex<span class="token punctuation">;</span>

            errorResult<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"errorType"</span><span class="token punctuation">,</span> <span class="token string">"validation"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            errorResult<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"errorMessage"</span><span class="token punctuation">,</span> validationEx<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            errorResult<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"validationErrors"</span><span class="token punctuation">,</span> validationEx<span class="token punctuation">.</span><span class="token function">getErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ToolResponse<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setResult</span><span class="token punctuation">(</span>errorResult<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

<span class="token comment">// 将其他异常重新抛出为 ToolExecutionExceptionthrow new ToolExecutionException("工具执行失败: " + ex.getMessage(), ex);</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h3 id="3-重试逻辑" style="position:relative;"><a href="#3-%E9%87%8D%E8%AF%95%E9%80%BB%E8%BE%91" aria-label="3 重试逻辑 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>3. 重试逻辑</strong></h3>
<p>为瞬时故障实施适当的重试逻辑：</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">execute_async</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    max_retries <span class="token operator">=</span> <span class="token number">3</span>
    retry_count <span class="token operator">=</span> <span class="token number">0</span>
    base_delay <span class="token operator">=</span> <span class="token number">1</span><span class="token comment"># 秒</span>

    <span class="token keyword">while</span> retry_count <span class="token operator">&lt;</span> max_retries<span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
<span class="token comment"># 调用外部 APIreturn await self._call_api(request.parameters)</span>
        <span class="token keyword">except</span> TransientError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            retry_count <span class="token operator">+=</span> <span class="token number">1</span>
            <span class="token keyword">if</span> retry_count <span class="token operator">>=</span> max_retries<span class="token punctuation">:</span>
                <span class="token keyword">raise</span> ToolExecutionException<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"操作在 </span><span class="token interpolation"><span class="token punctuation">{</span>max_retries<span class="token punctuation">}</span></span><span class="token string"> 次尝试后失败: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 指数退避</span>
            delay <span class="token operator">=</span> base_delay <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">**</span> <span class="token punctuation">(</span>retry_count <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"瞬时错误，在 </span><span class="token interpolation"><span class="token punctuation">{</span>delay<span class="token punctuation">}</span></span><span class="token string">s 后重试: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>delay<span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token comment"># 非瞬时错误，不重试raise ToolExecutionException(f"操作失败: {str(e)}")</span>
</code></pre></div>
<h3 id="性能优化" style="position:relative;"><a href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96" aria-label="性能优化 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>性能优化</strong></h3>
<h3 id="1-缓存" style="position:relative;"><a href="#1-%E7%BC%93%E5%AD%98" aria-label="1 缓存 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>1. 缓存</strong></h3>
<p>为昂贵的操作实施缓存：</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CachedDataTool</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IMcpTool</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IDatabase</span> _database<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IMemoryCache</span> _cache<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">CachedDataTool</span><span class="token punctuation">(</span><span class="token class-name">IDatabase</span> database<span class="token punctuation">,</span> <span class="token class-name">IMemoryCache</span> cache<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _database <span class="token operator">=</span> database<span class="token punctuation">;</span>
        _cache <span class="token operator">=</span> cache<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>ToolResponse<span class="token punctuation">></span></span> <span class="token function">ExecuteAsync</span><span class="token punctuation">(</span><span class="token class-name">ToolRequest</span> request<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> query <span class="token operator">=</span> request<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">GetProperty</span><span class="token punctuation">(</span><span class="token string">"query"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 根据参数创建缓存键var cacheKey = $"data_query_{ComputeHash(query)}";</span>

<span class="token comment">// 首先尝试从缓存中获取if (_cache.TryGetValue(cacheKey, out var cachedResult))</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ToolResponse</span> <span class="token punctuation">{</span> Result <span class="token operator">=</span> cachedResult <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

<span class="token comment">// 缓存未命中 - 执行实际查询var result = await _database.QueryAsync(query);</span>

<span class="token comment">// 存储在缓存中并设置过期时间var cacheOptions = new MemoryCacheEntryOptions()</span>
            <span class="token punctuation">.</span><span class="token function">SetAbsoluteExpiration</span><span class="token punctuation">(</span>TimeSpan<span class="token punctuation">.</span><span class="token function">FromMinutes</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        _cache<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>cacheKey<span class="token punctuation">,</span> JsonSerializer<span class="token punctuation">.</span><span class="token function">SerializeToElement</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">,</span> cacheOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ToolResponse</span> <span class="token punctuation">{</span> Result <span class="token operator">=</span> JsonSerializer<span class="token punctuation">.</span><span class="token function">SerializeToElement</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">ComputeHash</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> input<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
<span class="token comment">// 生成稳定哈希以用作缓存键的实现</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h3 id="2-异步处理" style="position:relative;"><a href="#2-%E5%BC%82%E6%AD%A5%E5%A4%84%E7%90%86" aria-label="2 异步处理 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>2. 异步处理</strong></h3>
<p>对 I/O 密集型操作使用异步编程模式：</p>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AsyncDocumentProcessingTool</span> <span class="token keyword">implements</span> <span class="token class-name">Tool</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">DocumentService</span> documentService<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ExecutorService</span> executorService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">ToolResponse</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">ToolRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> documentId <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"documentId"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 对于长时间运行的操作，立即返回一个处理 IDString processId = UUID.randomUUID().toString();</span>

<span class="token comment">// 启动异步处理</span>
        <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">runAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
<span class="token comment">// 执行长时间运行的操作</span>
                documentService<span class="token punctuation">.</span><span class="token function">processDocument</span><span class="token punctuation">(</span>documentId<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 更新状态（通常会存储在数据库中）</span>
                processStatusRepository<span class="token punctuation">.</span><span class="token function">updateStatus</span><span class="token punctuation">(</span>processId<span class="token punctuation">,</span> <span class="token string">"completed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                processStatusRepository<span class="token punctuation">.</span><span class="token function">updateStatus</span><span class="token punctuation">(</span>processId<span class="token punctuation">,</span> <span class="token string">"failed"</span><span class="token punctuation">,</span> ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> executorService<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 返回带有处理 ID 的即时响应</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"processId"</span><span class="token punctuation">,</span> processId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"status"</span><span class="token punctuation">,</span> <span class="token string">"processing"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"estimatedCompletionTime"</span><span class="token punctuation">,</span> <span class="token class-name">ZonedDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">plusMinutes</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ToolResponse<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setResult</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token comment">// 配套的状态检查工具public class ProcessStatusTool implements Tool {</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">ToolResponse</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">ToolRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> processId <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"processId"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">ProcessStatus</span> status <span class="token operator">=</span> processStatusRepository<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span>processId<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ToolResponse<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setResult</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h3 id="3-资源限制" style="position:relative;"><a href="#3-%E8%B5%84%E6%BA%90%E9%99%90%E5%88%B6" aria-label="3 资源限制 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>3. 资源限制</strong></h3>
<p>实施资源限制以防止过载：</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">ThrottledApiTool</span><span class="token punctuation">(</span>Tool<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>rate_limiter <span class="token operator">=</span> TokenBucketRateLimiter<span class="token punctuation">(</span>
            tokens_per_second<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token comment"># 允许每秒 5 个请求</span>
            bucket_size<span class="token operator">=</span><span class="token number">10</span><span class="token comment"># 允许最多 10 个请求的突发</span>
        <span class="token punctuation">)</span>

    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">execute_async</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token comment"># 检查我们是否可以继续或需要等待</span>
        delay <span class="token operator">=</span> self<span class="token punctuation">.</span>rate_limiter<span class="token punctuation">.</span>get_delay_time<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> delay <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> delay <span class="token operator">></span> <span class="token number">2.0</span><span class="token punctuation">:</span><span class="token comment"># 如果等待时间太长raise ToolExecutionException(</span>
                    <span class="token string-interpolation"><span class="token string">f"超出速率限制。请在 </span><span class="token interpolation"><span class="token punctuation">{</span>delay<span class="token punctuation">:</span><span class="token format-spec">.1f</span><span class="token punctuation">}</span></span><span class="token string"> 秒后重试。"</span></span>
                <span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
<span class="token comment"># 等待适当的延迟时间await asyncio.sleep(delay)</span>

<span class="token comment"># 消耗一个令牌并继续处理请求</span>
        self<span class="token punctuation">.</span>rate_limiter<span class="token punctuation">.</span>consume<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 调用 API</span>
        result <span class="token operator">=</span> <span class="token keyword">await</span> self<span class="token punctuation">.</span>_call_api<span class="token punctuation">(</span>request<span class="token punctuation">.</span>parameters<span class="token punctuation">)</span>
        <span class="token keyword">return</span> ToolResponse<span class="token punctuation">(</span>result<span class="token operator">=</span>result<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">TokenBucketRateLimiter</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> tokens_per_second<span class="token punctuation">,</span> bucket_size<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>tokens_per_second <span class="token operator">=</span> tokens_per_second
        self<span class="token punctuation">.</span>bucket_size <span class="token operator">=</span> bucket_size
        self<span class="token punctuation">.</span>tokens <span class="token operator">=</span> bucket_size
        self<span class="token punctuation">.</span>last_refill <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>lock <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>Lock<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">get_delay_time</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">async</span> <span class="token keyword">with</span> self<span class="token punctuation">.</span>lock<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_refill<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>tokens <span class="token operator">>=</span> <span class="token number">1</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token number">0</span>

<span class="token comment"># 计算下一个可用令牌的时间return (1 - self.tokens) / self.tokens_per_second</span>

    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">consume</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">async</span> <span class="token keyword">with</span> self<span class="token punctuation">.</span>lock<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_refill<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>tokens <span class="token operator">-=</span> <span class="token number">1</span>

    <span class="token keyword">def</span> <span class="token function">_refill</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        now <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        elapsed <span class="token operator">=</span> now <span class="token operator">-</span> self<span class="token punctuation">.</span>last_refill

<span class="token comment"># 根据经过的时间添加新令牌</span>
        new_tokens <span class="token operator">=</span> elapsed <span class="token operator">*</span> self<span class="token punctuation">.</span>tokens_per_second
        self<span class="token punctuation">.</span>tokens <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>bucket_size<span class="token punctuation">,</span> self<span class="token punctuation">.</span>tokens <span class="token operator">+</span> new_tokens<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>last_refill <span class="token operator">=</span> now
</code></pre></div>
<h3 id="安全最佳实践-1" style="position:relative;"><a href="#%E5%AE%89%E5%85%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-1" aria-label="安全最佳实践 1 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>安全最佳实践</strong></h3>
<h3 id="1-输入验证" style="position:relative;"><a href="#1-%E8%BE%93%E5%85%A5%E9%AA%8C%E8%AF%81" aria-label="1 输入验证 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>1. 输入验证</strong></h3>
<p>始终彻底验证输入参数：</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>ToolResponse<span class="token punctuation">></span></span> <span class="token function">ExecuteAsync</span><span class="token punctuation">(</span><span class="token class-name">ToolRequest</span> request<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// 验证参数是否存在if (!request.Parameters.TryGetProperty("query", out var queryProp))</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ToolExecutionException</span><span class="token punctuation">(</span><span class="token string">"缺少必需参数: query"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token comment">// 验证正确的类型if (queryProp.ValueKind != JsonValueKind.String)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ToolExecutionException</span><span class="token punctuation">(</span><span class="token string">"查询参数必须是字符串"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name"><span class="token keyword">var</span></span> query <span class="token operator">=</span> queryProp<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 验证字符串内容if (string.IsNullOrWhiteSpace(query))</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ToolExecutionException</span><span class="token punctuation">(</span><span class="token string">"查询参数不能为空"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>query<span class="token punctuation">.</span>Length <span class="token operator">></span> <span class="token number">500</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ToolExecutionException</span><span class="token punctuation">(</span><span class="token string">"查询参数超过最大长度 500 个字符"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token comment">// 如果适用，检查 SQL 注入攻击if (ContainsSqlInjection(query))</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ToolExecutionException</span><span class="token punctuation">(</span><span class="token string">"无效查询：包含可能不安全的 SQL"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token comment">// 继续执行// ...</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h3 id="2-授权检查" style="position:relative;"><a href="#2-%E6%8E%88%E6%9D%83%E6%A3%80%E6%9F%A5" aria-label="2 授权检查 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>2. 授权检查</strong></h3>
<p>实施适当的授权检查：</p>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">ToolResponse</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">ToolRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">// 从请求中获取用户上下文UserContext user = request.getContext().getUserContext();</span>

<span class="token comment">// 检查用户是否具有所需权限if (!authorizationService.hasPermission(user, "documents:read")) {</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ToolExecutionException</span><span class="token punctuation">(</span><span class="token string">"用户无权访问文档"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token comment">// 对于特定资源，检查对该资源的访问权限String documentId = request.getParameters().get("documentId").asText();</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>documentService<span class="token punctuation">.</span><span class="token function">canUserAccess</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> documentId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ToolExecutionException</span><span class="token punctuation">(</span><span class="token string">"拒绝访问所请求的文档"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token comment">// 继续执行工具// ...</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h3 id="3-敏感数据处理" style="position:relative;"><a href="#3-%E6%95%8F%E6%84%9F%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86" aria-label="3 敏感数据处理 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>3. 敏感数据处理</strong></h3>
<p>小心处理敏感数据：</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">SecureDataTool</span><span class="token punctuation">(</span>Tool<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">get_schema</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
            <span class="token string">"properties"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                <span class="token string">"userId"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"string"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string">"includeSensitiveData"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"boolean"</span><span class="token punctuation">,</span> <span class="token string">"default"</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">"required"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"userId"</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>

    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">execute_async</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        user_id <span class="token operator">=</span> request<span class="token punctuation">.</span>parameters<span class="token punctuation">[</span><span class="token string">"userId"</span><span class="token punctuation">]</span>
        include_sensitive <span class="token operator">=</span> request<span class="token punctuation">.</span>parameters<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"includeSensitiveData"</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>

<span class="token comment"># 获取用户数据</span>
        user_data <span class="token operator">=</span> <span class="token keyword">await</span> self<span class="token punctuation">.</span>user_service<span class="token punctuation">.</span>get_user_data<span class="token punctuation">(</span>user_id<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 除非明确请求并获得授权，否则筛选敏感字段if not include_sensitive or not self._is_authorized_for_sensitive_data(request):</span>
            user_data <span class="token operator">=</span> self<span class="token punctuation">.</span>_redact_sensitive_fields<span class="token punctuation">(</span>user_data<span class="token punctuation">)</span>

        <span class="token keyword">return</span> ToolResponse<span class="token punctuation">(</span>result<span class="token operator">=</span>user_data<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">_is_authorized_for_sensitive_data</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token comment"># 检查请求上下文中的授权级别</span>
        auth_level <span class="token operator">=</span> request<span class="token punctuation">.</span>context<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"authorizationLevel"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> auth_level <span class="token operator">==</span> <span class="token string">"admin"</span>

    <span class="token keyword">def</span> <span class="token function">_redact_sensitive_fields</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> user_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token comment"># 创建一个副本以避免修改原始数据</span>
        redacted <span class="token operator">=</span> user_data<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 编辑特定的敏感字段</span>
        sensitive_fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"ssn"</span><span class="token punctuation">,</span> <span class="token string">"creditCardNumber"</span><span class="token punctuation">,</span> <span class="token string">"password"</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> field <span class="token keyword">in</span> sensitive_fields<span class="token punctuation">:</span>
            <span class="token keyword">if</span> field <span class="token keyword">in</span> redacted<span class="token punctuation">:</span>
                redacted<span class="token punctuation">[</span>field<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"REDACTED"</span>

<span class="token comment"># 编辑嵌套的敏感数据if "financialInfo" in redacted:</span>
            redacted<span class="token punctuation">[</span><span class="token string">"financialInfo"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"available"</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string">"accessRestricted"</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">}</span>

        <span class="token keyword">return</span> redacted
</code></pre></div>
<h2 id="mcp-工具测试最佳实践" style="position:relative;"><a href="#mcp-%E5%B7%A5%E5%85%B7%E6%B5%8B%E8%AF%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5" aria-label="mcp 工具测试最佳实践 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>MCP 工具测试最佳实践</strong></h2>
<p>全面的测试可确保 MCP 工具正常运行、处理边缘情况并与系统的其余部分正确集成。</p>
<h3 id="单元测试" style="position:relative;"><a href="#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95" aria-label="单元测试 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>单元测试</strong></h3>
<h3 id="1-隔离测试每个工具" style="position:relative;"><a href="#1-%E9%9A%94%E7%A6%BB%E6%B5%8B%E8%AF%95%E6%AF%8F%E4%B8%AA%E5%B7%A5%E5%85%B7" aria-label="1 隔离测试每个工具 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>1. 隔离测试每个工具</strong></h3>
<p>为每个工具的功能创建集中的测试：</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Fact</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">WeatherTool_ValidLocation_ReturnsCorrectForecast</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// 安排var mockWeatherService = new Mock&lt;IWeatherService>();</span>
    mockWeatherService
        <span class="token punctuation">.</span><span class="token function">Setup</span><span class="token punctuation">(</span>s <span class="token operator">=></span> s<span class="token punctuation">.</span><span class="token function">GetForecastAsync</span><span class="token punctuation">(</span><span class="token string">"Seattle"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">ReturnsAsync</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">WeatherForecast</span><span class="token punctuation">(</span><span class="token comment">/* 测试数据 */</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">var</span></span> tool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WeatherForecastTool</span><span class="token punctuation">(</span>mockWeatherService<span class="token punctuation">.</span>Object<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">var</span></span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ToolRequest</span><span class="token punctuation">(</span>
        <span class="token named-parameter punctuation">toolName</span><span class="token punctuation">:</span> <span class="token string">"weatherForecast"</span><span class="token punctuation">,</span>
        <span class="token named-parameter punctuation">parameters</span><span class="token punctuation">:</span> JsonSerializer<span class="token punctuation">.</span><span class="token function">SerializeToElement</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token punctuation">{</span>
            location <span class="token operator">=</span> <span class="token string">"Seattle"</span><span class="token punctuation">,</span>
            days <span class="token operator">=</span> <span class="token number">3</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 操作var response = await tool.ExecuteAsync(request);</span>

<span class="token comment">// 断言</span>
    Assert<span class="token punctuation">.</span><span class="token function">NotNull</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> JsonSerializer<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Deserialize</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>WeatherForecast<span class="token punctuation">></span></span></span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>Result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Assert<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span><span class="token string">"Seattle"</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>Location<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Assert<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>DailyForecasts<span class="token punctuation">.</span>Count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Fact</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">WeatherTool_InvalidLocation_ThrowsToolExecutionException</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// 安排var mockWeatherService = new Mock&lt;IWeatherService>();</span>
    mockWeatherService
        <span class="token punctuation">.</span><span class="token function">Setup</span><span class="token punctuation">(</span>s <span class="token operator">=></span> s<span class="token punctuation">.</span><span class="token function">GetForecastAsync</span><span class="token punctuation">(</span><span class="token string">"InvalidLocation"</span><span class="token punctuation">,</span> It<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">IsAny</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">ThrowsAsync</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">LocationNotFoundException</span><span class="token punctuation">(</span><span class="token string">"未找到位置"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">var</span></span> tool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WeatherForecastTool</span><span class="token punctuation">(</span>mockWeatherService<span class="token punctuation">.</span>Object<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">var</span></span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ToolRequest</span><span class="token punctuation">(</span>
        <span class="token named-parameter punctuation">toolName</span><span class="token punctuation">:</span> <span class="token string">"weatherForecast"</span><span class="token punctuation">,</span>
        <span class="token named-parameter punctuation">parameters</span><span class="token punctuation">:</span> JsonSerializer<span class="token punctuation">.</span><span class="token function">SerializeToElement</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token punctuation">{</span>
            location <span class="token operator">=</span> <span class="token string">"InvalidLocation"</span><span class="token punctuation">,</span>
            days <span class="token operator">=</span> <span class="token number">3</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 操作和断言var exception = await Assert.ThrowsAsync&lt;ToolExecutionException>(</span>
        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> tool<span class="token punctuation">.</span><span class="token function">ExecuteAsync</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    Assert<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span><span class="token string">"未找到位置"</span><span class="token punctuation">,</span> exception<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h3 id="2-模式验证测试" style="position:relative;"><a href="#2-%E6%A8%A1%E5%BC%8F%E9%AA%8C%E8%AF%81%E6%B5%8B%E8%AF%95" aria-label="2 模式验证测试 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>2. 模式验证测试</strong></h3>
<p>测试模式是否有效并正确强制执行约束：</p>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSchemaValidation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">// 创建工具实例SearchTool searchTool = new SearchTool();</span>

<span class="token comment">// 获取模式Object schema = searchTool.getSchema();</span>

<span class="token comment">// 将模式转换为 JSON 以进行验证String schemaJson = objectMapper.writeValueAsString(schema);</span>

<span class="token comment">// 验证模式是否为有效的 JSONSchemaJsonSchemaFactory factory = JsonSchemaFactory.byDefault();</span>
    <span class="token class-name">JsonSchema</span> jsonSchema <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">getJsonSchema</span><span class="token punctuation">(</span>schemaJson<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 测试有效参数JsonNode validParams = objectMapper.createObjectNode()</span>
        <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"query"</span><span class="token punctuation">,</span> <span class="token string">"test query"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"limit"</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">ProcessingReport</span> validReport <span class="token operator">=</span> jsonSchema<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>validParams<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertTrue</span><span class="token punctuation">(</span>validReport<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 测试缺少必需参数JsonNode missingRequired = objectMapper.createObjectNode()</span>
        <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"limit"</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">ProcessingReport</span> missingReport <span class="token operator">=</span> jsonSchema<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>missingRequired<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertFalse</span><span class="token punctuation">(</span>missingReport<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 测试无效参数类型JsonNode invalidType = objectMapper.createObjectNode()</span>
        <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"query"</span><span class="token punctuation">,</span> <span class="token string">"test"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"limit"</span><span class="token punctuation">,</span> <span class="token string">"not-a-number"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">ProcessingReport</span> invalidReport <span class="token operator">=</span> jsonSchema<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>invalidType<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertFalse</span><span class="token punctuation">(</span>invalidReport<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h3 id="3-错误处理测试" style="position:relative;"><a href="#3-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E6%B5%8B%E8%AF%95" aria-label="3 错误处理测试 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>3. 错误处理测试</strong></h3>
<p>为错误条件创建特定的测试：</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>mark<span class="token punctuation">.</span>asyncio</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">test_api_tool_handles_timeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token comment"># 安排</span>
    tool <span class="token operator">=</span> ApiTool<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment"># 非常短的超时</span>

<span class="token comment"># 模拟一个会超时的请求with aioresponses() as mocked:</span>
        mocked<span class="token punctuation">.</span>get<span class="token punctuation">(</span>
            <span class="token string">"https://api.example.com/data"</span><span class="token punctuation">,</span>
            callback<span class="token operator">=</span><span class="token keyword">lambda</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">:</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token comment"># 比超时时间长</span>
        <span class="token punctuation">)</span>

        request <span class="token operator">=</span> ToolRequest<span class="token punctuation">(</span>
            tool_name<span class="token operator">=</span><span class="token string">"apiTool"</span><span class="token punctuation">,</span>
            parameters<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"url"</span><span class="token punctuation">:</span> <span class="token string">"https://api.example.com/data"</span><span class="token punctuation">}</span>
        <span class="token punctuation">)</span>

<span class="token comment"># 操作和断言with pytest.raises(ToolExecutionException) as exc_info:</span>
            <span class="token keyword">await</span> tool<span class="token punctuation">.</span>execute_async<span class="token punctuation">(</span>request<span class="token punctuation">)</span>

<span class="token comment"># 验证异常消息assert "timed out" in str(exc_info.value).lower()</span>

<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>mark<span class="token punctuation">.</span>asyncio</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">test_api_tool_handles_rate_limiting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token comment"># 安排</span>
    tool <span class="token operator">=</span> ApiTool<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 模拟一个速率受限的响应with aioresponses() as mocked:</span>
        mocked<span class="token punctuation">.</span>get<span class="token punctuation">(</span>
            <span class="token string">"https://api.example.com/data"</span><span class="token punctuation">,</span>
            status<span class="token operator">=</span><span class="token number">429</span><span class="token punctuation">,</span>
            headers<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"Retry-After"</span><span class="token punctuation">:</span> <span class="token string">"2"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            body<span class="token operator">=</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"error"</span><span class="token punctuation">:</span> <span class="token string">"Rate limit exceeded"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>

        request <span class="token operator">=</span> ToolRequest<span class="token punctuation">(</span>
            tool_name<span class="token operator">=</span><span class="token string">"apiTool"</span><span class="token punctuation">,</span>
            parameters<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"url"</span><span class="token punctuation">:</span> <span class="token string">"https://api.example.com/data"</span><span class="token punctuation">}</span>
        <span class="token punctuation">)</span>

<span class="token comment"># 操作和断言with pytest.raises(ToolExecutionException) as exc_info:</span>
            <span class="token keyword">await</span> tool<span class="token punctuation">.</span>execute_async<span class="token punctuation">(</span>request<span class="token punctuation">)</span>

<span class="token comment"># 验证异常包含速率限制信息</span>
        error_msg <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>exc_info<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">assert</span> <span class="token string">"rate limit"</span> <span class="token keyword">in</span> error_msg
        <span class="token keyword">assert</span> <span class="token string">"try again"</span> <span class="token keyword">in</span> error_msg
</code></pre></div>
<h3 id="集成测试" style="position:relative;"><a href="#%E9%9B%86%E6%88%90%E6%B5%8B%E8%AF%95" aria-label="集成测试 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>集成测试</strong></h3>
<h3 id="1-工具链测试" style="position:relative;"><a href="#1-%E5%B7%A5%E5%85%B7%E9%93%BE%E6%B5%8B%E8%AF%95" aria-label="1 工具链测试 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>1. 工具链测试</strong></h3>
<p>测试工具在预期组合中协同工作：</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Fact</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">DataProcessingWorkflow_CompletesSuccessfully</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// 安排var dataFetchTool = new DataFetchTool(mockDataService.Object);</span>
    <span class="token class-name"><span class="token keyword">var</span></span> analysisTools <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataAnalysisTool</span><span class="token punctuation">(</span>mockAnalysisService<span class="token punctuation">.</span>Object<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> visualizationTool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataVisualizationTool</span><span class="token punctuation">(</span>mockVisualizationService<span class="token punctuation">.</span>Object<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">var</span></span> toolRegistry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ToolRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    toolRegistry<span class="token punctuation">.</span><span class="token function">RegisterTool</span><span class="token punctuation">(</span>dataFetchTool<span class="token punctuation">)</span><span class="token punctuation">;</span>
    toolRegistry<span class="token punctuation">.</span><span class="token function">RegisterTool</span><span class="token punctuation">(</span>analysisTools<span class="token punctuation">)</span><span class="token punctuation">;</span>
    toolRegistry<span class="token punctuation">.</span><span class="token function">RegisterTool</span><span class="token punctuation">(</span>visualizationTool<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">var</span></span> workflowExecutor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WorkflowExecutor</span><span class="token punctuation">(</span>toolRegistry<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 操作var result = await workflowExecutor.ExecuteWorkflowAsync(new[] {</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ToolCall</span><span class="token punctuation">(</span><span class="token string">"dataFetch"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> source <span class="token operator">=</span> <span class="token string">"sales2023"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ToolCall</span><span class="token punctuation">(</span><span class="token string">"dataAnalysis"</span><span class="token punctuation">,</span> ctx <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token punctuation">{</span>
            data <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">GetResult</span><span class="token punctuation">(</span><span class="token string">"dataFetch"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            analysis <span class="token operator">=</span> <span class="token string">"trend"</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ToolCall</span><span class="token punctuation">(</span><span class="token string">"dataVisualize"</span><span class="token punctuation">,</span> ctx <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token punctuation">{</span>
            analysisResult <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">GetResult</span><span class="token punctuation">(</span><span class="token string">"dataAnalysis"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            type <span class="token operator">=</span> <span class="token string">"line-chart"</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 断言</span>
    Assert<span class="token punctuation">.</span><span class="token function">NotNull</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Assert<span class="token punctuation">.</span><span class="token function">True</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>Success<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Assert<span class="token punctuation">.</span><span class="token function">NotNull</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">GetResult</span><span class="token punctuation">(</span><span class="token string">"dataVisualize"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Assert<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span><span class="token string">"chartUrl"</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span><span class="token function">GetResult</span><span class="token punctuation">(</span><span class="token string">"dataVisualize"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h3 id="2-mcp-服务器测试" style="position:relative;"><a href="#2-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%B5%8B%E8%AF%95" aria-label="2 mcp 服务器测试 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>2. MCP 服务器测试</strong></h3>
<p>测试具有完整工具注册和执行的 MCP 服务器：</p>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token annotation punctuation">@AutoConfigureMockMvc</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">McpServerIntegrationTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">MockMvc</span> mockMvc<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ObjectMapper</span> objectMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testToolDiscovery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
<span class="token comment">// 测试发现端点</span>
        mockMvc<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/mcp/tools"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">jsonPath</span><span class="token punctuation">(</span><span class="token string">"$.tools"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">jsonPath</span><span class="token punctuation">(</span><span class="token string">"$.tools[*].name"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token function">hasItems</span><span class="token punctuation">(</span>
                <span class="token string">"weatherForecast"</span><span class="token punctuation">,</span> <span class="token string">"calculator"</span><span class="token punctuation">,</span> <span class="token string">"documentSearch"</span>
            <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testToolExecution</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
<span class="token comment">// 创建工具请求</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"toolName"</span><span class="token punctuation">,</span> <span class="token string">"calculator"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> parameters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        parameters<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"operation"</span><span class="token punctuation">,</span> <span class="token string">"add"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        parameters<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        parameters<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"parameters"</span><span class="token punctuation">,</span> parameters<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 发送请求并验证响应</span>
        mockMvc<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/mcp/execute"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">content</span><span class="token punctuation">(</span>objectMapper<span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">jsonPath</span><span class="token punctuation">(</span><span class="token string">"$.result.value"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testToolValidation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
<span class="token comment">// 创建无效的工具请求</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"toolName"</span><span class="token punctuation">,</span> <span class="token string">"calculator"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> parameters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        parameters<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"operation"</span><span class="token punctuation">,</span> <span class="token string">"divide"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        parameters<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 缺少参数 "b"</span>
        request<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"parameters"</span><span class="token punctuation">,</span> parameters<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 发送请求并验证错误响应</span>
        mockMvc<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/mcp/execute"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">content</span><span class="token punctuation">(</span>objectMapper<span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isBadRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">jsonPath</span><span class="token punctuation">(</span><span class="token string">"$.error"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h3 id="3-端到端测试" style="position:relative;"><a href="#3-%E7%AB%AF%E5%88%B0%E7%AB%AF%E6%B5%8B%E8%AF%95" aria-label="3 端到端测试 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>3. 端到端测试</strong></h3>
<p>测试从模型提示到工具执行的完整工作流：</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>mark<span class="token punctuation">.</span>asyncio</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">test_model_interaction_with_tool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token comment"># 安排 - 设置 MCP 客户端和模拟模型</span>
    mcp_client <span class="token operator">=</span> McpClient<span class="token punctuation">(</span>server_url<span class="token operator">=</span><span class="token string">"http://localhost:5000"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 模拟模型响应</span>
    mock_model <span class="token operator">=</span> MockLanguageModel<span class="token punctuation">(</span><span class="token punctuation">[</span>
        MockResponse<span class="token punctuation">(</span>
            <span class="token string">"What's the weather in Seattle?"</span><span class="token punctuation">,</span>
            tool_calls<span class="token operator">=</span><span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token string">"tool_name"</span><span class="token punctuation">:</span> <span class="token string">"weatherForecast"</span><span class="token punctuation">,</span>
                    <span class="token string">"parameters"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">"location"</span><span class="token punctuation">:</span> <span class="token string">"Seattle"</span><span class="token punctuation">,</span> <span class="token string">"days"</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        MockResponse<span class="token punctuation">(</span>
            <span class="token string">"Here's the weather forecast for Seattle:- Today: 65°F, Partly Cloudy- Tomorrow: 68°F, Sunny- Day after: 62°F, Rain"</span><span class="token punctuation">,</span>
            tool_calls<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 模拟天气工具响应with aioresponses() as mocked:</span>
        mocked<span class="token punctuation">.</span>post<span class="token punctuation">(</span>
            <span class="token string">"http://localhost:5000/mcp/execute"</span><span class="token punctuation">,</span>
            payload<span class="token operator">=</span><span class="token punctuation">{</span>
                <span class="token string">"result"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                    <span class="token string">"location"</span><span class="token punctuation">:</span> <span class="token string">"Seattle"</span><span class="token punctuation">,</span>
                    <span class="token string">"forecast"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
                        <span class="token punctuation">{</span><span class="token string">"date"</span><span class="token punctuation">:</span> <span class="token string">"2023-06-01"</span><span class="token punctuation">,</span> <span class="token string">"temperature"</span><span class="token punctuation">:</span> <span class="token number">65</span><span class="token punctuation">,</span> <span class="token string">"conditions"</span><span class="token punctuation">:</span> <span class="token string">"Partly Cloudy"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                        <span class="token punctuation">{</span><span class="token string">"date"</span><span class="token punctuation">:</span> <span class="token string">"2023-06-02"</span><span class="token punctuation">,</span> <span class="token string">"temperature"</span><span class="token punctuation">:</span> <span class="token number">68</span><span class="token punctuation">,</span> <span class="token string">"conditions"</span><span class="token punctuation">:</span> <span class="token string">"Sunny"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                        <span class="token punctuation">{</span><span class="token string">"date"</span><span class="token punctuation">:</span> <span class="token string">"2023-06-03"</span><span class="token punctuation">,</span> <span class="token string">"temperature"</span><span class="token punctuation">:</span> <span class="token number">62</span><span class="token punctuation">,</span> <span class="token string">"conditions"</span><span class="token punctuation">:</span> <span class="token string">"Rain"</span><span class="token punctuation">}</span>
                    <span class="token punctuation">]</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>

<span class="token comment"># 操作</span>
        response <span class="token operator">=</span> <span class="token keyword">await</span> mcp_client<span class="token punctuation">.</span>send_prompt<span class="token punctuation">(</span>
            <span class="token string">"What's the weather in Seattle?"</span><span class="token punctuation">,</span>
            model<span class="token operator">=</span>mock_model<span class="token punctuation">,</span>
            allowed_tools<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"weatherForecast"</span><span class="token punctuation">]</span>
        <span class="token punctuation">)</span>

<span class="token comment"># 断言assert "Seattle" in response.generated_text</span>
        <span class="token keyword">assert</span> <span class="token string">"65"</span> <span class="token keyword">in</span> response<span class="token punctuation">.</span>generated_text
        <span class="token keyword">assert</span> <span class="token string">"Sunny"</span> <span class="token keyword">in</span> response<span class="token punctuation">.</span>generated_text
        <span class="token keyword">assert</span> <span class="token string">"Rain"</span> <span class="token keyword">in</span> response<span class="token punctuation">.</span>generated_text
        <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>tool_calls<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span>
        <span class="token keyword">assert</span> response<span class="token punctuation">.</span>tool_calls<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>tool_name <span class="token operator">==</span> <span class="token string">"weatherForecast"</span>
</code></pre></div>
<h3 id="性能测试" style="position:relative;"><a href="#%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95" aria-label="性能测试 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>性能测试</strong></h3>
<h3 id="1-负载测试" style="position:relative;"><a href="#1-%E8%B4%9F%E8%BD%BD%E6%B5%8B%E8%AF%95" aria-label="1 负载测试 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>1. 负载测试</strong></h3>
<p>测试的 MCP 服务器可以处理多少并发请求：</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Fact</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">McpServer_HandlesHighConcurrency</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// 安排var server = new McpServer(</span>
        name<span class="token punctuation">:</span> <span class="token string">"TestServer"</span><span class="token punctuation">,</span>
        <span class="token named-parameter punctuation">version</span><span class="token punctuation">:</span> <span class="token string">"1.0"</span><span class="token punctuation">,</span>
        <span class="token named-parameter punctuation">maxConcurrentRequests</span><span class="token punctuation">:</span> <span class="token number">100</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    server<span class="token punctuation">.</span><span class="token function">RegisterTool</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">FastExecutingTool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> server<span class="token punctuation">.</span><span class="token function">StartAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">McpClient</span><span class="token punctuation">(</span><span class="token string">"http://localhost:5000"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 操作var tasks = new List&lt;Task&lt;McpResponse>>();</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        tasks<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">ExecuteToolAsync</span><span class="token punctuation">(</span><span class="token string">"fastTool"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> iteration <span class="token operator">=</span> i <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name"><span class="token keyword">var</span></span> results <span class="token operator">=</span> <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">WhenAll</span><span class="token punctuation">(</span>tasks<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 断言</span>
    Assert<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> results<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Assert<span class="token punctuation">.</span><span class="token function">All</span><span class="token punctuation">(</span>results<span class="token punctuation">,</span> r <span class="token operator">=></span> Assert<span class="token punctuation">.</span><span class="token function">NotNull</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h3 id="2-压力测试" style="position:relative;"><a href="#2-%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95" aria-label="2 压力测试 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>2. 压力测试</strong></h3>
<p>在极端负载下测试系统：</p>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testServerUnderStress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> maxUsers <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> rampUpTimeSeconds <span class="token operator">=</span> <span class="token number">60</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> testDurationSeconds <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">;</span>

<span class="token comment">// 设置 JMeter 进行压力测试StandardJMeterEngine jmeter = new StandardJMeterEngine();</span>

<span class="token comment">// 配置 JMeter 测试计划HashTree testPlanTree = new HashTree();</span>

<span class="token comment">// 创建测试计划、线程组、采样器等。TestPlan testPlan = new TestPlan("MCP Server Stress Test");</span>
    testPlanTree<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>testPlan<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">ThreadGroup</span> threadGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    threadGroup<span class="token punctuation">.</span><span class="token function">setNumThreads</span><span class="token punctuation">(</span>maxUsers<span class="token punctuation">)</span><span class="token punctuation">;</span>
    threadGroup<span class="token punctuation">.</span><span class="token function">setRampUp</span><span class="token punctuation">(</span>rampUpTimeSeconds<span class="token punctuation">)</span><span class="token punctuation">;</span>
    threadGroup<span class="token punctuation">.</span><span class="token function">setScheduler</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    threadGroup<span class="token punctuation">.</span><span class="token function">setDuration</span><span class="token punctuation">(</span>testDurationSeconds<span class="token punctuation">)</span><span class="token punctuation">;</span>

    testPlanTree<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>threadGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 添加用于工具执行的 HTTP 采样器HTTPSampler toolExecutionSampler = new HTTPSampler();</span>
    toolExecutionSampler<span class="token punctuation">.</span><span class="token function">setDomain</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    toolExecutionSampler<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    toolExecutionSampler<span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token string">"/mcp/execute"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    toolExecutionSampler<span class="token punctuation">.</span><span class="token function">setMethod</span><span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    toolExecutionSampler<span class="token punctuation">.</span><span class="token function">addArgument</span><span class="token punctuation">(</span><span class="token string">"toolName"</span><span class="token punctuation">,</span> <span class="token string">"calculator"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    toolExecutionSampler<span class="token punctuation">.</span><span class="token function">addArgument</span><span class="token punctuation">(</span><span class="token string">"parameters"</span><span class="token punctuation">,</span> <span class="token string">"{\"operation\":\"add\",\"a\":5,\"b\":7}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    threadGroup<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>toolExecutionSampler<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 添加侦听器SummaryReport summaryReport = new SummaryReport();</span>
    threadGroup<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>summaryReport<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 运行测试</span>
    jmeter<span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span>testPlanTree<span class="token punctuation">)</span><span class="token punctuation">;</span>
    jmeter<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 验证结果</span>
    <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> summaryReport<span class="token punctuation">.</span><span class="token function">getErrorCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertTrue</span><span class="token punctuation">(</span>summaryReport<span class="token punctuation">.</span><span class="token function">getAverage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 平均响应时间 &lt; 200ms</span>
    <span class="token function">assertTrue</span><span class="token punctuation">(</span>summaryReport<span class="token punctuation">.</span><span class="token function">getPercentile</span><span class="token punctuation">(</span><span class="token number">90.0</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 90% 百分位 &lt; 500ms</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h3 id="3-监控和分析" style="position:relative;"><a href="#3-%E7%9B%91%E6%8E%A7%E5%92%8C%E5%88%86%E6%9E%90" aria-label="3 监控和分析 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>3. 监控和分析</strong></h3>
<p>设置监控以进行长期性能分析：</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment"># 为 MCP 服务器配置监控def configure_monitoring(server):</span>
<span class="token comment"># 设置 Prometheus 指标</span>
    prometheus_metrics <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">"request_count"</span><span class="token punctuation">:</span> Counter<span class="token punctuation">(</span><span class="token string">"mcp_requests_total"</span><span class="token punctuation">,</span> <span class="token string">"总 MCP 请求数"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">"request_latency"</span><span class="token punctuation">:</span> Histogram<span class="token punctuation">(</span>
            <span class="token string">"mcp_request_duration_seconds"</span><span class="token punctuation">,</span>
            <span class="token string">"请求持续时间（秒）"</span><span class="token punctuation">,</span>
            buckets<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0.01</span><span class="token punctuation">,</span> <span class="token number">0.05</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">,</span> <span class="token number">10.0</span><span class="token punctuation">]</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">"tool_execution_count"</span><span class="token punctuation">:</span> Counter<span class="token punctuation">(</span>
            <span class="token string">"mcp_tool_executions_total"</span><span class="token punctuation">,</span>
            <span class="token string">"工具执行次数"</span><span class="token punctuation">,</span>
            labelnames<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"tool_name"</span><span class="token punctuation">]</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">"tool_execution_latency"</span><span class="token punctuation">:</span> Histogram<span class="token punctuation">(</span>
            <span class="token string">"mcp_tool_duration_seconds"</span><span class="token punctuation">,</span>
            <span class="token string">"工具执行持续时间（秒）"</span><span class="token punctuation">,</span>
            labelnames<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"tool_name"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            buckets<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0.01</span><span class="token punctuation">,</span> <span class="token number">0.05</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">,</span> <span class="token number">10.0</span><span class="token punctuation">]</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">"tool_errors"</span><span class="token punctuation">:</span> Counter<span class="token punctuation">(</span>
            <span class="token string">"mcp_tool_errors_total"</span><span class="token punctuation">,</span>
            <span class="token string">"工具执行错误"</span><span class="token punctuation">,</span>
            labelnames<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"tool_name"</span><span class="token punctuation">,</span> <span class="token string">"error_type"</span><span class="token punctuation">]</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

<span class="token comment"># 添加用于计时和记录指标的中间件</span>
    server<span class="token punctuation">.</span>add_middleware<span class="token punctuation">(</span>PrometheusMiddleware<span class="token punctuation">(</span>prometheus_metrics<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 公开指标端点    @server.router.get("/metrics")</span>
    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">metrics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> generate_latest<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> server
</code></pre></div>
<h2 id="mcp-工作流设计模式" style="position:relative;"><a href="#mcp-%E5%B7%A5%E4%BD%9C%E6%B5%81%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F" aria-label="mcp 工作流设计模式 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>MCP 工作流设计模式</strong></h2>
<p>精心设计的 MCP 工作流可以提高效率、可靠性和可维护性。以下是需要遵循的关键模式：</p>
<h3 id="1-工具链模式" style="position:relative;"><a href="#1-%E5%B7%A5%E5%85%B7%E9%93%BE%E6%A8%A1%E5%BC%8F" aria-label="1 工具链模式 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>1. 工具链模式</strong></h3>
<p>将多个工具按顺序连接起来，其中每个工具的输出都成为下一个工具的输入：</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment"># Python 工具链实现class ChainWorkflow:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> tools_chain<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>tools_chain <span class="token operator">=</span> tools_chain<span class="token comment"># 按顺序执行的工具名称列表</span>

    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">execute</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> mcp_client<span class="token punctuation">,</span> initial_input<span class="token punctuation">)</span><span class="token punctuation">:</span>
        current_result <span class="token operator">=</span> initial_input
        all_results <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"input"</span><span class="token punctuation">:</span> initial_input<span class="token punctuation">}</span>

        <span class="token keyword">for</span> tool_name <span class="token keyword">in</span> self<span class="token punctuation">.</span>tools_chain<span class="token punctuation">:</span>
<span class="token comment"># 执行链中的每个工具，传递上一个结果</span>
            response <span class="token operator">=</span> <span class="token keyword">await</span> mcp_client<span class="token punctuation">.</span>execute_tool<span class="token punctuation">(</span>tool_name<span class="token punctuation">,</span> current_result<span class="token punctuation">)</span>

<span class="token comment"># 存储结果并用作下一个工具的输入</span>
            all_results<span class="token punctuation">[</span>tool_name<span class="token punctuation">]</span> <span class="token operator">=</span> response<span class="token punctuation">.</span>result
            current_result <span class="token operator">=</span> response<span class="token punctuation">.</span>result

        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token string">"final_result"</span><span class="token punctuation">:</span> current_result<span class="token punctuation">,</span>
            <span class="token string">"all_results"</span><span class="token punctuation">:</span> all_results
        <span class="token punctuation">}</span>

<span class="token comment"># 用法示例</span>
data_processing_chain <span class="token operator">=</span> ChainWorkflow<span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token string">"dataFetch"</span><span class="token punctuation">,</span>
    <span class="token string">"dataCleaner"</span><span class="token punctuation">,</span>
    <span class="token string">"dataAnalyzer"</span><span class="token punctuation">,</span>
    <span class="token string">"dataVisualizer"</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

result <span class="token operator">=</span> <span class="token keyword">await</span> data_processing_chain<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>
    mcp_client<span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">"source"</span><span class="token punctuation">:</span> <span class="token string">"sales_database"</span><span class="token punctuation">,</span> <span class="token string">"table"</span><span class="token punctuation">:</span> <span class="token string">"transactions"</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre></div>
<h3 id="2-调度器模式" style="position:relative;"><a href="#2-%E8%B0%83%E5%BA%A6%E5%99%A8%E6%A8%A1%E5%BC%8F" aria-label="2 调度器模式 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>2. 调度器模式</strong></h3>
<p>使用一个中央工具，根据输入分派给专门的工具：</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ContentDispatcherTool</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IMcpTool</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IMcpClient</span> _mcpClient<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">ContentDispatcherTool</span><span class="token punctuation">(</span><span class="token class-name">IMcpClient</span> mcpClient<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _mcpClient <span class="token operator">=</span> mcpClient<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token operator">=></span> <span class="token string">"contentProcessor"</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Description <span class="token operator">=></span> <span class="token string">"处理各种类型的内容"</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">GetSchema</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            type <span class="token operator">=</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
            properties <span class="token operator">=</span> <span class="token punctuation">{</span>
                content <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> type <span class="token operator">=</span> <span class="token string">"string"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                contentType <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">{</span>
                    type <span class="token operator">=</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
                    <span class="token keyword">enum</span> <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token string">"text"</span><span class="token punctuation">,</span> <span class="token string">"html"</span><span class="token punctuation">,</span> <span class="token string">"markdown"</span><span class="token punctuation">,</span> <span class="token string">"csv"</span><span class="token punctuation">,</span> <span class="token string">"code"</span> <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                operation <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">{</span>
                    type <span class="token operator">=</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
                    <span class="token keyword">enum</span> <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token string">"summarize"</span><span class="token punctuation">,</span> <span class="token string">"analyze"</span><span class="token punctuation">,</span> <span class="token string">"extract"</span><span class="token punctuation">,</span> <span class="token string">"convert"</span> <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            required <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token string">"content"</span><span class="token punctuation">,</span> <span class="token string">"contentType"</span><span class="token punctuation">,</span> <span class="token string">"operation"</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>ToolResponse<span class="token punctuation">></span></span> <span class="token function">ExecuteAsync</span><span class="token punctuation">(</span><span class="token class-name">ToolRequest</span> request<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> content <span class="token operator">=</span> request<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">GetProperty</span><span class="token punctuation">(</span><span class="token string">"content"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> contentType <span class="token operator">=</span> request<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">GetProperty</span><span class="token punctuation">(</span><span class="token string">"contentType"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> operation <span class="token operator">=</span> request<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">GetProperty</span><span class="token punctuation">(</span><span class="token string">"operation"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 确定要使用的专用工具string targetTool = DetermineTargetTool(contentType, operation);</span>

<span class="token comment">// 转发到专用工具var specializedResponse = await _mcpClient.ExecuteToolAsync(</span>
            targetTool<span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token punctuation">{</span> content<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token function">GetOptionsForTool</span><span class="token punctuation">(</span>targetTool<span class="token punctuation">,</span> operation<span class="token punctuation">)</span> <span class="token punctuation">}</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ToolResponse</span> <span class="token punctuation">{</span> Result <span class="token operator">=</span> specializedResponse<span class="token punctuation">.</span>Result <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">DetermineTargetTool</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> contentType<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> operation<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>contentType<span class="token punctuation">,</span> operation<span class="token punctuation">)</span> <span class="token keyword">switch</span>
        <span class="token punctuation">{</span>
            <span class="token punctuation">(</span><span class="token string">"text"</span><span class="token punctuation">,</span> <span class="token string">"summarize"</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">"textSummarizer"</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token string">"text"</span><span class="token punctuation">,</span> <span class="token string">"analyze"</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">"textAnalyzer"</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token string">"html"</span><span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">"htmlProcessor"</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token string">"markdown"</span><span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">"markdownProcessor"</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token string">"csv"</span><span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">"csvProcessor"</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token string">"code"</span><span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">"codeAnalyzer"</span><span class="token punctuation">,</span>
            _ <span class="token operator">=></span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ToolExecutionException</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"没有可用于 </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">contentType</span><span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">operation</span><span class="token punctuation">}</span></span><span class="token string"> 的工具"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">GetOptionsForTool</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> toolName<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> operation<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
<span class="token comment">// 为每个专用工具返回适当的选项return toolName switch</span>
        <span class="token punctuation">{</span>
            <span class="token string">"textSummarizer"</span> <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token punctuation">{</span> length <span class="token operator">=</span> <span class="token string">"medium"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">"htmlProcessor"</span> <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token punctuation">{</span> cleanUp <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> operation <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// 其他工具的选项...</span>
            _ <span class="token operator">=></span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h3 id="3-并行处理模式" style="position:relative;"><a href="#3-%E5%B9%B6%E8%A1%8C%E5%A4%84%E7%90%86%E6%A8%A1%E5%BC%8F" aria-label="3 并行处理模式 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>3. 并行处理模式</strong></h3>
<p>为了提高效率，同时执行多个工具：</p>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ParallelDataProcessingWorkflow</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">McpClient</span> mcpClient<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">ParallelDataProcessingWorkflow</span><span class="token punctuation">(</span><span class="token class-name">McpClient</span> mcpClient<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mcpClient <span class="token operator">=</span> mcpClient<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">WorkflowResult</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">String</span> datasetId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">// 步骤 1：获取数据集元数据（同步）ToolResponse metadataResponse = mcpClient.executeTool("datasetMetadata",</span>
            <span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"datasetId"</span><span class="token punctuation">,</span> datasetId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 步骤 2：并行启动多个分析</span>
        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ToolResponse</span><span class="token punctuation">></span></span> statisticalAnalysis <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span>
            mcpClient<span class="token punctuation">.</span><span class="token function">executeTool</span><span class="token punctuation">(</span><span class="token string">"statisticalAnalysis"</span><span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>
                <span class="token string">"datasetId"</span><span class="token punctuation">,</span> datasetId<span class="token punctuation">,</span>
                <span class="token string">"type"</span><span class="token punctuation">,</span> <span class="token string">"comprehensive"</span>
            <span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ToolResponse</span><span class="token punctuation">></span></span> correlationAnalysis <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span>
            mcpClient<span class="token punctuation">.</span><span class="token function">executeTool</span><span class="token punctuation">(</span><span class="token string">"correlationAnalysis"</span><span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>
                <span class="token string">"datasetId"</span><span class="token punctuation">,</span> datasetId<span class="token punctuation">,</span>
                <span class="token string">"method"</span><span class="token punctuation">,</span> <span class="token string">"pearson"</span>
            <span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ToolResponse</span><span class="token punctuation">></span></span> outlierDetection <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span>
            mcpClient<span class="token punctuation">.</span><span class="token function">executeTool</span><span class="token punctuation">(</span><span class="token string">"outlierDetection"</span><span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>
                <span class="token string">"datasetId"</span><span class="token punctuation">,</span> datasetId<span class="token punctuation">,</span>
                <span class="token string">"sensitivity"</span><span class="token punctuation">,</span> <span class="token string">"medium"</span>
            <span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 等待所有并行任务完成</span>
        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">></span></span> allAnalyses <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">allOf</span><span class="token punctuation">(</span>
            statisticalAnalysis<span class="token punctuation">,</span> correlationAnalysis<span class="token punctuation">,</span> outlierDetection
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        allAnalyses<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 等待完成</span>

<span class="token comment">// 步骤 3：合并结果</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> combinedResults <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        combinedResults<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"metadata"</span><span class="token punctuation">,</span> metadataResponse<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        combinedResults<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"statistics"</span><span class="token punctuation">,</span> statisticalAnalysis<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        combinedResults<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"correlations"</span><span class="token punctuation">,</span> correlationAnalysis<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        combinedResults<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"outliers"</span><span class="token punctuation">,</span> outlierDetection<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 步骤 4：生成摘要报告ToolResponse summaryResponse = mcpClient.executeTool("reportGenerator",</span>
            <span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"analysisResults"</span><span class="token punctuation">,</span> combinedResults<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 返回完整的工作流结果WorkflowResult result = new WorkflowResult();</span>
        result<span class="token punctuation">.</span><span class="token function">setDatasetId</span><span class="token punctuation">(</span>datasetId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">setAnalysisResults</span><span class="token punctuation">(</span>combinedResults<span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">setSummaryReport</span><span class="token punctuation">(</span>summaryResponse<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h3 id="4-错误恢复模式" style="position:relative;"><a href="#4-%E9%94%99%E8%AF%AF%E6%81%A2%E5%A4%8D%E6%A8%A1%E5%BC%8F" aria-label="4 错误恢复模式 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>4. 错误恢复模式</strong></h3>
<p>为工具故障实施优雅的回退：</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">ResilientWorkflow</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> mcp_client<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>client <span class="token operator">=</span> mcp_client

    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">execute_with_fallback</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> primary_tool<span class="token punctuation">,</span> fallback_tool<span class="token punctuation">,</span> parameters<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
<span class="token comment"># 首先尝试主工具</span>
            response <span class="token operator">=</span> <span class="token keyword">await</span> self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>execute_tool<span class="token punctuation">(</span>primary_tool<span class="token punctuation">,</span> parameters<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                <span class="token string">"result"</span><span class="token punctuation">:</span> response<span class="token punctuation">.</span>result<span class="token punctuation">,</span>
                <span class="token string">"source"</span><span class="token punctuation">:</span> <span class="token string">"primary"</span><span class="token punctuation">,</span>
                <span class="token string">"tool"</span><span class="token punctuation">:</span> primary_tool
            <span class="token punctuation">}</span>
        <span class="token keyword">except</span> ToolExecutionException <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token comment"># 记录失败</span>
            logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"主工具 '</span><span class="token interpolation"><span class="token punctuation">{</span>primary_tool<span class="token punctuation">}</span></span><span class="token string">' 失败: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 回退到辅助工具try:</span>
<span class="token comment"># 可能需要为回退工具转换参数</span>
                fallback_params <span class="token operator">=</span> self<span class="token punctuation">.</span>_adapt_parameters<span class="token punctuation">(</span>parameters<span class="token punctuation">,</span> primary_tool<span class="token punctuation">,</span> fallback_tool<span class="token punctuation">)</span>

                response <span class="token operator">=</span> <span class="token keyword">await</span> self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>execute_tool<span class="token punctuation">(</span>fallback_tool<span class="token punctuation">,</span> fallback_params<span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token punctuation">{</span>
                    <span class="token string">"result"</span><span class="token punctuation">:</span> response<span class="token punctuation">.</span>result<span class="token punctuation">,</span>
                    <span class="token string">"source"</span><span class="token punctuation">:</span> <span class="token string">"fallback"</span><span class="token punctuation">,</span>
                    <span class="token string">"tool"</span><span class="token punctuation">:</span> fallback_tool<span class="token punctuation">,</span>
                    <span class="token string">"primaryError"</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token keyword">except</span> ToolExecutionException <span class="token keyword">as</span> fallback_error<span class="token punctuation">:</span>
<span class="token comment"># 两个工具都失败了</span>
                logging<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"主工具和回退工具都失败了。回退错误: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>fallback_error<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">raise</span> WorkflowExecutionException<span class="token punctuation">(</span>
                    <span class="token string-interpolation"><span class="token string">f"工作流失败：主错误: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">; 回退错误: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>fallback_error<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
                <span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">_adapt_parameters</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> params<span class="token punctuation">,</span> from_tool<span class="token punctuation">,</span> to_tool<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""如果需要，在不同工具之间调整参数"""</span>
<span class="token comment"># 此实现将取决于具体的工具# 对于此示例，我们将只返回原始参数return params</span>

<span class="token comment"># 用法示例async def get_weather(workflow, location):</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> workflow<span class="token punctuation">.</span>execute_with_fallback<span class="token punctuation">(</span>
        <span class="token string">"premiumWeatherService"</span><span class="token punctuation">,</span><span class="token comment"># 主（付费）天气 API"basicWeatherService",# 回退（免费）天气 API</span>
        <span class="token punctuation">{</span><span class="token string">"location"</span><span class="token punctuation">:</span> location<span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
</code></pre></div>
<h3 id="5-工作流组合模式" style="position:relative;"><a href="#5-%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F" aria-label="5 工作流组合模式 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>5. 工作流组合模式</strong></h3>
<p>通过组合更简单的工作流来构建复杂的工作流：</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompositeWorkflow</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IWorkflow</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">List<span class="token punctuation">&lt;</span>IWorkflow<span class="token punctuation">></span></span> _workflows<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">CompositeWorkflow</span><span class="token punctuation">(</span><span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>IWorkflow<span class="token punctuation">></span></span> workflows<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _workflows <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>IWorkflow<span class="token punctuation">></span></span><span class="token punctuation">(</span>workflows<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>WorkflowResult<span class="token punctuation">></span></span> <span class="token function">ExecuteAsync</span><span class="token punctuation">(</span><span class="token class-name">WorkflowContext</span> context<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> results <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">object</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> workflow <span class="token keyword">in</span> _workflows<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> workflowResult <span class="token operator">=</span> <span class="token keyword">await</span> workflow<span class="token punctuation">.</span><span class="token function">ExecuteAsync</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 存储每个工作流的结果</span>
            results<span class="token punctuation">[</span>workflow<span class="token punctuation">.</span>Name<span class="token punctuation">]</span> <span class="token operator">=</span> workflowResult<span class="token punctuation">;</span>

<span class="token comment">// 使用结果更新上下文以用于下一个工作流</span>
            context <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">WithResult</span><span class="token punctuation">(</span>workflow<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> workflowResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WorkflowResult</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token operator">=></span> <span class="token string">"CompositeWorkflow"</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Description <span class="token operator">=></span> <span class="token string">"按顺序执行多个工作流"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 用法示例var documentWorkflow = new CompositeWorkflow(new IWorkflow[] {</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DocumentFetchWorkflow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DocumentProcessingWorkflow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">InsightGenerationWorkflow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ReportGenerationWorkflow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> <span class="token keyword">await</span> documentWorkflow<span class="token punctuation">.</span><span class="token function">ExecuteAsync</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">WorkflowContext</span> <span class="token punctuation">{</span>
    Parameters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> documentId <span class="token operator">=</span> <span class="token string">"12345"</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<h1 id="测试-mcp-服务器最佳实践和重要提示" style="position:relative;"><a href="#%E6%B5%8B%E8%AF%95-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E5%92%8C%E9%87%8D%E8%A6%81%E6%8F%90%E7%A4%BA" aria-label="测试 mcp 服务器最佳实践和重要提示 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>测试 MCP 服务器：最佳实践和重要提示</strong></h1>
<h2 id="概述" style="position:relative;"><a href="#%E6%A6%82%E8%BF%B0" aria-label="概述 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>概述</strong></h2>
<p>测试是开发可靠、高质量 MCP 服务器的关键环节。本指南提供了在整个开发生命周期中测试 MCP 服务器的全面最佳实践和技巧，从单元测试到集成测试和端到端验证。</p>
<h2 id="为什么测试对-mcp-服务器很重要" style="position:relative;"><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E6%B5%8B%E8%AF%95%E5%AF%B9-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%BE%88%E9%87%8D%E8%A6%81" aria-label="为什么测试对 mcp 服务器很重要 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>为什么测试对 MCP 服务器很重要</strong></h2>
<p>MCP 服务器是 AI 模型和客户端应用程序之间的关键中间件。全面的测试可确保：</p>
<ul>
<li>在生产环境中的可靠性</li>
<li>准确处理请求和响应</li>
<li>正确实施 MCP 规</li>
<li>应对故障和边缘情况的弹性</li>
<li>在各种负载下保持一致的性能</li>
</ul>
<h2 id="mcp-服务器的单元测试" style="position:relative;"><a href="#mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95" aria-label="mcp 服务器的单元测试 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>MCP 服务器的单元测试</strong></h2>
<h3 id="单元测试基础" style="position:relative;"><a href="#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E5%9F%BA%E7%A1%80" aria-label="单元测试基础 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>单元测试（基础）</strong></h3>
<p>单元测试可独立验证 MCP 服务器的各个组件。</p>
<h3 id="测试内容" style="position:relative;"><a href="#%E6%B5%8B%E8%AF%95%E5%86%85%E5%AE%B9" aria-label="测试内容 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>测试内容</strong></h3>
<ol>
<li><strong>资源处理程序</strong>：独立测试每个资源处理程序的逻辑</li>
<li><strong>工具实现</strong>：使用各种输入验证工具行为</li>
<li><strong>提示模板</strong>：确保提示模板正确呈现</li>
<li><strong>模式验证</strong>：测试参数验证逻辑</li>
<li><strong>错误处理</strong>：验证无效输入的错误响应</li>
</ol>
<h3 id="单元测试最佳实践" style="position:relative;"><a href="#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5" aria-label="单元测试最佳实践 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>单元测试最佳实践</strong></h3>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token comment">// C# 中计算器工具的单元测试示例</span>
<span class="token punctuation">[</span>Fact<span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">CalculatorTool_Add_ReturnsCorrectSum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// 安排var calculator = new CalculatorTool();</span>
    <span class="token class-name"><span class="token keyword">var</span></span> parameters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">object</span><span class="token punctuation">></span></span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token string">"operation"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"add"</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token string">"a"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token string">"b"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">7</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 操作var response = await calculator.ExecuteAsync(parameters);</span>
    <span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> JsonSerializer<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Deserialize</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>CalculationResult<span class="token punctuation">></span></span></span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>Content<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 断言</span>
    Assert<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>Value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment"># Python 中计算器工具的单元测试示例def test_calculator_tool_add():</span>
<span class="token comment"># 安排</span>
    calculator <span class="token operator">=</span> CalculatorTool<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    parameters <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">"operation"</span><span class="token punctuation">:</span> <span class="token string">"add"</span><span class="token punctuation">,</span>
        <span class="token string">"a"</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
        <span class="token string">"b"</span><span class="token punctuation">:</span> <span class="token number">7</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment"># 操作</span>
    response <span class="token operator">=</span> calculator<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>parameters<span class="token punctuation">)</span><span class="token punctuation">;</span>
    result <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>response<span class="token punctuation">.</span>content<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 断言assert result["value"] == 12</span>
</code></pre></div>
<h3 id="集成测试中间层" style="position:relative;"><a href="#%E9%9B%86%E6%88%90%E6%B5%8B%E8%AF%95%E4%B8%AD%E9%97%B4%E5%B1%82" aria-label="集成测试中间层 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>集成测试（中间层）</strong></h3>
<p>集成测试验证 MCP 服务器组件之间的交互。</p>
<h3 id="测试内容-1" style="position:relative;"><a href="#%E6%B5%8B%E8%AF%95%E5%86%85%E5%AE%B9-1" aria-label="测试内容 1 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>测试内容</strong></h3>
<ol>
<li><strong>服务器初始化</strong>：使用各种配置测试服务器启动</li>
<li><strong>路由注册</strong>：验证所有端点是否正确注册</li>
<li><strong>请求处理</strong>：测试完整的请求-响应周期</li>
<li><strong>错误传播</strong>：确保错误在组件之间得到正确处理</li>
<li><strong>身份验证和授权</strong>：测试安全机制</li>
</ol>
<h3 id="集成测试最佳实践" style="position:relative;"><a href="#%E9%9B%86%E6%88%90%E6%B5%8B%E8%AF%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5" aria-label="集成测试最佳实践 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>集成测试最佳实践</strong></h3>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token comment">// C# 中 MCP 服务器的集成测试示例</span>
<span class="token punctuation">[</span>Fact<span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Server_ProcessToolRequest_ReturnsValidResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// 安排var server = new McpServer();</span>
    server<span class="token punctuation">.</span><span class="token function">RegisterTool</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">CalculatorTool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> server<span class="token punctuation">.</span><span class="token function">StartAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">var</span></span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">McpRequest</span>
    <span class="token punctuation">{</span>
        Tool <span class="token operator">=</span> <span class="token string">"calculator"</span><span class="token punctuation">,</span>
        Parameters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">object</span><span class="token punctuation">></span></span>
        <span class="token punctuation">{</span>
            <span class="token punctuation">[</span><span class="token string">"operation"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"multiply"</span><span class="token punctuation">,</span>
            <span class="token punctuation">[</span><span class="token string">"a"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">,</span>
            <span class="token punctuation">[</span><span class="token string">"b"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">7</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 操作var response = await server.ProcessRequestAsync(request);</span>

<span class="token comment">// 断言</span>
    Assert<span class="token punctuation">.</span><span class="token function">NotNull</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Assert<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>McpStatusCodes<span class="token punctuation">.</span>Success<span class="token punctuation">,</span> response<span class="token punctuation">.</span>StatusCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 对响应内容的其他断言</span>

<span class="token comment">// 清理await server.StopAsync();</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h3 id="端到端测试顶层" style="position:relative;"><a href="#%E7%AB%AF%E5%88%B0%E7%AB%AF%E6%B5%8B%E8%AF%95%E9%A1%B6%E5%B1%82" aria-label="端到端测试顶层 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>端到端测试（顶层）</strong></h3>
<p>端到端测试验证从客户端到服务器的完整系统行为。</p>
<h3 id="测试内容-2" style="position:relative;"><a href="#%E6%B5%8B%E8%AF%95%E5%86%85%E5%AE%B9-2" aria-label="测试内容 2 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>测试内容</strong></h3>
<ol>
<li><strong>客户端-服务器通信</strong>：测试完整的请求-响应周期</li>
<li><strong>真实客户端 SDK</strong>：使用实际的客户端实现进行测试</li>
<li><strong>负载下的性能</strong>：验证多个并发请求下的行为</li>
<li><strong>错误恢复</strong>：测试系统从故障中恢复的能力</li>
<li><strong>长时间运行的操作</strong>：验证流式处理和长时间运行操作的处理</li>
</ol>
<h3 id="e2e-测试最佳实践" style="position:relative;"><a href="#e2e-%E6%B5%8B%E8%AF%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5" aria-label="e2e 测试最佳实践 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>E2E 测试最佳实践</strong></h3>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// 使用 TypeScript 客户端的 E2E 测试示例describe('MCP Server E2E Tests', () => {</span>
  <span class="token keyword">let</span> client<span class="token operator">:</span> McpClient<span class="token punctuation">;</span>

  <span class="token function">beforeAll</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="token comment">// 在测试环境中启动服务器await startTestServer();</span>
    client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">McpClient</span><span class="token punctuation">(</span><span class="token string">'http://localhost:5000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">afterAll</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">stopTestServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'客户端可以调用计算器工具并获得正确的结果'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="token comment">// 操作const response = await client.invokeToolAsync('calculator', {</span>
      operation<span class="token operator">:</span> <span class="token string">'divide'</span><span class="token punctuation">,</span>
      a<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
      b<span class="token operator">:</span> <span class="token number">4</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 断言expect(response.statusCode).toBe(200);</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>content<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toContain</span><span class="token punctuation">(</span><span class="token string">'5'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<h2 id="mcp-测试的模拟策略" style="position:relative;"><a href="#mcp-%E6%B5%8B%E8%AF%95%E7%9A%84%E6%A8%A1%E6%8B%9F%E7%AD%96%E7%95%A5" aria-label="mcp 测试的模拟策略 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>MCP 测试的模拟策略</strong></h2>
<p>模拟对于在测试期间隔离组件至关重要。</p>
<h3 id="要模拟的组件" style="position:relative;"><a href="#%E8%A6%81%E6%A8%A1%E6%8B%9F%E7%9A%84%E7%BB%84%E4%BB%B6" aria-label="要模拟的组件 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>要模拟的组件</strong></h3>
<ol>
<li><strong>外部 AI 模型</strong>：模拟模型响应以进行可预测的测试</li>
<li><strong>外部服务</strong>：模拟 API 依赖项（数据库、第三方服务）</li>
<li><strong>身份验证服务</strong>：模拟身份提供程序</li>
<li><strong>资源提供程序</strong>：模拟昂贵的资源处理程序</li>
</ol>
<h3 id="示例模拟-ai-模型响应" style="position:relative;"><a href="#%E7%A4%BA%E4%BE%8B%E6%A8%A1%E6%8B%9F-ai-%E6%A8%A1%E5%9E%8B%E5%93%8D%E5%BA%94" aria-label="示例模拟 ai 模型响应 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>示例：模拟 AI 模型响应</strong></h3>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token comment">// 使用 Moq 的 C# 示例var mockModel = new Mock&lt;ILanguageModel>();</span>
mockModel
    <span class="token punctuation">.</span><span class="token function">Setup</span><span class="token punctuation">(</span>m <span class="token operator">=></span> m<span class="token punctuation">.</span><span class="token function">GenerateResponseAsync</span><span class="token punctuation">(</span>
        It<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">IsAny</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        It<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">IsAny</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>McpRequestContext<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">ReturnsAsync</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">ModelResponse</span> <span class="token punctuation">{</span>
        Text <span class="token operator">=</span> <span class="token string">"模拟的模型响应"</span><span class="token punctuation">,</span>
        FinishReason <span class="token operator">=</span> FinishReason<span class="token punctuation">.</span>Completed
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">McpServer</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">modelClient</span><span class="token punctuation">:</span> mockModel<span class="token punctuation">.</span>Object<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment"># 使用 unittest.mock 的 Python 示例@patch('mcp_server.models.OpenAIModel')</span>
<span class="token keyword">def</span> <span class="token function">test_with_mock_model</span><span class="token punctuation">(</span>mock_model<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token comment"># 配置模拟</span>
    mock_model<span class="token punctuation">.</span>return_value<span class="token punctuation">.</span>generate_response<span class="token punctuation">.</span>return_value <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">"text"</span><span class="token punctuation">:</span> <span class="token string">"模拟的模型响应"</span><span class="token punctuation">,</span>
        <span class="token string">"finish_reason"</span><span class="token punctuation">:</span> <span class="token string">"completed"</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment"># 在测试中使用模拟</span>
    server <span class="token operator">=</span> McpServer<span class="token punctuation">(</span>model_client<span class="token operator">=</span>mock_model<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment"># 继续测试</span></code></pre></div>
<h2 id="性能测试-1" style="position:relative;"><a href="#%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95-1" aria-label="性能测试 1 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>性能测试</strong></h2>
<p>性能测试对于生产 MCP 服务器至关重要。</p>
<h3 id="测量内容" style="position:relative;"><a href="#%E6%B5%8B%E9%87%8F%E5%86%85%E5%AE%B9" aria-label="测量内容 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>测量内容</strong></h3>
<ol>
<li><strong>延迟</strong>：请求的响应时间</li>
<li><strong>吞吐量</strong>：每秒处理的请求数</li>
<li><strong>资源利用率</strong>：CPU、内存、网络使用情况</li>
<li><strong>并发处理</strong>：并行请求下的行为</li>
<li><strong>扩展特性</strong>：负载增加时的性能</li>
</ol>
<h3 id="性能测试工具" style="position:relative;"><a href="#%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7" aria-label="性能测试工具 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>性能测试工具</strong></h3>
<ul>
<li><strong>k6</strong>：开源负载测试工具</li>
<li><strong>JMeter</strong>：全面的性能测试</li>
<li><strong>Locust</strong>：基于 Python 的负载测试</li>
<li><strong>Azure 负载测试</strong>：基于云的性能测试</li>
</ul>
<h3 id="示例使用-k6-进行基本负载测试" style="position:relative;"><a href="#%E7%A4%BA%E4%BE%8B%E4%BD%BF%E7%94%A8-k6-%E8%BF%9B%E8%A1%8C%E5%9F%BA%E6%9C%AC%E8%B4%9F%E8%BD%BD%E6%B5%8B%E8%AF%95" aria-label="示例使用 k6 进行基本负载测试 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>示例：使用 k6 进行基本负载测试</strong></h3>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// 用于对 MCP 服务器进行负载测试的 k6 脚本import http from 'k6/http';</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> check<span class="token punctuation">,</span> sleep <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'k6'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">vus</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span><span class="token comment">// 10 个虚拟用户duration: '30s',</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> payload <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">tool</span><span class="token operator">:</span> <span class="token string">'calculator'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">parameters</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">operation</span><span class="token operator">:</span> <span class="token string">'add'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">a</span><span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">b</span><span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
      <span class="token string-property property">'Authorization'</span><span class="token operator">:</span> <span class="token string">'Bearer test-token'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> res <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'http://localhost:5000/api/tools/invoke'</span><span class="token punctuation">,</span> payload<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">check</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token string-property property">'status is 200'</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token operator">=></span> r<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">,</span>
    <span class="token string-property property">'response time &lt; 500ms'</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token operator">=></span> r<span class="token punctuation">.</span>timings<span class="token punctuation">.</span>duration <span class="token operator">&lt;</span> <span class="token number">500</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h2 id="mcp-服务器的测试自动化" style="position:relative;"><a href="#mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E6%B5%8B%E8%AF%95%E8%87%AA%E5%8A%A8%E5%8C%96" aria-label="mcp 服务器的测试自动化 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>MCP 服务器的测试自动化</strong></h2>
<p>自动化测试可确保一致的质量和更快的反馈循环。</p>
<h3 id="cicd-集成" style="position:relative;"><a href="#cicd-%E9%9B%86%E6%88%90" aria-label="cicd 集成 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>CI/CD 集成</strong></h3>
<ol>
<li><strong>在拉取请求上运行单元测试</strong>：确保代码更改不会破坏现有功能</li>
<li><strong>在暂存环境中进行集成测试</strong>：在预生产环境中运行集成测试</li>
<li><strong>性能基准</strong>：维护性能基准以捕获回归</li>
<li><strong>安全扫描</strong>：将安全测试自动化为管道的一部分</li>
</ol>
<h3 id="ci-管道示例-github-actions" style="position:relative;"><a href="#ci-%E7%AE%A1%E9%81%93%E7%A4%BA%E4%BE%8B-github-actions" aria-label="ci 管道示例 github actions permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>CI 管道示例 (GitHub Actions)</strong></h3>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">name</span><span class="token punctuation">:</span> MCP 服务器测试

<span class="token key atrule">on</span><span class="token punctuation">:</span>
  <span class="token key atrule">push</span><span class="token punctuation">:</span>
    <span class="token key atrule">branches</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> main <span class="token punctuation">]</span>
  <span class="token key atrule">pull_request</span><span class="token punctuation">:</span>
    <span class="token key atrule">branches</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> main <span class="token punctuation">]</span>

<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">test</span><span class="token punctuation">:</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest

    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v2

    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 设置运行时
      <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>dotnet@v1
      <span class="token key atrule">with</span><span class="token punctuation">:</span>
        <span class="token key atrule">dotnet-version</span><span class="token punctuation">:</span> <span class="token string">'8.0.x'</span>

    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 还原依赖项
      <span class="token key atrule">run</span><span class="token punctuation">:</span> dotnet restore

    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 构建
      <span class="token key atrule">run</span><span class="token punctuation">:</span> dotnet build <span class="token punctuation">-</span><span class="token punctuation">-</span>no<span class="token punctuation">-</span>restore

    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 单元测试
      <span class="token key atrule">run</span><span class="token punctuation">:</span> dotnet test <span class="token punctuation">-</span><span class="token punctuation">-</span>no<span class="token punctuation">-</span>build <span class="token punctuation">-</span><span class="token punctuation">-</span>filter Category=Unit

    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 集成测试
      <span class="token key atrule">run</span><span class="token punctuation">:</span> dotnet test <span class="token punctuation">-</span><span class="token punctuation">-</span>no<span class="token punctuation">-</span>build <span class="token punctuation">-</span><span class="token punctuation">-</span>filter Category=Integration

    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 性能测试
      <span class="token key atrule">run</span><span class="token punctuation">:</span> dotnet run <span class="token punctuation">-</span><span class="token punctuation">-</span>project tests/PerformanceTests/PerformanceTests.csproj
</code></pre></div>
<h2 id="测试是否符合-mcp-规范" style="position:relative;"><a href="#%E6%B5%8B%E8%AF%95%E6%98%AF%E5%90%A6%E7%AC%A6%E5%90%88-mcp-%E8%A7%84%E8%8C%83" aria-label="测试是否符合 mcp 规范 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>测试是否符合 MCP 规范</strong></h2>
<p>验证的服务器是否正确实施了 MCP 规范。</p>
<h3 id="关键合规领域" style="position:relative;"><a href="#%E5%85%B3%E9%94%AE%E5%90%88%E8%A7%84%E9%A2%86%E5%9F%9F" aria-label="关键合规领域 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>关键合规领域</strong></h3>
<ol>
<li><strong>API 端点</strong>：测试必需的端点（/resources、/tools 等）</li>
<li><strong>请求/响应格式</strong>：验证模式合规性</li>
<li><strong>错误代码</strong>：验证各种场景的正确状态代码</li>
<li><strong>内容类型</strong>：测试不同内容类型的处理</li>
<li><strong>身份验证流程</strong>：验证符合规范的身份验证机制</li>
</ol>
<h3 id="合规性测试套件" style="position:relative;"><a href="#%E5%90%88%E8%A7%84%E6%80%A7%E6%B5%8B%E8%AF%95%E5%A5%97%E4%BB%B6" aria-label="合规性测试套件 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>合规性测试套件</strong></h3>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Fact</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Server_ResourceEndpoint_ReturnsCorrectSchema</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// 安排var client = new HttpClient();</span>
    client<span class="token punctuation">.</span>DefaultRequestHeaders<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"Authorization"</span><span class="token punctuation">,</span> <span class="token string">"Bearer test-token"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 操作var response = await client.GetAsync("http://localhost:5000/api/resources");</span>
    <span class="token class-name"><span class="token keyword">var</span></span> content <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span>Content<span class="token punctuation">.</span><span class="token function">ReadAsStringAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> resources <span class="token operator">=</span> JsonSerializer<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Deserialize</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ResourceList<span class="token punctuation">></span></span></span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 断言</span>
    Assert<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>HttpStatusCode<span class="token punctuation">.</span>OK<span class="token punctuation">,</span> response<span class="token punctuation">.</span>StatusCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Assert<span class="token punctuation">.</span><span class="token function">NotNull</span><span class="token punctuation">(</span>resources<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Assert<span class="token punctuation">.</span><span class="token function">All</span><span class="token punctuation">(</span>resources<span class="token punctuation">.</span>Resources<span class="token punctuation">,</span> resource <span class="token operator">=></span>
    <span class="token punctuation">{</span>
        Assert<span class="token punctuation">.</span><span class="token function">NotNull</span><span class="token punctuation">(</span>resource<span class="token punctuation">.</span>Id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Assert<span class="token punctuation">.</span><span class="token function">NotNull</span><span class="token punctuation">(</span>resource<span class="token punctuation">.</span>Type<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 其他模式验证</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h2 id="有效-mcp-服务器测试的-10-大技巧" style="position:relative;"><a href="#%E6%9C%89%E6%95%88-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%B5%8B%E8%AF%95%E7%9A%84-10-%E5%A4%A7%E6%8A%80%E5%B7%A7" aria-label="有效 mcp 服务器测试的 10 大技巧 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>有效 MCP 服务器测试的 10 大技巧</strong></h2>
<ol>
<li><strong>单独测试工具定义</strong>：独立于工具逻辑验证模式定义</li>
<li><strong>使用参数化测试</strong>：使用各种输入（包括边缘情况）测试工具</li>
<li><strong>检查错误响应</strong>：验证所有可能错误条件的正确错误处理</li>
<li><strong>测试授权逻辑</strong>：确保对不同用户角色的正确访问控制</li>
<li><strong>监控测试覆盖率</strong>：力求关键路径代码的高覆盖率</li>
<li><strong>测试流式响应</strong>：验证流式内容的正确处理</li>
<li><strong>模拟网络问题</strong>：在恶劣的网络条件下测试行为</li>
<li><strong>测试资源限制</strong>：验证达到配额或速率限制时的行为</li>
<li><strong>自动化回归测试</strong>：构建一个在每次代码更改时运行的套件</li>
<li><strong>记录测试用例</strong>：维护清晰的测试场景文档</li>
</ol>
<h2 id="常见的测试陷阱" style="position:relative;"><a href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E6%B5%8B%E8%AF%95%E9%99%B7%E9%98%B1" aria-label="常见的测试陷阱 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>常见的测试陷阱</strong></h2>
<ul>
<li><strong>过度依赖“正常路径”测试</strong>：确保彻底测试错误情况</li>
<li><strong>忽略性能测试</strong>：在影响生产之前识别瓶颈</li>
<li><strong>仅在隔离环境中测试</strong>：结合单元、集成和 E2E 测试</li>
<li><strong>API 覆盖不完整</strong>：确保测试所有端点和功能</li>
<li><strong>测试环境不一致</strong>：使用容器确保一致的测试环境</li>
</ul>
<h2 id="结论" style="position:relative;"><a href="#%E7%BB%93%E8%AE%BA" aria-label="结论 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>结论</strong></h2>
<p>全面的测试策略对于开发可靠、高质量的 MCP 服务器至关重要。通过实施本指南中概述的最佳实践和技巧，可以确保的 MCP 实施符合最高的质量、可靠性和性能标准。</p>
<h2 id="关键要点-2" style="position:relative;"><a href="#%E5%85%B3%E9%94%AE%E8%A6%81%E7%82%B9-2" aria-label="关键要点 2 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>关键要点</strong></h2>
<ol>
<li><strong>工具设计</strong>：遵循单一职责原则，使用依赖注入，并为可组合性进行设计</li>
<li><strong>模式设计</strong>：创建具有适当验证约束的清晰、文档齐全的模式</li>
<li><strong>错误处理</strong>：实施优雅的错误处理、结构化的错误响应和重试逻辑</li>
<li><strong>性能</strong>：使用缓存、异步处理和资源限制</li>
<li><strong>安全</strong>：应用彻底的输入验证、授权检查和敏感数据处理</li>
<li><strong>测试</strong>：创建全面的单元、集成和端到端测试</li>
<li><strong>工作流模式</strong>：应用既定的模式，如链、调度程序和并行处理</li>
</ol>
<h1 id="09-mcp-案例研究" style="position:relative;"><a href="#09-mcp-%E6%A1%88%E4%BE%8B%E7%A0%94%E7%A9%B6" aria-label="09 mcp 案例研究 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>09-MCP 案例研究</strong></h1>
<h2 id="特色案例研究" style="position:relative;"><a href="#%E7%89%B9%E8%89%B2%E6%A1%88%E4%BE%8B%E7%A0%94%E7%A9%B6" aria-label="特色案例研究 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>特色案例研究</strong></h2>
<h3 id="1azure-ai-旅行社--参考实现" style="position:relative;"><a href="#1azure-ai-%E6%97%85%E8%A1%8C%E7%A4%BE--%E5%8F%82%E8%80%83%E5%AE%9E%E7%8E%B0" aria-label="1azure ai 旅行社  参考实现 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>1. Azure AI 旅行社 – 参考实现</strong></h3>
<p>本案例研究探讨了微软的综合参考解决方案，该解决方案演示了如何使用 MCP、Azure OpenAI 和 Azure AI 搜索构建一个多代理、AI 驱动的旅行计划应用程序。该项目展示了：</p>
<ul>
<li>通过 MCP 进行多代理编排</li>
<li>与 Azure AI 搜索的企业数据集成</li>
<li>使用 Azure 服务的安全、可扩展的架构</li>
<li>带有可重用 MCP 组件的可扩展工具</li>
<li>由 Azure OpenAI 提供支持的对话式用户体验</li>
</ul>
<p>架构和实施细节为使用 MCP 作为协调层构建复杂的多代理系统提供了宝贵的见解。</p>
<h3 id="2从-youtube-数据更新-azure-devops-工作项" style="position:relative;"><a href="#2%E4%BB%8E-youtube-%E6%95%B0%E6%8D%AE%E6%9B%B4%E6%96%B0-azure-devops-%E5%B7%A5%E4%BD%9C%E9%A1%B9" aria-label="2从 youtube 数据更新 azure devops 工作项 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>2. 从 YouTube 数据更新 Azure DevOps 工作项</strong></h3>
<p>本案例研究演示了 MCP 在自动化工作流流程方面的实际应用。它展示了如何使用 MCP 工具来：</p>
<ul>
<li>从在线平台 (YouTube) 提取数据</li>
<li>更新 Azure DevOps 系统中的工作项</li>
<li>创建可重复的自动化工作流</li>
<li>集成不同系统之间的数据</li>
</ul>
<p>此示例说明了即使是相对简单的 MCP 实施也可以通过自动化常规任务和提高跨系统数据的一致性来显着提高效率。</p>
<h3 id="3使用-mcp-进行实时文档检索" style="position:relative;"><a href="#3%E4%BD%BF%E7%94%A8-mcp-%E8%BF%9B%E8%A1%8C%E5%AE%9E%E6%97%B6%E6%96%87%E6%A1%A3%E6%A3%80%E7%B4%A2" aria-label="3使用 mcp 进行实时文档检索 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>3. 使用 MCP 进行实时文档检索</strong></h3>
<p>本案例研究将指导将 Python 控制台客户端连接到模型上下文协议 (MCP) 服务器，以检索和记录实时、上下文感知的 Microsoft 文档。将学习如何：</p>
<ul>
<li>使用 Python 客户端和官方 MCP SDK 连接到 MCP 服务器</li>
<li>使用流式 HTTP 客户端进行高效、实时的数据检索</li>
<li>在服务器上调用文档工具并将响应直接记录到控制台</li>
<li>无需离开终端即可将最新的 Microsoft 文档集成到的工作流中</li>
</ul>
<h3 id="4使用-mcp-的交互式学习计划生成器-web-应用" style="position:relative;"><a href="#4%E4%BD%BF%E7%94%A8-mcp-%E7%9A%84%E4%BA%A4%E4%BA%92%E5%BC%8F%E5%AD%A6%E4%B9%A0%E8%AE%A1%E5%88%92%E7%94%9F%E6%88%90%E5%99%A8-web-%E5%BA%94%E7%94%A8" aria-label="4使用 mcp 的交互式学习计划生成器 web 应用 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>4. 使用 MCP 的交互式学习计划生成器 Web 应用</strong></h3>
<p>本案例研究演示了如何使用 Chainlit 和模型上下文协议 (MCP) 构建一个交互式 Web 应用程序，为任何主题生成个性化的学习计划。用户可以指定一个主题（例如“AI-900 认证”）和一个学习时长（例如 8 周），应用程序将提供每周推荐内容的细分。Chainlit 支持对话式聊天界面，使体验引人入胜且具有适应性。</p>
<ul>
<li>由 Chainlit 提供支持的对话式 Web 应用</li>
<li>用户驱动的有关主题和时长的提示</li>
<li>使用 MCP 的每周内容推荐</li>
<li>在聊天界面中提供实时、自适应的响应</li>
</ul>
<p>该项目说明了如何将对话式 AI 和 MCP 相结合，在现代 Web 环境中创建动态、用户驱动的教育工具。</p>
<h3 id="5在-vs-code-中使用-mcp-服务器的编辑器内文档" style="position:relative;"><a href="#5%E5%9C%A8-vs-code-%E4%B8%AD%E4%BD%BF%E7%94%A8-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E7%BC%96%E8%BE%91%E5%99%A8%E5%86%85%E6%96%87%E6%A1%A3" aria-label="5在 vs code 中使用 mcp 服务器的编辑器内文档 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>5. 在 VS Code 中使用 MCP 服务器的编辑器内文档</strong></h3>
<p>本案例研究演示了如何使用 MCP 服务器将 Microsoft Learn 文档直接引入的 VS Code 环境——再也不用切换浏览器选项卡了！将看到如何：</p>
<ul>
<li>使用 MCP 面板或命令面板在 VS Code 中即时搜索和阅读文档</li>
<li>直接在的自述文件或课程降价文件中引用文档并插入链接</li>
<li>将 GitHub Copilot 和 MCP 结合使用，实现无缝、AI 驱动的文档和代码工作流</li>
<li>通过实时反馈和 Microsoft 提供的准确性来验证和增强的文档</li>
<li>将 MCP 与 GitHub 工作流集成以进行持续的文档验证</li>
</ul>
<p>实施包括：</p>
<ul>
<li>用于轻松设置的示例 <code class="language-text">.vscode/mcp.json</code> 配置</li>
<li>基于屏幕截图的编辑器内体验演练</li>
<li>结合使用 Copilot 和 MCP 以实现最高生产力的技巧</li>
</ul>
<p>此场景非常适合希望在编辑器中专注于处理文档、Copilot 和验证工具的课程作者、文档编写者和开发人员——所有这些都由 MCP 提供支持。</p>
<h3 id="6创建-apim-mcp-服务器" style="position:relative;"><a href="#6%E5%88%9B%E5%BB%BA-apim-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8" aria-label="6创建 apim mcp 服务器 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>6. 创建 APIM MCP 服务器</strong></h3>
<p>本案例研究提供了有关如何使用 Azure API 管理 (APIM) 创建 MCP 服务器的分步指南。它涵盖了：</p>
<ul>
<li>在 Azure API 管理中设置 MCP 服务器</li>
<li>将 API 操作公开为 MCP 工具</li>
<li>配置速率限制和安全策略</li>
<li>使用 Visual Studio Code 和 GitHub Copilot 测试 MCP 服务器</li>
</ul>
<p>此示例说明了如何利用 Azure 的功能来创建一个强大的 MCP 服务器，该服务器可用于各种应用程序，从而增强 AI 系统与企业 API 的集成。</p>
<h2 id="结论-1" style="position:relative;"><a href="#%E7%BB%93%E8%AE%BA-1" aria-label="结论 1 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>结论</strong></h2>
<p>这些案例研究突出了模型上下文协议在真实世界场景中的多功能性和实际应用。从复杂的多代理系统到有针对性的自动化工作流，MCP 提供了一种标准化的方式来将 AI 系统与它们提供价值所需的工具和数据连接起来。</p>
<p>通过研究这些实施，可以深入了解可应用于自己的 MCP 项目的架构模式、实施策略和最佳实践。这些示例表明，MCP 不仅仅是一个理论框架，而且是解决实际业务挑战的实用解决方案。</p>
<h1 id="10-简化-ai-工作流程使用-ai-工具包构建-mcp-服务器" style="position:relative;"><a href="#10-%E7%AE%80%E5%8C%96-ai-%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E4%BD%BF%E7%94%A8-ai-%E5%B7%A5%E5%85%B7%E5%8C%85%E6%9E%84%E5%BB%BA-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8" aria-label="10 简化 ai 工作流程使用 ai 工具包构建 mcp 服务器 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>10-简化 AI 工作流程：使用 AI 工具包构建 MCP 服务器</strong></h1>
<h2 id="lab-1" style="position:relative;"><a href="#lab-1" aria-label="lab 1 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Lab-1</h2>
<h3 id="-ai-工具包-aitk-简介" style="position:relative;"><a href="#-ai-%E5%B7%A5%E5%85%B7%E5%8C%85-aitk-%E7%AE%80%E4%BB%8B" aria-label=" ai 工具包 aitk 简介 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🧠 AI 工具包 (AITK) 简介</strong></h3>
<p><strong>Visual Studio Code 的 AI 工具包</strong> 是微软的旗舰扩展，它将 VS Code 转变为一个全面的人工智能开发环境。它弥合了人工智能研究与实际应用开发之间的差距，使各种技能水平的开发人员都能使用生成式人工智能。</p>
<h3 id="-关键功能" style="position:relative;"><a href="#-%E5%85%B3%E9%94%AE%E5%8A%9F%E8%83%BD" aria-label=" 关键功能 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🌟 关键功能</strong></h3>
<table>
<thead>
<tr>
<th>功能</th>
<th>描述</th>
<th>用例</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>🗂️ 模型目录</strong></td>
<td>访问来自 GitHub、ONNX、OpenAI、Anthropic、Google 的 100 多个模型</td>
<td>模型发现和选择</td>
</tr>
<tr>
<td><strong>🔌 BYOM 支持</strong></td>
<td>集成自己的模型（本地/远程）</td>
<td>自定义模型部署</td>
</tr>
<tr>
<td><strong>🎮 交互式 Playground</strong></td>
<td>通过聊天界面进行实时模型测试</td>
<td>快速原型设计和测试</td>
</tr>
<tr>
<td><strong>📎 多模态支持</strong></td>
<td>处理文本、图像和附件</td>
<td>复杂的人工智能应用</td>
</tr>
<tr>
<td><strong>⚡ 批量处理</strong></td>
<td>同时运行多个提示</td>
<td>高效的测试工作流</td>
</tr>
<tr>
<td><strong>📊 模型评估</strong></td>
<td>内置指标（F1、相关性、相似性、连贯性）</td>
<td>性能评估</td>
</tr>
</tbody>
</table>
<h3 id="-ai-工具包为何重要" style="position:relative;"><a href="#-ai-%E5%B7%A5%E5%85%B7%E5%8C%85%E4%B8%BA%E4%BD%95%E9%87%8D%E8%A6%81" aria-label=" ai 工具包为何重要 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🎯 AI 工具包为何重要</strong></h3>
<ul>
<li><strong>🚀 加速开发</strong>：在几分钟内从想法到原型</li>
<li><strong>🔄 统一工作流</strong>：一个界面适用于多个 AI 提供商</li>
<li><strong>🧪 轻松实验</strong>：无需复杂设置即可比较模型</li>
<li><strong>📈 生产就绪</strong>：从原型到部署的无缝过渡</li>
</ul>
<h3 id="️-先决条件和设置" style="position:relative;"><a href="#%EF%B8%8F-%E5%85%88%E5%86%B3%E6%9D%A1%E4%BB%B6%E5%92%8C%E8%AE%BE%E7%BD%AE" aria-label="️ 先决条件和设置 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🛠️ 先决条件和设置</strong></h3>
<h3 id="-安装-ai-工具包扩展" style="position:relative;"><a href="#-%E5%AE%89%E8%A3%85-ai-%E5%B7%A5%E5%85%B7%E5%8C%85%E6%89%A9%E5%B1%95" aria-label=" 安装 ai 工具包扩展 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>📦 安装 AI 工具包扩展</strong></h3>
<p><strong>步骤 1：访问扩展市场</strong></p>
<ol>
<li>打开 Visual Studio Code</li>
<li>导航到扩展视图（<code class="language-text">Ctrl+Shift+X</code> 或 <code class="language-text">Cmd+Shift+X</code>）</li>
<li>搜索 “AI Toolkit”</li>
</ol>
<p><strong>步骤 2：选择的版本</strong></p>
<ul>
<li><strong>🟢 发布版</strong>：建议用于生产环境</li>
<li><strong>🔶 预发布版</strong>：抢先体验前沿功能</li>
</ul>
<p><strong>步骤 3：安装并激活</strong></p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/a8c760c9c5d5fd013a1e86a7423ca44e/e8950/mcp_image_10.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 70.5521472392638%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAACdElEQVR42k1SW27TQBQNVSUKtRPHdeyM7bHHY3v8fr/itEnT8ChUlZAQQkIIia8KhPhjDWyARbANtsBeWADXSVA5mhlpNHPuPefeOwqqIv38Fb+7sxnru2a1WldV1bbNed9dLBerRdWUGQvDy8jfMIp0bOxg7jCKX71Z/v6j/PhFg7i/ui42t+n6Jl9uF9ub9vJ6u8w2fZFmeRrHcRSF/0AphRAj0j+df/spvv1uegl99pFsP1gv7uiT987tF/ryE00Xvud5vg+/iXWPQ2ZCiEWoZQ5i1LmiIUUbzjnWECwD63hYg1rg2LYNnP11IDPG2h3Ksuy6ru8XTdMURQFf6X+AK6jN89x1XQgBKQeyruuSJMmyDFtSIClWMdEMS1LQeCoK06kwFcfjsaIovj84gLjL5dJxnMHzbDYbAR4cH50IIx4JVm61z6Or1yg6H/Hq0ckUnuCd47ggCCB5mmZt10HyHVlWjk8nCqaaHVpxY8YNijo56OZepbnF3PRmKj4dC9x44g+F870wcf3QMPAgG+Q9kvSqrtM4Cn1GTExNw3Ns5lDbIgbGcIrynBNExty9Z6AdPEsInyAvzcthNqBi3VCwLMsZ86CgSFU1FU1mKi8h32NpmtZVBbaBviNr5BEpwiip6+Zite4WgL6uaxgKcAjeLGKKGuVk7DF3bxtw6LOk08d2G4Qx+AmD0HNtnzlgAN6gJNBiE+tT3ebnhDl2kqbQNujzgXyG8CkOm6ZlWWuXG6dck+zCjFqyAzh0HftMNTlJhYLBOCRJcj9hkqw85EXH9ViYUD8mbqiajqyZCtIUpIJnVdN4QeQnU4gDXkA5zNWe/BdER3x3sbBSFAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/a8c760c9c5d5fd013a1e86a7423ca44e/a6d36/mcp_image_10.png"
        srcset="/static/a8c760c9c5d5fd013a1e86a7423ca44e/222b7/mcp_image_10.png 163w,
/static/a8c760c9c5d5fd013a1e86a7423ca44e/ff46a/mcp_image_10.png 325w,
/static/a8c760c9c5d5fd013a1e86a7423ca44e/a6d36/mcp_image_10.png 650w,
/static/a8c760c9c5d5fd013a1e86a7423ca44e/e548f/mcp_image_10.png 975w,
/static/a8c760c9c5d5fd013a1e86a7423ca44e/3c492/mcp_image_10.png 1300w,
/static/a8c760c9c5d5fd013a1e86a7423ca44e/e8950/mcp_image_10.png 2000w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<h3 id="-动手练习-1探索-github-模型" style="position:relative;"><a href="#-%E5%8A%A8%E6%89%8B%E7%BB%83%E4%B9%A0-1%E6%8E%A2%E7%B4%A2-github-%E6%A8%A1%E5%9E%8B" aria-label=" 动手练习 1探索 github 模型 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🧪 动手练习 1：探索 GitHub 模型</strong></h3>
<p><strong>🎯 目标</strong>：掌握模型目录并测试的第一个 AI 模型</p>
<h3 id="-步骤-1浏览模型目录" style="position:relative;"><a href="#-%E6%AD%A5%E9%AA%A4-1%E6%B5%8F%E8%A7%88%E6%A8%A1%E5%9E%8B%E7%9B%AE%E5%BD%95" aria-label=" 步骤 1浏览模型目录 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>📊 步骤 1：浏览模型目录</strong></h3>
<p>模型目录是通往 AI 生态系统的门户。它聚合了来自多个提供商的模型，使发现和比较选项变得容易。</p>
<p><strong>🔍 导航指南：</strong></p>
<p>在 AI 工具包侧边栏中点击 <strong>MODELS - Catalog</strong></p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/3418333c36137de0875c23d246a018de/ea66f/mcp_image_11.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 56.44171779141104%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB8UlEQVR42iWR6XLaMBSF/RIEMN60Xm0GLBu7eAOTpWlCEpj+af91+v4P0Qs9oxlJdySdq+8EWussy2azGaV0GIa+74/T1HVd23XTNJVlifXsLkIIAOAivitJkkAp5Zybz+dY3e12eBor+i4ALaVkjCU3pWkSr8IwiuP0rttlnPDacrmIk9T7uigKzjkW8W0pCecMDdE1y1LCBJhcgSSE/m8k8L7S2jLKCZX7dnp5OjV1XfrCubzrtsPQeV+uUbnTm113ejuOQ+HLPM+xtSAMw9VqtVwu0W16fN73x7odumHabrdt218u16/Pj+v1ej6fd6W/fLx/fpyv16/z+5tzNoiiaLFYzB8eEAFTeQYuky6DNWO8a/ePp6nv2vFw3NW1Mm7TjNvbGIxvhTIBOiCh8E7CFI0tW7Mp7Q2XpHnN6mfiT8RW1BRMSMqBgWF6LbSVoAKEdjOfz6Mklcdf+uUPa34oBUowWj3p739h+i3sRgEIJI+UmKDWg8SdDDBGDAOjSuLYAuckFjQDCYJLyQlLQmApHsUIMEAuRBxHcbTCBQYcVFWF6EIElpFv/cGXpdYGNBBD8FmMnHGBfrghWarlrUIJxZ9aa4PVXcsFtp0VTX88jFVZubXLG6X374fXS1NXGJsx2ubb4fXnOI6IyRgDAP8Aa3FuyvIhSJgAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/3418333c36137de0875c23d246a018de/a6d36/mcp_image_11.png"
        srcset="/static/3418333c36137de0875c23d246a018de/222b7/mcp_image_11.png 163w,
/static/3418333c36137de0875c23d246a018de/ff46a/mcp_image_11.png 325w,
/static/3418333c36137de0875c23d246a018de/a6d36/mcp_image_11.png 650w,
/static/3418333c36137de0875c23d246a018de/e548f/mcp_image_11.png 975w,
/static/3418333c36137de0875c23d246a018de/3c492/mcp_image_11.png 1300w,
/static/3418333c36137de0875c23d246a018de/ea66f/mcp_image_11.png 2828w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<p><strong>💡 专业提示</strong>：寻找具有与的用例相匹配的特定功能的模型（例如，代码生成、创意写作、分析）。</p>
<p><strong>⚠️ 注意</strong>：GitHub 托管的模型（即 GitHub 模型）可免费使用，但请求和令牌有速率限制。如果想访问非 GitHub 模型（即通过 Azure AI 或其他端点托管的外部模型），则需要提供相应的 API 密钥或身份验证。</p>
<h3 id="-步骤-2添加和配置的第一个模型" style="position:relative;"><a href="#-%E6%AD%A5%E9%AA%A4-2%E6%B7%BB%E5%8A%A0%E5%92%8C%E9%85%8D%E7%BD%AE%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA%E6%A8%A1%E5%9E%8B" aria-label=" 步骤 2添加和配置的第一个模型 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🚀 步骤 2：添加和配置的第一个模型</strong></h3>
<p><strong>模型选择策略：</strong></p>
<ul>
<li><strong>GPT-4.1</strong>：最适合复杂的推理和分析</li>
<li><strong>Phi-4-mini</strong>：轻量级，适用于简单任务的快速响应</li>
</ul>
<p><strong>🔧 配置过程：</strong></p>
<ol>
<li>从目录中选择 <strong>OpenAI GPT-4.1</strong></li>
<li>点击 <strong>Add to My Models</strong> - 这将注册模型以供使用</li>
<li>选择 <strong>Try in Playground</strong> 启动测试环境</li>
<li>等待模型初始化（首次设置可能需要一些时间）</li>
</ol>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/361cabbb0d322b009ea4c8cf7b39fc71/b0bb3/mcp_image_12.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 62.576687116564415%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAABSElEQVR42o2S626DMAyF8yDAuIRwKYNwGxulVVVpf/cue/8/+4hbxNZN2lFAxvbxsR1UZ2tjX83HZzy+J6Gvdap50jSKoqcdwjBMkiSO4yAIyrKcpslaq3zfJ+Z5XlEUuF4c5nk+HA4SAhCqqqrrmrrYeAhlWabupQPUmqZ5dsAwxmyyEHC2bYsaRY0Dxo3sO9CYvkM8GxnZ8/kMmXFoninyPF/bZobr9XpxOJ1Olx2YJXCALHOi3/d913UYigDdj+OIaxgG3tI82RiERBmDEGl0mzogeSNPDsTYFuVZD0k0JpPLhlGjHAaf+BFYybKq2qFxIA8+frawzQwYVbZACdKUxPwdPAcMmVay5Yb318461PYlJ9ze37Fnyu3QuQr+h8da60+SZnmsDSdJs79OlOjfyW/zclwWttzY1rbd4+n6oazqH+JC/gIgaHWzV9cnVAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/361cabbb0d322b009ea4c8cf7b39fc71/a6d36/mcp_image_12.png"
        srcset="/static/361cabbb0d322b009ea4c8cf7b39fc71/222b7/mcp_image_12.png 163w,
/static/361cabbb0d322b009ea4c8cf7b39fc71/ff46a/mcp_image_12.png 325w,
/static/361cabbb0d322b009ea4c8cf7b39fc71/a6d36/mcp_image_12.png 650w,
/static/361cabbb0d322b009ea4c8cf7b39fc71/e548f/mcp_image_12.png 975w,
/static/361cabbb0d322b009ea4c8cf7b39fc71/3c492/mcp_image_12.png 1300w,
/static/361cabbb0d322b009ea4c8cf7b39fc71/b0bb3/mcp_image_12.png 2344w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<p><strong>⚙️ 理解模型参数：</strong></p>
<ul>
<li><strong>Temperature</strong>：控制创造力（0 = 确定性，1 = 创造性）</li>
<li><strong>Max Tokens</strong>：最大响应长度</li>
<li><strong>Top-p</strong>：用于响应多样性的核心采样</li>
</ul>
<h3 id="-步骤-3掌握-playground-界面" style="position:relative;"><a href="#-%E6%AD%A5%E9%AA%A4-3%E6%8E%8C%E6%8F%A1-playground-%E7%95%8C%E9%9D%A2" aria-label=" 步骤 3掌握 playground 界面 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🎯 步骤 3：掌握 Playground 界面</strong></h3>
<p>Playground 是的 AI 实验实验室。以下是如何最大限度地发挥其潜力：</p>
<p><strong>🎨 提示工程最佳实践：</strong></p>
<ol>
<li><strong>具体</strong>：清晰、详细的指令会产生更好的结果</li>
<li><strong>提供上下文</strong>：包含相关的背景信息</li>
<li><strong>使用示例</strong>：通过示例向模型展示想要什么</li>
<li><strong>迭代</strong>：根据初步结果优化提示</li>
</ol>
<p><strong>🧪 测试场景：</strong></p>
<div class="gatsby-highlight" data-language="markdown"><pre class="language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 示例 1：代码生成</span>
"编写一个使用递归计算数字阶乘的 Python 函数。包括错误处理和文档字符串。"

<span class="token title important"><span class="token punctuation">#</span> 示例 2：创意写作</span>
"写一封专业的电子邮件给客户，解释项目延迟，在保持积极基调的同时，坦诚地说明挑战。"

<span class="token title important"><span class="token punctuation">#</span> 示例 3：数据分析</span>
"分析此销售数据并提供见解：[粘贴的数据]。重点关注趋势、异常和可行的建议。"</code></pre></div>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/f05cf43adfc9f81c29d757b3ece6ee35/92a6b/mcp_image_13.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 63.190184049079754%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAABjUlEQVR42nWSyW7CQBBE5zOsGG/jGGy8bxCwMAkGCSSUC7fwF/n/Q55nhEWkpA6tnqWquntGFGWZZXmexn7SBp/fTjXYpmE7jv2Ao+C6ru/7nuexkyTJarUqy1KEcWrbFmdSetJzfSm59KowJZC5mud5EATcZGmaZhzH4u2BVAFVdqdcRyklm0VRwF8ul/P5HMUsy4T0XxGzLOtFwVR4zsFsNoO22+3QUjVK4ujcv3+0TYMMB6wTBb0E+ECjfiJ9Yl5VVdM0xLquRd/3XdcNw7Df71nrAzok0UsAOQzDtm3hI+crIC2+7vfb7XY8Htfr9WazORwO5MhRJPF0OhGZMEWhCAEVlovFgirE9Xo9n8/aFjJnhmHQ5NQ5OROhbPgk+vGiKBrJOEDGgYFTGBJ6qsRSATcm5KiXd54wDgwyTJzpBzLm2+1Wx06BWvgbzm9QAs0LmoSsW71cLvjzjLQEh8eEhu2/ZAwhTIN9LpvC+FIIMdu/yXXTMmd6mx45fSAbP33OEVXoUU1gilEU/QDE54UEI7wcWwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/f05cf43adfc9f81c29d757b3ece6ee35/a6d36/mcp_image_13.png"
        srcset="/static/f05cf43adfc9f81c29d757b3ece6ee35/222b7/mcp_image_13.png 163w,
/static/f05cf43adfc9f81c29d757b3ece6ee35/ff46a/mcp_image_13.png 325w,
/static/f05cf43adfc9f81c29d757b3ece6ee35/a6d36/mcp_image_13.png 650w,
/static/f05cf43adfc9f81c29d757b3ece6ee35/e548f/mcp_image_13.png 975w,
/static/f05cf43adfc9f81c29d757b3ece6ee35/3c492/mcp_image_13.png 1300w,
/static/f05cf43adfc9f81c29d757b3ece6ee35/92a6b/mcp_image_13.png 2334w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<h3 id="-挑战练习模型性能比较" style="position:relative;"><a href="#-%E6%8C%91%E6%88%98%E7%BB%83%E4%B9%A0%E6%A8%A1%E5%9E%8B%E6%80%A7%E8%83%BD%E6%AF%94%E8%BE%83" aria-label=" 挑战练习模型性能比较 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🏆 挑战练习：模型性能比较</strong></h3>
<p><strong>🎯 目标</strong>：使用相同的提示比较不同模型，以了解它们的优势</p>
<p><strong>📋 说明：</strong></p>
<ol>
<li>将 <strong>Phi-4-mini</strong> 添加到的工作区</li>
<li>对 GPT-4.1 和 Phi-4-mini 使用相同的提示</li>
</ol>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/e80b3e2089837cef0b8cbc2028f5bb26/0c1ff/mcp_image_14.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 47.852760736196316%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABMklEQVR42m2RSXaDQAxE+yBgCB0w84yB0Ewvl8gil8nN893K82ORWshCQ1Wprfq2yYYt/fqJPr8D/+Z53s2C5O2CIAjeLcjLspznuaoqVRT5YtaHOcaPNUnipmn6vp+mKU1ToRC6JEnyPL/f747j+L4PVxiGKo5jsyzzNK7GdF0HH3EYhqIoXsuu6zYWWZYxABEWWFQobNu27ztqtKMookcRe4jIPpHphwXiWus/ZaqI1HXNJZDhDW5yikRGZZkWdy7L0rat2H4qQ4MOPmElMcYcx7FbnOeJF3k/DJNrC5YLC0WDFxrHkR7XQkxCJMcOyoxyc26BoBhBBrrnMpv4YVTWJPLJNPfLNDlF1OASI1QUPX4Yfa1J5PLIQh6chAWMyBNinlwJsfsfvAtk5vrnaa1/Ac89YX9guJmPAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/e80b3e2089837cef0b8cbc2028f5bb26/a6d36/mcp_image_14.png"
        srcset="/static/e80b3e2089837cef0b8cbc2028f5bb26/222b7/mcp_image_14.png 163w,
/static/e80b3e2089837cef0b8cbc2028f5bb26/ff46a/mcp_image_14.png 325w,
/static/e80b3e2089837cef0b8cbc2028f5bb26/a6d36/mcp_image_14.png 650w,
/static/e80b3e2089837cef0b8cbc2028f5bb26/e548f/mcp_image_14.png 975w,
/static/e80b3e2089837cef0b8cbc2028f5bb26/3c492/mcp_image_14.png 1300w,
/static/e80b3e2089837cef0b8cbc2028f5bb26/0c1ff/mcp_image_14.png 2192w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<ol>
<li>比较响应质量、速度和准确性</li>
<li>在结果部分记录的发现</li>
</ol>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/9197966d7d2713644b12c0fde14880c0/b0bb3/mcp_image_15.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 66.25766871165644%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAABwUlEQVR42k2S2Y7yMAyF+xAglham7ZRpG0q6QFsG+Cm7WMQdv4SEEHe8/yPMRyJGcy6i2Mc+dhwbn66TJInv+71e7/OND4Vut+s6zpfCL+u6rm3bnU7H8zxDyLQfRaGC9waZ0JZl9uNsIKUIQ9T/spZlIWQk5SxOUrSDINASXKiDx3HspPwH679ZIYRmkcA0RODneT4cDkejEZeiKLhHCiiEfk+zOuCXJZPTiGPhea9nmKbZaDTq9XqtVms2m+12m7bDuPSD0HEcXtFUaLVapsKr7aqaXy6X0+l0Pp/3+/3xeMTc7XaLxcK2P7JhPpvNyrL8VtAXzlBNwdhut8/n83q9Ph6P+/1O5nq9llIiTLWiyKuqIn+hsFqtlsslATh5jsE/UQcblc1mowrazFMnE3q73ZD+r0AB1CeTyWDAJ0iDoKWC1qbIeDyWCgyc8VJkPp/r+lD6n1kBZm5g6NfqykRMp1OCkCeTFpjC4XCgYfy0ip83E/CaNskYfENfQb4Rx7HeLXRRJJRWeSMnFLoEG77/WgCC9HowQwhOTO3Um4dHsxq0rdYzkkVZ0kyapkiiHSuwDH0hQhGVis2yLPkDvTM/9FKSmOXdS+EAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/9197966d7d2713644b12c0fde14880c0/a6d36/mcp_image_15.png"
        srcset="/static/9197966d7d2713644b12c0fde14880c0/222b7/mcp_image_15.png 163w,
/static/9197966d7d2713644b12c0fde14880c0/ff46a/mcp_image_15.png 325w,
/static/9197966d7d2713644b12c0fde14880c0/a6d36/mcp_image_15.png 650w,
/static/9197966d7d2713644b12c0fde14880c0/e548f/mcp_image_15.png 975w,
/static/9197966d7d2713644b12c0fde14880c0/3c492/mcp_image_15.png 1300w,
/static/9197966d7d2713644b12c0fde14880c0/b0bb3/mcp_image_15.png 2344w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<p><strong>💡 待发现的关键见解：</strong></p>
<ul>
<li>何时使用 LLM vs SLM</li>
<li>成本与性能的权衡</li>
<li>不同模型的专业能力</li>
</ul>
<h2 id="-动手练习-2使用-agent-builder-构建自定义代理" style="position:relative;"><a href="#-%E5%8A%A8%E6%89%8B%E7%BB%83%E4%B9%A0-2%E4%BD%BF%E7%94%A8-agent-builder-%E6%9E%84%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BB%A3%E7%90%86" aria-label=" 动手练习 2使用 agent builder 构建自定义代理 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🤖 动手练习 2：使用 Agent Builder 构建自定义代理</strong></h2>
<p><strong>🎯 目标</strong>：创建针对特定任务和工作流的专用 AI 代理</p>
<h3 id="️-步骤-1理解-agent-builder" style="position:relative;"><a href="#%EF%B8%8F-%E6%AD%A5%E9%AA%A4-1%E7%90%86%E8%A7%A3-agent-builder" aria-label="️ 步骤 1理解 agent builder permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🏗️ 步骤 1：理解 Agent Builder</strong></h3>
<p>Agent Builder 是 AI 工具包真正闪耀的地方。它允许创建专用的 AI 助手，将大型语言模型的强大功能与自定义指令、特定参数和专业知识相结合。</p>
<p><strong>🧠 代理架构组件：</strong></p>
<ul>
<li><strong>核心模型</strong>：基础 LLM（GPT-4、Groks、Phi 等）</li>
<li><strong>系统提示</strong>：定义代理的个性和行为</li>
<li><strong>参数</strong>：为实现最佳性能而进行的微调设置</li>
<li><strong>工具集成</strong>：连接到外部 API 和 MCP 服务</li>
<li><strong>内存</strong>：对话上下文和会话持久性</li>
</ul>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/6dfaa327ae62205e99fc0c9a5cdbccda/f60cd/mcp_image_16.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 62.576687116564415%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAABdklEQVR42n1SW26DMBDkEulHxStAMDjYQDHBUYRJQnqGflZN1ftfoYM30DSqOkLGNjs7s7s4w/GY53kURUmSrO8QhiGttPkTTlmWjLHtdiuESNN0Y4EbZMwYyzI8Ge6TO1AMNk5dVYhDNN1ijeMY0VKInBdcTKk3M+ir7/uBxaSM3LgiJ7FFURQwEq4j1/Nd1+20HscLCjyfz8MwIOBGNsbs9/u+78dxPBwOSqm6hpuKc45qsbZKcf0qxrd8d4Iu9OELPZrIYDZNo7WmrDhKKaGMLhAZ6YqyLsqXNONUM7VgIkOzbdvKAjRwpAXKQRWoCEaUaqQUqHfRpEE4gzFd14G/s8AGUvCykHFErtgaXnqGT5NyZ6FngNxYQBARCEXnYD6dQTXfyJWdc/x7htRzGPNnBHf4GRWYdJ6u5jgSATn4Fw4MLJnoBQpjKZ4Hsud5DxacJ3N9Gq4rc30+ffqXr9VAx49V/x4wGYVobAQBNBnjoPkt//Y3Dz97SC/44VQAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/6dfaa327ae62205e99fc0c9a5cdbccda/a6d36/mcp_image_16.png"
        srcset="/static/6dfaa327ae62205e99fc0c9a5cdbccda/222b7/mcp_image_16.png 163w,
/static/6dfaa327ae62205e99fc0c9a5cdbccda/ff46a/mcp_image_16.png 325w,
/static/6dfaa327ae62205e99fc0c9a5cdbccda/a6d36/mcp_image_16.png 650w,
/static/6dfaa327ae62205e99fc0c9a5cdbccda/e548f/mcp_image_16.png 975w,
/static/6dfaa327ae62205e99fc0c9a5cdbccda/3c492/mcp_image_16.png 1300w,
/static/6dfaa327ae62205e99fc0c9a5cdbccda/f60cd/mcp_image_16.png 2318w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<h3 id="️-步骤-2代理配置深入探讨" style="position:relative;"><a href="#%EF%B8%8F-%E6%AD%A5%E9%AA%A4-2%E4%BB%A3%E7%90%86%E9%85%8D%E7%BD%AE%E6%B7%B1%E5%85%A5%E6%8E%A2%E8%AE%A8" aria-label="️ 步骤 2代理配置深入探讨 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>⚙️ 步骤 2：代理配置深入探讨</strong></h3>
<p><strong>🎨 创建有效的系统提示：</strong></p>
<div class="gatsby-highlight" data-language="markdown"><pre class="language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 模板结构：</span>
<span class="token title important"><span class="token punctuation">##</span> 角色定义</span>
是一位在 [领域] 方面具有专业知识的 [特定角色]。

<span class="token title important"><span class="token punctuation">##</span> 能力</span>
<span class="token list punctuation">-</span> 列出具体能力
<span class="token list punctuation">-</span> 定义知识范围
<span class="token list punctuation">-</span> 阐明局限性

<span class="token title important"><span class="token punctuation">##</span> 行为准则</span>
<span class="token list punctuation">-</span> 响应风格（正式、随意、技术性）
<span class="token list punctuation">-</span> 输出格式偏好
<span class="token list punctuation">-</span> 错误处理方法

<span class="token title important"><span class="token punctuation">##</span> 示例</span>
提供 2-3 个理想交互的示例
</code></pre></div>
<p><em>当然，也可以使用“生成系统提示”功能，让 AI 帮助生成和优化提示</em></p>
<p><strong>🔧 参数优化：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>推荐范围</th>
<th>用例</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Temperature</strong></td>
<td>0.1-0.3</td>
<td>技术性/事实性响应</td>
</tr>
<tr>
<td><strong>Temperature</strong></td>
<td>0.7-0.9</td>
<td>创意/头脑风暴任务</td>
</tr>
<tr>
<td><strong>Max Tokens</strong></td>
<td>500-1000</td>
<td>简洁的响应</td>
</tr>
<tr>
<td><strong>Max Tokens</strong></td>
<td>2000-4000</td>
<td>详细的解释</td>
</tr>
</tbody>
</table>
<h3 id="-步骤-3实践练习---python-编程代理" style="position:relative;"><a href="#-%E6%AD%A5%E9%AA%A4-3%E5%AE%9E%E8%B7%B5%E7%BB%83%E4%B9%A0---python-%E7%BC%96%E7%A8%8B%E4%BB%A3%E7%90%86" aria-label=" 步骤 3实践练习   python 编程代理 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🐍 步骤 3：实践练习 - Python 编程代理</strong></h3>
<p><strong>🎯 任务</strong>：创建一个专门的 Python 编码助手</p>
<p><strong>📋 配置步骤：</strong></p>
<ol>
<li><strong>模型选择</strong>：选择 <strong>Claude 3.5 Sonnet</strong>（非常适合编码）</li>
<li><strong>系统提示设计</strong>：</li>
</ol>
<div class="gatsby-highlight" data-language="markdown"><pre class="language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> Python 编程专家代理</span>

<span class="token title important"><span class="token punctuation">##</span> 角色</span>
是一位拥有 10 年以上经验的高级 Python 开发人员。擅长编写干净、高效且文档齐全的 Python 代码。

<span class="token title important"><span class="token punctuation">##</span> 能力</span>
<span class="token list punctuation">-</span> 编写生产就绪的 Python 代码
<span class="token list punctuation">-</span> 调试复杂问题
<span class="token list punctuation">-</span> 清晰地解释代码概念
<span class="token list punctuation">-</span> 建议最佳实践和优化
<span class="token list punctuation">-</span> 提供完整的工作示例

<span class="token title important"><span class="token punctuation">##</span> 响应格式</span>
<span class="token list punctuation">-</span> 始终包含文档字符串
<span class="token list punctuation">-</span> 为复杂逻辑添加内联注释
<span class="token list punctuation">-</span> 建议测试方法
<span class="token list punctuation">-</span> 适用时提及相关库

<span class="token title important"><span class="token punctuation">##</span> 代码质量标准</span>
<span class="token list punctuation">-</span> 遵循 PEP 8 风格指南
<span class="token list punctuation">-</span> 适当时使用类型提示
<span class="token list punctuation">-</span> 优雅地处理异常
<span class="token list punctuation">-</span> 编写可读、可维护的代码
</code></pre></div>
<ol>
<li><strong>参数配置</strong>：
<ul>
<li>Temperature: 0.2 (用于一致、可靠的代码)</li>
<li>Max Tokens: 2000 (详细解释)</li>
<li>Top-p: 0.9 (平衡的创造力)</li>
</ul>
</li>
</ol>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/22d0df003c674c42bd5cdba7a6c5e3a6/8ad1b/mcp_image_17.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 63.80368098159509%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAABn0lEQVR42mWSCa7iQAxE+w7zMyxZSdKdfQMEExFAIBDiACMN4v73mJfuD0L6pcgyxmVXORF93x+Px7quI43FC4HGZ/IToizLqqqUUiR5nscvpAbJCP6lIn9AtG3b1HWWZfxgs2GSMKsoirxq66Yh933f+4CvIehAs2GGYWj4rKSYqAS9TdOs12sq6DTWcGH4YhgGPO/3+/P5fLlcOAGtq9Wq6zomLpcddSpYqzVQikz4I/l0Ol2vV8jE+/1+u92YtdlsttsthCRJYWGbQTg3VlHBfpYLmna7Hd0rDUMjsiHPsjCKkzRDsOu60+l0MpmYOJ/Pv2UfDgfDgVC/QM4GDA8vUGQ5HKN5JC812Imx7gNUODYHHAn6PJwTCbYGQhghGI83c+o33t9JGAQyjlUUOo5jWZaRbcAIIeNIychzbN91PNcZo2PH4aIscv2+OVTheMFshk37zTS2ha8KT34/gSp5XJKkivJ2ofIwWCRSxSoNI6nSPJbK/YCwtn+/+ofVP77+POz9czY8Saz+36/++bu7ed7YZCIviU/tfS0p5X/fBXoxeGkCTgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/22d0df003c674c42bd5cdba7a6c5e3a6/a6d36/mcp_image_17.png"
        srcset="/static/22d0df003c674c42bd5cdba7a6c5e3a6/222b7/mcp_image_17.png 163w,
/static/22d0df003c674c42bd5cdba7a6c5e3a6/ff46a/mcp_image_17.png 325w,
/static/22d0df003c674c42bd5cdba7a6c5e3a6/a6d36/mcp_image_17.png 650w,
/static/22d0df003c674c42bd5cdba7a6c5e3a6/e548f/mcp_image_17.png 975w,
/static/22d0df003c674c42bd5cdba7a6c5e3a6/3c492/mcp_image_17.png 1300w,
/static/22d0df003c674c42bd5cdba7a6c5e3a6/8ad1b/mcp_image_17.png 2320w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<h3 id="-步骤-4测试的-python-代理" style="position:relative;"><a href="#-%E6%AD%A5%E9%AA%A4-4%E6%B5%8B%E8%AF%95%E7%9A%84-python-%E4%BB%A3%E7%90%86" aria-label=" 步骤 4测试的 python 代理 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🧪 步骤 4：测试的 Python 代理</strong></h3>
<p><strong>测试场景：</strong></p>
<ol>
<li><strong>基本函数</strong>：“创建一个函数来查找素数”</li>
<li><strong>复杂算法</strong>：“实现一个具有插入、删除和搜索方法的二叉搜索树”</li>
<li><strong>实际问题</strong>：“构建一个处理速率限制和重试的网络爬虫”</li>
<li><strong>调试</strong>：“修复此代码 [粘贴有错误的代码]”</li>
</ol>
<p><strong>🏆 成功标准：</strong></p>
<ul>
<li>✅ 代码运行无误</li>
<li>✅ 包含适当的文档</li>
<li>✅ 遵循 Python 最佳实践</li>
<li>✅ 提供清晰的解释</li>
<li>✅ 建议改进</li>
</ul>
<h2 id="lab-2" style="position:relative;"><a href="#lab-2" aria-label="lab 2 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Lab-2</h2>
<h2 id="-理解模型上下文协议-mcp" style="position:relative;"><a href="#-%E7%90%86%E8%A7%A3%E6%A8%A1%E5%9E%8B%E4%B8%8A%E4%B8%8B%E6%96%87%E5%8D%8F%E8%AE%AE-mcp" aria-label=" 理解模型上下文协议 mcp permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🧠 理解模型上下文协议 (MCP)</strong></h2>
<h3 id="-什么是-mcp" style="position:relative;"><a href="#-%E4%BB%80%E4%B9%88%E6%98%AF-mcp" aria-label=" 什么是 mcp permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🔍 什么是 MCP？</strong></h3>
<p>模型上下文协议 (MCP) 是 <strong>“AI 应用的 USB-C”</strong>——一个革命性的开放标准，它将大型语言模型 (LLM) 连接到外部工具、数据源和服务。就像 USB-C 通过提供一个通用连接器消除了线缆的混乱一样，MCP 通过一个标准化的协议消除了 AI 集成的复杂性。</p>
<h3 id="-mcp-解决的问题" style="position:relative;"><a href="#-mcp-%E8%A7%A3%E5%86%B3%E7%9A%84%E9%97%AE%E9%A2%98" aria-label=" mcp 解决的问题 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🎯 MCP 解决的问题</strong></h3>
<p><strong>在 MCP 出现之前：</strong></p>
<ul>
<li>🔧 每个工具都需要自定义集成</li>
<li>🔄 专有解决方案导致的供应商锁定</li>
<li>🔒 临时连接带来的安全漏洞</li>
<li>⏱️ 基本集成需要数月的开发时间</li>
</ul>
<p><strong>有了 MCP：</strong></p>
<ul>
<li>⚡ 即插即用的工具集成</li>
<li>🔄 与供应商无关的架构</li>
<li>🛡️ 内置的安全最佳实践</li>
<li>🚀 在几分钟内添加新功能</li>
</ul>
<h3 id="️-mcp-架构深入解析" style="position:relative;"><a href="#%EF%B8%8F-mcp-%E6%9E%B6%E6%9E%84%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90" aria-label="️ mcp 架构深入解析 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🏗️ MCP 架构深入解析</strong></h3>
<p>MCP 遵循<strong>客户端-服务器架构</strong>，创建了一个安全、可扩展的生态系统：</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text"></code></pre></div>
<p><strong>🔧 核心组件：</strong></p>
<table>
<thead>
<tr>
<th>组件</th>
<th>角色</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>MCP 主机</strong></td>
<td>消费 MCP 服务的应用程序</td>
<td>Claude Desktop, VS Code, AI Toolkit</td>
</tr>
<tr>
<td><strong>MCP 客户端</strong></td>
<td>协议处理器 (与服务器 1:1)</td>
<td>内置于主机应用程序中</td>
</tr>
<tr>
<td><strong>MCP 服务器</strong></td>
<td>通过标准协议公开功能</td>
<td>Playwright, Files, Azure, GitHub</td>
</tr>
<tr>
<td><strong>传输层</strong></td>
<td>通信方法</td>
<td>stdio, HTTP, WebSockets</td>
</tr>
</tbody>
</table>
<h2 id="-微软的-mcp-服务器生态系统" style="position:relative;"><a href="#-%E5%BE%AE%E8%BD%AF%E7%9A%84-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%94%9F%E6%80%81%E7%B3%BB%E7%BB%9F" aria-label=" 微软的 mcp 服务器生态系统 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🏢 微软的 MCP 服务器生态系统</strong></h2>
<p>微软以一套全面的企业级服务器引领着 MCP 生态系统，这些服务器满足了真实的业务需求。</p>
<h3 id="-特色的微软-mcp-服务器" style="position:relative;"><a href="#-%E7%89%B9%E8%89%B2%E7%9A%84%E5%BE%AE%E8%BD%AF-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8" aria-label=" 特色的微软 mcp 服务器 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🌟 特色的微软 MCP 服务器</strong></h3>
<h3 id="1-️-azure-mcp-服务器" style="position:relative;"><a href="#1-%EF%B8%8F-azure-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8" aria-label="1 ️ azure mcp 服务器 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>1. ☁️ Azure MCP 服务器</strong></h3>
<p><strong>🔗 仓库</strong>: <a href="https://github.com/azure/azure-mcp">azure/azure-mcp</a> <strong>🎯 目的</strong>: 通过 AI 集成实现全面的 Azure 资源管理</p>
<p><strong>✨ 主要功能:</strong></p>
<ul>
<li>声明式基础设施配置</li>
<li>实时资源监控</li>
<li>成本优化建议</li>
<li>安全合规性检查</li>
</ul>
<p><strong>🚀 用例:</strong></p>
<ul>
<li>借助 AI 的基础设施即代码</li>
<li>自动化资源扩展</li>
<li>云成本优化</li>
<li>DevOps 工作流自动化</li>
</ul>
<h3 id="2--microsoft-dataverse-mcp" style="position:relative;"><a href="#2--microsoft-dataverse-mcp" aria-label="2  microsoft dataverse mcp permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>2. 📊 Microsoft Dataverse MCP</strong></h3>
<p><strong>📚 文档</strong>: <a href="https://go.microsoft.com/fwlink/?linkid=2320176">Microsoft Dataverse 集成</a> <strong>🎯 目的</strong>: 用于业务数据的自然语言界面</p>
<p><strong>✨ 主要功能:</strong></p>
<ul>
<li>自然语言数据库查询</li>
<li>业务上下文理解</li>
<li>自定义提示模板</li>
<li>企业数据治理</li>
</ul>
<p><strong>🚀 用例:</strong></p>
<ul>
<li>商业智能报告</li>
<li>客户数据分析</li>
<li>销售管道洞察</li>
<li>合规性数据查询</li>
</ul>
<h3 id="3--playwright-mcp-服务器" style="position:relative;"><a href="#3--playwright-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8" aria-label="3  playwright mcp 服务器 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>3. 🌐 Playwright MCP 服务器</strong></h3>
<p><strong>🔗 仓库</strong>: <a href="https://github.com/microsoft/playwright-mcp">microsoft/playwright-mcp</a> <strong>🎯 目的</strong>: 浏览器自动化和 Web 交互功能</p>
<p><strong>✨ 主要功能:</strong></p>
<ul>
<li>跨浏览器自动化 (Chrome, Firefox, Safari)</li>
<li>智能元素检测</li>
<li>截图和 PDF 生成</li>
<li>网络流量监控</li>
</ul>
<p><strong>🚀 用例:</strong></p>
<ul>
<li>自动化测试工作流</li>
<li>网页抓取和数据提取</li>
<li>UI/UX 监控</li>
<li>竞争分析自动化</li>
</ul>
<h3 id="4--文件-mcp-服务器" style="position:relative;"><a href="#4--%E6%96%87%E4%BB%B6-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8" aria-label="4  文件 mcp 服务器 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>4. 📁 文件 MCP 服务器</strong></h3>
<p><strong>🔗 仓库</strong>: <a href="https://github.com/microsoft/files-mcp-server">microsoft/files-mcp-server</a> <strong>🎯 目的</strong>: 智能文件系统操作</p>
<p><strong>✨ 主要功能:</strong></p>
<ul>
<li>声明式文件管理</li>
<li>内容同步</li>
<li>版本控制集成</li>
<li>元数据提取</li>
</ul>
<p><strong>🚀 用例:</strong></p>
<ul>
<li>文档管理</li>
<li>代码仓库组织</li>
<li>内容发布工作流</li>
<li>数据管道文件处理</li>
</ul>
<h3 id="5--markitdown-mcp-服务器" style="position:relative;"><a href="#5--markitdown-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8" aria-label="5  markitdown mcp 服务器 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>5. 📝 MarkItDown MCP 服务器</strong></h3>
<p><strong>🔗 仓库</strong>: <a href="https://github.com/microsoft/markitdown">microsoft/markitdown</a> <strong>🎯 目的</strong>: 高级 Markdown 处理和操作</p>
<p><strong>✨ 主要功能:</strong></p>
<ul>
<li>丰富的 Markdown 解析</li>
<li>格式转换 (MD ↔ HTML ↔ PDF)</li>
<li>内容结构分析</li>
<li>模板处理</li>
</ul>
<p><strong>🚀 用例:</strong></p>
<ul>
<li>技术文档工作流</li>
<li>内容管理系统</li>
<li>报告生成</li>
<li>知识库自动化</li>
</ul>
<h3 id="6--clarity-mcp-服务器" style="position:relative;"><a href="#6--clarity-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8" aria-label="6  clarity mcp 服务器 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>6. 📈 Clarity MCP 服务器</strong></h3>
<p><strong>📦 包</strong>: <a href="https://www.npmjs.com/package/@microsoft/clarity-mcp-server">@microsoft/clarity-mcp-server</a> <strong>🎯 目的</strong>: Web 分析和用户行为洞察</p>
<p><strong>✨ 主要功能:</strong></p>
<ul>
<li>热力图数据分析</li>
<li>用户会话录制</li>
<li>性能指标</li>
<li>转化漏斗分析</li>
</ul>
<p><strong>🚀 用例:</strong></p>
<ul>
<li>网站优化</li>
<li>用户体验研究</li>
<li>A/B 测试分析</li>
<li>商业智能仪表板</li>
</ul>
<h3 id="-社区生态系统" style="position:relative;"><a href="#-%E7%A4%BE%E5%8C%BA%E7%94%9F%E6%80%81%E7%B3%BB%E7%BB%9F" aria-label=" 社区生态系统 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🌍 社区生态系统</strong></h3>
<p>除了微软的服务器，MCP 生态系统还包括：</p>
<ul>
<li><strong>🐙 GitHub MCP</strong>: 仓库管理和代码分析</li>
<li><strong>🗄️ 数据库 MCP</strong>: PostgreSQL, MySQL, MongoDB 集成</li>
<li><strong>☁️ 云提供商 MCP</strong>: AWS, GCP, Digital Ocean 工具</li>
<li><strong>📧 通信 MCP</strong>: Slack, Teams, Email 集成</li>
</ul>
<h2 id="️-动手实验构建浏览器自动化代理" style="position:relative;"><a href="#%EF%B8%8F-%E5%8A%A8%E6%89%8B%E5%AE%9E%E9%AA%8C%E6%9E%84%E5%BB%BA%E6%B5%8F%E8%A7%88%E5%99%A8%E8%87%AA%E5%8A%A8%E5%8C%96%E4%BB%A3%E7%90%86" aria-label="️ 动手实验构建浏览器自动化代理 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🛠️ 动手实验：构建浏览器自动化代理</strong></h2>
<p><strong>🎯 项目目标</strong>: 创建一个智能浏览器自动化代理，使用 Playwright MCP 服务器导航网站、提取信息并执行复杂的 Web 交互。</p>
<h3 id="-阶段-1代理基础设置" style="position:relative;"><a href="#-%E9%98%B6%E6%AE%B5-1%E4%BB%A3%E7%90%86%E5%9F%BA%E7%A1%80%E8%AE%BE%E7%BD%AE" aria-label=" 阶段 1代理基础设置 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🚀 阶段 1：代理基础设置</strong></h3>
<h3 id="步骤-1初始化的代理" style="position:relative;"><a href="#%E6%AD%A5%E9%AA%A4-1%E5%88%9D%E5%A7%8B%E5%8C%96%E7%9A%84%E4%BB%A3%E7%90%86" aria-label="步骤 1初始化的代理 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>步骤 1：初始化的代理</strong></h3>
<ol>
<li><strong>打开 AI 工具包的 Agent Builder</strong></li>
<li><strong>创建新代理</strong> 并使用以下配置：
<ul>
<li><strong>名称</strong>: <code class="language-text">BrowserAgent</code></li>
<li><strong>模型</strong>: 选择 GPT-4o</li>
</ul>
<span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/74df7b5cb0baaff3b3eb067defe92ba1/c8252/mcp_image_18.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 72.39263803680981%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAABlUlEQVR42n1S2W6DMBDkL6pGKQZDAsYGHyU2R5S8VEJ5SdX//5mO7QYRqe3IQvayszt7JOM4Xi4XrTXnvG3b4wOHgLIs4qXaYHVIGGO8aSil8U0DyrLsuq5pGi4EHPBrv9+/PUAIyQMSGQDXuq6LooghcIcKkI9M5LQQgg+2t72x9jQMAxwQIk1TT3bOwc9L4DwKU0qhEARCEkjXvZ2Xr/Hj001nZy3kkIBknufz+Xy9Xm+32/1+X5YFsbRWUqmq8lqmaXx3Uz0uYr4VFc+zDJlhz7Is6fveWguRyGa0NsZAC+cNLDWrUT8sJ/j0uirpIfQv9sWTrXVuGMHqOtlJ1fqvlF63QSGU5j6oMUJgEFXsCGjoVsjsRrDhKpV+PqZmfgooHupiz+Oc4teTpTbI1nYKabdHSl03PCM/iNlW4OkbdjhWrVS0KFOSkSxfD55lUEj+RoJJoBCSplurX48wNvIvEiyTCPuwtUJYbOnWmAY8kdPfENcQl22dmC0yrTX7DXvZ4DVgfe52u21EqBNCxNAIxBj7BhDtgCI6d256AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/74df7b5cb0baaff3b3eb067defe92ba1/a6d36/mcp_image_18.png"
        srcset="/static/74df7b5cb0baaff3b3eb067defe92ba1/222b7/mcp_image_18.png 163w,
/static/74df7b5cb0baaff3b3eb067defe92ba1/ff46a/mcp_image_18.png 325w,
/static/74df7b5cb0baaff3b3eb067defe92ba1/a6d36/mcp_image_18.png 650w,
/static/74df7b5cb0baaff3b3eb067defe92ba1/e548f/mcp_image_18.png 975w,
/static/74df7b5cb0baaff3b3eb067defe92ba1/3c492/mcp_image_18.png 1300w,
/static/74df7b5cb0baaff3b3eb067defe92ba1/c8252/mcp_image_18.png 2178w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></li>
</ol>
<h3 id="-阶段-2mcp-集成工作流" style="position:relative;"><a href="#-%E9%98%B6%E6%AE%B5-2mcp-%E9%9B%86%E6%88%90%E5%B7%A5%E4%BD%9C%E6%B5%81" aria-label=" 阶段 2mcp 集成工作流 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🔧 阶段 2：MCP 集成工作流</strong></h3>
<h3 id="步骤-3添加-mcp-服务器集成" style="position:relative;"><a href="#%E6%AD%A5%E9%AA%A4-3%E6%B7%BB%E5%8A%A0-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%9B%86%E6%88%90" aria-label="步骤 3添加 mcp 服务器集成 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>步骤 3：添加 MCP 服务器集成</strong></h3>
<ol>
<li>在 Agent Builder 中 <strong>导航到工具部分</strong></li>
<li><strong>点击 “Add Tool”</strong> 打开集成菜单</li>
<li>从可用选项中 <strong>选择 “MCP Server”</strong></li>
</ol>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/5f513e0eda35a383e8af4768e9f533a2/ea64c/mcp_image_19.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 22.699386503067483%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAmUlEQVR42oWPwQ6DIBBE+Q+VIgKBYCwIxEYTMRxMlHjw/3+mG++lc9jsYd/sDGKMGWO6rsMYv/6JUiqE0ForpaSUCLBhGNq2raqqrusC2TSNc+44jvu+r+uKMSLOed/3YPZ+BN6/IgA8z/O+7ymlbdustQiux3GEDcJ778swvMk5n+cJc1kWtK5rCGGaps8jCFIuTx9BWULIF/CuLpmDX5N/AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/5f513e0eda35a383e8af4768e9f533a2/a6d36/mcp_image_19.png"
        srcset="/static/5f513e0eda35a383e8af4768e9f533a2/222b7/mcp_image_19.png 163w,
/static/5f513e0eda35a383e8af4768e9f533a2/ff46a/mcp_image_19.png 325w,
/static/5f513e0eda35a383e8af4768e9f533a2/a6d36/mcp_image_19.png 650w,
/static/5f513e0eda35a383e8af4768e9f533a2/e548f/mcp_image_19.png 975w,
/static/5f513e0eda35a383e8af4768e9f533a2/ea64c/mcp_image_19.png 1116w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<p><strong>🔍 理解工具类型：</strong></p>
<ul>
<li><strong>内置工具</strong>: 预配置的 AI 工具包功能</li>
<li><strong>MCP 服务器</strong>: 外部服务集成</li>
<li><strong>自定义 API</strong>: 自己的服务端点</li>
<li><strong>函数调用</strong>: 直接的模型函数访问</li>
</ul>
<h3 id="步骤-4mcp-服务器选择" style="position:relative;"><a href="#%E6%AD%A5%E9%AA%A4-4mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%80%89%E6%8B%A9" aria-label="步骤 4mcp 服务器选择 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>步骤 4：MCP 服务器选择</strong></h3>
<ol>
<li><strong>选择 “MCP Server”</strong> 选项以继续</li>
</ol>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/b97eed1326cde00a4110ddad63829400/1843f/mcp_image_20.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 9.815950920245399%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAS0lEQVR42nXGSQqAMAwAwD5GMQRtmqRpI3XB/3/KghcRhDlMYD+SrZRdaut6YOEHkr7IB5CGKLadl7ddi4vVLrJyLkltwnkE/DMA3nfeFhetey3zAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/b97eed1326cde00a4110ddad63829400/a6d36/mcp_image_20.png"
        srcset="/static/b97eed1326cde00a4110ddad63829400/222b7/mcp_image_20.png 163w,
/static/b97eed1326cde00a4110ddad63829400/ff46a/mcp_image_20.png 325w,
/static/b97eed1326cde00a4110ddad63829400/a6d36/mcp_image_20.png 650w,
/static/b97eed1326cde00a4110ddad63829400/e548f/mcp_image_20.png 975w,
/static/b97eed1326cde00a4110ddad63829400/1843f/mcp_image_20.png 1186w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<ol>
<li><strong>浏览 MCP 目录</strong> 以探索可用的集成</li>
<li></li>
</ol>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/b7f8972b21fc385a8377750a7958c9a8/187fa/mcp_image_21.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 36.19631901840491%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAABHElEQVR42m2Oa0vDMBSG+0H9osKEfRF1s+lcc1+yJKVJJu2YG15BVpQNvOIvmPr/MetwTPDh4fDywjmcSPmh8YVyRTYodR2ML7Urmc5hTyGhiTT/CoWJDkfvZ9V3t/rqTD+T6QLcL/aLj72ytli641+33ctfn7f8266pImCvxPUTGT2Q8SObzHqXczqZwWHVtjdgcBf726YcN/jooPcrX9rgF016HnGCcqMyJa1RLtOmL5RgkhOGU4q6aQeA1lHSPknaxys7p621Eec8t9ZkmbXOOd/vq26aBhFGhFKMCYQohQG0DCkEIFkbMcastXkeLlitdQje+3BGSokxRgiRGkppmKEBG0ShMsYopVZzHYQQ4Slaw2rCZhzHm8s/6LRP6iywkiEAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/b7f8972b21fc385a8377750a7958c9a8/a6d36/mcp_image_21.png"
        srcset="/static/b7f8972b21fc385a8377750a7958c9a8/222b7/mcp_image_21.png 163w,
/static/b7f8972b21fc385a8377750a7958c9a8/ff46a/mcp_image_21.png 325w,
/static/b7f8972b21fc385a8377750a7958c9a8/a6d36/mcp_image_21.png 650w,
/static/b7f8972b21fc385a8377750a7958c9a8/e548f/mcp_image_21.png 975w,
/static/b7f8972b21fc385a8377750a7958c9a8/187fa/mcp_image_21.png 1194w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<h3 id="-阶段-3playwright-mcp-配置" style="position:relative;"><a href="#-%E9%98%B6%E6%AE%B5-3playwright-mcp-%E9%85%8D%E7%BD%AE" aria-label=" 阶段 3playwright mcp 配置 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🎮 阶段 3：Playwright MCP 配置</strong></h3>
<h3 id="步骤-5选择和配置-playwright" style="position:relative;"><a href="#%E6%AD%A5%E9%AA%A4-5%E9%80%89%E6%8B%A9%E5%92%8C%E9%85%8D%E7%BD%AE-playwright" aria-label="步骤 5选择和配置 playwright permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>步骤 5：选择和配置 Playwright</strong></h3>
<ol>
<li><strong>点击 “Use Featured MCP Servers”</strong> 访问微软验证的服务器</li>
<li>从特色列表中 <strong>选择 “Playwright”</strong></li>
<li><strong>接受默认的 MCP ID</strong> 或为的环境自定义</li>
</ol>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/761656691da363f2f16024a29a4a868e/f213e/mcp_image_22.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 10.429447852760736%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAAsTAAALEwEAmpwYAAAASklEQVR42lXMOw6AQAgE0D2LQkEjiAS6jfc/lRMSCl8xIfzW3vttmXmPiHB35DOuP1UVkYWNqoqGM7wwM2xjjHvUaCKPwcxnI6IPszoWdfHyQdwAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/761656691da363f2f16024a29a4a868e/a6d36/mcp_image_22.png"
        srcset="/static/761656691da363f2f16024a29a4a868e/222b7/mcp_image_22.png 163w,
/static/761656691da363f2f16024a29a4a868e/ff46a/mcp_image_22.png 325w,
/static/761656691da363f2f16024a29a4a868e/a6d36/mcp_image_22.png 650w,
/static/761656691da363f2f16024a29a4a868e/e548f/mcp_image_22.png 975w,
/static/761656691da363f2f16024a29a4a868e/f213e/mcp_image_22.png 1192w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<h3 id="步骤-6启用-playwright-功能" style="position:relative;"><a href="#%E6%AD%A5%E9%AA%A4-6%E5%90%AF%E7%94%A8-playwright-%E5%8A%9F%E8%83%BD" aria-label="步骤 6启用 playwright 功能 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>步骤 6：启用 Playwright 功能</strong></h3>
<p><strong>🔑 关键步骤</strong>: 选择 <strong>所有</strong> 可用的 Playwright 方法以获得最大功能</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/200010596adf47c21a380e652539cf78/df56e/mcp_image_23.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 59.50920245398773%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAABbElEQVR42m2Sy26DMBRE8xndAQ5gbBPwg1d4JZUqdZtVpW4qtf2tfmzHvilJpI4cRAJnZq6dnTJNu77Y6eymZzuehR2E6WRlsFRtVe2UG5Q70pJ2eL28vX98z5fPp6+f3eFQLct69BqNtVobrTUvipwX+zRjLGXQHkpp5ZwLIfGUFSXgw7LMfd8Pw+Cca5qmbVtde0kp8iwrOE/TYBGUJEkcx/iwOCJ4ATlN0xIE2FprjCmKQkpZlmWe5x54FIw8vK6+NuBxHJEMDLFogf5CCDQGzDnPg3gQbq4wJYMnktQEVVWFZLyjlEIL9Sfcw9TDp9MJJPJhQYUpk2KjKEr+0y0ZG0bl0VwHoTli4YXk+4HZna4zIxMWIOd5pmmBuSAUwZDYPOqSZdkNhv2WCYuu62hyTEUbs5EyCMdGg3gYrQCDpG2j064fRYMgBlf4Wv9f0nDZ4QsOCYF9EGLxAEeNLnhpC0TGtuG44nfG2C9EcII7IOOPgAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/200010596adf47c21a380e652539cf78/a6d36/mcp_image_23.png"
        srcset="/static/200010596adf47c21a380e652539cf78/222b7/mcp_image_23.png 163w,
/static/200010596adf47c21a380e652539cf78/ff46a/mcp_image_23.png 325w,
/static/200010596adf47c21a380e652539cf78/a6d36/mcp_image_23.png 650w,
/static/200010596adf47c21a380e652539cf78/e548f/mcp_image_23.png 975w,
/static/200010596adf47c21a380e652539cf78/df56e/mcp_image_23.png 1188w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/207fea0a13f023a1c9dbc47c4e838298/9f82e/mcp_image_24.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 46.62576687116564%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/UlEQVR42o2RwU6EMBCGeQoTD0sLtKWl7bqgwDaYIKwRLfHgU3j3/Q/+FLMaN7vZL+2hnfnnn04jEkjTNKGUCk2YInFMTkAwSZaUlTQQ4SrLsr1zT4/OfHzlb5+b2xvk/lXGcayUappmGAbvfd/3VVXVdR0tJSnBgnWoTGjw+QcMOOd5nksphRA4Ls6cM72t9N2DqVose++0sfqEIqACOBpjGGMRdneY2/HdtKN1z3Y/FtoqKdUZYN51HXpenCHeba3VSrA055kUTJ5XHkEXizNeUmiNYXg/T9PryzTN3qOrCyUQ+hUj1VqLAZZluQvgRl/k583rH67/cYRexzfJN1YA4PoZbQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/207fea0a13f023a1c9dbc47c4e838298/a6d36/mcp_image_24.png"
        srcset="/static/207fea0a13f023a1c9dbc47c4e838298/222b7/mcp_image_24.png 163w,
/static/207fea0a13f023a1c9dbc47c4e838298/ff46a/mcp_image_24.png 325w,
/static/207fea0a13f023a1c9dbc47c4e838298/a6d36/mcp_image_24.png 650w,
/static/207fea0a13f023a1c9dbc47c4e838298/9f82e/mcp_image_24.png 820w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<p><strong>🛠️ 必要的 Playwright 工具：</strong></p>
<ul>
<li><strong>导航</strong>: <code class="language-text">goto</code>, <code class="language-text">goBack</code>, <code class="language-text">goForward</code>, <code class="language-text">reload</code></li>
<li><strong>交互</strong>: <code class="language-text">click</code>, <code class="language-text">fill</code>, <code class="language-text">press</code>, <code class="language-text">hover</code>, <code class="language-text">drag</code></li>
<li><strong>提取</strong>: <code class="language-text">textContent</code>, <code class="language-text">innerHTML</code>, <code class="language-text">getAttribute</code></li>
<li><strong>验证</strong>: <code class="language-text">isVisible</code>, <code class="language-text">isEnabled</code>, <code class="language-text">waitForSelector</code></li>
<li><strong>捕获</strong>: <code class="language-text">screenshot</code>, <code class="language-text">pdf</code>, <code class="language-text">video</code></li>
<li><strong>网络</strong>: <code class="language-text">setExtraHTTPHeaders</code>, <code class="language-text">route</code>, <code class="language-text">waitForResponse</code></li>
</ul>
<h3 id="步骤-7验证集成成功" style="position:relative;"><a href="#%E6%AD%A5%E9%AA%A4-7%E9%AA%8C%E8%AF%81%E9%9B%86%E6%88%90%E6%88%90%E5%8A%9F" aria-label="步骤 7验证集成成功 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>步骤 7：验证集成成功</strong></h3>
<p><strong>✅ 成功指标：</strong></p>
<ul>
<li>所有工具都出现在 Agent Builder 界面中</li>
<li>集成面板中没有错误消息</li>
<li>Playwright 服务器状态显示 “Connected”</li>
</ul>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/207fea0a13f023a1c9dbc47c4e838298/9f82e/mcp_image_25.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 46.62576687116564%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/UlEQVR42o2RwU6EMBCGeQoTD0sLtKWl7bqgwDaYIKwRLfHgU3j3/Q/+FLMaN7vZL+2hnfnnn04jEkjTNKGUCk2YInFMTkAwSZaUlTQQ4SrLsr1zT4/OfHzlb5+b2xvk/lXGcayUappmGAbvfd/3VVXVdR0tJSnBgnWoTGjw+QcMOOd5nksphRA4Ls6cM72t9N2DqVose++0sfqEIqACOBpjGGMRdneY2/HdtKN1z3Y/FtoqKdUZYN51HXpenCHeba3VSrA055kUTJ5XHkEXizNeUmiNYXg/T9PryzTN3qOrCyUQ+hUj1VqLAZZluQvgRl/k583rH67/cYRexzfJN1YA4PoZbQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/207fea0a13f023a1c9dbc47c4e838298/a6d36/mcp_image_25.png"
        srcset="/static/207fea0a13f023a1c9dbc47c4e838298/222b7/mcp_image_25.png 163w,
/static/207fea0a13f023a1c9dbc47c4e838298/ff46a/mcp_image_25.png 325w,
/static/207fea0a13f023a1c9dbc47c4e838298/a6d36/mcp_image_25.png 650w,
/static/207fea0a13f023a1c9dbc47c4e838298/9f82e/mcp_image_25.png 820w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<p><strong>🔧 常见问题故障排除：</strong></p>
<ul>
<li><strong>连接失败</strong>: 检查互联网连接和防火墙设置</li>
<li><strong>缺少工具</strong>: 确保在设置过程中选择了所有功能</li>
<li><strong>权限错误</strong>: 验证 VS Code 是否具有必要的系统权限</li>
</ul>
<h3 id="-阶段-4高级提示工程" style="position:relative;"><a href="#-%E9%98%B6%E6%AE%B5-4%E9%AB%98%E7%BA%A7%E6%8F%90%E7%A4%BA%E5%B7%A5%E7%A8%8B" aria-label=" 阶段 4高级提示工程 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🎯 阶段 4：高级提示工程</strong></h3>
<h3 id="步骤-8设计智能系统提示" style="position:relative;"><a href="#%E6%AD%A5%E9%AA%A4-8%E8%AE%BE%E8%AE%A1%E6%99%BA%E8%83%BD%E7%B3%BB%E7%BB%9F%E6%8F%90%E7%A4%BA" aria-label="步骤 8设计智能系统提示 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>步骤 8：设计智能系统提示</strong></h3>
<p>创建能够充分利用 Playwright 全部功能的复杂提示：</p>
<div class="gatsby-highlight" data-language="markdown"><pre class="language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> Web 自动化专家系统提示</span>

<span class="token title important"><span class="token punctuation">##</span> 核心身份</span>
是一位高级 Web 自动化专家，在浏览器自动化、网页抓取和用户体验分析方面拥有深厚的专业知识。可以使用 Playwright 工具进行全面的浏览器控制。

<span class="token title important"><span class="token punctuation">##</span> 能力与方法</span>
<span class="token title important"><span class="token punctuation">###</span> 导航策略</span>
<span class="token list punctuation">-</span> 始终从截图开始，以了解页面布局
<span class="token list punctuation">-</span> 尽可能使用语义选择器（文本内容、标签）
<span class="token list punctuation">-</span> 为动态内容实施等待策略
<span class="token list punctuation">-</span> 有效处理单页应用程序 (SPA)

<span class="token title important"><span class="token punctuation">###</span> 错误处理</span>
<span class="token list punctuation">-</span> 使用指数退避重试失败的操作
<span class="token list punctuation">-</span> 提供清晰的错误描述和解决方案
<span class="token list punctuation">-</span> 当主要方法失败时，建议替代方法
<span class="token list punctuation">-</span> 始终在出错时捕获诊断性截图

<span class="token title important"><span class="token punctuation">###</span> 数据提取</span>
<span class="token list punctuation">-</span> 尽可能以 JSON 格式提取结构化数据
<span class="token list punctuation">-</span> 为提取的信息提供置信度分数
<span class="token list punctuation">-</span> 验证数据的完整性和准确性
<span class="token list punctuation">-</span> 处理分页和无限滚动场景

<span class="token title important"><span class="token punctuation">###</span> 报告</span>
<span class="token list punctuation">-</span> 包括分步执行日志
<span class="token list punctuation">-</span> 提供前后截图以供验证
<span class="token list punctuation">-</span> 建议优化和替代方法
<span class="token list punctuation">-</span> 记录遇到的任何限制或边缘情况

<span class="token title important"><span class="token punctuation">##</span> 道德准则</span>
<span class="token list punctuation">-</span> 尊重 robots.txt 和速率限制
<span class="token list punctuation">-</span> 避免使目标服务器过载
<span class="token list punctuation">-</span> 仅提取公开可用的信息
<span class="token list punctuation">-</span> 遵守网站服务条款
</code></pre></div>
<h3 id="步骤-9创建动态用户提示" style="position:relative;"><a href="#%E6%AD%A5%E9%AA%A4-9%E5%88%9B%E5%BB%BA%E5%8A%A8%E6%80%81%E7%94%A8%E6%88%B7%E6%8F%90%E7%A4%BA" aria-label="步骤 9创建动态用户提示 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>步骤 9：创建动态用户提示</strong></h3>
<p>设计能够展示各种功能的提示：</p>
<p><strong>🌐 Web 分析示例：</strong></p>
<div class="gatsby-highlight" data-language="markdown"><pre class="language-markdown"><code class="language-markdown">导航到 github.com/kinfey 并提供全面的分析，包括：
<span class="token list punctuation">1.</span> 仓库结构和组织
<span class="token list punctuation">2.</span> 近期活动和贡献模式
<span class="token list punctuation">3.</span> 文档质量评估
<span class="token list punctuation">4.</span> 技术栈识别
<span class="token list punctuation">5.</span> 社区参与度指标
<span class="token list punctuation">6.</span> 著名的项目及其用途

在关键步骤中包含截图，并提供可行的见解。
</code></pre></div>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/2ec62cac7ebafc9fda7ed03a61b1a942/b4904/mcp_image_26.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 82.82208588957054%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAAsTAAALEwEAmpwYAAACM0lEQVR42o1T246bMBDlG9JKfdhADJiLMWAbQyBsEgghidqV2r61H9DHrqpV/1/qwTS72T60PRoicObMnLnYqut6v993XVcUhW3bjuMQQlb/B0sptdlsqqrK81wIgc84jimlYRhGYRiEL4heAydW27a73W5tUF8BFfgbIeATBFME3/fJDTwDC66glWU5DMPhcOj7HrHSNE2SxHNdoWueyTzPsiz3KUUcPAiE6ibZc81bJK9riC/LSusS+lGFT/2l7fg+3W63p3E49rvxsD+NR+QIKAXfAvPh4eFyPh2HYTOhwYNaoJwxBoVa67apRTsW5y/68jWrO87QFjaR2+1+PF3wq9dNuW4yoVia80zAYjYpR5SmXouml/0ndfgcy9r0IZhkazAMTL4Wygs9QSkdJ5nrEs45SpAikymLfOISFOKjWxBl5bJAkiTNkzSDzTnT6cRk9lwE2jSmlvt7liQRJJtRTZmJ60op4ihE+2bDoiyX9tK2oQ0ZIHvqRNPg83bOU2YPwoTyeOnYS8cATpgM4iMHyFJKzBInz7vxQsbo4kz5XFPMxAAcEOA9d3ve1nmwf65nLlFTp8om5TwxYAbYkzn833Yb1ZdaVaWG9zS+K/AO/f8gU5fknImMsyhY2XfEWbpXW8FuAOW4dq/ITiRcXnppRRK9YgpmR9KYcihqXj1fBgiBHBejv8J6231bjD8Wx++L46P94enu/RNe3oyPi/PPd9VHCCHktzdaiPuDjiLnTP4FiASo7dO0YlYAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/2ec62cac7ebafc9fda7ed03a61b1a942/a6d36/mcp_image_26.png"
        srcset="/static/2ec62cac7ebafc9fda7ed03a61b1a942/222b7/mcp_image_26.png 163w,
/static/2ec62cac7ebafc9fda7ed03a61b1a942/ff46a/mcp_image_26.png 325w,
/static/2ec62cac7ebafc9fda7ed03a61b1a942/a6d36/mcp_image_26.png 650w,
/static/2ec62cac7ebafc9fda7ed03a61b1a942/e548f/mcp_image_26.png 975w,
/static/2ec62cac7ebafc9fda7ed03a61b1a942/3c492/mcp_image_26.png 1300w,
/static/2ec62cac7ebafc9fda7ed03a61b1a942/b4904/mcp_image_26.png 1768w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<h3 id="-阶段-5执行和测试" style="position:relative;"><a href="#-%E9%98%B6%E6%AE%B5-5%E6%89%A7%E8%A1%8C%E5%92%8C%E6%B5%8B%E8%AF%95" aria-label=" 阶段 5执行和测试 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🚀 阶段 5：执行和测试</strong></h3>
<h3 id="步骤-10执行的第一个自动化" style="position:relative;"><a href="#%E6%AD%A5%E9%AA%A4-10%E6%89%A7%E8%A1%8C%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA%E8%87%AA%E5%8A%A8%E5%8C%96" aria-label="步骤 10执行的第一个自动化 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>步骤 10：执行的第一个自动化</strong></h3>
<ol>
<li><strong>点击 “Run”</strong> 启动自动化序列</li>
<li><strong>监控实时执行</strong>：
<ul>
<li>Chrome 浏览器自动启动</li>
<li>代理导航到目标网站</li>
<li>截图捕获每个主要步骤</li>
<li>分析结果实时流式传输</li>
</ul>
<span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/7081caafe8b892ed1855e21dadc2e445/ea66f/mcp_image_27.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 57.668711656441715%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAACiUlEQVR42j1SS08TURSeHyGdTmdaZ6YzZR5tpykzMG2IkSaaaFBiDImIEsJDi1RBEiS6cKOudePGhfFBKC3ERhNgh8YEXOJCFiYuXSjGUrCdmTuP1jOV+OU+Tm7Od79zvnuxaDSK43goFOrs7IRYEESO43iOj8t8KpXSdV3VutUeXU4oHBfjeV6SJFGSIIemaYxl2UAgQJJkJpOBVFmWoz64eCIhiAIgEgmTVDiZ1mVFkxRNSHQpXdmUCpdqWDweJ9tQVbXHh66qXaCWL8zevDUzMzubz+fHxifn5u9N5gtjkzfGr01PFW7Pzd+9PjWNQTbDMARBgHJvby+siqKMjo7atr37ZWd7+yNCZtPzjPofhJCFkOO6DcNotVqVSgVLp1WKosLhcF9fXy6Xy2azoigODw9//bb77MmDOxOXdj5v1Rum7TQdt9lsesjxDMsG8sbGBqYkFZpmoMvubg0q1zQNPBu5euX5i5WBwfvnzhcWi+W6Ye3VrFrDtR3nV/XwR7UO5M3NTQxvIxgMAkeQJDYaDQaJoctDnz5sPXz08vHTd5W371seOjw8gLI917GMumVZR8rBNgggx/iYGGcjZAg/Nnjxwu9qdX+/1qj77ZnIrRkuchy/YeQayIHD9fX1NhnHCSpCJU9QyZNMOhcQM/1DE7XaQb3RgGEhGzRNCxx0LAt9/7n/fe8A2Gtra0fkIBmJ6mfpnv7j6mlCyQ2MFEzTbBj+ABGoFryCAGx3bdt1vbby/7IJIpUUEjKfEHk5xp45lVt8/aq0XHyzurq6slIul0ulkj+Xl5eKxeJSEd5pYWEBg3f6R2bYCMvRPMcI8PdYJhwiqBDhOxAIdHR0wEbCHyYIWP2gjb+2xUbr9NrfPQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/7081caafe8b892ed1855e21dadc2e445/a6d36/mcp_image_27.png"
        srcset="/static/7081caafe8b892ed1855e21dadc2e445/222b7/mcp_image_27.png 163w,
/static/7081caafe8b892ed1855e21dadc2e445/ff46a/mcp_image_27.png 325w,
/static/7081caafe8b892ed1855e21dadc2e445/a6d36/mcp_image_27.png 650w,
/static/7081caafe8b892ed1855e21dadc2e445/e548f/mcp_image_27.png 975w,
/static/7081caafe8b892ed1855e21dadc2e445/3c492/mcp_image_27.png 1300w,
/static/7081caafe8b892ed1855e21dadc2e445/ea66f/mcp_image_27.png 2828w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></li>
</ol>
<h3 id="步骤-11分析结果和见解" style="position:relative;"><a href="#%E6%AD%A5%E9%AA%A4-11%E5%88%86%E6%9E%90%E7%BB%93%E6%9E%9C%E5%92%8C%E8%A7%81%E8%A7%A3" aria-label="步骤 11分析结果和见解 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>步骤 11：分析结果和见解</strong></h3>
<p>在 Agent Builder 的界面中查看全面的分析：</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/21a5f748afc2adb45b4be40a6672b961/fb937/mcp_image_28.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 65.03067484662577%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAABoklEQVR42m2S626CQBCF9x28xAi7IFcFRLCCguKtmvivD9A/pmnf/xX6la1G056QybA7Z+bMzIrVarXdbtfrdRiGnuc5N9i2PXqA8x/EdDqdzWZ4cRzj+75PCuxkMhn/gJwB0IeP4ETAyfM8iiKiXNe9X6RpmiRxlOazLCc7xa1nIE2QPMsyssPUUlFBWVRw5flBWZZ1VfErpVRKPZGLomiapqqquq5pHodcLy0gKyWHwyE03flgMOh0Ot1uF2uaplgsFsyM0N1udz6fD4cDPl0kSYKFgCKsbGEYxvAGVIjNZnM6neAjD0tl7HK5ZBDwaWE+n6MOPkytVgNfEH3Y78uiQAIEZpO1wKFzVByPRxbJLVkY5GPbgoIUr1oQmt+Az/xRfv/VJ0/kNmISBD8bCm/AZ7dco5zUuilS0LYW/Et2XDedlyM3kMpSlq0/x2VHISdUu1wu7Bya9QfCtZU/jq2RY0vDUiafrcxx4CXReGQr6tMOA2vfTMK20XUfm+jX793m2m+uvebDOH7K1y+cXnPtbD8GxZulpG6Raeu3+PjUvgGlOH03bOhPXgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/21a5f748afc2adb45b4be40a6672b961/a6d36/mcp_image_28.png"
        srcset="/static/21a5f748afc2adb45b4be40a6672b961/222b7/mcp_image_28.png 163w,
/static/21a5f748afc2adb45b4be40a6672b961/ff46a/mcp_image_28.png 325w,
/static/21a5f748afc2adb45b4be40a6672b961/a6d36/mcp_image_28.png 650w,
/static/21a5f748afc2adb45b4be40a6672b961/e548f/mcp_image_28.png 975w,
/static/21a5f748afc2adb45b4be40a6672b961/3c492/mcp_image_28.png 1300w,
/static/21a5f748afc2adb45b4be40a6672b961/fb937/mcp_image_28.png 1820w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<h3 id="-阶段-6高级功能和部署" style="position:relative;"><a href="#-%E9%98%B6%E6%AE%B5-6%E9%AB%98%E7%BA%A7%E5%8A%9F%E8%83%BD%E5%92%8C%E9%83%A8%E7%BD%B2" aria-label=" 阶段 6高级功能和部署 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🌟 阶段 6：高级功能和部署</strong></h3>
<h3 id="步骤-12导出和生产部署" style="position:relative;"><a href="#%E6%AD%A5%E9%AA%A4-12%E5%AF%BC%E5%87%BA%E5%92%8C%E7%94%9F%E4%BA%A7%E9%83%A8%E7%BD%B2" aria-label="步骤 12导出和生产部署 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>步骤 12：导出和生产部署</strong></h3>
<p>Agent Builder 支持多种部署选项：</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/f6378531de2b5e12c50dbc93a579a33b/5b2ff/mcp_image_29.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 57.05521472392638%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABDklEQVR42pWSDWrDMAyFc5Ek/lUkWbbjNO3a0vufa0qTwRi0dOZhhM2TPlnuBOM580koI4D3xpjx49UVLpQleGed7ft+GIZ/mBMJ15lYoEjEyTs3fly8Q5jOS6mSSy5JklPzOGr9neI9SJeQbl/z/drWubXaltOSOBERMyNijPGdmUkut2VdpUrKaQMAAPVM07RTvDOPxmKpqTWPYIPph4P2eDyl3sGHv9LLTmdDtZS15VORxhMFwBDQA4dIIT53jfXEgzsUnwLXaQaUUs/X+7o8LutcsxAyBGu3kR/S+Ld+DjtjrbaXmBIjESKxthui5g8qG4J9/XM2bISo30sQkmbR0cUYwmbQvGYHePFg35ZEWvbcd6DUAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/f6378531de2b5e12c50dbc93a579a33b/a6d36/mcp_image_29.png"
        srcset="/static/f6378531de2b5e12c50dbc93a579a33b/222b7/mcp_image_29.png 163w,
/static/f6378531de2b5e12c50dbc93a579a33b/ff46a/mcp_image_29.png 325w,
/static/f6378531de2b5e12c50dbc93a579a33b/a6d36/mcp_image_29.png 650w,
/static/f6378531de2b5e12c50dbc93a579a33b/e548f/mcp_image_29.png 975w,
/static/f6378531de2b5e12c50dbc93a579a33b/3c492/mcp_image_29.png 1300w,
/static/f6378531de2b5e12c50dbc93a579a33b/5b2ff/mcp_image_29.png 2190w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<h2 id="-模块-2-总结与后续步骤" style="position:relative;"><a href="#-%E6%A8%A1%E5%9D%97-2-%E6%80%BB%E7%BB%93%E4%B8%8E%E5%90%8E%E7%BB%AD%E6%AD%A5%E9%AA%A4" aria-label=" 模块 2 总结与后续步骤 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🎓 模块 2 总结与后续步骤</strong></h2>
<h3 id="-成就解锁mcp-集成大师" style="position:relative;"><a href="#-%E6%88%90%E5%B0%B1%E8%A7%A3%E9%94%81mcp-%E9%9B%86%E6%88%90%E5%A4%A7%E5%B8%88" aria-label=" 成就解锁mcp 集成大师 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🏆 成就解锁：MCP 集成大师</strong></h3>
<p><strong>✅ 掌握的技能：</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled>  理解 MCP 架构和优势</li>
<li class="task-list-item"><input type="checkbox" disabled>  浏览微软的 MCP 服务器生态系统</li>
<li class="task-list-item"><input type="checkbox" disabled>  将 Playwright MCP 与 AI 工具包集成</li>
<li class="task-list-item"><input type="checkbox" disabled>  构建复杂的浏览器自动化代理</li>
<li class="task-list-item"><input type="checkbox" disabled>  用于 Web 自动化的高级提示工程</li>
</ul>
<h2 id="lab-3" style="position:relative;"><a href="#lab-3" aria-label="lab 3 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Lab-3</h2>
<h2 id="-核心组件概述" style="position:relative;"><a href="#-%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6%E6%A6%82%E8%BF%B0" aria-label=" 核心组件概述 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🔧 核心组件概述</strong></h2>
<h3 id="-mcp-python-sdk" style="position:relative;"><a href="#-mcp-python-sdk" aria-label=" mcp python sdk permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🐍 MCP Python SDK</strong></h3>
<p>模型上下文协议 Python SDK 为构建自定义 MCP 服务器提供了基础。将使用具有增强调试功能的 1.9.3 版本。</p>
<h3 id="-mcp-检查器" style="position:relative;"><a href="#-mcp-%E6%A3%80%E6%9F%A5%E5%99%A8" aria-label=" mcp 检查器 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🔍 MCP 检查器</strong></h3>
<p>一个强大的调试工具，提供：</p>
<ul>
<li>实时服务器监控</li>
<li>工具执行可视化</li>
<li>网络请求/响应检查</li>
<li>交互式测试环境</li>
</ul>
<hr>
<h2 id="-分步实施" style="position:relative;"><a href="#-%E5%88%86%E6%AD%A5%E5%AE%9E%E6%96%BD" aria-label=" 分步实施 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>📖 分步实施</strong></h2>
<h3 id="步骤-1在-agent-builder-中创建-weatheragent" style="position:relative;"><a href="#%E6%AD%A5%E9%AA%A4-1%E5%9C%A8-agent-builder-%E4%B8%AD%E5%88%9B%E5%BB%BA-weatheragent" aria-label="步骤 1在 agent builder 中创建 weatheragent permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>步骤 1：在 Agent Builder 中创建 WeatherAgent</strong></h3>
<ol>
<li>通过 AI 工具包扩展在 VS Code 中 <strong>启动 Agent Builder</strong></li>
<li><strong>创建一个新代理</strong>，配置如下：
<ul>
<li>代理名称: <code class="language-text">WeatherAgent</code></li>
</ul>
</li>
</ol>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/c885ca7769f6d5305b2d1fcbd7f6b0d9/7321b/mcp_image_30.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 90.18404907975462%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAAsTAAALEwEAmpwYAAABfklEQVR42o2T646CMBBG+x4oi6a4oIBSFEQwriYQ4w99/7fZ085qNu5qOInNUOfydaZVTdOcz+e+77uum0wmY4fv+x8DUHmeb6GujTFJkvBZFEWWZbPZ7PMF/BWGIauKomi1WuEd6hB7sViQYj6fh68hHgecFdWJjKN4NBr5d95IDYKAAiJTlWWJ6s1mU9d127bL5TJ5C5GUjePYBtMke05jApeYsuM/iBwxOCr+1CBe8cscaZqSjPXp81FTRLFDcORQp9Ppdrtdr9fL5VJVFeIbBwYjsOt2Wzk4FDbHxCYF4m1lSSMzAK31er0m6fF4PBwOrAxPZvOY1s+ZKSI3hMToMQ68sdNfPB1BJqoYsqgqHWJL//PXEEUuhSvC9m3L99NUpG3/Ig4KhQR/3ZGeuftaS9tgt9uxzyr7gEZbGXlskQKDPplhoBxdtttyY6Th0TCk4YpLgwBUMSF/ADwBz/PkISguOmmm0+mQN4wzZWmVhNhgeYADg1ErT0pr/Q0M3bcATeRvuAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/c885ca7769f6d5305b2d1fcbd7f6b0d9/a6d36/mcp_image_30.png"
        srcset="/static/c885ca7769f6d5305b2d1fcbd7f6b0d9/222b7/mcp_image_30.png 163w,
/static/c885ca7769f6d5305b2d1fcbd7f6b0d9/ff46a/mcp_image_30.png 325w,
/static/c885ca7769f6d5305b2d1fcbd7f6b0d9/a6d36/mcp_image_30.png 650w,
/static/c885ca7769f6d5305b2d1fcbd7f6b0d9/e548f/mcp_image_30.png 975w,
/static/c885ca7769f6d5305b2d1fcbd7f6b0d9/7321b/mcp_image_30.png 1184w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<h3 id="步骤-2初始化-mcp-服务器项目" style="position:relative;"><a href="#%E6%AD%A5%E9%AA%A4-2%E5%88%9D%E5%A7%8B%E5%8C%96-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%A1%B9%E7%9B%AE" aria-label="步骤 2初始化 mcp 服务器项目 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>步骤 2：初始化 MCP 服务器项目</strong></h3>
<ol>
<li>在 Agent Builder 中导航到 <strong>工具</strong> → <strong>添加工具</strong></li>
<li>从可用选项中 <strong>选择 “MCP 服务器”</strong></li>
<li><strong>选择 “创建一个新的 MCP 服务器”</strong></li>
<li><strong>选择 <code class="language-text">python-weather</code> 模板</strong></li>
<li><strong>命名的服务器：</strong> <code class="language-text">weather_mcp</code></li>
</ol>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/7f0c404374a871fb1eb219175a9606fa/5b587/mcp_image_31.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 13.496932515337424%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAeUlEQVR42mOwsnUws7SxsLYzt7IFMoBcI1MLHX0jPUNj/EjfyJjBysXL3MHVytnDzN5N38LOwNJB18xW19xW28xGWddERk1XVl1PVgMr0mfQ8krQcI3S845XdAiXtw9VACKHUEWHMCFTXz5DLz5DTyDiNfDARDyGXgAK6yOtgnAP5wAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/7f0c404374a871fb1eb219175a9606fa/a6d36/mcp_image_31.png"
        srcset="/static/7f0c404374a871fb1eb219175a9606fa/222b7/mcp_image_31.png 163w,
/static/7f0c404374a871fb1eb219175a9606fa/ff46a/mcp_image_31.png 325w,
/static/7f0c404374a871fb1eb219175a9606fa/a6d36/mcp_image_31.png 650w,
/static/7f0c404374a871fb1eb219175a9606fa/e548f/mcp_image_31.png 975w,
/static/7f0c404374a871fb1eb219175a9606fa/5b587/mcp_image_31.png 1010w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<h3 id="步骤-3打开并检查项目" style="position:relative;"><a href="#%E6%AD%A5%E9%AA%A4-3%E6%89%93%E5%BC%80%E5%B9%B6%E6%A3%80%E6%9F%A5%E9%A1%B9%E7%9B%AE" aria-label="步骤 3打开并检查项目 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>步骤 3：打开并检查项目</strong></h3>
<ol>
<li>
<p>在 VS Code 中 <strong>打开生成的项目</strong></p>
</li>
<li>
<p><strong>审查项目结构：</strong></p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">weather_mcp/
├── src/
│   ├── __init__.py
│   └── server.py
├── inspector/
│   ├── package.json
│   └── package-lock.json
├── .vscode/
│   ├── launch.json
│   └── tasks.json
├── pyproject.toml
└── README.md
</code></pre></div>
</li>
</ol>
<h3 id="步骤-4升级到最新的-mcp-sdk" style="position:relative;"><a href="#%E6%AD%A5%E9%AA%A4-4%E5%8D%87%E7%BA%A7%E5%88%B0%E6%9C%80%E6%96%B0%E7%9A%84-mcp-sdk" aria-label="步骤 4升级到最新的 mcp sdk permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>步骤 4：升级到最新的 MCP SDK</strong></h3>
<blockquote>
<p>🔍 为什么要升级？ 我们希望使用最新的 MCP SDK (v1.9.3) 和 Inspector 服务 (0.14.0) 以获得增强的功能和更好的调试能力。</p>
</blockquote>
<h3 id="4a-更新-python-依赖项" style="position:relative;"><a href="#4a-%E6%9B%B4%E6%96%B0-python-%E4%BE%9D%E8%B5%96%E9%A1%B9" aria-label="4a 更新 python 依赖项 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>4a. 更新 Python 依赖项</strong></h3>
<p><strong>编辑 <code class="language-text">pyproject.toml</code>：</strong> 更新 <a href="https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/10-StreamliningAIWorkflowsBuildingAnMCPServerWithAIToolkit/lab3/code/weather_mcp/pyproject.toml">./code/weather_mcp/pyproject.toml</a></p>
<h3 id="4b-更新-inspector-配置" style="position:relative;"><a href="#4b-%E6%9B%B4%E6%96%B0-inspector-%E9%85%8D%E7%BD%AE" aria-label="4b 更新 inspector 配置 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>4b. 更新 Inspector 配置</strong></h3>
<p><strong>编辑 <code class="language-text">inspector/package.json</code>：</strong> 更新 <a href="https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/10-StreamliningAIWorkflowsBuildingAnMCPServerWithAIToolkit/lab3/code/weather_mcp/inspector/package.json">./code/weather_mcp/inspector/package.json</a></p>
<h3 id="4c-更新-inspector-依赖项" style="position:relative;"><a href="#4c-%E6%9B%B4%E6%96%B0-inspector-%E4%BE%9D%E8%B5%96%E9%A1%B9" aria-label="4c 更新 inspector 依赖项 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>4c. 更新 Inspector 依赖项</strong></h3>
<p><strong>编辑 <code class="language-text">inspector/package-lock.json</code>：</strong> 更新 <a href="https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/10-StreamliningAIWorkflowsBuildingAnMCPServerWithAIToolkit/lab3/code/weather_mcp/inspector/package-lock.json">./code/weather_mcp/inspector/package-lock.json</a></p>
<blockquote>
<p>📝 注意： 此文件包含大量的依赖项定义。以下是基本结构——完整内容确保正确的依赖项解析。</p>
</blockquote>
<blockquote>
<p>⚡ 完整的 package-lock： 完整的 package-lock.json 包含约 3000 行的依赖项定义。上面显示了关键结构——请使用提供的文件进行完整的依赖项解析。</p>
</blockquote>
<h3 id="步骤-5配置-vs-code-调试" style="position:relative;"><a href="#%E6%AD%A5%E9%AA%A4-5%E9%85%8D%E7%BD%AE-vs-code-%E8%B0%83%E8%AF%95" aria-label="步骤 5配置 vs code 调试 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>步骤 5：配置 VS Code 调试</strong></h3>
<p><em>注意：请复制指定路径中的文件以替换相应的本地文件</em></p>
<h3 id="5a-更新启动配置" style="position:relative;"><a href="#5a-%E6%9B%B4%E6%96%B0%E5%90%AF%E5%8A%A8%E9%85%8D%E7%BD%AE" aria-label="5a 更新启动配置 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>5a. 更新启动配置</strong></h3>
<p><strong>编辑 <code class="language-text">.vscode/launch.json</code>：</strong></p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"0.2.0"</span><span class="token punctuation">,</span>
  <span class="token property">"configurations"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"附加到本地 MCP"</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"debugpy"</span><span class="token punctuation">,</span>
      <span class="token property">"request"</span><span class="token operator">:</span> <span class="token string">"attach"</span><span class="token punctuation">,</span>
      <span class="token property">"connect"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"host"</span><span class="token operator">:</span> <span class="token string">"localhost"</span><span class="token punctuation">,</span>
        <span class="token property">"port"</span><span class="token operator">:</span> <span class="token number">5678</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">"presentation"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"hidden"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">"internalConsoleOptions"</span><span class="token operator">:</span> <span class="token string">"neverOpen"</span><span class="token punctuation">,</span>
      <span class="token property">"postDebugTask"</span><span class="token operator">:</span> <span class="token string">"终止所有任务"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"启动 Inspector (Edge)"</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"msedge"</span><span class="token punctuation">,</span>
      <span class="token property">"request"</span><span class="token operator">:</span> <span class="token string">"launch"</span><span class="token punctuation">,</span>
      <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"http://localhost:6274?timeout=60000&amp;serverUrl=http://localhost:3001/sse#tools"</span><span class="token punctuation">,</span>
      <span class="token property">"cascadeTerminateToConfigurations"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">"附加到本地 MCP"</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">"presentation"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"hidden"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">"internalConsoleOptions"</span><span class="token operator">:</span> <span class="token string">"neverOpen"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"启动 Inspector (Chrome)"</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"chrome"</span><span class="token punctuation">,</span>
      <span class="token property">"request"</span><span class="token operator">:</span> <span class="token string">"launch"</span><span class="token punctuation">,</span>
      <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"http://localhost:6274?timeout=60000&amp;serverUrl=http://localhost:3001/sse#tools"</span><span class="token punctuation">,</span>
      <span class="token property">"cascadeTerminateToConfigurations"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">"附加到本地 MCP"</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">"presentation"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"hidden"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">"internalConsoleOptions"</span><span class="token operator">:</span> <span class="token string">"neverOpen"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"compounds"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"在 Agent Builder 中调试"</span><span class="token punctuation">,</span>
      <span class="token property">"configurations"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">"附加到本地 MCP"</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">"preLaunchTask"</span><span class="token operator">:</span> <span class="token string">"打开 Agent Builder"</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"在 Inspector 中调试 (Edge)"</span><span class="token punctuation">,</span>
      <span class="token property">"configurations"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">"启动 Inspector (Edge)"</span><span class="token punctuation">,</span>
        <span class="token string">"附加到本地 MCP"</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">"preLaunchTask"</span><span class="token operator">:</span> <span class="token string">"启动 MCP Inspector"</span><span class="token punctuation">,</span>
      <span class="token property">"stopAll"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"在 Inspector 中调试 (Chrome)"</span><span class="token punctuation">,</span>
      <span class="token property">"configurations"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">"启动 Inspector (Chrome)"</span><span class="token punctuation">,</span>
        <span class="token string">"附加到本地 MCP"</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">"preLaunchTask"</span><span class="token operator">:</span> <span class="token string">"启动 MCP Inspector"</span><span class="token punctuation">,</span>
      <span class="token property">"stopAll"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p><strong>编辑 <code class="language-text">.vscode/tasks.json</code>：</strong></p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "启动 MCP 服务器",
      "type": "shell",
      "command": "python -m debugpy --listen 127.0.0.1:5678 src/__init__.py sse",
      "isBackground": true,
      "options": {
        "cwd": "${workspaceFolder}",
        "env": {
          "PORT": "3001"
        }
      },
      "problemMatcher": {
        "pattern": [
          {
            "regexp": "^.*$",
            "file": 0,
            "location": 1,
            "message": 2
          }
        ],
        "background": {
          "activeOnStart": true,
          "beginsPattern": ".*",
          "endsPattern": "Application startup complete|running"
        }
      }
    },
    {
      "label": "启动 MCP Inspector",
      "type": "shell",
      "command": "npm run dev:inspector",
      "isBackground": true,
      "options": {
        "cwd": "${workspaceFolder}/inspector",
        "env": {
          "CLIENT_PORT": "6274",
          "SERVER_PORT": "6277",
        }
      },
      "problemMatcher": {
        "pattern": [
          {
            "regexp": "^.*$",
            "file": 0,
            "location": 1,
            "message": 2
          }
        ],
        "background": {
          "activeOnStart": true,
          "beginsPattern": "Starting MCP inspector",
          "endsPattern": "Proxy server listening on port"
        }
      },
      "dependsOn": [
        "启动 MCP 服务器"
      ]
    },
    {
      "label": "打开 Agent Builder",
      "type": "shell",
      "command": "echo ${input:openAgentBuilder}",
      "presentation": {
        "reveal": "never"
      },
      "dependsOn": [
        "启动 MCP 服务器"
      ],
    },
    {
      "label": "终止所有任务",
      "command": "echo ${input:terminate}",
      "type": "shell",
      "problemMatcher": []
    }
  ],
  "inputs": [
    {
      "id": "openAgentBuilder",
      "type": "command",
      "command": "ai-mlstudio.agentBuilder",
      "args": {
        "initialMCPs": [ "local-server-weather_mcp" ],
        "triggeredFrom": "vsc-tasks"
      }
    },
    {
      "id": "terminate",
      "type": "command",
      "command": "workbench.action.tasks.terminate",
      "args": "terminateAll"
    }
  ]
}
</code></pre></div>
<hr>
<h2 id="-运行和测试的-mcp-服务器" style="position:relative;"><a href="#-%E8%BF%90%E8%A1%8C%E5%92%8C%E6%B5%8B%E8%AF%95%E7%9A%84-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8" aria-label=" 运行和测试的 mcp 服务器 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🚀 运行和测试的 MCP 服务器</strong></h2>
<h3 id="步骤-6安装依赖项" style="position:relative;"><a href="#%E6%AD%A5%E9%AA%A4-6%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96%E9%A1%B9" aria-label="步骤 6安装依赖项 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>步骤 6：安装依赖项</strong></h3>
<p>进行配置更改后，运行以下命令：</p>
<p><strong>安装 Python 依赖项：</strong></p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">uv <span class="token function">sync</span></code></pre></div>
<p><strong>安装 Inspector 依赖项：</strong></p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">cd</span> inspector
<span class="token function">npm</span> <span class="token function">install</span></code></pre></div>
<h3 id="步骤-7使用-agent-builder-进行调试" style="position:relative;"><a href="#%E6%AD%A5%E9%AA%A4-7%E4%BD%BF%E7%94%A8-agent-builder-%E8%BF%9B%E8%A1%8C%E8%B0%83%E8%AF%95" aria-label="步骤 7使用 agent builder 进行调试 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>步骤 7：使用 Agent Builder 进行调试</strong></h3>
<ol>
<li><strong>按 F5</strong> 或使用 <strong>“在 Agent Builder 中调试”</strong> 配置</li>
<li>从调试面板中 <strong>选择复合配置</strong></li>
<li><strong>等待服务器启动</strong> 并且 Agent Builder 打开</li>
<li>使用自然语言查询 <strong>测试的天气 MCP 服务器</strong></li>
</ol>
<p>像这样输入提示</p>
<p>系统提示</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">你是我的天气助手</code></pre></div>
<p>用户提示</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">西雅图的天气怎么样</code></pre></div>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/97d988888e36d5fd85a7e127a1350308/e9fa0/mcp_image_32.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 46.62576687116564%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA+klEQVR42m2RS26EQAxE+w4oKwKBmU5E+DbhGyBsEPe/0jxsgSZK3gI1lqtc7jbDMMzzXBTFh3A/uf3m/h/mU+CUZVmSJFq11lJMhMvU/sF8CTqZ//eTsizzPE9z13Z92zYMD8Pw7Yk4jk2apvTRjfKy16IMtPhWVUUQBK8nvu8fsZdl+RG2bdv3fZqmruuaplFBFEVBEGj3yxOe5+FlvoW6rpFhxNc5h4zMLEw2UhDBF67JOB47072uK3o2R0BIAjMWOzSs0/f9OI7U8cIUL010iJmGmAejyQmVwEEvQsW8hV6nPgeZj53p01F6uOBXr11HQSawCJn1wh8WJFX1034MWAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/97d988888e36d5fd85a7e127a1350308/a6d36/mcp_image_32.png"
        srcset="/static/97d988888e36d5fd85a7e127a1350308/222b7/mcp_image_32.png 163w,
/static/97d988888e36d5fd85a7e127a1350308/ff46a/mcp_image_32.png 325w,
/static/97d988888e36d5fd85a7e127a1350308/a6d36/mcp_image_32.png 650w,
/static/97d988888e36d5fd85a7e127a1350308/e548f/mcp_image_32.png 975w,
/static/97d988888e36d5fd85a7e127a1350308/3c492/mcp_image_32.png 1300w,
/static/97d988888e36d5fd85a7e127a1350308/e9fa0/mcp_image_32.png 2292w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<h3 id="步骤-8使用-mcp-inspector-进行调试" style="position:relative;"><a href="#%E6%AD%A5%E9%AA%A4-8%E4%BD%BF%E7%94%A8-mcp-inspector-%E8%BF%9B%E8%A1%8C%E8%B0%83%E8%AF%95" aria-label="步骤 8使用 mcp inspector 进行调试 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>步骤 8：使用 MCP Inspector 进行调试</strong></h3>
<ol>
<li>使用 <strong>“在 Inspector 中调试”</strong> 配置 (Edge 或 Chrome)</li>
<li>在 <code class="language-text">http://localhost:6274</code> <strong>打开 Inspector 界面</strong></li>
<li><strong>探索交互式测试环境：</strong>
<ul>
<li>查看可用工具</li>
<li>测试工具执行</li>
<li>监控网络请求</li>
<li>调试服务器响应</li>
</ul>
</li>
</ol>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/a27f2ba570e5c59ff8c4104e99bf2884/d9ed5/mcp_image_33.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 52.14723926380368%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABTUlEQVR42l1R2W6DMBB0ARPMaVODjZ0ADeQ+npJKfer//1WHOErSSCNrrfUcuyaFHHi9innnRyrmfWkOeb3OqpGJHkWhNjhLsxfN9mNWA16kHiC5XNK4IbTymQ5TC+AFhHB1L3CN8kVRDbNsji5NGpoYIAALnmn5JdQKDZ81ThuNKQvTTgIPAFa0gDMAJjJNbYyEcggzGyQGKonoYOJ8AJDBAdmD7kvsuzOvxlJvMrnE/UFD7ZxJWKHb7660wETq38xCb1R/Ut0ETEKodIt53U3ANFp+pv1EO0VIIylxFQJ7DNvukNm7besxcJiYym7V/FiatRc/badQbp8A4mVymI+XT3sU5uDAm33dnhfLcyJ6lrfeW+xnRWVWrcbzb7v9aYarGb8d7HhJ+YIE8u2TJwrWg9i3f9OpXNf9pbR7bnZc31G3p1S0JHxnepH6A9ebKMlNm6VQAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/a27f2ba570e5c59ff8c4104e99bf2884/a6d36/mcp_image_33.png"
        srcset="/static/a27f2ba570e5c59ff8c4104e99bf2884/222b7/mcp_image_33.png 163w,
/static/a27f2ba570e5c59ff8c4104e99bf2884/ff46a/mcp_image_33.png 325w,
/static/a27f2ba570e5c59ff8c4104e99bf2884/a6d36/mcp_image_33.png 650w,
/static/a27f2ba570e5c59ff8c4104e99bf2884/e548f/mcp_image_33.png 975w,
/static/a27f2ba570e5c59ff8c4104e99bf2884/3c492/mcp_image_33.png 1300w,
/static/a27f2ba570e5c59ff8c4104e99bf2884/d9ed5/mcp_image_33.png 2880w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<hr>
<h2 id="-主要学习成果" style="position:relative;"><a href="#-%E4%B8%BB%E8%A6%81%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C" aria-label=" 主要学习成果 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🎯 主要学习成果</strong></h2>
<p>通过完成本实验，已经：</p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" checked disabled>  [x] <strong>使用 AI 工具包模板创建了自定义 MCP 服务器</strong></li>
<li class="task-list-item"><input type="checkbox" checked disabled>  [x] <strong>升级到最新的 MCP SDK</strong> (v1.9.3) 以获得增强的功能</li>
<li class="task-list-item"><input type="checkbox" checked disabled>  [x] <strong>为 Agent Builder 和 Inspector 配置了专业的调试工作流</strong></li>
<li class="task-list-item"><input type="checkbox" checked disabled>  [x] <strong>设置了 MCP Inspector</strong> 进行交互式服务器测试</li>
<li class="task-list-item"><input type="checkbox" checked disabled>  [x] <strong>掌握了用于 MCP 开发的 VS Code 调试配置</strong></li>
</ul>
<h2 id="lab-4" style="position:relative;"><a href="#lab-4" aria-label="lab 4 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Lab-4</h2>
<h2 id="️-项目概述" style="position:relative;"><a href="#%EF%B8%8F-%E9%A1%B9%E7%9B%AE%E6%A6%82%E8%BF%B0" aria-label="️ 项目概述 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🏗️ 项目概述</strong></h2>
<h3 id="真实世界的开发挑战" style="position:relative;"><a href="#%E7%9C%9F%E5%AE%9E%E4%B8%96%E7%95%8C%E7%9A%84%E5%BC%80%E5%8F%91%E6%8C%91%E6%88%98" aria-label="真实世界的开发挑战 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>真实世界的开发挑战</strong></h3>
<p>作为开发人员，我们经常使用 GitHub 克隆仓库并在 VS Code 或 VS Code Insiders 中打开它们。这个手动过程包括：</p>
<ol>
<li>打开终端/命令提示符</li>
<li>导航到所需目录</li>
<li>运行 <code class="language-text">git clone</code> 命令</li>
<li>在克隆的目录中打开 VS Code</li>
</ol>
<p><strong>我们的 MCP 解决方案将此过程简化为单个智能命令！</strong></p>
<h3 id="将构建什么" style="position:relative;"><a href="#%E5%B0%86%E6%9E%84%E5%BB%BA%E4%BB%80%E4%B9%88" aria-label="将构建什么 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>将构建什么</strong></h3>
<p>一个 <strong>GitHub 克隆 MCP 服务器</strong> (<code class="language-text">git_mcp_server</code>)，它提供：</p>
<table>
<thead>
<tr>
<th>功能</th>
<th>描述</th>
<th>好处</th>
</tr>
</thead>
<tbody>
<tr>
<td>🔄 <strong>智能仓库克隆</strong></td>
<td>克隆带有验证的 GitHub 仓库</td>
<td>自动错误检查</td>
</tr>
<tr>
<td>📁 <strong>智能目录管理</strong></td>
<td>安全地检查和创建目录</td>
<td>防止覆盖</td>
</tr>
<tr>
<td>🚀 <strong>跨平台 VS Code 集成</strong></td>
<td>在 VS Code/Insiders 中打开项目</td>
<td>无缝工作流转换</td>
</tr>
<tr>
<td>🛡️ <strong>强大的错误处理</strong></td>
<td>处理网络、权限和路径问题</td>
<td>生产就绪的可靠性</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="-分步实施-1" style="position:relative;"><a href="#-%E5%88%86%E6%AD%A5%E5%AE%9E%E6%96%BD-1" aria-label=" 分步实施 1 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>📖 分步实施</strong></h2>
<h3 id="步骤-1在-agent-builder-中创建-github-代理" style="position:relative;"><a href="#%E6%AD%A5%E9%AA%A4-1%E5%9C%A8-agent-builder-%E4%B8%AD%E5%88%9B%E5%BB%BA-github-%E4%BB%A3%E7%90%86" aria-label="步骤 1在 agent builder 中创建 github 代理 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>步骤 1：在 Agent Builder 中创建 GitHub 代理</strong></h3>
<ol>
<li>
<p>通过 AI 工具包扩展 <strong>启动 Agent Builder</strong></p>
</li>
<li>
<p><strong>创建一个新代理</strong>，配置如下：</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">代理名称: GitHubAgent</code></pre></div>
</li>
<li>
<p><strong>初始化自定义 MCP 服务器：</strong></p>
<ul>
<li>导航到 <strong>工具</strong> → <strong>添加工具</strong> → <strong>MCP 服务器</strong></li>
<li>选择 <strong>“创建一个新的 MCP 服务器”</strong></li>
<li>选择 <strong>Python 模板</strong> 以获得最大的灵活性</li>
<li><strong>服务器名称：</strong> <code class="language-text">git_mcp_server</code></li>
</ul>
</li>
</ol>
<h3 id="步骤-2配置-github-copilot-代理模式" style="position:relative;"><a href="#%E6%AD%A5%E9%AA%A4-2%E9%85%8D%E7%BD%AE-github-copilot-%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F" aria-label="步骤 2配置 github copilot 代理模式 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>步骤 2：配置 GitHub Copilot 代理模式</strong></h3>
<ol>
<li>在 VS Code 中 <strong>打开 GitHub Copilot</strong> (Ctrl/Cmd + Shift + P → “GitHub Copilot: Open”)</li>
<li>在 Copilot 界面中 <strong>选择代理模型</strong></li>
<li><strong>选择 Claude 3.7 模型</strong> 以增强推理能力</li>
<li><strong>启用 MCP 集成</strong> 以进行工具访问</li>
</ol>
<blockquote>
<p>💡 专业提示： Claude 3.7 对开发工作流和错误处理模式有更出色的理解。</p>
</blockquote>
<h3 id="步骤-3实现核心-mcp-服务器功能" style="position:relative;"><a href="#%E6%AD%A5%E9%AA%A4-3%E5%AE%9E%E7%8E%B0%E6%A0%B8%E5%BF%83-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8A%9F%E8%83%BD" aria-label="步骤 3实现核心 mcp 服务器功能 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>步骤 3：实现核心 MCP 服务器功能</strong></h3>
<p><strong>在 GitHub Copilot 代理模式下使用以下详细提示：</strong></p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">创建两个具有以下全面要求的 MCP 工具：

🔧 工具 A：clone_repository
要求：
- 将任何 GitHub 仓库克隆到指定的本地文件夹
- 返回成功克隆的项目的绝对路径
- 实现全面的验证：
  ✓ 检查目标目录是否已存在（如果存在则返回错误）
  ✓ 验证 GitHub URL 格式 (https://github.com/user/repo)
  ✓ 验证 git 命令的可用性（如果缺少则提示安装）
  ✓ 处理网络连接问题
  ✓ 为所有失败场景提供清晰的错误消息

🚀 工具 B：open_in_vscode
要求：
- 在 VS Code 或 VS Code Insiders 中打开指定的文件夹
- 跨平台兼容性 (Windows/Linux/macOS)
- 使用直接的应用程序启动（而不是终端命令）
- 自动检测可用的 VS Code 安装
- 处理未安装 VS Code 的情况
- 提供用户友好的错误消息

附加要求：
- 遵循 MCP 1.9.3 最佳实践
- 包括适当的类型提示和文档
- 实现用于调试目的的日志记录
- 为所有参数添加入参验证
- 包括全面的错误处理
</code></pre></div>
<h3 id="步骤-4测试的-mcp-服务器" style="position:relative;"><a href="#%E6%AD%A5%E9%AA%A4-4%E6%B5%8B%E8%AF%95%E7%9A%84-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8" aria-label="步骤 4测试的 mcp 服务器 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>步骤 4：测试的 MCP 服务器</strong></h3>
<h3 id="4a-在-agent-builder-中测试" style="position:relative;"><a href="#4a-%E5%9C%A8-agent-builder-%E4%B8%AD%E6%B5%8B%E8%AF%95" aria-label="4a 在 agent builder 中测试 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>4a. 在 Agent Builder 中测试</strong></h3>
<ol>
<li><strong>启动 Agent Builder 的调试配置</strong></li>
<li><strong>使用此系统提示配置的代理：</strong></li>
</ol>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">系统提示：
是我的智能编码仓库助手。帮助开发人员高效地克隆 GitHub 仓库并设置他们的开发环境。始终提供有关操作的清晰反馈，并优雅地处理错误。
</code></pre></div>
<ol>
<li><strong>使用真实的用户场景进行测试：</strong></li>
</ol>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">用户提示示例：

场景：基本克隆和打开
“克隆 {的 GitHub 仓库链接，例如 https://github.com/kinfey/GHCAgentWorkshop
 } 并保存到 {指定的全局路径}，然后用 VS Code Insiders 打开它”
</code></pre></div>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/3d15b757828dbffe6fccd3cc538a2f4b/f60cd/mcp_image_34.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 51.533742331288344%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABY0lEQVR42m2Q246CQBBE+QazRhDkJsr9sooICFFh1ReNxrf9/x/ZI4RdH7bS6fRMpqqrRsiyrK5r3/eXHcwBhmH0vYf5HwTbtgPftyzLcRzmeYfFYuF5Ht11XS4R7S+tN3AjxHGy2WRRFIdRGEaR2yHiHMcviTD5XK3jOGK5pmm6rmsDmIVdWdbVrsi3X21zu17btiUITILgZW5ZSZKs12v2o6WqqqIos9mM/tpcHc6X+/f+cq9Ptzj5DDsEQQCfzmvMEg8yQbjBMMzRaMRyoSh2+0OT52W2zdM0ZclqtWIbzlluvAEJtKYdRFF82a6q6nw+tW1zPB6aAUVRIIFtHPJbGO75EMbj8UcHWZYFzw8o23GXtkPZ/LnjUq7nkQoCZDhY5TVdGoCuYKqytzB1RdKmE7Wrv0GRsEp4UqCCZwj6gFdmKb1ONndp+xCzh1o+tfLJwFHKn3LS6pr6+5QUfIT+hh83n15JhztyHwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/3d15b757828dbffe6fccd3cc538a2f4b/a6d36/mcp_image_34.png"
        srcset="/static/3d15b757828dbffe6fccd3cc538a2f4b/222b7/mcp_image_34.png 163w,
/static/3d15b757828dbffe6fccd3cc538a2f4b/ff46a/mcp_image_34.png 325w,
/static/3d15b757828dbffe6fccd3cc538a2f4b/a6d36/mcp_image_34.png 650w,
/static/3d15b757828dbffe6fccd3cc538a2f4b/e548f/mcp_image_34.png 975w,
/static/3d15b757828dbffe6fccd3cc538a2f4b/3c492/mcp_image_34.png 1300w,
/static/3d15b757828dbffe6fccd3cc538a2f4b/f60cd/mcp_image_34.png 2318w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<p><strong>预期结果：</strong></p>
<ul>
<li>✅ 成功克隆并确认路径</li>
<li>✅ 自动启动 VS Code</li>
<li>✅ 为无效场景提供清晰的错误消息</li>
<li>✅ 正确处理边缘情况</li>
</ul>
<h3 id="4b-在-mcp-检查器中测试" style="position:relative;"><a href="#4b-%E5%9C%A8-mcp-%E6%A3%80%E6%9F%A5%E5%99%A8%E4%B8%AD%E6%B5%8B%E8%AF%95" aria-label="4b 在 mcp 检查器中测试 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>4b. 在 MCP 检查器中测试</strong></h3>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/5a2ed464564611743396c141aafac746/93ba6/mcp_image_35.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 58.282208588957054%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAABpklEQVR42m2RC2+bMBSFTXjaxjg8DMY8HZKG0SaV2k3rpP3/37VDklZUmvTJss099xxfSNkuafXk88ZlRnWX4oYopr2ei+6q+mveXrDyzDphuYuqLYQmHQnWW58bno4eq136DY8ZkR+kOvrMeBvwiQRxE4oOzpABdHGpjpIO99gA1GX1OatntGCZFbmNsxErikmc2bJZeGrRicqO7QcItu1wTMuTqk5pMWXpsA1FEBV6gDqeDlJNkehC0eKIh6xZqI73Yyz7kBvKEU3fWZ2r/kX3l3p8pfsB4kyfYU5lj+R3UFSPV7ALS/J9ZiQpp7jAPE5wgzivzxDAE0eADWLnZhZ6cmjlftreBlkT4hf4B/cVhpjq/RXwf4wtqgIElq0n9I7pHV/xhEFf8pUBnVDqBMoJSkACteIrJnv0SjCLondj7YraTcy6YmAuwlCIy1A0zfSW1j9idRIbzPCizKzwR+SAZyPIA6qJE1UruGWmnz/G5W9l3/XhJ8DGHH+rdnFC5fi3RGH1Wb9KiCysyMYkt+CwfEzPf9rj+4PprX/61doLly37H/8A6dkzpQIFM/cAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image.png"
        title=""
        src="/static/5a2ed464564611743396c141aafac746/a6d36/mcp_image_35.png"
        srcset="/static/5a2ed464564611743396c141aafac746/222b7/mcp_image_35.png 163w,
/static/5a2ed464564611743396c141aafac746/ff46a/mcp_image_35.png 325w,
/static/5a2ed464564611743396c141aafac746/a6d36/mcp_image_35.png 650w,
/static/5a2ed464564611743396c141aafac746/e548f/mcp_image_35.png 975w,
/static/5a2ed464564611743396c141aafac746/3c492/mcp_image_35.png 1300w,
/static/5a2ed464564611743396c141aafac746/93ba6/mcp_image_35.png 2874w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<hr>
<p><strong>🎉 恭喜！</strong> 已成功创建一个实用、可用于生产的 MCP 服务器，解决了实际的开发工作流挑战。的自定义 GitHub 克隆服务器展示了 MCP 在自动化和提高开发人员生产力方面的强大功能。</p>
<h3 id="-成就解锁" style="position:relative;"><a href="#-%E6%88%90%E5%B0%B1%E8%A7%A3%E9%94%81" aria-label=" 成就解锁 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🏆 成就解锁：</strong></h3>
<ul>
<li>✅ <strong>MCP 开发人员</strong> - 创建了自定义 MCP 服务器</li>
<li>✅ <strong>工作流自动化者</strong> - 简化了开发流程</li>
<li>✅ <strong>集成专家</strong> - 连接了多个开发工具</li>
<li>✅ <strong>生产就绪</strong> - 构建了可部署的解决方案</li>
</ul>
<hr>
<h2 id="-研讨会完成的模型上下文协议之旅" style="position:relative;"><a href="#-%E7%A0%94%E8%AE%A8%E4%BC%9A%E5%AE%8C%E6%88%90%E7%9A%84%E6%A8%A1%E5%9E%8B%E4%B8%8A%E4%B8%8B%E6%96%87%E5%8D%8F%E8%AE%AE%E4%B9%8B%E6%97%85" aria-label=" 研讨会完成的模型上下文协议之旅 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🎓 研讨会完成：的模型上下文协议之旅</strong></h2>
<p><strong>亲爱的研讨会参与者，</strong></p>
<p>恭喜完成了模型上下文协议研讨会的所有四个模块！从理解基本的 AI 工具包概念到构建可用于生产的、解决实际开发挑战的 MCP 服务器，已经取得了长足的进步。</p>
<h3 id="-的学习路径回顾" style="position:relative;"><a href="#-%E7%9A%84%E5%AD%A6%E4%B9%A0%E8%B7%AF%E5%BE%84%E5%9B%9E%E9%A1%BE" aria-label=" 的学习路径回顾 permalink" class="toc-anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><strong>🚀 的学习路径回顾：</strong></h3>
<p><a href="https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/10-StreamliningAIWorkflowsBuildingAnMCPServerWithAIToolkit/lab1/README.md"><strong>模块 1</strong></a>：从探索 AI 工具包基础、模型测试和创建的第一个 AI 代理开始。</p>
<p><a href="https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/10-StreamliningAIWorkflowsBuildingAnMCPServerWithAIToolkit/lab2/README.md"><strong>模块 2</strong></a>：学习了 MCP 架构，集成了 Playwright MCP，并构建了的第一个浏览器自动化代理。</p>
<p><a href="https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/10-StreamliningAIWorkflowsBuildingAnMCPServerWithAIToolkit/lab3/README.md"><strong>模块 3</strong></a>：通过天气 MCP 服务器进阶到自定义 MCP 服务器开发，并掌握了调试工具。</p>
<p><a href="https://file+.vscode-resource.vscode-cdn.net/Users/zxc/code/bzd111/mcp-for-beginners/10-StreamliningAIWorkflowsBuildingAnMCPServerWithAIToolkit/lab4/README.md"><strong>模块 4</strong></a>：现在，已经应用所学知识创建了一个实用的 GitHub 仓库工作流自动化工具。</p></div></div></div><div class="max-w-4xl mx-auto mt-8"><div class="giscus"></div></div><div class="hidden lg:block fixed left-4 top-32 w-64"><div class="bg-white p-4 rounded-lg shadow-lg" style="max-height:calc(100vh - 12rem);overflow-y:auto"><h3 class="font-bold mb-2 text-left">目录: </h3><div class="text-left"><ul>
<li>
<p><a href="#mcp-for-beginners">mcp-for-beginners</a></p>
</li>
<li>
<p><a href="#01-mcp-%E4%BB%8B%E7%BB%8D"><strong>01-MCP 介绍</strong></a></p>
<ul>
<li>
<ul>
<li><a href="#mcp-%E6%A0%87%E5%87%86%E5%8C%96%E7%9A%84%E4%BC%98%E5%8A%BF"><strong>MCP 标准化的优势</strong></a></li>
</ul>
</li>
<li>
<p><a href="#mcp-%E9%AB%98%E5%B1%82%E6%9E%B6%E6%9E%84%E6%A6%82%E8%BF%B0"><strong>MCP 高层架构概述</strong></a></p>
<ul>
<li><a href="#%E5%85%B3%E9%94%AE%E7%BB%84%E4%BB%B6"><strong>关键组件：</strong></a></li>
</ul>
</li>
<li>
<p><a href="#mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C"><strong>MCP 服务器如何工作</strong></a></p>
</li>
<li>
<p><a href="#%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BA-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%99%84%E7%A4%BA%E4%BE%8B"><strong>如何构建 MCP 服务器（附示例）</strong></a></p>
</li>
<li>
<p><a href="#-mcp-%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><strong>🌍 MCP 实际应用场景</strong></a></p>
<ul>
<li><a href="#-mcp--ai-%E4%BA%A4%E4%BA%92%E7%9A%84%E9%80%9A%E7%94%A8%E6%A0%87%E5%87%86"><strong>🧠 MCP = AI 交互的通用标准</strong></a></li>
<li><a href="#-%E4%BF%83%E8%BF%9B%E7%9F%A5%E8%AF%86%E8%AE%BF%E9%97%AE"><strong>💡 促进知识访问</strong></a></li>
<li><a href="#-%E7%A4%BA%E4%BE%8B%E5%8F%AF%E6%89%A9%E5%B1%95%E7%9A%84%E4%BB%A3%E7%90%86%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><strong>👉 示例：可扩展的代理解决方案</strong></a></li>
<li><a href="#-%E5%AE%A2%E6%88%B7%E7%AB%AF-%E6%9C%8D%E5%8A%A1%E5%99%A8-llm-%E9%9B%86%E6%88%90%E7%9A%84%E9%AB%98%E7%BA%A7-mcp-%E5%9C%BA%E6%99%AF"><strong>🔄 客户端-服务器 LLM 集成的高级 MCP 场景</strong></a></li>
</ul>
</li>
<li>
<p><a href="#-mcp-%E7%9A%84%E5%AE%9E%E9%99%85%E4%BC%98%E5%8A%BF"><strong>🔐 MCP 的实际优势</strong></a></p>
</li>
<li>
<p><a href="#-%E5%85%B3%E9%94%AE%E8%A6%81%E7%82%B9"><strong>📌 关键要点</strong></a></p>
</li>
</ul>
</li>
<li>
<p><a href="#02-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E8%AF%A6%E8%A7%A3"><strong>02-核心概念详解</strong></a></p>
<ul>
<li>
<p><a href="#-mcp-%E6%9E%B6%E6%9E%84%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90"><strong>🔎 MCP 架构：深入解析</strong></a></p>
<ul>
<li><a href="#1-%E4%B8%BB%E6%9C%BA"><strong>1. 主机</strong></a></li>
<li><a href="#2-%E5%AE%A2%E6%88%B7%E7%AB%AF"><strong>2. 客户端</strong></a></li>
<li><a href="#3-%E6%9C%8D%E5%8A%A1%E5%99%A8"><strong>3. 服务器</strong></a></li>
<li><a href="#4-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8A%9F%E8%83%BD"><strong>4. 服务器功能</strong></a></li>
<li><a href="#-%E8%B5%84%E6%BA%90"><strong>📑 资源</strong></a></li>
<li><a href="#-%E6%8F%90%E7%A4%BA"><strong>🤖 提示</strong></a></li>
<li><a href="#%EF%B8%8F-%E5%B7%A5%E5%85%B7"><strong>⛏️ 工具</strong></a></li>
</ul>
</li>
<li>
<p><a href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%8A%9F%E8%83%BD"><strong>客户端功能</strong></a></p>
<ul>
<li><a href="#-%E9%87%87%E6%A0%B7"><strong>👉 采样</strong></a></li>
</ul>
</li>
<li>
<p><a href="#mcp-%E4%B8%AD%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81"><strong>MCP 中的信息流</strong></a></p>
</li>
<li>
<p><a href="#%E5%8D%8F%E8%AE%AE%E8%AF%A6%E6%83%85"><strong>协议详情</strong></a></p>
<ul>
<li><a href="#%E5%85%B3%E9%94%AE%E5%8D%8F%E8%AE%AE%E7%89%B9%E6%80%A7"><strong>关键协议特性</strong></a></li>
<li><a href="#-%E5%9F%BA%E7%A1%80%E5%8D%8F%E8%AE%AE"><strong>🧢 基础协议</strong></a></li>
<li><a href="#-%E9%99%84%E5%8A%A0%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7"><strong>➕ 附加实用工具</strong></a></li>
<li><a href="#-%E5%AE%89%E5%85%A8%E8%80%83%E8%99%91"><strong>🔐 安全考虑</strong></a></li>
</ul>
</li>
<li>
<p><a href="#%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B%E5%85%B3%E9%94%AE%E7%BB%84%E4%BB%B6"><strong>代码示例：关键组件</strong></a></p>
</li>
<li>
<p><a href="#%E5%AE%89%E5%85%A8%E4%B8%8E%E6%8E%88%E6%9D%83"><strong>安全与授权</strong></a></p>
</li>
<li>
<p><a href="#%E5%8D%8F%E8%AE%AE%E6%B6%88%E6%81%AF"><strong>协议消息</strong></a></p>
</li>
<li>
<p><a href="#%E5%85%B3%E9%94%AE%E8%A6%81%E7%82%B9"><strong>关键要点</strong></a></p>
</li>
</ul>
</li>
<li>
<p><a href="#03-mcp-%E5%AE%89%E5%85%A8%E6%80%A7"><strong>03-MCP 安全性</strong></a></p>
<ul>
<li><a href="#%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97"><strong>入门指南</strong></a></li>
<li><a href="#01-first-server">01-first-server</a></li>
<li><a href="#02-client">02-client</a></li>
<li><a href="#03-llm-client">03-llm-client</a></li>
<li><a href="#04-vscode">04-vscode</a></li>
<li><a href="#05-sse-server">05-sse-server</a></li>
<li><a href="#06-http-streaming">06-http-streaming</a></li>
<li><a href="#07-ai-toolkit">07-<strong>AI Toolkit</strong></a></li>
<li><a href="#08-testing">08-testing</a></li>
<li><a href="#09-deployment">09-deployment</a></li>
</ul>
</li>
<li>
<p><a href="#04-%E5%AE%9E%E6%88%98%E5%BA%94%E7%94%A8"><strong>04-实战应用</strong></a></p>
<ul>
<li>
<ul>
<li><a href="#%E6%A0%B8%E5%BF%83%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8A%9F%E8%83%BD"><strong>核心服务器功能</strong></a></li>
<li><a href="#%E8%B5%84%E6%BA%90"><strong>资源</strong></a></li>
<li><a href="#%E6%8F%90%E7%A4%BA"><strong>提示</strong></a></li>
<li><a href="#%E5%B7%A5%E5%85%B7"><strong>工具</strong></a></li>
<li><a href="#%E7%A4%BA%E4%BE%8B%E5%AE%9E%E7%8E%B0python"><strong>示例实现：Python</strong></a></li>
<li><a href="#%E5%85%B3%E9%94%AE%E5%8A%9F%E8%83%BD"><strong>关键功能</strong></a></li>
<li><a href="#api%E7%AE%A1%E7%90%86"><strong>API管理</strong></a></li>
<li><a href="#%E5%B0%86%E8%BF%9C%E7%A8%8Bmcp%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2%E5%88%B0azure"><strong>将远程MCP服务器部署到Azure</strong></a></li>
<li><a href="#%E4%BD%BF%E7%94%A8mcp%E6%A3%80%E6%9F%A5%E5%99%A8%E6%B5%8B%E8%AF%95%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8"><strong>使用MCP检查器测试的服务器</strong></a></li>
</ul>
</li>
</ul>
</li>
<li>
<p><a href="#05-mcp-%E9%AB%98%E7%BA%A7%E8%AF%9D%E9%A2%98"><strong>05-MCP 高级话题</strong></a></p>
<ul>
<li>
<p><a href="#mcp-%E4%B8%8E-azure-%E9%9B%86%E6%88%90"><strong>MCP 与 Azure 集成</strong></a></p>
</li>
<li>
<p><a href="#%E5%A4%9A%E6%A8%A1%E6%80%81"><strong>多模态</strong></a></p>
</li>
<li>
<p><a href="#mcp-oauth2-%E6%BC%94%E7%A4%BA"><strong>MCP OAuth2 演示</strong></a></p>
</li>
<li>
<p><a href="#%E6%A0%B9%E4%B8%8A%E4%B8%8B%E6%96%87"><strong>根上下文</strong></a></p>
</li>
<li>
<p><a href="#%E8%B7%AF%E7%94%B1"><strong>路由</strong></a></p>
<ul>
<li><a href="#%E6%99%BA%E8%83%BD%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><strong>智能负载均衡</strong></a></li>
<li><a href="#%E5%8A%A8%E6%80%81%E5%B7%A5%E5%85%B7%E8%B7%AF%E7%94%B1"><strong>动态工具路由</strong></a></li>
</ul>
</li>
<li>
<p><a href="#%E9%87%87%E6%A0%B7"><strong>采样</strong></a></p>
<ul>
<li><a href="#%E9%87%87%E6%A0%B7%E5%8F%82%E6%95%B0%E6%A6%82%E8%A7%88"><strong>采样参数概览</strong></a></li>
<li><a href="#%E6%B8%A9%E5%BA%A6%E5%92%8C-top-ktop-p-%E9%87%87%E6%A0%B7"><strong>温度和 Top-K/Top-P 采样</strong></a></li>
<li><a href="#%E7%A1%AE%E5%AE%9A%E6%80%A7%E9%87%87%E6%A0%B7"><strong>确定性采样</strong></a></li>
<li><a href="#%E5%8A%A8%E6%80%81%E9%87%87%E6%A0%B7%E9%85%8D%E7%BD%AE"><strong>动态采样配置</strong></a></li>
<li><a href="#%E5%81%9C%E6%AD%A2%E5%BA%8F%E5%88%97%E5%92%8C%E6%A0%87%E8%AE%B0%E9%99%90%E5%88%B6"><strong>停止序列和标记限制</strong></a></li>
<li><a href="#%E9%87%87%E6%A0%B7%E7%AD%96%E7%95%A5%E5%BA%94%E7%94%A8"><strong>采样策略应用</strong></a></li>
</ul>
</li>
<li>
<p><a href="#%E6%89%A9%E5%B1%95"><strong>扩展</strong></a></p>
<ul>
<li><a href="#%E5%8F%AF%E6%89%A9%E5%B1%95%E6%80%A7%E7%AD%96%E7%95%A5"><strong>可扩展性策略</strong></a></li>
<li><a href="#%E6%B0%B4%E5%B9%B3%E6%89%A9%E5%B1%95"><strong>水平扩展</strong></a></li>
<li><a href="#%E5%9E%82%E7%9B%B4%E6%89%A9%E5%B1%95%E5%92%8C%E8%B5%84%E6%BA%90%E4%BC%98%E5%8C%96"><strong>垂直扩展和资源优化</strong></a></li>
<li><a href="#%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84"><strong>分布式架构</strong></a></li>
</ul>
</li>
<li>
<p><a href="#%E5%AE%89%E5%85%A8"><strong>安全</strong></a></p>
<ul>
<li><a href="#%E8%AE%A4%E8%AF%81%E4%B8%8E%E6%8E%88%E6%9D%83"><strong>认证与授权</strong></a></li>
<li><a href="#net-identity-%E9%9B%86%E6%88%90"><strong>.NET Identity 集成</strong></a></li>
<li><a href="#java-spring-security-%E9%9B%86%E6%88%90"><strong>Java Spring Security 集成</strong></a></li>
<li><a href="#%E6%95%B0%E6%8D%AE%E4%BF%9D%E6%8A%A4%E4%B8%8E%E9%9A%90%E7%A7%81"><strong>数据保护与隐私</strong></a></li>
<li><a href="#python-%E6%95%B0%E6%8D%AE%E4%BF%9D%E6%8A%A4%E7%A4%BA%E4%BE%8B"><strong>Python 数据保护示例</strong></a></li>
</ul>
</li>
<li>
<p><a href="#%E5%AE%9E%E6%97%B6-web-%E6%90%9C%E7%B4%A2">实时 Web 搜索</a></p>
</li>
<li>
<p><a href="#%E6%A8%A1%E5%9E%8B%E4%B8%8A%E4%B8%8B%E6%96%87%E5%8D%8F%E8%AE%AE%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84-entra-id-%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81">模型上下文协议服务器的 Entra ID 身份验证</a></p>
<ul>
<li><a href="#microsoft-entra-id-%E7%AE%80%E4%BB%8B"><strong>Microsoft Entra ID 简介</strong></a></li>
<li><a href="#%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81%E6%B5%81%E7%A8%8B"><strong>身份验证流程</strong></a></li>
<li><a href="#%E4%BB%8B%E7%BB%8D-microsoft-%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81%E5%BA%93-msal"><strong>介绍 Microsoft 身份验证库 (MSAL)</strong></a></li>
</ul>
</li>
<li>
<p><a href="#%E4%BD%BF%E7%94%A8-entra-id-%E4%BF%9D%E6%8A%A4%E7%9A%84-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%88%86%E6%AD%A5%E6%8C%87%E5%8D%97"><strong>使用 Entra ID 保护的 MCP 服务器：分步指南</strong></a></p>
<ul>
<li><a href="#%E5%9C%BA%E6%99%AF-1%E4%BF%9D%E6%8A%A4%E6%9C%AC%E5%9C%B0-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BD%BF%E7%94%A8%E5%85%AC%E5%85%B1%E5%AE%A2%E6%88%B7%E7%AB%AF"><strong>场景 1：保护本地 MCP 服务器（使用公共客户端）</strong></a></li>
<li><a href="#1-%E5%9C%A8-entra-id-%E4%B8%AD%E8%AE%BE%E7%BD%AE%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><strong>1. 在 Entra ID 中设置应用程序</strong></a></li>
<li><a href="#2-%E4%BB%A3%E7%A0%81%E5%88%86%E8%A7%A3"><strong>2. 代码：分解</strong></a></li>
<li><a href="#3-%E5%AE%83%E4%BB%AC%E5%A6%82%E4%BD%95%E5%8D%8F%E5%90%8C%E5%B7%A5%E4%BD%9C"><strong>3. 它们如何协同工作</strong></a></li>
<li><a href="#%E5%9C%BA%E6%99%AF-2%E4%BF%9D%E6%8A%A4%E8%BF%9C%E7%A8%8B-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BD%BF%E7%94%A8%E6%9C%BA%E5%AF%86%E5%AE%A2%E6%88%B7%E7%AB%AF"><strong>场景 2：保护远程 MCP 服务器（使用机密客户端）</strong></a></li>
<li><a href="#1-%E5%9C%A8-entra-id-%E4%B8%AD%E8%AE%BE%E7%BD%AE%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F-1"><strong>1. 在 Entra ID 中设置应用程序</strong></a></li>
<li><a href="#2-%E4%BB%A3%E7%A0%81%E5%88%86%E8%A7%A3-1"><strong>2. 代码：分解</strong></a></li>
<li><a href="#3-%E5%AE%83%E4%BB%AC%E5%A6%82%E4%BD%95%E5%8D%8F%E5%90%8C%E5%B7%A5%E4%BD%9C-1"><strong>3. 它们如何协同工作</strong></a></li>
<li><a href="#%E5%AE%89%E5%85%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><strong>安全最佳实践</strong></a></li>
</ul>
</li>
<li>
<p><a href="#azure-ai-foundry-%E4%BB%A3%E7%90%86%E9%9B%86%E6%88%90">Azure AI Foundry 代理集成</a></p>
<ul>
<li><a href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%A8%A1%E5%9E%8B%E4%B8%8A%E4%B8%8B%E6%96%87%E5%8D%8F%E8%AE%AE-mcp"><strong>什么是模型上下文协议 (MCP)？</strong></a></li>
<li><a href="#%E4%BD%BF%E7%94%A8-azure-ai-foundry-%E8%AE%BE%E7%BD%AE-mcp"><strong>使用 Azure AI Foundry 设置 MCP</strong></a></li>
<li><a href="#1-%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><strong>1. 环境配置</strong></a></li>
<li><a href="#2-%E5%88%9B%E5%BB%BA%E5%85%B7%E6%9C%89-mcp-%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BB%A3%E7%90%86"><strong>2. 创建具有 MCP 工具的代理</strong></a></li>
<li><a href="#mcp-%E5%B7%A5%E5%85%B7%E9%85%8D%E7%BD%AE%E9%80%89%E9%A1%B9"><strong>MCP 工具配置选项</strong></a></li>
<li><a href="#%E9%85%8D%E7%BD%AE"><strong>配置</strong></a></li>
<li><a href="#%E5%AE%8C%E6%95%B4%E7%A4%BA%E4%BE%8B%E4%BD%BF%E7%94%A8-microsoft-learn-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8"><strong>完整示例：使用 Microsoft Learn MCP 服务器</strong></a></li>
<li><a href="#%E8%A7%A3%E5%86%B3%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98"><strong>解决常见问题</strong></a></li>
<li><a href="#1-%E8%BF%9E%E6%8E%A5%E9%97%AE%E9%A2%98"><strong>1. 连接问题</strong></a></li>
<li><a href="#2-%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8%E5%A4%B1%E8%B4%A5"><strong>2. 工具调用失败</strong></a></li>
<li><a href="#3-%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98"><strong>3. 性能问题</strong></a></li>
</ul>
</li>
</ul>
</li>
<li>
<p><a href="#06-%E7%A4%BE%E5%8C%BA%E8%B4%A1%E7%8C%AE"><strong>06-社区贡献</strong></a></p>
<ul>
<li>
<p><a href="#mcp-%E7%A4%BE%E5%8C%BA%E7%94%9F%E6%80%81%E7%B3%BB%E7%BB%9F"><strong>MCP 社区生态系统</strong></a></p>
<ul>
<li><a href="#%E5%85%B3%E9%94%AE%E7%A4%BE%E5%8C%BA%E7%BB%84%E4%BB%B6"><strong>关键社区组件</strong></a></li>
<li><a href="#%E7%A4%BE%E5%8C%BA%E8%B5%84%E6%BA%90"><strong>社区资源</strong></a></li>
<li><a href="#%E5%AE%98%E6%96%B9%E6%B8%A0%E9%81%93"><strong>官方渠道</strong></a></li>
<li><a href="#%E7%A4%BE%E5%8C%BA%E9%A9%B1%E5%8A%A8%E8%B5%84%E6%BA%90"><strong>社区驱动资源</strong></a></li>
</ul>
</li>
<li>
<p><a href="#%E4%B8%BA-mcp-%E5%81%9A%E8%B4%A1%E7%8C%AE"><strong>为 MCP 做贡献</strong></a></p>
<ul>
<li><a href="#%E8%B4%A1%E7%8C%AE%E7%B1%BB%E5%9E%8B"><strong>贡献类型</strong></a></li>
<li><a href="#%E8%B4%A1%E7%8C%AE%E6%B5%81%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8D%8F%E8%AE%AE"><strong>贡献流程：核心协议</strong></a></li>
<li><a href="#python-%E7%A4%BA%E4%BE%8B%E4%B8%BA%E6%A0%87%E5%87%86%E5%BA%93%E8%B4%A1%E7%8C%AE%E6%96%B0%E5%B7%A5%E5%85%B7"><strong>Python 示例：为标准库贡献新工具</strong></a></li>
<li><a href="#%E8%B4%A1%E7%8C%AE%E6%8C%87%E5%8D%97"><strong>贡献指南</strong></a></li>
<li><a href="#%E7%A4%BA%E4%BE%8B%E8%B4%A1%E7%8C%AE%E5%B7%A5%E4%BD%9C%E6%B5%81"><strong>示例贡献工作流</strong></a></li>
</ul>
</li>
<li>
<p><a href="#%E5%88%9B%E5%BB%BA%E5%92%8C%E5%88%86%E4%BA%AB%E8%87%AA%E5%AE%9A%E4%B9%89-mcp-%E5%B7%A5%E5%85%B7"><strong>创建和分享自定义 MCP 工具</strong></a></p>
<ul>
<li><a href="#%E5%BC%80%E5%8F%91%E5%8F%AF%E5%88%86%E4%BA%AB%E7%9A%84%E5%B7%A5%E5%85%B7"><strong>开发可分享的工具</strong></a></li>
<li><a href="#python-%E7%A4%BA%E4%BE%8B%E5%8F%91%E5%B8%83-pypi-%E5%8C%85"><strong>Python 示例：发布 PyPI 包</strong></a></li>
<li><a href="#%E5%88%86%E4%BA%AB%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><strong>分享最佳实践</strong></a></li>
</ul>
</li>
<li>
<p><a href="#%E7%A4%BE%E5%8C%BA%E5%8D%8F%E4%BD%9C%E4%B8%8E%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><strong>社区协作与最佳实践</strong></a></p>
<ul>
<li><a href="#%E6%B2%9F%E9%80%9A%E6%B8%A0%E9%81%93"><strong>沟通渠道</strong></a></li>
<li><a href="#%E4%BB%A3%E7%A0%81%E5%AE%A1%E6%9F%A5"><strong>代码审查</strong></a></li>
<li><a href="#%E7%89%88%E6%9C%AC%E5%85%BC%E5%AE%B9%E6%80%A7"><strong>版本兼容性</strong></a></li>
</ul>
</li>
<li>
<p><a href="#%E7%A4%BA%E4%BE%8B%E7%A4%BE%E5%8C%BA%E9%A1%B9%E7%9B%AEmcp-%E5%B7%A5%E5%85%B7%E6%B3%A8%E5%86%8C%E8%A1%A8"><strong>示例社区项目：MCP 工具注册表</strong></a></p>
</li>
<li>
<p><a href="#%E5%85%B3%E9%94%AE%E8%A6%81%E7%82%B9-1"><strong>关键要点</strong></a></p>
</li>
</ul>
</li>
<li>
<p><a href="#07-%E6%97%A9%E6%9C%9F%E9%87%87%E7%94%A8%E7%BB%8F%E9%AA%8C%E5%88%86%E4%BA%AB"><strong>07-早期采用经验分享</strong></a></p>
<ul>
<li>
<p><a href="#%E7%9C%9F%E5%AE%9E%E7%9A%84-mcp-%E5%AE%9E%E6%96%BD"><strong>真实的 MCP 实施</strong></a></p>
<ul>
<li><a href="#%E6%A1%88%E4%BE%8B%E7%A0%94%E7%A9%B6-1%E4%BC%81%E4%B8%9A%E5%AE%A2%E6%88%B7%E6%94%AF%E6%8C%81%E8%87%AA%E5%8A%A8%E5%8C%96"><strong>案例研究 1：企业客户支持自动化</strong></a></li>
<li><a href="#%E6%A1%88%E4%BE%8B%E7%A0%94%E7%A9%B6-2%E5%8C%BB%E7%96%97%E4%BF%9D%E5%81%A5%E8%AF%8A%E6%96%AD%E5%8A%A9%E6%89%8B"><strong>案例研究 2：医疗保健诊断助手</strong></a></li>
<li><a href="#%E6%A1%88%E4%BE%8B%E7%A0%94%E7%A9%B6-3%E9%87%91%E8%9E%8D%E6%9C%8D%E5%8A%A1%E9%A3%8E%E9%99%A9%E5%88%86%E6%9E%90"><strong>案例研究 3：金融服务风险分析</strong></a></li>
<li><a href="#%E6%A1%88%E4%BE%8B%E7%A0%94%E7%A9%B6-4%E7%94%A8%E4%BA%8E%E6%B5%8F%E8%A7%88%E5%99%A8%E8%87%AA%E5%8A%A8%E5%8C%96%E7%9A%84-microsoft-playwright-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8"><strong>案例研究 4：用于浏览器自动化的 Microsoft Playwright MCP 服务器</strong></a></li>
<li><a href="#%E6%A1%88%E4%BE%8B%E7%A0%94%E7%A9%B6-5azure-mcp--%E4%BC%81%E4%B8%9A%E7%BA%A7%E6%A8%A1%E5%9E%8B%E4%B8%8A%E4%B8%8B%E6%96%87%E5%8D%8F%E8%AE%AE%E5%8D%B3%E6%9C%8D%E5%8A%A1"><strong>案例研究 5：Azure MCP – 企业级模型上下文协议即服务</strong></a></li>
<li><a href="#%E6%A1%88%E4%BE%8B%E7%A0%94%E7%A9%B6-6nlweb"><strong>案例研究 6：NLWeb</strong></a></li>
<li><a href="#%E6%A1%88%E4%BE%8B%E7%A0%94%E7%A9%B6-7%E7%94%A8%E4%BA%8E-foundry-%E7%9A%84-mcp--%E9%9B%86%E6%88%90-azure-ai-%E4%BB%A3%E7%90%86"><strong>案例研究 7：用于 Foundry 的 MCP – 集成 Azure AI 代理</strong></a></li>
<li><a href="#%E6%A1%88%E4%BE%8B%E7%A0%94%E7%A9%B6-8foundry-mcp-playground--%E5%AE%9E%E9%AA%8C%E5%92%8C%E5%8E%9F%E5%9E%8B%E8%AE%BE%E8%AE%A1"><strong>案例研究 8：Foundry MCP Playground – 实验和原型设计</strong></a></li>
<li><a href="#%E6%A1%88%E4%BE%8B%E7%A0%94%E7%A9%B6-9-microsoft-docs-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8---%E5%AD%A6%E4%B9%A0%E5%92%8C%E6%8A%80%E8%83%BD%E6%8F%90%E5%8D%87"><strong>案例研究 9. Microsoft Docs MCP 服务器 - 学习和技能提升</strong></a></li>
</ul>
</li>
<li>
<p><a href="#%E5%8A%A8%E6%89%8B%E9%A1%B9%E7%9B%AE-todo"><strong>动手项目 TODO</strong></a></p>
<ul>
<li><a href="#%E9%A1%B9%E7%9B%AE-1%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%A4%9A%E6%8F%90%E4%BE%9B%E5%95%86-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8"><strong>项目 1：构建一个多提供商 MCP 服务器</strong></a></li>
<li><a href="#%E9%A1%B9%E7%9B%AE-2%E4%BC%81%E4%B8%9A%E6%8F%90%E7%A4%BA%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F"><strong>项目 2：企业提示管理系统</strong></a></li>
<li><a href="#%E9%A1%B9%E7%9B%AE-3%E5%9F%BA%E4%BA%8E-mcp-%E7%9A%84%E5%86%85%E5%AE%B9%E7%94%9F%E6%88%90%E5%B9%B3%E5%8F%B0"><strong>项目 3：基于 MCP 的内容生成平台</strong></a></li>
</ul>
</li>
<li>
<p><a href="#mcp-%E6%8A%80%E6%9C%AF%E7%9A%84%E6%9C%AA%E6%9D%A5%E6%96%B9%E5%90%91"><strong>MCP 技术的未来方向</strong></a></p>
<ul>
<li><a href="#%E6%96%B0%E5%85%B4%E8%B6%8B%E5%8A%BF"><strong>新兴趋势</strong></a></li>
<li><a href="#%E6%9D%A5%E8%87%AA%E5%BE%AE%E8%BD%AF%E7%9A%84-mcp-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><strong>来自微软的 MCP 解决方案</strong></a></li>
<li><a href="#%E5%BE%AE%E8%BD%AF%E7%BB%84%E7%BB%87"><strong>微软组织</strong></a></li>
<li><a href="#azure-samples-%E7%BB%84%E7%BB%87"><strong>Azure-Samples 组织</strong></a></li>
<li><a href="#mcp-%E8%B5%84%E6%BA%90%E7%9B%AE%E5%BD%95"><strong>MCP 资源目录</strong></a></li>
<li><a href="#mcp-%E8%B5%84%E6%BA%90%E7%9B%AE%E5%BD%95-1"><strong>MCP 资源目录</strong></a></li>
<li><a href="#%E7%A0%94%E7%A9%B6%E6%9C%BA%E4%BC%9A"><strong>研究机会</strong></a></li>
</ul>
</li>
<li>
<p><a href="#%E5%85%B6%E4%BB%96%E8%B5%84%E6%BA%90"><strong>其他资源</strong></a></p>
</li>
</ul>
</li>
<li>
<p><a href="#08-mcp-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><strong>08-MCP 最佳实践</strong></a></p>
<ul>
<li>
<p><a href="#mcp-%E5%B7%A5%E5%85%B7%E5%BC%80%E5%8F%91%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><strong>MCP 工具开发最佳实践</strong></a></p>
<ul>
<li><a href="#%E6%9E%B6%E6%9E%84%E5%8E%9F%E5%88%99"><strong>架构原则</strong></a></li>
<li><a href="#1-%E5%8D%95%E4%B8%80%E8%81%8C%E8%B4%A3%E5%8E%9F%E5%88%99"><strong>1. 单一职责原则</strong></a></li>
<li><a href="#2-%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E5%92%8C%E5%8F%AF%E6%B5%8B%E8%AF%95%E6%80%A7"><strong>2. 依赖注入和可测试性</strong></a></li>
<li><a href="#3-%E5%8F%AF%E7%BB%84%E5%90%88%E5%B7%A5%E5%85%B7"><strong>3. 可组合工具</strong></a></li>
<li><a href="#%E6%A8%A1%E5%BC%8F%E8%AE%BE%E8%AE%A1%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><strong>模式设计最佳实践</strong></a></li>
<li><a href="#1-%E6%B8%85%E6%99%B0%E7%9A%84%E5%8F%82%E6%95%B0%E6%8F%8F%E8%BF%B0"><strong>1. 清晰的参数描述</strong></a></li>
<li><a href="#2-%E9%AA%8C%E8%AF%81%E7%BA%A6%E6%9D%9F"><strong>2. 验证约束</strong></a></li>
<li><a href="#3-%E4%B8%80%E8%87%B4%E7%9A%84%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%84"><strong>3. 一致的返回结构</strong></a></li>
<li><a href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><strong>错误处理</strong></a></li>
<li><a href="#1-%E4%BC%98%E9%9B%85%E7%9A%84%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><strong>1. 优雅的错误处理</strong></a></li>
<li><a href="#2-%E7%BB%93%E6%9E%84%E5%8C%96%E9%94%99%E8%AF%AF%E5%93%8D%E5%BA%94"><strong>2. 结构化错误响应</strong></a></li>
<li><a href="#3-%E9%87%8D%E8%AF%95%E9%80%BB%E8%BE%91"><strong>3. 重试逻辑</strong></a></li>
<li><a href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><strong>性能优化</strong></a></li>
<li><a href="#1-%E7%BC%93%E5%AD%98"><strong>1. 缓存</strong></a></li>
<li><a href="#2-%E5%BC%82%E6%AD%A5%E5%A4%84%E7%90%86"><strong>2. 异步处理</strong></a></li>
<li><a href="#3-%E8%B5%84%E6%BA%90%E9%99%90%E5%88%B6"><strong>3. 资源限制</strong></a></li>
<li><a href="#%E5%AE%89%E5%85%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-1"><strong>安全最佳实践</strong></a></li>
<li><a href="#1-%E8%BE%93%E5%85%A5%E9%AA%8C%E8%AF%81"><strong>1. 输入验证</strong></a></li>
<li><a href="#2-%E6%8E%88%E6%9D%83%E6%A3%80%E6%9F%A5"><strong>2. 授权检查</strong></a></li>
<li><a href="#3-%E6%95%8F%E6%84%9F%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86"><strong>3. 敏感数据处理</strong></a></li>
</ul>
</li>
<li>
<p><a href="#mcp-%E5%B7%A5%E5%85%B7%E6%B5%8B%E8%AF%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><strong>MCP 工具测试最佳实践</strong></a></p>
<ul>
<li><a href="#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"><strong>单元测试</strong></a></li>
<li><a href="#1-%E9%9A%94%E7%A6%BB%E6%B5%8B%E8%AF%95%E6%AF%8F%E4%B8%AA%E5%B7%A5%E5%85%B7"><strong>1. 隔离测试每个工具</strong></a></li>
<li><a href="#2-%E6%A8%A1%E5%BC%8F%E9%AA%8C%E8%AF%81%E6%B5%8B%E8%AF%95"><strong>2. 模式验证测试</strong></a></li>
<li><a href="#3-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E6%B5%8B%E8%AF%95"><strong>3. 错误处理测试</strong></a></li>
<li><a href="#%E9%9B%86%E6%88%90%E6%B5%8B%E8%AF%95"><strong>集成测试</strong></a></li>
<li><a href="#1-%E5%B7%A5%E5%85%B7%E9%93%BE%E6%B5%8B%E8%AF%95"><strong>1. 工具链测试</strong></a></li>
<li><a href="#2-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%B5%8B%E8%AF%95"><strong>2. MCP 服务器测试</strong></a></li>
<li><a href="#3-%E7%AB%AF%E5%88%B0%E7%AB%AF%E6%B5%8B%E8%AF%95"><strong>3. 端到端测试</strong></a></li>
<li><a href="#%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95"><strong>性能测试</strong></a></li>
<li><a href="#1-%E8%B4%9F%E8%BD%BD%E6%B5%8B%E8%AF%95"><strong>1. 负载测试</strong></a></li>
<li><a href="#2-%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95"><strong>2. 压力测试</strong></a></li>
<li><a href="#3-%E7%9B%91%E6%8E%A7%E5%92%8C%E5%88%86%E6%9E%90"><strong>3. 监控和分析</strong></a></li>
</ul>
</li>
<li>
<p><a href="#mcp-%E5%B7%A5%E4%BD%9C%E6%B5%81%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><strong>MCP 工作流设计模式</strong></a></p>
<ul>
<li><a href="#1-%E5%B7%A5%E5%85%B7%E9%93%BE%E6%A8%A1%E5%BC%8F"><strong>1. 工具链模式</strong></a></li>
<li><a href="#2-%E8%B0%83%E5%BA%A6%E5%99%A8%E6%A8%A1%E5%BC%8F"><strong>2. 调度器模式</strong></a></li>
<li><a href="#3-%E5%B9%B6%E8%A1%8C%E5%A4%84%E7%90%86%E6%A8%A1%E5%BC%8F"><strong>3. 并行处理模式</strong></a></li>
<li><a href="#4-%E9%94%99%E8%AF%AF%E6%81%A2%E5%A4%8D%E6%A8%A1%E5%BC%8F"><strong>4. 错误恢复模式</strong></a></li>
<li><a href="#5-%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F"><strong>5. 工作流组合模式</strong></a></li>
</ul>
</li>
</ul>
</li>
<li>
<p><a href="#%E6%B5%8B%E8%AF%95-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E5%92%8C%E9%87%8D%E8%A6%81%E6%8F%90%E7%A4%BA"><strong>测试 MCP 服务器：最佳实践和重要提示</strong></a></p>
<ul>
<li>
<p><a href="#%E6%A6%82%E8%BF%B0"><strong>概述</strong></a></p>
</li>
<li>
<p><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E6%B5%8B%E8%AF%95%E5%AF%B9-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%BE%88%E9%87%8D%E8%A6%81"><strong>为什么测试对 MCP 服务器很重要</strong></a></p>
</li>
<li>
<p><a href="#mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"><strong>MCP 服务器的单元测试</strong></a></p>
<ul>
<li><a href="#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E5%9F%BA%E7%A1%80"><strong>单元测试（基础）</strong></a></li>
<li><a href="#%E6%B5%8B%E8%AF%95%E5%86%85%E5%AE%B9"><strong>测试内容</strong></a></li>
<li><a href="#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><strong>单元测试最佳实践</strong></a></li>
<li><a href="#%E9%9B%86%E6%88%90%E6%B5%8B%E8%AF%95%E4%B8%AD%E9%97%B4%E5%B1%82"><strong>集成测试（中间层）</strong></a></li>
<li><a href="#%E6%B5%8B%E8%AF%95%E5%86%85%E5%AE%B9-1"><strong>测试内容</strong></a></li>
<li><a href="#%E9%9B%86%E6%88%90%E6%B5%8B%E8%AF%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><strong>集成测试最佳实践</strong></a></li>
<li><a href="#%E7%AB%AF%E5%88%B0%E7%AB%AF%E6%B5%8B%E8%AF%95%E9%A1%B6%E5%B1%82"><strong>端到端测试（顶层）</strong></a></li>
<li><a href="#%E6%B5%8B%E8%AF%95%E5%86%85%E5%AE%B9-2"><strong>测试内容</strong></a></li>
<li><a href="#e2e-%E6%B5%8B%E8%AF%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><strong>E2E 测试最佳实践</strong></a></li>
</ul>
</li>
<li>
<p><a href="#mcp-%E6%B5%8B%E8%AF%95%E7%9A%84%E6%A8%A1%E6%8B%9F%E7%AD%96%E7%95%A5"><strong>MCP 测试的模拟策略</strong></a></p>
<ul>
<li><a href="#%E8%A6%81%E6%A8%A1%E6%8B%9F%E7%9A%84%E7%BB%84%E4%BB%B6"><strong>要模拟的组件</strong></a></li>
<li><a href="#%E7%A4%BA%E4%BE%8B%E6%A8%A1%E6%8B%9F-ai-%E6%A8%A1%E5%9E%8B%E5%93%8D%E5%BA%94"><strong>示例：模拟 AI 模型响应</strong></a></li>
</ul>
</li>
<li>
<p><a href="#%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95-1"><strong>性能测试</strong></a></p>
<ul>
<li><a href="#%E6%B5%8B%E9%87%8F%E5%86%85%E5%AE%B9"><strong>测量内容</strong></a></li>
<li><a href="#%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7"><strong>性能测试工具</strong></a></li>
<li><a href="#%E7%A4%BA%E4%BE%8B%E4%BD%BF%E7%94%A8-k6-%E8%BF%9B%E8%A1%8C%E5%9F%BA%E6%9C%AC%E8%B4%9F%E8%BD%BD%E6%B5%8B%E8%AF%95"><strong>示例：使用 k6 进行基本负载测试</strong></a></li>
</ul>
</li>
<li>
<p><a href="#mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E6%B5%8B%E8%AF%95%E8%87%AA%E5%8A%A8%E5%8C%96"><strong>MCP 服务器的测试自动化</strong></a></p>
<ul>
<li><a href="#cicd-%E9%9B%86%E6%88%90"><strong>CI/CD 集成</strong></a></li>
<li><a href="#ci-%E7%AE%A1%E9%81%93%E7%A4%BA%E4%BE%8B-github-actions"><strong>CI 管道示例 (GitHub Actions)</strong></a></li>
</ul>
</li>
<li>
<p><a href="#%E6%B5%8B%E8%AF%95%E6%98%AF%E5%90%A6%E7%AC%A6%E5%90%88-mcp-%E8%A7%84%E8%8C%83"><strong>测试是否符合 MCP 规范</strong></a></p>
<ul>
<li><a href="#%E5%85%B3%E9%94%AE%E5%90%88%E8%A7%84%E9%A2%86%E5%9F%9F"><strong>关键合规领域</strong></a></li>
<li><a href="#%E5%90%88%E8%A7%84%E6%80%A7%E6%B5%8B%E8%AF%95%E5%A5%97%E4%BB%B6"><strong>合规性测试套件</strong></a></li>
</ul>
</li>
<li>
<p><a href="#%E6%9C%89%E6%95%88-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%B5%8B%E8%AF%95%E7%9A%84-10-%E5%A4%A7%E6%8A%80%E5%B7%A7"><strong>有效 MCP 服务器测试的 10 大技巧</strong></a></p>
</li>
<li>
<p><a href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E6%B5%8B%E8%AF%95%E9%99%B7%E9%98%B1"><strong>常见的测试陷阱</strong></a></p>
</li>
<li>
<p><a href="#%E7%BB%93%E8%AE%BA"><strong>结论</strong></a></p>
</li>
<li>
<p><a href="#%E5%85%B3%E9%94%AE%E8%A6%81%E7%82%B9-2"><strong>关键要点</strong></a></p>
</li>
</ul>
</li>
<li>
<p><a href="#09-mcp-%E6%A1%88%E4%BE%8B%E7%A0%94%E7%A9%B6"><strong>09-MCP 案例研究</strong></a></p>
<ul>
<li>
<p><a href="#%E7%89%B9%E8%89%B2%E6%A1%88%E4%BE%8B%E7%A0%94%E7%A9%B6"><strong>特色案例研究</strong></a></p>
<ul>
<li><a href="#1azure-ai-%E6%97%85%E8%A1%8C%E7%A4%BE--%E5%8F%82%E8%80%83%E5%AE%9E%E7%8E%B0"><strong>1. Azure AI 旅行社 – 参考实现</strong></a></li>
<li><a href="#2%E4%BB%8E-youtube-%E6%95%B0%E6%8D%AE%E6%9B%B4%E6%96%B0-azure-devops-%E5%B7%A5%E4%BD%9C%E9%A1%B9"><strong>2. 从 YouTube 数据更新 Azure DevOps 工作项</strong></a></li>
<li><a href="#3%E4%BD%BF%E7%94%A8-mcp-%E8%BF%9B%E8%A1%8C%E5%AE%9E%E6%97%B6%E6%96%87%E6%A1%A3%E6%A3%80%E7%B4%A2"><strong>3. 使用 MCP 进行实时文档检索</strong></a></li>
<li><a href="#4%E4%BD%BF%E7%94%A8-mcp-%E7%9A%84%E4%BA%A4%E4%BA%92%E5%BC%8F%E5%AD%A6%E4%B9%A0%E8%AE%A1%E5%88%92%E7%94%9F%E6%88%90%E5%99%A8-web-%E5%BA%94%E7%94%A8"><strong>4. 使用 MCP 的交互式学习计划生成器 Web 应用</strong></a></li>
<li><a href="#5%E5%9C%A8-vs-code-%E4%B8%AD%E4%BD%BF%E7%94%A8-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E7%BC%96%E8%BE%91%E5%99%A8%E5%86%85%E6%96%87%E6%A1%A3"><strong>5. 在 VS Code 中使用 MCP 服务器的编辑器内文档</strong></a></li>
<li><a href="#6%E5%88%9B%E5%BB%BA-apim-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8"><strong>6. 创建 APIM MCP 服务器</strong></a></li>
</ul>
</li>
<li>
<p><a href="#%E7%BB%93%E8%AE%BA-1"><strong>结论</strong></a></p>
</li>
</ul>
</li>
<li>
<p><a href="#10-%E7%AE%80%E5%8C%96-ai-%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E4%BD%BF%E7%94%A8-ai-%E5%B7%A5%E5%85%B7%E5%8C%85%E6%9E%84%E5%BB%BA-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8"><strong>10-简化 AI 工作流程：使用 AI 工具包构建 MCP 服务器</strong></a></p>
<ul>
<li>
<p><a href="#lab-1">Lab-1</a></p>
<ul>
<li><a href="#-ai-%E5%B7%A5%E5%85%B7%E5%8C%85-aitk-%E7%AE%80%E4%BB%8B"><strong>🧠 AI 工具包 (AITK) 简介</strong></a></li>
<li><a href="#-%E5%85%B3%E9%94%AE%E5%8A%9F%E8%83%BD"><strong>🌟 关键功能</strong></a></li>
<li><a href="#-ai-%E5%B7%A5%E5%85%B7%E5%8C%85%E4%B8%BA%E4%BD%95%E9%87%8D%E8%A6%81"><strong>🎯 AI 工具包为何重要</strong></a></li>
<li><a href="#%EF%B8%8F-%E5%85%88%E5%86%B3%E6%9D%A1%E4%BB%B6%E5%92%8C%E8%AE%BE%E7%BD%AE"><strong>🛠️ 先决条件和设置</strong></a></li>
<li><a href="#-%E5%AE%89%E8%A3%85-ai-%E5%B7%A5%E5%85%B7%E5%8C%85%E6%89%A9%E5%B1%95"><strong>📦 安装 AI 工具包扩展</strong></a></li>
<li><a href="#-%E5%8A%A8%E6%89%8B%E7%BB%83%E4%B9%A0-1%E6%8E%A2%E7%B4%A2-github-%E6%A8%A1%E5%9E%8B"><strong>🧪 动手练习 1：探索 GitHub 模型</strong></a></li>
<li><a href="#-%E6%AD%A5%E9%AA%A4-1%E6%B5%8F%E8%A7%88%E6%A8%A1%E5%9E%8B%E7%9B%AE%E5%BD%95"><strong>📊 步骤 1：浏览模型目录</strong></a></li>
<li><a href="#-%E6%AD%A5%E9%AA%A4-2%E6%B7%BB%E5%8A%A0%E5%92%8C%E9%85%8D%E7%BD%AE%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA%E6%A8%A1%E5%9E%8B"><strong>🚀 步骤 2：添加和配置的第一个模型</strong></a></li>
<li><a href="#-%E6%AD%A5%E9%AA%A4-3%E6%8E%8C%E6%8F%A1-playground-%E7%95%8C%E9%9D%A2"><strong>🎯 步骤 3：掌握 Playground 界面</strong></a></li>
<li><a href="#-%E6%8C%91%E6%88%98%E7%BB%83%E4%B9%A0%E6%A8%A1%E5%9E%8B%E6%80%A7%E8%83%BD%E6%AF%94%E8%BE%83"><strong>🏆 挑战练习：模型性能比较</strong></a></li>
</ul>
</li>
<li>
<p><a href="#-%E5%8A%A8%E6%89%8B%E7%BB%83%E4%B9%A0-2%E4%BD%BF%E7%94%A8-agent-builder-%E6%9E%84%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BB%A3%E7%90%86"><strong>🤖 动手练习 2：使用 Agent Builder 构建自定义代理</strong></a></p>
<ul>
<li><a href="#%EF%B8%8F-%E6%AD%A5%E9%AA%A4-1%E7%90%86%E8%A7%A3-agent-builder"><strong>🏗️ 步骤 1：理解 Agent Builder</strong></a></li>
<li><a href="#%EF%B8%8F-%E6%AD%A5%E9%AA%A4-2%E4%BB%A3%E7%90%86%E9%85%8D%E7%BD%AE%E6%B7%B1%E5%85%A5%E6%8E%A2%E8%AE%A8"><strong>⚙️ 步骤 2：代理配置深入探讨</strong></a></li>
<li><a href="#-%E6%AD%A5%E9%AA%A4-3%E5%AE%9E%E8%B7%B5%E7%BB%83%E4%B9%A0---python-%E7%BC%96%E7%A8%8B%E4%BB%A3%E7%90%86"><strong>🐍 步骤 3：实践练习 - Python 编程代理</strong></a></li>
<li><a href="#-%E6%AD%A5%E9%AA%A4-4%E6%B5%8B%E8%AF%95%E7%9A%84-python-%E4%BB%A3%E7%90%86"><strong>🧪 步骤 4：测试的 Python 代理</strong></a></li>
</ul>
</li>
<li>
<p><a href="#lab-2">Lab-2</a></p>
</li>
<li>
<p><a href="#-%E7%90%86%E8%A7%A3%E6%A8%A1%E5%9E%8B%E4%B8%8A%E4%B8%8B%E6%96%87%E5%8D%8F%E8%AE%AE-mcp"><strong>🧠 理解模型上下文协议 (MCP)</strong></a></p>
<ul>
<li><a href="#-%E4%BB%80%E4%B9%88%E6%98%AF-mcp"><strong>🔍 什么是 MCP？</strong></a></li>
<li><a href="#-mcp-%E8%A7%A3%E5%86%B3%E7%9A%84%E9%97%AE%E9%A2%98"><strong>🎯 MCP 解决的问题</strong></a></li>
<li><a href="#%EF%B8%8F-mcp-%E6%9E%B6%E6%9E%84%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90"><strong>🏗️ MCP 架构深入解析</strong></a></li>
</ul>
</li>
<li>
<p><a href="#-%E5%BE%AE%E8%BD%AF%E7%9A%84-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%94%9F%E6%80%81%E7%B3%BB%E7%BB%9F"><strong>🏢 微软的 MCP 服务器生态系统</strong></a></p>
<ul>
<li><a href="#-%E7%89%B9%E8%89%B2%E7%9A%84%E5%BE%AE%E8%BD%AF-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8"><strong>🌟 特色的微软 MCP 服务器</strong></a></li>
<li><a href="#1-%EF%B8%8F-azure-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8"><strong>1. ☁️ Azure MCP 服务器</strong></a></li>
<li><a href="#2--microsoft-dataverse-mcp"><strong>2. 📊 Microsoft Dataverse MCP</strong></a></li>
<li><a href="#3--playwright-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8"><strong>3. 🌐 Playwright MCP 服务器</strong></a></li>
<li><a href="#4--%E6%96%87%E4%BB%B6-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8"><strong>4. 📁 文件 MCP 服务器</strong></a></li>
<li><a href="#5--markitdown-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8"><strong>5. 📝 MarkItDown MCP 服务器</strong></a></li>
<li><a href="#6--clarity-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8"><strong>6. 📈 Clarity MCP 服务器</strong></a></li>
<li><a href="#-%E7%A4%BE%E5%8C%BA%E7%94%9F%E6%80%81%E7%B3%BB%E7%BB%9F"><strong>🌍 社区生态系统</strong></a></li>
</ul>
</li>
<li>
<p><a href="#%EF%B8%8F-%E5%8A%A8%E6%89%8B%E5%AE%9E%E9%AA%8C%E6%9E%84%E5%BB%BA%E6%B5%8F%E8%A7%88%E5%99%A8%E8%87%AA%E5%8A%A8%E5%8C%96%E4%BB%A3%E7%90%86"><strong>🛠️ 动手实验：构建浏览器自动化代理</strong></a></p>
<ul>
<li><a href="#-%E9%98%B6%E6%AE%B5-1%E4%BB%A3%E7%90%86%E5%9F%BA%E7%A1%80%E8%AE%BE%E7%BD%AE"><strong>🚀 阶段 1：代理基础设置</strong></a></li>
<li><a href="#%E6%AD%A5%E9%AA%A4-1%E5%88%9D%E5%A7%8B%E5%8C%96%E7%9A%84%E4%BB%A3%E7%90%86"><strong>步骤 1：初始化的代理</strong></a></li>
<li><a href="#-%E9%98%B6%E6%AE%B5-2mcp-%E9%9B%86%E6%88%90%E5%B7%A5%E4%BD%9C%E6%B5%81"><strong>🔧 阶段 2：MCP 集成工作流</strong></a></li>
<li><a href="#%E6%AD%A5%E9%AA%A4-3%E6%B7%BB%E5%8A%A0-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%9B%86%E6%88%90"><strong>步骤 3：添加 MCP 服务器集成</strong></a></li>
<li><a href="#%E6%AD%A5%E9%AA%A4-4mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%80%89%E6%8B%A9"><strong>步骤 4：MCP 服务器选择</strong></a></li>
<li><a href="#-%E9%98%B6%E6%AE%B5-3playwright-mcp-%E9%85%8D%E7%BD%AE"><strong>🎮 阶段 3：Playwright MCP 配置</strong></a></li>
<li><a href="#%E6%AD%A5%E9%AA%A4-5%E9%80%89%E6%8B%A9%E5%92%8C%E9%85%8D%E7%BD%AE-playwright"><strong>步骤 5：选择和配置 Playwright</strong></a></li>
<li><a href="#%E6%AD%A5%E9%AA%A4-6%E5%90%AF%E7%94%A8-playwright-%E5%8A%9F%E8%83%BD"><strong>步骤 6：启用 Playwright 功能</strong></a></li>
<li><a href="#%E6%AD%A5%E9%AA%A4-7%E9%AA%8C%E8%AF%81%E9%9B%86%E6%88%90%E6%88%90%E5%8A%9F"><strong>步骤 7：验证集成成功</strong></a></li>
<li><a href="#-%E9%98%B6%E6%AE%B5-4%E9%AB%98%E7%BA%A7%E6%8F%90%E7%A4%BA%E5%B7%A5%E7%A8%8B"><strong>🎯 阶段 4：高级提示工程</strong></a></li>
<li><a href="#%E6%AD%A5%E9%AA%A4-8%E8%AE%BE%E8%AE%A1%E6%99%BA%E8%83%BD%E7%B3%BB%E7%BB%9F%E6%8F%90%E7%A4%BA"><strong>步骤 8：设计智能系统提示</strong></a></li>
<li><a href="#%E6%AD%A5%E9%AA%A4-9%E5%88%9B%E5%BB%BA%E5%8A%A8%E6%80%81%E7%94%A8%E6%88%B7%E6%8F%90%E7%A4%BA"><strong>步骤 9：创建动态用户提示</strong></a></li>
<li><a href="#-%E9%98%B6%E6%AE%B5-5%E6%89%A7%E8%A1%8C%E5%92%8C%E6%B5%8B%E8%AF%95"><strong>🚀 阶段 5：执行和测试</strong></a></li>
<li><a href="#%E6%AD%A5%E9%AA%A4-10%E6%89%A7%E8%A1%8C%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA%E8%87%AA%E5%8A%A8%E5%8C%96"><strong>步骤 10：执行的第一个自动化</strong></a></li>
<li><a href="#%E6%AD%A5%E9%AA%A4-11%E5%88%86%E6%9E%90%E7%BB%93%E6%9E%9C%E5%92%8C%E8%A7%81%E8%A7%A3"><strong>步骤 11：分析结果和见解</strong></a></li>
<li><a href="#-%E9%98%B6%E6%AE%B5-6%E9%AB%98%E7%BA%A7%E5%8A%9F%E8%83%BD%E5%92%8C%E9%83%A8%E7%BD%B2"><strong>🌟 阶段 6：高级功能和部署</strong></a></li>
<li><a href="#%E6%AD%A5%E9%AA%A4-12%E5%AF%BC%E5%87%BA%E5%92%8C%E7%94%9F%E4%BA%A7%E9%83%A8%E7%BD%B2"><strong>步骤 12：导出和生产部署</strong></a></li>
</ul>
</li>
<li>
<p><a href="#-%E6%A8%A1%E5%9D%97-2-%E6%80%BB%E7%BB%93%E4%B8%8E%E5%90%8E%E7%BB%AD%E6%AD%A5%E9%AA%A4"><strong>🎓 模块 2 总结与后续步骤</strong></a></p>
<ul>
<li><a href="#-%E6%88%90%E5%B0%B1%E8%A7%A3%E9%94%81mcp-%E9%9B%86%E6%88%90%E5%A4%A7%E5%B8%88"><strong>🏆 成就解锁：MCP 集成大师</strong></a></li>
</ul>
</li>
<li>
<p><a href="#lab-3">Lab-3</a></p>
</li>
<li>
<p><a href="#-%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6%E6%A6%82%E8%BF%B0"><strong>🔧 核心组件概述</strong></a></p>
<ul>
<li><a href="#-mcp-python-sdk"><strong>🐍 MCP Python SDK</strong></a></li>
<li><a href="#-mcp-%E6%A3%80%E6%9F%A5%E5%99%A8"><strong>🔍 MCP 检查器</strong></a></li>
</ul>
</li>
<li>
<p><a href="#-%E5%88%86%E6%AD%A5%E5%AE%9E%E6%96%BD"><strong>📖 分步实施</strong></a></p>
<ul>
<li><a href="#%E6%AD%A5%E9%AA%A4-1%E5%9C%A8-agent-builder-%E4%B8%AD%E5%88%9B%E5%BB%BA-weatheragent"><strong>步骤 1：在 Agent Builder 中创建 WeatherAgent</strong></a></li>
<li><a href="#%E6%AD%A5%E9%AA%A4-2%E5%88%9D%E5%A7%8B%E5%8C%96-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%A1%B9%E7%9B%AE"><strong>步骤 2：初始化 MCP 服务器项目</strong></a></li>
<li><a href="#%E6%AD%A5%E9%AA%A4-3%E6%89%93%E5%BC%80%E5%B9%B6%E6%A3%80%E6%9F%A5%E9%A1%B9%E7%9B%AE"><strong>步骤 3：打开并检查项目</strong></a></li>
<li><a href="#%E6%AD%A5%E9%AA%A4-4%E5%8D%87%E7%BA%A7%E5%88%B0%E6%9C%80%E6%96%B0%E7%9A%84-mcp-sdk"><strong>步骤 4：升级到最新的 MCP SDK</strong></a></li>
<li><a href="#4a-%E6%9B%B4%E6%96%B0-python-%E4%BE%9D%E8%B5%96%E9%A1%B9"><strong>4a. 更新 Python 依赖项</strong></a></li>
<li><a href="#4b-%E6%9B%B4%E6%96%B0-inspector-%E9%85%8D%E7%BD%AE"><strong>4b. 更新 Inspector 配置</strong></a></li>
<li><a href="#4c-%E6%9B%B4%E6%96%B0-inspector-%E4%BE%9D%E8%B5%96%E9%A1%B9"><strong>4c. 更新 Inspector 依赖项</strong></a></li>
<li><a href="#%E6%AD%A5%E9%AA%A4-5%E9%85%8D%E7%BD%AE-vs-code-%E8%B0%83%E8%AF%95"><strong>步骤 5：配置 VS Code 调试</strong></a></li>
<li><a href="#5a-%E6%9B%B4%E6%96%B0%E5%90%AF%E5%8A%A8%E9%85%8D%E7%BD%AE"><strong>5a. 更新启动配置</strong></a></li>
</ul>
</li>
<li>
<p><a href="#-%E8%BF%90%E8%A1%8C%E5%92%8C%E6%B5%8B%E8%AF%95%E7%9A%84-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8"><strong>🚀 运行和测试的 MCP 服务器</strong></a></p>
<ul>
<li><a href="#%E6%AD%A5%E9%AA%A4-6%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96%E9%A1%B9"><strong>步骤 6：安装依赖项</strong></a></li>
<li><a href="#%E6%AD%A5%E9%AA%A4-7%E4%BD%BF%E7%94%A8-agent-builder-%E8%BF%9B%E8%A1%8C%E8%B0%83%E8%AF%95"><strong>步骤 7：使用 Agent Builder 进行调试</strong></a></li>
<li><a href="#%E6%AD%A5%E9%AA%A4-8%E4%BD%BF%E7%94%A8-mcp-inspector-%E8%BF%9B%E8%A1%8C%E8%B0%83%E8%AF%95"><strong>步骤 8：使用 MCP Inspector 进行调试</strong></a></li>
</ul>
</li>
<li>
<p><a href="#-%E4%B8%BB%E8%A6%81%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C"><strong>🎯 主要学习成果</strong></a></p>
</li>
<li>
<p><a href="#lab-4">Lab-4</a></p>
</li>
<li>
<p><a href="#%EF%B8%8F-%E9%A1%B9%E7%9B%AE%E6%A6%82%E8%BF%B0"><strong>🏗️ 项目概述</strong></a></p>
<ul>
<li><a href="#%E7%9C%9F%E5%AE%9E%E4%B8%96%E7%95%8C%E7%9A%84%E5%BC%80%E5%8F%91%E6%8C%91%E6%88%98"><strong>真实世界的开发挑战</strong></a></li>
<li><a href="#%E5%B0%86%E6%9E%84%E5%BB%BA%E4%BB%80%E4%B9%88"><strong>将构建什么</strong></a></li>
</ul>
</li>
<li>
<p><a href="#-%E5%88%86%E6%AD%A5%E5%AE%9E%E6%96%BD-1"><strong>📖 分步实施</strong></a></p>
<ul>
<li><a href="#%E6%AD%A5%E9%AA%A4-1%E5%9C%A8-agent-builder-%E4%B8%AD%E5%88%9B%E5%BB%BA-github-%E4%BB%A3%E7%90%86"><strong>步骤 1：在 Agent Builder 中创建 GitHub 代理</strong></a></li>
<li><a href="#%E6%AD%A5%E9%AA%A4-2%E9%85%8D%E7%BD%AE-github-copilot-%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F"><strong>步骤 2：配置 GitHub Copilot 代理模式</strong></a></li>
<li><a href="#%E6%AD%A5%E9%AA%A4-3%E5%AE%9E%E7%8E%B0%E6%A0%B8%E5%BF%83-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8A%9F%E8%83%BD"><strong>步骤 3：实现核心 MCP 服务器功能</strong></a></li>
<li><a href="#%E6%AD%A5%E9%AA%A4-4%E6%B5%8B%E8%AF%95%E7%9A%84-mcp-%E6%9C%8D%E5%8A%A1%E5%99%A8"><strong>步骤 4：测试的 MCP 服务器</strong></a></li>
<li><a href="#4a-%E5%9C%A8-agent-builder-%E4%B8%AD%E6%B5%8B%E8%AF%95"><strong>4a. 在 Agent Builder 中测试</strong></a></li>
<li><a href="#4b-%E5%9C%A8-mcp-%E6%A3%80%E6%9F%A5%E5%99%A8%E4%B8%AD%E6%B5%8B%E8%AF%95"><strong>4b. 在 MCP 检查器中测试</strong></a></li>
<li><a href="#-%E6%88%90%E5%B0%B1%E8%A7%A3%E9%94%81"><strong>🏆 成就解锁：</strong></a></li>
</ul>
</li>
<li>
<p><a href="#-%E7%A0%94%E8%AE%A8%E4%BC%9A%E5%AE%8C%E6%88%90%E7%9A%84%E6%A8%A1%E5%9E%8B%E4%B8%8A%E4%B8%8B%E6%96%87%E5%8D%8F%E8%AE%AE%E4%B9%8B%E6%97%85"><strong>🎓 研讨会完成：的模型上下文协议之旅</strong></a></p>
<ul>
<li><a href="#-%E7%9A%84%E5%AD%A6%E4%B9%A0%E8%B7%AF%E5%BE%84%E5%9B%9E%E9%A1%BE"><strong>🚀 的学习路径回顾：</strong></a></li>
</ul>
</li>
</ul>
</li>
</ul></div></div></div></div><footer class="text-center py-4 mt-8 border-t">© 2025 · Built with Gatsby</footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2025-07-12-mcp-for-beginners/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-ec515adc39aa7430d310.js\"],\"component---src-pages-404-js\":[\"/component---src-pages-404-js-051f7e1a395ea4ec2b2a.js\"],\"component---src-pages-about-js\":[\"/component---src-pages-about-js-093de8076e2cf835e1d3.js\"],\"component---src-pages-index-js\":[\"/component---src-pages-index-js-c34369a01a85b628d9ac.js\"],\"component---src-pages-links-js\":[\"/component---src-pages-links-js-7666f811b66803f137c5.js\"],\"component---src-pages-tags-js\":[\"/component---src-pages-tags-js-512d381bd81244b1af9c.js\"],\"component---src-pages-using-ssr-js\":[\"/component---src-pages-using-ssr-js-005fd2817f4487ca3dc9.js\"],\"component---src-templates-blog-list-js\":[\"/component---src-templates-blog-list-js-5fadf6a59ac6c5cfa4ee.js\"],\"component---src-templates-blog-post-js\":[\"/component---src-templates-blog-post-js-9498a20d0ef2eefd61ce.js\"],\"component---src-templates-tags-js\":[\"/component---src-templates-tags-js-13eab85942606ca6630c.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="7d877e823468a4de5503";</script><script src="/webpack-runtime-7789ddc4cd9085cabb24.js" async></script><script src="/framework-6a525285796fb83f2864.js" async></script><script src="/app-ec515adc39aa7430d310.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>